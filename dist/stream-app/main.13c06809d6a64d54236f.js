(self.webpackChunkstream_app=self.webpackChunkstream_app||[]).push([[179],{255:Xs=>{function tr(Js){return Promise.resolve().then(()=>{var nr=new Error("Cannot find module '"+Js+"'");throw nr.code="MODULE_NOT_FOUND",nr})}tr.keys=()=>[],tr.resolve=tr,tr.id=255,Xs.exports=tr},370:(Xs,tr,Js)=>{"use strict";function nr(n){return"function"==typeof n}let Al=!1;const Zt={Promise:void 0,set useDeprecatedSynchronousErrorHandling(n){if(n){const e=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+e.stack)}else Al&&console.log("RxJS: Back to a better error behavior. Thank you. <3");Al=n},get useDeprecatedSynchronousErrorHandling(){return Al}};function Yr(n){setTimeout(()=>{throw n},0)}const yo={closed:!0,next(n){},error(n){if(Zt.useDeprecatedSynchronousErrorHandling)throw n;Yr(n)},complete(){}},Kv=Array.isArray||(n=>n&&"number"==typeof n.length);function th(n){return null!==n&&"object"==typeof n}const Eo=(()=>{function n(e){return Error.call(this),this.message=e?`${e.length} errors occurred during unsubscription:\n${e.map((t,r)=>`${r+1}) ${t.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=e,this}return n.prototype=Object.create(Error.prototype),n})();class Ne{constructor(e){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,e&&(this._ctorUnsubscribe=!0,this._unsubscribe=e)}unsubscribe(){let e;if(this.closed)return;let{_parentOrParents:t,_ctorUnsubscribe:r,_unsubscribe:s,_subscriptions:i}=this;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,t instanceof Ne)t.remove(this);else if(null!==t)for(let o=0;o<t.length;++o)t[o].remove(this);if(nr(s)){r&&(this._unsubscribe=void 0);try{s.call(this)}catch(o){e=o instanceof Eo?nh(o.errors):[o]}}if(Kv(i)){let o=-1,a=i.length;for(;++o<a;){const l=i[o];if(th(l))try{l.unsubscribe()}catch(c){e=e||[],c instanceof Eo?e=e.concat(nh(c.errors)):e.push(c)}}}if(e)throw new Eo(e)}add(e){let t=e;if(!e)return Ne.EMPTY;switch(typeof e){case"function":t=new Ne(e);case"object":if(t===this||t.closed||"function"!=typeof t.unsubscribe)return t;if(this.closed)return t.unsubscribe(),t;if(!(t instanceof Ne)){const i=t;t=new Ne,t._subscriptions=[i]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}let{_parentOrParents:r}=t;if(null===r)t._parentOrParents=this;else if(r instanceof Ne){if(r===this)return t;t._parentOrParents=[r,this]}else{if(-1!==r.indexOf(this))return t;r.push(this)}const s=this._subscriptions;return null===s?this._subscriptions=[t]:s.push(t),t}remove(e){const t=this._subscriptions;if(t){const r=t.indexOf(e);-1!==r&&t.splice(r,1)}}}var n;function nh(n){return n.reduce((e,t)=>e.concat(t instanceof Eo?t.errors:t),[])}Ne.EMPTY=((n=new Ne).closed=!0,n);const To="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random();class vt extends Ne{constructor(e,t,r){switch(super(),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=yo;break;case 1:if(!e){this.destination=yo;break}if("object"==typeof e){e instanceof vt?(this.syncErrorThrowable=e.syncErrorThrowable,this.destination=e,e.add(this)):(this.syncErrorThrowable=!0,this.destination=new rh(this,e));break}default:this.syncErrorThrowable=!0,this.destination=new rh(this,e,t,r)}}[To](){return this}static create(e,t,r){const s=new vt(e,t,r);return s.syncErrorThrowable=!1,s}next(e){this.isStopped||this._next(e)}error(e){this.isStopped||(this.isStopped=!0,this._error(e))}complete(){this.isStopped||(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe())}_next(e){this.destination.next(e)}_error(e){this.destination.error(e),this.unsubscribe()}_complete(){this.destination.complete(),this.unsubscribe()}_unsubscribeAndRecycle(){const{_parentOrParents:e}=this;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this}}class rh extends vt{constructor(e,t,r,s){super(),this._parentSubscriber=e;let i,o=this;nr(t)?i=t:t&&(i=t.next,r=t.error,s=t.complete,t!==yo&&(o=Object.create(t),nr(o.unsubscribe)&&this.add(o.unsubscribe.bind(o)),o.unsubscribe=this.unsubscribe.bind(this))),this._context=o,this._next=i,this._error=r,this._complete=s}next(e){if(!this.isStopped&&this._next){const{_parentSubscriber:t}=this;Zt.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}}error(e){if(!this.isStopped){const{_parentSubscriber:t}=this,{useDeprecatedSynchronousErrorHandling:r}=Zt;if(this._error)r&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)r?(t.syncErrorValue=e,t.syncErrorThrown=!0):Yr(e),this.unsubscribe();else{if(this.unsubscribe(),r)throw e;Yr(e)}}}complete(){if(!this.isStopped){const{_parentSubscriber:e}=this;if(this._complete){const t=()=>this._complete.call(this._context);Zt.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,t),this.unsubscribe()):(this.__tryOrUnsub(t),this.unsubscribe())}else this.unsubscribe()}}__tryOrUnsub(e,t){try{e.call(this._context,t)}catch(r){if(this.unsubscribe(),Zt.useDeprecatedSynchronousErrorHandling)throw r;Yr(r)}}__tryOrSetError(e,t,r){if(!Zt.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,r)}catch(s){return Zt.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=s,e.syncErrorThrown=!0,!0):(Yr(s),!0)}return!1}_unsubscribe(){const{_parentSubscriber:e}=this;this._context=null,this._parentSubscriber=null,e.unsubscribe()}}const Zs="function"==typeof Symbol&&Symbol.observable||"@@observable";function sh(n){return n}let dt=(()=>{class n{constructor(t){this._isScalar=!1,t&&(this._subscribe=t)}lift(t){const r=new n;return r.source=this,r.operator=t,r}subscribe(t,r,s){const{operator:i}=this,o=function(n,e,t){if(n){if(n instanceof vt)return n;if(n[To])return n[To]()}return n||e||t?new vt(n,e,t):new vt(yo)}(t,r,s);if(o.add(i?i.call(o,this.source):this.source||Zt.useDeprecatedSynchronousErrorHandling&&!o.syncErrorThrowable?this._subscribe(o):this._trySubscribe(o)),Zt.useDeprecatedSynchronousErrorHandling&&o.syncErrorThrowable&&(o.syncErrorThrowable=!1,o.syncErrorThrown))throw o.syncErrorValue;return o}_trySubscribe(t){try{return this._subscribe(t)}catch(r){Zt.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=r),function(n){for(;n;){const{closed:e,destination:t,isStopped:r}=n;if(e||r)return!1;n=t&&t instanceof vt?t:null}return!0}(t)?t.error(r):console.warn(r)}}forEach(t,r){return new(r=oh(r))((s,i)=>{let o;o=this.subscribe(a=>{try{t(a)}catch(l){i(l),o&&o.unsubscribe()}},i,s)})}_subscribe(t){const{source:r}=this;return r&&r.subscribe(t)}[Zs](){return this}pipe(...t){return 0===t.length?this:function(n){return 0===n.length?sh:1===n.length?n[0]:function(t){return n.reduce((r,s)=>s(r),t)}}(t)(this)}toPromise(t){return new(t=oh(t))((r,s)=>{let i;this.subscribe(o=>i=o,o=>s(o),()=>r(i))})}}return n.create=e=>new n(e),n})();function oh(n){if(n||(n=Zt.Promise||Promise),!n)throw new Error("no Promise impl found");return n}const ei=(()=>{function n(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return n.prototype=Object.create(Error.prototype),n})();class qv extends Ne{constructor(e,t){super(),this.subject=e,this.subscriber=t,this.closed=!1}unsubscribe(){if(this.closed)return;this.closed=!0;const e=this.subject,t=e.observers;if(this.subject=null,!t||0===t.length||e.isStopped||e.closed)return;const r=t.indexOf(this.subscriber);-1!==r&&t.splice(r,1)}}class ah extends vt{constructor(e){super(e),this.destination=e}}let wl=(()=>{class n extends dt{constructor(){super(),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}[To](){return new ah(this)}lift(t){const r=new lh(this,this);return r.operator=t,r}next(t){if(this.closed)throw new ei;if(!this.isStopped){const{observers:r}=this,s=r.length,i=r.slice();for(let o=0;o<s;o++)i[o].next(t)}}error(t){if(this.closed)throw new ei;this.hasError=!0,this.thrownError=t,this.isStopped=!0;const{observers:r}=this,s=r.length,i=r.slice();for(let o=0;o<s;o++)i[o].error(t);this.observers.length=0}complete(){if(this.closed)throw new ei;this.isStopped=!0;const{observers:t}=this,r=t.length,s=t.slice();for(let i=0;i<r;i++)s[i].complete();this.observers.length=0}unsubscribe(){this.isStopped=!0,this.closed=!0,this.observers=null}_trySubscribe(t){if(this.closed)throw new ei;return super._trySubscribe(t)}_subscribe(t){if(this.closed)throw new ei;return this.hasError?(t.error(this.thrownError),Ne.EMPTY):this.isStopped?(t.complete(),Ne.EMPTY):(this.observers.push(t),new qv(this,t))}asObservable(){const t=new dt;return t.source=this,t}}return n.create=(e,t)=>new lh(e,t),n})();class lh extends wl{constructor(e,t){super(),this.destination=e,this.source=t}next(e){const{destination:t}=this;t&&t.next&&t.next(e)}error(e){const{destination:t}=this;t&&t.error&&this.destination.error(e)}complete(){const{destination:e}=this;e&&e.complete&&this.destination.complete()}_subscribe(e){const{source:t}=this;return t?this.source.subscribe(e):Ne.EMPTY}}function ch(n){return n&&"function"==typeof n.schedule}function ti(n,e){return function(r){if("function"!=typeof n)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return r.lift(new zv(n,e))}}class zv{constructor(e,t){this.project=e,this.thisArg=t}call(e,t){return t.subscribe(new Qv(e,this.project,this.thisArg))}}class Qv extends vt{constructor(e,t,r){super(e),this.project=t,this.count=0,this.thisArg=r||this}_next(e){let t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(r){return void this.destination.error(r)}this.destination.next(t)}}const uh=n=>e=>{for(let t=0,r=n.length;t<r&&!e.closed;t++)e.next(n[t]);e.complete()},Do="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator",dh=n=>n&&"number"==typeof n.length&&"function"!=typeof n;function fh(n){return!!n&&"function"!=typeof n.subscribe&&"function"==typeof n.then}const hh=n=>{if(n&&"function"==typeof n[Zs])return(n=>e=>{const t=n[Zs]();if("function"!=typeof t.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return t.subscribe(e)})(n);if(dh(n))return uh(n);if(fh(n))return(n=>e=>(n.then(t=>{e.closed||(e.next(t),e.complete())},t=>e.error(t)).then(null,Yr),e))(n);if(n&&"function"==typeof n[Do])return(n=>e=>{const t=n[Do]();for(;;){let r;try{r=t.next()}catch(s){return e.error(s),e}if(r.done){e.complete();break}if(e.next(r.value),e.closed)break}return"function"==typeof t.return&&e.add(()=>{t.return&&t.return()}),e})(n);{const t=`You provided ${th(n)?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.`;throw new TypeError(t)}};function Rl(n,e){return new dt(t=>{const r=new Ne;let s=0;return r.add(e.schedule(function(){s!==n.length?(t.next(n[s++]),t.closed||r.add(this.schedule())):t.complete()})),r})}class l_ extends vt{constructor(e){super(),this.parent=e}_next(e){this.parent.notifyNext(e)}_error(e){this.parent.notifyError(e),this.unsubscribe()}_complete(){this.parent.notifyComplete(),this.unsubscribe()}}class c_ extends vt{notifyNext(e){this.destination.next(e)}notifyError(e){this.destination.error(e)}notifyComplete(){this.destination.complete()}}function Ll(n,e,t=Number.POSITIVE_INFINITY){return"function"==typeof e?r=>r.pipe(Ll((s,i)=>function(n,e){return n instanceof dt?n:new dt(hh(n))}(n(s,i)).pipe(ti((o,a)=>e(s,o,i,a))),t)):("number"==typeof e&&(t=e),r=>r.lift(new d_(n,t)))}class d_{constructor(e,t=Number.POSITIVE_INFINITY){this.project=e,this.concurrent=t}call(e,t){return t.subscribe(new f_(e,this.project,this.concurrent))}}class f_ extends c_{constructor(e,t,r=Number.POSITIVE_INFINITY){super(e),this.project=t,this.concurrent=r,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}_next(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)}_tryNext(e){let t;const r=this.index++;try{t=this.project(e,r)}catch(s){return void this.destination.error(s)}this.active++,this._innerSub(t)}_innerSub(e){const t=new l_(this),r=this.destination;r.add(t);const s=function(n,e){if(e.closed)return;if(n instanceof dt)return n.subscribe(e);let t;try{t=hh(n)(e)}catch(r){e.error(r)}return t}(e,t);s!==t&&r.add(s)}_complete(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()}notifyNext(e){this.destination.next(e)}notifyComplete(){const e=this.buffer;this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()}}function ph(n,e){return e?Rl(n,e):new dt(uh(n))}function gh(){return function(e){return e.lift(new g_(e))}}class g_{constructor(e){this.connectable=e}call(e,t){const{connectable:r}=this;r._refCount++;const s=new m_(e,r),i=t.subscribe(s);return s.closed||(s.connection=r.connect()),i}}class m_ extends vt{constructor(e,t){super(e),this.connectable=t}_unsubscribe(){const{connectable:e}=this;if(!e)return void(this.connection=null);this.connectable=null;const t=e._refCount;if(t<=0)return void(this.connection=null);if(e._refCount=t-1,t>1)return void(this.connection=null);const{connection:r}=this,s=e._connection;this.connection=null,s&&(!r||s===r)&&s.unsubscribe()}}class y_ extends dt{constructor(e,t){super(),this.source=e,this.subjectFactory=t,this._refCount=0,this._isComplete=!1}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){const e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}connect(){let e=this._connection;return e||(this._isComplete=!1,e=this._connection=new Ne,e.add(this.source.subscribe(new T_(this.getSubject(),this))),e.closed&&(this._connection=null,e=Ne.EMPTY)),e}refCount(){return gh()(this)}}const E_=(()=>{const n=y_.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:n._subscribe},_isComplete:{value:n._isComplete,writable:!0},getSubject:{value:n.getSubject},connect:{value:n.connect},refCount:{value:n.refCount}}})();class T_ extends ah{constructor(e,t){super(e),this.connectable=t}_error(e){this._unsubscribe(),super._error(e)}_complete(){this.connectable._isComplete=!0,this._unsubscribe(),super._complete()}_unsubscribe(){const e=this.connectable;if(e){this.connectable=null;const t=e._connection;e._refCount=0,e._subject=null,e._connection=null,t&&t.unsubscribe()}}}function x_(){return new wl}function le(n){for(let e in n)if(n[e]===le)return e;throw Error("Could not find renamed property on target object.")}function ee(n){if("string"==typeof n)return n;if(Array.isArray(n))return"["+n.map(ee).join(", ")+"]";if(null==n)return""+n;if(n.overriddenName)return`${n.overriddenName}`;if(n.name)return`${n.name}`;const e=n.toString();if(null==e)return""+e;const t=e.indexOf("\n");return-1===t?e:e.substring(0,t)}function Pl(n,e){return null==n||""===n?null===e?"":e:null==e||""===e?n:n+" "+e}const b_=le({__forward_ref__:le});function Fl(n){return n.__forward_ref__=Fl,n.toString=function(){return ee(this())},n}function B(n){return function(n){return"function"==typeof n&&n.hasOwnProperty(b_)&&n.__forward_ref__===Fl}(n)?n():n}class rr extends Error{constructor(e,t){super(function(n,e){return`${n?`NG0${n}: `:""}${e}`}(e,t)),this.code=e}}function ft(n){return"function"==typeof n?n.name||n.toString():"object"==typeof n&&null!=n&&"function"==typeof n.type?n.type.name||n.type.toString():function(n){return"string"==typeof n?n:null==n?"":String(n)}(n)}function vo(n,e){const t=e?` in ${e}`:"";throw new rr("201",`No provider for ${ft(n)} found${t}`)}function At(n,e){null==n&&function(n,e,t,r){throw new Error(`ASSERTION ERROR: ${n}`+(null==r?"":` [Expected=> ${t} ${r} ${e} <=Actual]`))}(e,n,null,"!=")}function se(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function Un(n){return{providers:n.providers||[],imports:n.imports||[]}}function Vn(n){return yh(n,_o)||yh(n,Th)}function yh(n,e){return n.hasOwnProperty(e)?n[e]:null}function Eh(n){return n&&(n.hasOwnProperty(Nl)||n.hasOwnProperty(M_))?n[Nl]:null}const _o=le({\u0275prov:le}),Nl=le({\u0275inj:le}),Th=le({ngInjectableDef:le}),M_=le({ngInjectorDef:le});var $=(()=>(($=$||{})[$.Default=0]="Default",$[$.Host=1]="Host",$[$.Self=2]="Self",$[$.SkipSelf=4]="SkipSelf",$[$.Optional=8]="Optional",$))();let Ol;function sr(n){const e=Ol;return Ol=n,e}function Dh(n,e,t){const r=Vn(n);return r&&"root"==r.providedIn?void 0===r.value?r.value=r.factory():r.value:t&$.Optional?null:void 0!==e?e:void vo(ee(n),"Injector")}function ir(n){return{toString:n}.toString()}var Nt=(()=>((Nt=Nt||{})[Nt.OnPush=0]="OnPush",Nt[Nt.Default=1]="Default",Nt))(),He=(()=>((He=He||{})[He.Emulated=0]="Emulated",He[He.None=2]="None",He[He.ShadowDom=3]="ShadowDom",He))();const F_="undefined"!=typeof globalThis&&globalThis,k_="undefined"!=typeof window&&window,N_="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,de=F_||"undefined"!=typeof global&&global||k_||N_,qr={},pe=[],xo=le({\u0275cmp:le}),Bl=le({\u0275dir:le}),Ul=le({\u0275pipe:le}),vh=le({\u0275mod:le}),O_=le({\u0275loc:le}),$n=le({\u0275fac:le}),ni=le({__NG_ELEMENT_ID__:le});let B_=0;function Co(n){return ir(()=>{const t={},r={type:n.type,providersResolver:null,decls:n.decls,vars:n.vars,factory:null,template:n.template||null,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:t,inputs:null,outputs:null,exportAs:n.exportAs||null,onPush:n.changeDetection===Nt.OnPush,directiveDefs:null,pipeDefs:null,selectors:n.selectors||pe,viewQuery:n.viewQuery||null,features:n.features||null,data:n.data||{},encapsulation:n.encapsulation||He.Emulated,id:"c",styles:n.styles||pe,_:null,setInput:null,schemas:n.schemas||null,tView:null},s=n.directives,i=n.features,o=n.pipes;return r.id+=B_++,r.inputs=bh(n.inputs,t),r.outputs=bh(n.outputs),i&&i.forEach(a=>a(r)),r.directiveDefs=s?()=>("function"==typeof s?s():s).map(_h):null,r.pipeDefs=o?()=>("function"==typeof o?o():o).map(xh):null,r})}function _h(n){return nt(n)||function(n){return n[Bl]||null}(n)}function xh(n){return function(n){return n[Ul]||null}(n)}const Ch={};function vr(n){return ir(()=>{const e={type:n.type,bootstrap:n.bootstrap||pe,declarations:n.declarations||pe,imports:n.imports||pe,exports:n.exports||pe,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null};return null!=n.id&&(Ch[n.id]=n.type),e})}function bh(n,e){if(null==n)return qr;const t={};for(const r in n)if(n.hasOwnProperty(r)){let s=n[r],i=s;Array.isArray(s)&&(i=s[1],s=s[0]),t[s]=r,e&&(e[s]=i)}return t}const Ot=Co;function nt(n){return n[xo]||null}function Bt(n,e){const t=n[vh]||null;if(!t&&!0===e)throw new Error(`Type ${ee(n)} does not have '\u0275mod' property.`);return t}const J=11;function _n(n){return Array.isArray(n)&&"object"==typeof n[1]}function tn(n){return Array.isArray(n)&&!0===n[1]}function Hl(n){return 0!=(8&n.flags)}function Ao(n){return 2==(2&n.flags)}function wo(n){return 1==(1&n.flags)}function nn(n){return null!==n.template}function K_(n){return 0!=(512&n[2])}function Sr(n,e){return n.hasOwnProperty($n)?n[$n]:null}class Ih{constructor(e,t,r){this.previousValue=e,this.currentValue=t,this.firstChange=r}isFirstChange(){return this.firstChange}}function Ah(n){return n.type.prototype.ngOnChanges&&(n.setInput=z_),q_}function q_(){const n=Rh(this),e=null==n?void 0:n.current;if(e){const t=n.previous;if(t===qr)n.previous=e;else for(let r in e)t[r]=e[r];n.current=null,this.ngOnChanges(e)}}function z_(n,e,t,r){const s=Rh(n)||function(n,e){return n[wh]=e}(n,{previous:qr,current:null}),i=s.current||(s.current={}),o=s.previous,a=this.declaredInputs[t],l=o[a];i[a]=new Ih(l&&l.currentValue,e,o===qr),n[r]=e}const wh="__ngSimpleChanges__";function Rh(n){return n[wh]||null}let Kl;function Fe(n){return!!n.listen}const Ph={createRenderer:(n,e)=>void 0!==Kl?Kl:"undefined"!=typeof document?document:void 0};function Be(n){for(;Array.isArray(n);)n=n[0];return n}function Rt(n,e){return Be(e[n.index])}function Yl(n,e){return n.data[e]}function Lt(n,e){const t=e[n];return _n(t)?t:t[0]}function Fh(n){return 4==(4&n[2])}function ql(n){return 128==(128&n[2])}function ar(n,e){return null==e?null:n[e]}function kh(n){n[18]=0}function zl(n,e){n[5]+=e;let t=n,r=n[3];for(;null!==r&&(1===e&&1===t[5]||-1===e&&0===t[5]);)r[5]+=e,t=r,r=r[3]}const K={lFrame:jh(null),bindingsEnabled:!0,isInCheckNoChangesMode:!1};function Nh(){return K.bindingsEnabled}function A(){return K.lFrame.lView}function ie(){return K.lFrame.tView}function je(){let n=Oh();for(;null!==n&&64===n.type;)n=n.parent;return n}function Oh(){return K.lFrame.currentTNode}function xn(n,e){const t=K.lFrame;t.currentTNode=n,t.isParent=e}function Ql(){return K.lFrame.isParent}function Mo(){return K.isInCheckNoChangesMode}function Po(n){K.isInCheckNoChangesMode=n}function dx(n,e){const t=K.lFrame;t.bindingIndex=t.bindingRootIndex=n,Jl(e)}function Jl(n){K.lFrame.currentDirectiveIndex=n}function Vh(){return K.lFrame.currentQueryIndex}function ec(n){K.lFrame.currentQueryIndex=n}function hx(n){const e=n[1];return 2===e.type?e.declTNode:1===e.type?n[6]:null}function $h(n,e,t){if(t&$.SkipSelf){let s=e,i=n;for(;!(s=s.parent,null!==s||t&$.Host||(s=hx(i),null===s||(i=i[15],10&s.type))););if(null===s)return!1;e=s,n=i}const r=K.lFrame=Hh();return r.currentTNode=e,r.lView=n,!0}function Fo(n){const e=Hh(),t=n[1];K.lFrame=e,e.currentTNode=t.firstChild,e.lView=n,e.tView=t,e.contextLView=n,e.bindingIndex=t.bindingStartIndex,e.inI18n=!1}function Hh(){const n=K.lFrame,e=null===n?null:n.child;return null===e?jh(n):e}function jh(n){const e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return null!==n&&(n.child=e),e}function Gh(){const n=K.lFrame;return K.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}const Kh=Gh;function ko(){const n=Gh();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function lr(n){K.lFrame.selectedIndex=n}function No(n,e){for(let t=e.directiveStart,r=e.directiveEnd;t<r;t++){const i=n.data[t].type.prototype,{ngAfterContentInit:o,ngAfterContentChecked:a,ngAfterViewInit:l,ngAfterViewChecked:c,ngOnDestroy:u}=i;o&&(n.contentHooks||(n.contentHooks=[])).push(-t,o),a&&((n.contentHooks||(n.contentHooks=[])).push(t,a),(n.contentCheckHooks||(n.contentCheckHooks=[])).push(t,a)),l&&(n.viewHooks||(n.viewHooks=[])).push(-t,l),c&&((n.viewHooks||(n.viewHooks=[])).push(t,c),(n.viewCheckHooks||(n.viewCheckHooks=[])).push(t,c)),null!=u&&(n.destroyHooks||(n.destroyHooks=[])).push(t,u)}}function Oo(n,e,t){Wh(n,e,3,t)}function Bo(n,e,t,r){(3&n[2])===t&&Wh(n,e,t,r)}function tc(n,e){let t=n[2];(3&t)===e&&(t&=2047,t+=1,n[2]=t)}function Wh(n,e,t,r){const i=null!=r?r:-1,o=e.length-1;let a=0;for(let l=void 0!==r?65535&n[18]:0;l<o;l++)if("number"==typeof e[l+1]){if(a=e[l],null!=r&&a>=r)break}else e[l]<0&&(n[18]+=65536),(a<i||-1==i)&&(_x(n,t,e,l),n[18]=(4294901760&n[18])+l+2),l++}function _x(n,e,t,r){const s=t[r]<0,i=t[r+1],a=n[s?-t[r]:t[r]];if(s){if(n[2]>>11<n[18]>>16&&(3&n[2])===e){n[2]+=2048;try{i.call(a)}finally{}}}else try{i.call(a)}finally{}}class ai{constructor(e,t,r){this.factory=e,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=r}}function Uo(n,e,t){const r=Fe(n);let s=0;for(;s<t.length;){const i=t[s];if("number"==typeof i){if(0!==i)break;s++;const o=t[s++],a=t[s++],l=t[s++];r?n.setAttribute(e,a,l,o):e.setAttributeNS(o,a,l)}else{const o=i,a=t[++s];rc(o)?r&&n.setProperty(e,o,a):r?n.setAttribute(e,o,a):e.setAttribute(o,a),s++}}return s}function Yh(n){return 3===n||4===n||6===n}function rc(n){return 64===n.charCodeAt(0)}function Vo(n,e){if(null!==e&&0!==e.length)if(null===n||0===n.length)n=e.slice();else{let t=-1;for(let r=0;r<e.length;r++){const s=e[r];"number"==typeof s?t=s:0===t||qh(n,t,s,null,-1===t||2===t?e[++r]:null)}}return n}function qh(n,e,t,r,s){let i=0,o=n.length;if(-1===e)o=-1;else for(;i<n.length;){const a=n[i++];if("number"==typeof a){if(a===e){o=-1;break}if(a>e){o=i-1;break}}}for(;i<n.length;){const a=n[i];if("number"==typeof a)break;if(a===t){if(null===r)return void(null!==s&&(n[i+1]=s));if(r===n[i+1])return void(n[i+2]=s)}i++,null!==r&&i++,null!==s&&i++}-1!==o&&(n.splice(o,0,e),i=o+1),n.splice(i++,0,t),null!==r&&n.splice(i++,0,r),null!==s&&n.splice(i++,0,s)}function zh(n){return-1!==n}function ts(n){return 32767&n}function ns(n,e){let t=function(n){return n>>16}(n),r=e;for(;t>0;)r=r[15],t--;return r}let sc=!0;function $o(n){const e=sc;return sc=n,e}let Ax=0;function ci(n,e){const t=oc(n,e);if(-1!==t)return t;const r=e[1];r.firstCreatePass&&(n.injectorIndex=e.length,ic(r.data,n),ic(e,null),ic(r.blueprint,null));const s=Ho(n,e),i=n.injectorIndex;if(zh(s)){const o=ts(s),a=ns(s,e),l=a[1].data;for(let c=0;c<8;c++)e[i+c]=a[o+c]|l[o+c]}return e[i+8]=s,i}function ic(n,e){n.push(0,0,0,0,0,0,0,0,e)}function oc(n,e){return-1===n.injectorIndex||n.parent&&n.parent.injectorIndex===n.injectorIndex||null===e[n.injectorIndex+8]?-1:n.injectorIndex}function Ho(n,e){if(n.parent&&-1!==n.parent.injectorIndex)return n.parent.injectorIndex;let t=0,r=null,s=e;for(;null!==s;){const i=s[1],o=i.type;if(r=2===o?i.declTNode:1===o?s[6]:null,null===r)return-1;if(t++,s=s[15],-1!==r.injectorIndex)return r.injectorIndex|t<<16}return-1}function jo(n,e,t){!function(n,e,t){let r;"string"==typeof t?r=t.charCodeAt(0)||0:t.hasOwnProperty(ni)&&(r=t[ni]),null==r&&(r=t[ni]=Ax++);const s=255&r;e.data[n+(s>>5)]|=1<<s}(n,e,t)}function Jh(n,e,t){if(t&$.Optional)return n;vo(e,"NodeInjector")}function Zh(n,e,t,r){if(t&$.Optional&&void 0===r&&(r=null),0==(t&($.Self|$.Host))){const s=n[9],i=sr(void 0);try{return s?s.get(e,r,t&$.Optional):Dh(e,r,t&$.Optional)}finally{sr(i)}}return Jh(r,e,t)}function ep(n,e,t,r=$.Default,s){if(null!==n){const i=function(n){if("string"==typeof n)return n.charCodeAt(0)||0;const e=n.hasOwnProperty(ni)?n[ni]:void 0;return"number"==typeof e?e>=0?255&e:Lx:e}(t);if("function"==typeof i){if(!$h(e,n,r))return r&$.Host?Jh(s,t,r):Zh(e,t,r,s);try{const o=i(r);if(null!=o||r&$.Optional)return o;vo(t)}finally{Kh()}}else if("number"==typeof i){let o=null,a=oc(n,e),l=-1,c=r&$.Host?e[16][6]:null;for((-1===a||r&$.SkipSelf)&&(l=-1===a?Ho(n,e):e[a+8],-1!==l&&rp(r,!1)?(o=e[1],a=ts(l),e=ns(l,e)):a=-1);-1!==a;){const u=e[1];if(np(i,a,u.data)){const d=Mx(a,e,t,o,r,c);if(d!==tp)return d}l=e[a+8],-1!==l&&rp(r,e[1].data[a+8]===c)&&np(i,a,e)?(o=u,a=ts(l),e=ns(l,e)):a=-1}}}return Zh(e,t,r,s)}const tp={};function Lx(){return new rs(je(),A())}function Mx(n,e,t,r,s,i){const o=e[1],a=o.data[n+8],u=Go(a,o,t,null==r?Ao(a)&&sc:r!=o&&0!=(3&a.type),s&$.Host&&i===a);return null!==u?ui(e,o,u,a):tp}function Go(n,e,t,r,s){const i=n.providerIndexes,o=e.data,a=1048575&i,l=n.directiveStart,u=i>>20,f=s?a+u:n.directiveEnd;for(let h=r?a:a+u;h<f;h++){const p=o[h];if(h<l&&t===p||h>=l&&p.type===t)return h}if(s){const h=o[l];if(h&&nn(h)&&h.type===t)return l}return null}function ui(n,e,t,r){let s=n[t];const i=e.data;if(function(n){return n instanceof ai}(s)){const o=s;o.resolving&&function(n,e){throw new rr("200",`Circular dependency in DI detected for ${n}`)}(ft(i[t]));const a=$o(o.canSeeViewProviders);o.resolving=!0;const l=o.injectImpl?sr(o.injectImpl):null;$h(n,r,$.Default);try{s=n[t]=o.factory(void 0,i,n,r),e.firstCreatePass&&t>=r.directiveStart&&function(n,e,t){const{ngOnChanges:r,ngOnInit:s,ngDoCheck:i}=e.type.prototype;if(r){const o=Ah(e);(t.preOrderHooks||(t.preOrderHooks=[])).push(n,o),(t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(n,o)}s&&(t.preOrderHooks||(t.preOrderHooks=[])).push(0-n,s),i&&((t.preOrderHooks||(t.preOrderHooks=[])).push(n,i),(t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(n,i))}(t,i[t],e)}finally{null!==l&&sr(l),$o(a),o.resolving=!1,Kh()}}return s}function np(n,e,t){return!!(t[e+(n>>5)]&1<<n)}function rp(n,e){return!(n&$.Self||n&$.Host&&e)}class rs{constructor(e,t){this._tNode=e,this._lView=t}get(e,t,r){return ep(this._tNode,this._lView,e,r,t)}}const is="__parameters__";function Ir(n,e,t){return ir(()=>{const r=function(n){return function(...t){if(n){const r=n(...t);for(const s in r)this[s]=r[s]}}}(e);function s(...i){if(this instanceof s)return r.apply(this,i),this;const o=new s(...i);return a.annotation=o,a;function a(l,c,u){const d=l.hasOwnProperty(is)?l[is]:Object.defineProperty(l,is,{value:[]})[is];for(;d.length<=u;)d.push(null);return(d[u]=d[u]||[]).push(o),l}}return t&&(s.prototype=Object.create(t.prototype)),s.prototype.ngMetadataName=n,s.annotationCls=s,s})}class ce{constructor(e,t){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=se({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}toString(){return`InjectionToken ${this._desc}`}}function $t(n,e){void 0===e&&(e=n);for(let t=0;t<n.length;t++){let r=n[t];Array.isArray(r)?(e===n&&(e=n.slice(0,t)),$t(r,e)):e!==n&&e.push(r)}return e}function bn(n,e){n.forEach(t=>Array.isArray(t)?bn(t,e):e(t))}function Wo(n,e,t){e>=n.length?n.push(t):n.splice(e,0,t)}function Ar(n,e){return e>=n.length-1?n.pop():n.splice(e,1)[0]}const pi={},hc="__NG_DI_FLAG__",ls="ngTempTokenPath",Wx=/\n/gm,pc="__source",gc=le({provide:String,useValue:le});let gi;function cs(n){const e=gi;return gi=n,e}function qx(n,e=$.Default){if(void 0===gi)throw new Error("inject() must be called from an injection context");return null===gi?Dh(n,void 0,e):gi.get(n,e&$.Optional?null:void 0,e)}function W(n,e=$.Default){return(Ol||qx)(B(n),e)}function wr(n){const e=[];for(let t=0;t<n.length;t++){const r=B(n[t]);if(Array.isArray(r)){if(0===r.length)throw new Error("Arguments array must have arguments.");let s,i=$.Default;for(let o=0;o<r.length;o++){const a=r[o],l=zx(a);"number"==typeof l?-1===l?s=a.token:i|=l:s=a}e.push(W(s,i))}else e.push(W(r))}return e}function mi(n,e){return n[hc]=e,n.prototype[hc]=e,n}function zx(n){return n[hc]}function cp(n,e,t,r){const s=n[ls];throw e[pc]&&s.unshift(e[pc]),n.message=function(n,e,t,r=null){n=n&&"\n"===n.charAt(0)&&"\u0275"==n.charAt(1)?n.substr(2):n;let s=ee(e);if(Array.isArray(e))s=e.map(ee).join(" -> ");else if("object"==typeof e){let i=[];for(let o in e)if(e.hasOwnProperty(o)){let a=e[o];i.push(o+":"+("string"==typeof a?JSON.stringify(a):ee(a)))}s=`{${i.join(", ")}}`}return`${t}${r?"("+r+")":""}[${s}]: ${n.replace(Wx,"\n  ")}`}("\n"+n.message,s,t,r),n.ngTokenPath=s,n[ls]=null,n}const yi=mi(Ir("Inject",n=>({token:n})),-1),Sn=mi(Ir("Optional"),8),Rr=mi(Ir("SkipSelf"),4);var Pt=(()=>((Pt=Pt||{})[Pt.Important=1]="Important",Pt[Pt.DashCase=2]="DashCase",Pt))();const gp="__ngContext__";function st(n,e){n[gp]=e}function Ec(n){const e=function(n){return n[gp]||null}(n);return e?Array.isArray(e)?e:e.lView:null}function Dc(n,e){return undefined(n,e)}function Di(n){const e=n[3];return tn(e)?e[3]:e}function vc(n){return _p(n[13])}function _c(n){return _p(n[4])}function _p(n){for(;null!==n&&!tn(n);)n=n[4];return n}function ds(n,e,t,r,s){if(null!=r){let i,o=!1;tn(r)?i=r:_n(r)&&(o=!0,r=r[0]);const a=Be(r);0===n&&null!==t?null==s?Ap(e,t,a):Lr(e,t,a,s||null,!0):1===n&&null!==t?Lr(e,t,a,s||null,!0):2===n?function(n,e,t){const r=Xo(n,e);r&&function(n,e,t,r){Fe(n)?n.removeChild(e,t,r):e.removeChild(t)}(n,r,e,t)}(e,a,o):3===n&&e.destroyNode(a),null!=i&&function(n,e,t,r,s){const i=t[7];i!==Be(t)&&ds(e,n,r,i,s);for(let a=10;a<t.length;a++){const l=t[a];vi(l[1],l,n,e,r,i)}}(e,n,i,t,s)}}function Cc(n,e,t){return Fe(n)?n.createElement(e,t):null===t?n.createElement(e):n.createElementNS(t,e)}function Cp(n,e){const t=n[9],r=t.indexOf(e),s=e[3];1024&e[2]&&(e[2]&=-1025,zl(s,-1)),t.splice(r,1)}function bc(n,e){if(n.length<=10)return;const t=10+e,r=n[t];if(r){const s=r[17];null!==s&&s!==n&&Cp(s,r),e>0&&(n[t-1][4]=r[4]);const i=Ar(n,10+e);!function(n,e){vi(n,e,e[J],2,null,null),e[0]=null,e[6]=null}(r[1],r);const o=i[19];null!==o&&o.detachView(i[1]),r[3]=null,r[4]=null,r[2]&=-129}return r}function bp(n,e){if(!(256&e[2])){const t=e[J];Fe(t)&&t.destroyNode&&vi(n,e,t,3,null,null),function(n){let e=n[13];if(!e)return Sc(n[1],n);for(;e;){let t=null;if(_n(e))t=e[13];else{const r=e[10];r&&(t=r)}if(!t){for(;e&&!e[4]&&e!==n;)_n(e)&&Sc(e[1],e),e=e[3];null===e&&(e=n),_n(e)&&Sc(e[1],e),t=e&&e[4]}e=t}}(e)}}function Sc(n,e){if(!(256&e[2])){e[2]&=-129,e[2]|=256,function(n,e){let t;if(null!=n&&null!=(t=n.destroyHooks))for(let r=0;r<t.length;r+=2){const s=e[t[r]];if(!(s instanceof ai)){const i=t[r+1];if(Array.isArray(i))for(let o=0;o<i.length;o+=2){const a=s[i[o]],l=i[o+1];try{l.call(a)}finally{}}else try{i.call(s)}finally{}}}}(n,e),function(n,e){const t=n.cleanup,r=e[7];let s=-1;if(null!==t)for(let i=0;i<t.length-1;i+=2)if("string"==typeof t[i]){const o=t[i+1],a="function"==typeof o?o(e):Be(e[o]),l=r[s=t[i+2]],c=t[i+3];"boolean"==typeof c?a.removeEventListener(t[i],l,c):c>=0?r[s=c]():r[s=-c].unsubscribe(),i+=2}else{const o=r[s=t[i+1]];t[i].call(o)}if(null!==r){for(let i=s+1;i<r.length;i++)r[i]();e[7]=null}}(n,e),1===e[1].type&&Fe(e[J])&&e[J].destroy();const t=e[17];if(null!==t&&tn(e[3])){t!==e[3]&&Cp(t,e);const r=e[19];null!==r&&r.detachView(n)}}}function Sp(n,e,t){return function(n,e,t){let r=e;for(;null!==r&&40&r.type;)r=(e=r).parent;if(null===r)return t[0];if(2&r.flags){const s=n.data[r.directiveStart].encapsulation;if(s===He.None||s===He.Emulated)return null}return Rt(r,t)}(n,e.parent,t)}function Lr(n,e,t,r,s){Fe(n)?n.insertBefore(e,t,r,s):e.insertBefore(t,r,s)}function Ap(n,e,t){Fe(n)?n.appendChild(e,t):e.appendChild(t)}function wp(n,e,t,r,s){null!==r?Lr(n,e,t,r,s):Ap(n,e,t)}function Xo(n,e){return Fe(n)?n.parentNode(e):e.parentNode}let Mp=function(n,e,t){return 40&n.type?Rt(n,t):null};function Jo(n,e,t,r){const s=Sp(n,r,e),i=e[J],a=function(n,e,t){return Mp(n,e,t)}(r.parent||e[6],r,e);if(null!=s)if(Array.isArray(t))for(let l=0;l<t.length;l++)wp(i,s,t[l],a,!1);else wp(i,s,t,a,!1)}function Zo(n,e){if(null!==e){const t=e.type;if(3&t)return Rt(e,n);if(4&t)return Ac(-1,n[e.index]);if(8&t){const r=e.child;if(null!==r)return Zo(n,r);{const s=n[e.index];return tn(s)?Ac(-1,s):Be(s)}}if(32&t)return Dc(e,n)()||Be(n[e.index]);{const r=Fp(n,e);return null!==r?Array.isArray(r)?r[0]:Zo(Di(n[16]),r):Zo(n,e.next)}}return null}function Fp(n,e){return null!==e?n[16][6].projection[e.projection]:null}function Ac(n,e){const t=10+n+1;if(t<e.length){const r=e[t],s=r[1].firstChild;if(null!==s)return Zo(r,s)}return e[7]}function Rc(n,e,t,r,s,i,o){for(;null!=t;){const a=r[t.index],l=t.type;if(o&&0===e&&(a&&st(Be(a),r),t.flags|=4),64!=(64&t.flags))if(8&l)Rc(n,e,t.child,r,s,i,!1),ds(e,n,s,a,i);else if(32&l){const c=Dc(t,r);let u;for(;u=c();)ds(e,n,s,u,i);ds(e,n,s,a,i)}else 16&l?kp(n,e,r,t,s,i):ds(e,n,s,a,i);t=o?t.projectionNext:t.next}}function vi(n,e,t,r,s,i){Rc(t,r,n.firstChild,e,s,i,!1)}function kp(n,e,t,r,s,i){const o=t[16],l=o[6].projection[r.projection];if(Array.isArray(l))for(let c=0;c<l.length;c++)ds(e,n,s,l[c],i);else Rc(n,e,l,o[3],s,i,!0)}function Np(n,e,t){Fe(n)?n.setAttribute(e,"style",t):e.style.cssText=t}function Lc(n,e,t){Fe(n)?""===t?n.removeAttribute(e,"class"):n.setAttribute(e,"class",t):e.className=t}function ra(n){return n.ngOriginalError}function lb(n,...e){n.error(...e)}class Fr{constructor(){this._console=console}handleError(e){const t=this._findOriginalError(e),r=this._findContext(e),s=function(n){return n&&n.ngErrorLogger||lb}(e);s(this._console,"ERROR",e),t&&s(this._console,"ORIGINAL ERROR",t),r&&s(this._console,"ERROR CONTEXT",r)}_findContext(e){return e?function(n){return n.ngDebugContext}(e)||this._findContext(ra(e)):null}_findOriginalError(e){let t=e&&ra(e);for(;t&&ra(t);)t=ra(t);return t||null}}const ng=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(de))();function wn(n){return n instanceof Function?n():n}function sg(n,e,t){let r=n.length;for(;;){const s=n.indexOf(e,t);if(-1===s)return s;if(0===s||n.charCodeAt(s-1)<=32){const i=e.length;if(s+i===r||n.charCodeAt(s+i)<=32)return s}t=s+1}}const ig="ng-template";function mb(n,e,t){let r=0;for(;r<n.length;){let s=n[r++];if(t&&"class"===s){if(s=n[r],-1!==sg(s.toLowerCase(),e,0))return!0}else if(1===s){for(;r<n.length&&"string"==typeof(s=n[r++]);)if(s.toLowerCase()===e)return!0;return!1}}return!1}function og(n){return 4===n.type&&n.value!==ig}function yb(n,e,t){return e===(4!==n.type||t?n.value:ig)}function Eb(n,e,t){let r=4;const s=n.attrs||[],i=function(n){for(let e=0;e<n.length;e++)if(Yh(n[e]))return e;return n.length}(s);let o=!1;for(let a=0;a<e.length;a++){const l=e[a];if("number"!=typeof l){if(!o)if(4&r){if(r=2|1&r,""!==l&&!yb(n,l,t)||""===l&&1===e.length){if(rn(r))return!1;o=!0}}else{const c=8&r?l:e[++a];if(8&r&&null!==n.attrs){if(!mb(n.attrs,c,t)){if(rn(r))return!1;o=!0}continue}const d=Tb(8&r?"class":l,s,og(n),t);if(-1===d){if(rn(r))return!1;o=!0;continue}if(""!==c){let f;f=d>i?"":s[d+1].toLowerCase();const h=8&r?f:null;if(h&&-1!==sg(h,c,0)||2&r&&c!==f){if(rn(r))return!1;o=!0}}}}else{if(!o&&!rn(r)&&!rn(l))return!1;if(o&&rn(l))continue;o=!1,r=l|1&r}}return rn(r)||o}function rn(n){return 0==(1&n)}function Tb(n,e,t,r){if(null===e)return-1;let s=0;if(r||!t){let i=!1;for(;s<e.length;){const o=e[s];if(o===n)return s;if(3===o||6===o)i=!0;else{if(1===o||2===o){let a=e[++s];for(;"string"==typeof a;)a=e[++s];continue}if(4===o)break;if(0===o){s+=4;continue}}s+=i?1:2}return-1}return function(n,e){let t=n.indexOf(4);if(t>-1)for(t++;t<n.length;){const r=n[t];if("number"==typeof r)return-1;if(r===e)return t;t++}return-1}(e,n)}function ag(n,e,t=!1){for(let r=0;r<e.length;r++)if(Eb(n,e[r],t))return!0;return!1}function lg(n,e){return n?":not("+e.trim()+")":e}function Cb(n){let e=n[0],t=1,r=2,s="",i=!1;for(;t<n.length;){let o=n[t];if("string"==typeof o)if(2&r){const a=n[++t];s+="["+o+(a.length>0?'="'+a+'"':"")+"]"}else 8&r?s+="."+o:4&r&&(s+=" "+o);else""!==s&&!rn(o)&&(e+=lg(i,s),s=""),r=o,i=i||!rn(r);t++}return""!==s&&(e+=lg(i,s)),e}const z={};function Tg(n,e){const t=n.contentQueries;if(null!==t)for(let r=0;r<t.length;r+=2){const s=t[r],i=t[r+1];if(-1!==i){const o=n.data[i];ec(s),o.contentQueries(2,e[i],i)}}}function bi(n,e,t,r,s,i,o,a,l,c){const u=e.blueprint.slice();return u[0]=s,u[2]=140|r,kh(u),u[3]=u[15]=n,u[8]=t,u[10]=o||n&&n[10],u[J]=a||n&&n[J],u[12]=l||n&&n[12]||null,u[9]=c||n&&n[9]||null,u[6]=i,u[16]=2==e.type?n[16]:u,u}function hs(n,e,t,r,s){let i=n.data[e];if(null===i)i=function(n,e,t,r,s){const i=Oh(),o=Ql(),l=n.data[e]=function(n,e,t,r,s,i){return{type:t,index:r,insertBeforeIndex:null,injectorIndex:e?e.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:s,attrs:i,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,o?i:i&&i.parent,t,e,r,s);return null===n.firstChild&&(n.firstChild=l),null!==i&&(o?null==i.child&&null!==l.parent&&(i.child=l):null===i.next&&(i.next=l)),l}(n,e,t,r,s),K.lFrame.inI18n&&(i.flags|=64);else if(64&i.type){i.type=t,i.value=r,i.attrs=s;const o=function(){const n=K.lFrame,e=n.currentTNode;return n.isParent?e:e.parent}();i.injectorIndex=null===o?-1:o.injectorIndex}return xn(i,!0),i}function ps(n,e,t,r){if(0===t)return-1;const s=e.length;for(let i=0;i<t;i++)e.push(r),n.blueprint.push(r),n.data.push(null);return s}function Si(n,e,t){Fo(e);try{const r=n.viewQuery;null!==r&&ru(1,r,t);const s=n.template;null!==s&&Dg(n,e,s,1,t),n.firstCreatePass&&(n.firstCreatePass=!1),n.staticContentQueries&&Tg(n,e),n.staticViewQueries&&ru(2,n.viewQuery,t);const i=n.components;null!==i&&function(n,e){for(let t=0;t<e.length;t++)sS(n,e[t])}(e,i)}catch(r){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),r}finally{e[2]&=-5,ko()}}function gs(n,e,t,r){const s=e[2];if(256==(256&s))return;Fo(e);const i=Mo();try{kh(e),function(n){K.lFrame.bindingIndex=n}(n.bindingStartIndex),null!==t&&Dg(n,e,t,2,r);const o=3==(3&s);if(!i)if(o){const c=n.preOrderCheckHooks;null!==c&&Oo(e,c,null)}else{const c=n.preOrderHooks;null!==c&&Bo(e,c,0,null),tc(e,0)}if(function(n){for(let e=vc(n);null!==e;e=_c(e)){if(!e[2])continue;const t=e[9];for(let r=0;r<t.length;r++){const s=t[r],i=s[3];0==(1024&s[2])&&zl(i,1),s[2]|=1024}}}(e),function(n){for(let e=vc(n);null!==e;e=_c(e))for(let t=10;t<e.length;t++){const r=e[t],s=r[1];ql(r)&&gs(s,r,s.template,r[8])}}(e),null!==n.contentQueries&&Tg(n,e),!i)if(o){const c=n.contentCheckHooks;null!==c&&Oo(e,c)}else{const c=n.contentHooks;null!==c&&Bo(e,c,1),tc(e,1)}!function(n,e){const t=n.hostBindingOpCodes;if(null!==t)try{for(let r=0;r<t.length;r++){const s=t[r];if(s<0)lr(~s);else{const i=s,o=t[++r],a=t[++r];dx(o,i),a(2,e[i])}}}finally{lr(-1)}}(n,e);const a=n.components;null!==a&&function(n,e){for(let t=0;t<e.length;t++)rS(n,e[t])}(e,a);const l=n.viewQuery;if(null!==l&&ru(2,l,r),!i)if(o){const c=n.viewCheckHooks;null!==c&&Oo(e,c)}else{const c=n.viewHooks;null!==c&&Bo(e,c,2),tc(e,2)}!0===n.firstUpdatePass&&(n.firstUpdatePass=!1),i||(e[2]&=-73),1024&e[2]&&(e[2]&=-1025,zl(e[3],-1))}finally{ko()}}function Bb(n,e,t,r){const s=e[10],i=!Mo(),o=Fh(e);try{i&&!o&&s.begin&&s.begin(),o&&Si(n,e,r),gs(n,e,t,r)}finally{i&&!o&&s.end&&s.end()}}function Dg(n,e,t,r,s){const i=K.lFrame.selectedIndex,o=2&r;try{lr(-1),o&&e.length>20&&function(n,e,t,r){if(!r)if(3==(3&e[2])){const i=n.preOrderCheckHooks;null!==i&&Oo(e,i,t)}else{const i=n.preOrderHooks;null!==i&&Bo(e,i,0,t)}lr(t)}(n,e,20,Mo()),t(r,s)}finally{lr(i)}}function zc(n,e,t){!Nh()||(function(n,e,t,r){const s=t.directiveStart,i=t.directiveEnd;n.firstCreatePass||ci(t,e),st(r,e);const o=t.initialInputs;for(let a=s;a<i;a++){const l=n.data[a],c=nn(l);c&&Jb(e,t,l);const u=ui(e,n,a,t);st(u,e),null!==o&&Zb(0,a-s,u,l,0,o),c&&(Lt(t.index,e)[8]=u)}}(n,e,t,Rt(t,e)),128==(128&t.flags)&&function(n,e,t){const r=t.directiveStart,s=t.directiveEnd,o=t.index,a=K.lFrame.currentDirectiveIndex;try{lr(o);for(let l=r;l<s;l++){const c=n.data[l],u=e[l];Jl(l),(null!==c.hostBindings||0!==c.hostVars||null!==c.hostAttrs)&&wg(c,u)}}finally{lr(-1),Jl(a)}}(n,e,t))}function Qc(n,e,t=Rt){const r=e.localNames;if(null!==r){let s=e.index+1;for(let i=0;i<r.length;i+=2){const o=r[i+1],a=-1===o?t(e,n):n[o];n[s++]=a}}}function _g(n){const e=n.tView;return null===e||e.incompleteFirstPass?n.tView=aa(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts):e}function aa(n,e,t,r,s,i,o,a,l,c){const u=20+r,d=u+s,f=function(n,e){const t=[];for(let r=0;r<e;r++)t.push(r<n?null:z);return t}(u,d),h="function"==typeof c?c():c;return f[1]={type:n,blueprint:f,template:t,queries:null,viewQuery:a,declTNode:e,data:f.slice().fill(null,u),bindingStartIndex:u,expandoStartIndex:d,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof i?i():i,pipeRegistry:"function"==typeof o?o():o,firstChild:null,schemas:l,consts:h,incompleteFirstPass:!1}}function bg(n,e,t,r){const s=function(n){return n[7]||(n[7]=[])}(e);null===t?s.push(r):(s.push(t),n.firstCreatePass&&function(n){return n.cleanup||(n.cleanup=[])}(n).push(r,s.length-1))}function Sg(n,e,t){for(let r in n)if(n.hasOwnProperty(r)){const s=n[r];(t=null===t?{}:t).hasOwnProperty(r)?t[r].push(e,s):t[r]=[e,s]}return t}function Xc(n,e,t,r){let s=!1;if(Nh()){const i=function(n,e,t){const r=n.directiveRegistry;let s=null;if(r)for(let i=0;i<r.length;i++){const o=r[i];ag(t,o.selectors,!1)&&(s||(s=[]),jo(ci(t,e),n,o.type),nn(o)?(Rg(n,t),s.unshift(o)):s.push(o))}return s}(n,e,t),o=null===r?null:{"":-1};if(null!==i){s=!0,Lg(t,n.data.length,i.length);for(let u=0;u<i.length;u++){const d=i[u];d.providersResolver&&d.providersResolver(d)}let a=!1,l=!1,c=ps(n,e,i.length,null);for(let u=0;u<i.length;u++){const d=i[u];t.mergedAttrs=Vo(t.mergedAttrs,d.hostAttrs),Mg(n,t,e,c,d),Xb(c,d,o),null!==d.contentQueries&&(t.flags|=8),(null!==d.hostBindings||null!==d.hostAttrs||0!==d.hostVars)&&(t.flags|=128);const f=d.type.prototype;!a&&(f.ngOnChanges||f.ngOnInit||f.ngDoCheck)&&((n.preOrderHooks||(n.preOrderHooks=[])).push(t.index),a=!0),!l&&(f.ngOnChanges||f.ngDoCheck)&&((n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(t.index),l=!0),c++}!function(n,e){const r=e.directiveEnd,s=n.data,i=e.attrs,o=[];let a=null,l=null;for(let c=e.directiveStart;c<r;c++){const u=s[c],d=u.inputs,f=null===i||og(e)?null:eS(d,i);o.push(f),a=Sg(d,c,a),l=Sg(u.outputs,c,l)}null!==a&&(a.hasOwnProperty("class")&&(e.flags|=16),a.hasOwnProperty("style")&&(e.flags|=32)),e.initialInputs=o,e.inputs=a,e.outputs=l}(n,t)}o&&function(n,e,t){if(e){const r=n.localNames=[];for(let s=0;s<e.length;s+=2){const i=t[e[s+1]];if(null==i)throw new rr("301",`Export of name '${e[s+1]}' not found!`);r.push(e[s],i)}}}(t,r,o)}return t.mergedAttrs=Vo(t.mergedAttrs,t.attrs),s}function Ag(n,e,t,r,s,i){const o=i.hostBindings;if(o){let a=n.hostBindingOpCodes;null===a&&(a=n.hostBindingOpCodes=[]);const l=~e.index;(function(n){let e=n.length;for(;e>0;){const t=n[--e];if("number"==typeof t&&t<0)return t}return 0})(a)!=l&&a.push(l),a.push(r,s,o)}}function wg(n,e){null!==n.hostBindings&&n.hostBindings(1,e)}function Rg(n,e){e.flags|=2,(n.components||(n.components=[])).push(e.index)}function Xb(n,e,t){if(t){if(e.exportAs)for(let r=0;r<e.exportAs.length;r++)t[e.exportAs[r]]=n;nn(e)&&(t[""]=n)}}function Lg(n,e,t){n.flags|=1,n.directiveStart=e,n.directiveEnd=e+t,n.providerIndexes=e}function Mg(n,e,t,r,s){n.data[r]=s;const i=s.factory||(s.factory=Sr(s.type)),o=new ai(i,nn(s),null);n.blueprint[r]=o,t[r]=o,Ag(n,e,0,r,ps(n,t,s.hostVars,z),s)}function Jb(n,e,t){const r=Rt(e,n),s=_g(t),i=n[10],o=la(n,bi(n,s,null,t.onPush?64:16,r,e,i,i.createRenderer(r,t),null,null));n[e.index]=o}function Zb(n,e,t,r,s,i){const o=i[e];if(null!==o){const a=r.setInput;for(let l=0;l<o.length;){const c=o[l++],u=o[l++],d=o[l++];null!==a?r.setInput(t,d,c,u):t[u]=d}}}function eS(n,e){let t=null,r=0;for(;r<e.length;){const s=e[r];if(0!==s)if(5!==s){if("number"==typeof s)break;n.hasOwnProperty(s)&&(null===t&&(t=[]),t.push(s,n[s],e[r+1])),r+=2}else r+=2;else r+=4}return t}function Pg(n,e,t,r){return new Array(n,!0,!1,e,null,0,r,t,null,null)}function rS(n,e){const t=Lt(e,n);if(ql(t)){const r=t[1];80&t[2]?gs(r,t,r.template,t[8]):t[5]>0&&Zc(t)}}function Zc(n){for(let r=vc(n);null!==r;r=_c(r))for(let s=10;s<r.length;s++){const i=r[s];if(1024&i[2]){const o=i[1];gs(o,i,o.template,i[8])}else i[5]>0&&Zc(i)}const t=n[1].components;if(null!==t)for(let r=0;r<t.length;r++){const s=Lt(t[r],n);ql(s)&&s[5]>0&&Zc(s)}}function sS(n,e){const t=Lt(e,n),r=t[1];(function(n,e){for(let t=e.length;t<n.blueprint.length;t++)e.push(n.blueprint[t])})(r,t),Si(r,t,t[8])}function la(n,e){return n[13]?n[14][4]=e:n[13]=e,n[14]=e,e}function nu(n,e,t){const r=e[10];r.begin&&r.begin();try{gs(n,e,n.template,t)}catch(s){throw function(n,e){const t=n[9],r=t?t.get(Fr,null):null;r&&r.handleError(e)}(e,s),s}finally{r.end&&r.end()}}function Fg(n){!function(n){for(let e=0;e<n.components.length;e++){const t=n.components[e],r=Ec(t),s=r[1];Bb(s,r,s.template,t)}}(n[8])}function ru(n,e,t){ec(0),e(n,t)}const cS=(()=>Promise.resolve(null))();function Ug(n,e,t,r,s){for(let i=0;i<t.length;){const o=t[i++],a=t[i++],l=e[o],c=n.data[o];null!==c.setInput?c.setInput(l,s,r,a):l[a]=s}}function ca(n,e,t){let r=t?n.styles:null,s=t?n.classes:null,i=0;if(null!==e)for(let o=0;o<e.length;o++){const a=e[o];"number"==typeof a?i=a:1==i?s=Pl(s,a):2==i&&(r=Pl(r,a+": "+e[++o]+";"))}t?n.styles=r:n.stylesWithoutHost=r,t?n.classes=s:n.classesWithoutHost=s}const ms=new ce("INJECTOR",-1);class Vg{get(e,t=pi){if(t===pi){const r=new Error(`NullInjectorError: No provider for ${ee(e)}!`);throw r.name="NullInjectorError",r}return t}}const Ii=new ce("Set Injector scope."),Ai={},fS={};let su;function $g(){return void 0===su&&(su=new Vg),su}function Hg(n,e=null,t=null,r){return new pS(n,t,e||$g(),r)}class pS{constructor(e,t,r,s=null){this.parent=r,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const i=[];t&&bn(t,a=>this.processProvider(a,e,t)),bn([e],a=>this.processInjectorType(a,[],i)),this.records.set(ms,ys(void 0,this));const o=this.records.get(Ii);this.scope=null!=o?o.value:null,this.source=s||("object"==typeof e?null:ee(e))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(e=>e.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(e,t=pi,r=$.Default){this.assertNotDestroyed();const s=cs(this),i=sr(void 0);try{if(!(r&$.SkipSelf)){let a=this.records.get(e);if(void 0===a){const l=function(n){return"function"==typeof n||"object"==typeof n&&n instanceof ce}(e)&&Vn(e);a=l&&this.injectableDefInScope(l)?ys(iu(e),Ai):null,this.records.set(e,a)}if(null!=a)return this.hydrate(e,a)}return(r&$.Self?$g():this.parent).get(e,t=r&$.Optional&&t===pi?null:t)}catch(o){if("NullInjectorError"===o.name){if((o[ls]=o[ls]||[]).unshift(ee(e)),s)throw o;return cp(o,e,"R3InjectorError",this.source)}throw o}finally{sr(i),cs(s)}}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(e=>this.get(e))}toString(){const e=[];return this.records.forEach((r,s)=>e.push(ee(s))),`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Error("Injector has already been destroyed.")}processInjectorType(e,t,r){if(!(e=B(e)))return!1;let s=Eh(e);const i=null==s&&e.ngModule||void 0,o=void 0===i?e:i,a=-1!==r.indexOf(o);if(void 0!==i&&(s=Eh(i)),null==s)return!1;if(null!=s.imports&&!a){let u;r.push(o);try{bn(s.imports,d=>{this.processInjectorType(d,t,r)&&(void 0===u&&(u=[]),u.push(d))})}finally{}if(void 0!==u)for(let d=0;d<u.length;d++){const{ngModule:f,providers:h}=u[d];bn(h,p=>this.processProvider(p,f,h||pe))}}this.injectorDefTypes.add(o);const l=Sr(o)||(()=>new o);this.records.set(o,ys(l,Ai));const c=s.providers;if(null!=c&&!a){const u=e;bn(c,d=>this.processProvider(d,u,c))}return void 0!==i&&void 0!==e.providers}processProvider(e,t,r){let s=Es(e=B(e))?e:B(e&&e.provide);const i=function(n,e,t){return Gg(n)?ys(void 0,n.useValue):ys(function(n,e,t){let r;if(Es(n)){const s=B(n);return Sr(s)||iu(s)}if(Gg(n))r=()=>B(n.useValue);else if(function(n){return!(!n||!n.useFactory)}(n))r=()=>n.useFactory(...wr(n.deps||[]));else if(function(n){return!(!n||!n.useExisting)}(n))r=()=>W(B(n.useExisting));else{const s=B(n&&(n.useClass||n.provide));if(!function(n){return!!n.deps}(n))return Sr(s)||iu(s);r=()=>new s(...wr(n.deps))}return r}(n),Ai)}(e);if(Es(e)||!0!==e.multi)this.records.get(s);else{let o=this.records.get(s);o||(o=ys(void 0,Ai,!0),o.factory=()=>wr(o.multi),this.records.set(s,o)),s=e,o.multi.push(e)}this.records.set(s,i)}hydrate(e,t){return t.value===Ai&&(t.value=fS,t.value=t.factory()),"object"==typeof t.value&&t.value&&function(n){return null!==n&&"object"==typeof n&&"function"==typeof n.ngOnDestroy}(t.value)&&this.onDestroy.add(t.value),t.value}injectableDefInScope(e){if(!e.providedIn)return!1;const t=B(e.providedIn);return"string"==typeof t?"any"===t||t===this.scope:this.injectorDefTypes.has(t)}}function iu(n){const e=Vn(n),t=null!==e?e.factory:Sr(n);if(null!==t)return t;if(n instanceof ce)throw new Error(`Token ${ee(n)} is missing a \u0275prov definition.`);if(n instanceof Function)return function(n){const e=n.length;if(e>0){const r=function(n,e){const t=[];for(let r=0;r<n;r++)t.push(e);return t}(e,"?");throw new Error(`Can't resolve all parameters for ${ee(n)}: (${r.join(", ")}).`)}const t=function(n){const e=n&&(n[_o]||n[Th]);if(e){const t=function(n){if(n.hasOwnProperty("name"))return n.name;const e=(""+n).match(/^function\s*([^\s(]+)/);return null===e?"":e[1]}(n);return console.warn(`DEPRECATED: DI is instantiating a token "${t}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${t}" class.`),e}return null}(n);return null!==t?()=>t.factory(n):()=>new n}(n);throw new Error("unreachable")}function ys(n,e,t=!1){return{factory:n,value:e,multi:t?[]:void 0}}function Gg(n){return null!==n&&"object"==typeof n&&gc in n}function Es(n){return"function"==typeof n}const Kg=function(n,e,t){return function(n,e=null,t=null,r){const s=Hg(n,e,t,r);return s._resolveInjectorDefTypes(),s}({name:t},e,n,t)};let xe=(()=>{class n{static create(t,r){return Array.isArray(t)?Kg(t,r,""):Kg(t.providers,t.parent,t.name||"")}}return n.THROW_IF_NOT_FOUND=pi,n.NULL=new Vg,n.\u0275prov=se({token:n,providedIn:"any",factory:()=>W(ms)}),n.__NG_ELEMENT_ID__=-1,n})();function kS(n,e){No(Ec(n)[1],je())}let ua=null;function Ts(){if(!ua){const n=de.Symbol;if(n&&n.iterator)ua=n.iterator;else{const e=Object.getOwnPropertyNames(Map.prototype);for(let t=0;t<e.length;++t){const r=e[t];"entries"!==r&&"size"!==r&&Map.prototype[r]===Map.prototype.entries&&(ua=r)}}}return ua}function Ri(n){return!!fu(n)&&(Array.isArray(n)||!(n instanceof Map)&&Ts()in n)}function fu(n){return null!==n&&("function"==typeof n||"object"==typeof n)}function ne(n,e=$.Default){const t=A();return null===t?W(n,e):ep(je(),t,B(n),e)}function ha(n,e,t){const r=A();return function(n,e,t){return!Object.is(n[e],t)&&(n[e]=t,!0)}(r,K.lFrame.bindingIndex++,e)&&function(n,e,t,r,s,i,o,a){const l=Rt(e,t);let u,c=e.inputs;!a&&null!=c&&(u=c[r])?(Ug(n,t,u,r,s),Ao(e)&&function(n,e){const t=Lt(e,n);16&t[2]||(t[2]|=64)}(t,e.index)):3&e.type&&(r=function(n){return"class"===n?"className":"for"===n?"htmlFor":"formaction"===n?"formAction":"innerHtml"===n?"innerHTML":"readonly"===n?"readOnly":"tabindex"===n?"tabIndex":n}(r),s=null!=o?o(s,e.value||"",r):s,Fe(i)?i.setProperty(l,r,s):rc(r)||(l.setProperty?l.setProperty(r,s):l[r]=s))}(ie(),function(){const n=K.lFrame;return Yl(n.tView,n.selectedIndex)}(),r,n,e,r[J],t,!1),ha}function yu(n,e,t,r,s){const o=s?"class":"style";Ug(n,t,e.inputs[o],o,r)}function pa(n,e,t,r){const s=A(),i=ie(),o=20+n,a=s[J],l=s[o]=Cc(a,e,K.lFrame.currentNamespace),c=i.firstCreatePass?function(n,e,t,r,s,i,o){const a=e.consts,c=hs(e,n,2,s,ar(a,i));return Xc(e,t,c,ar(a,o)),null!==c.attrs&&ca(c,c.attrs,!1),null!==c.mergedAttrs&&ca(c,c.mergedAttrs,!0),null!==e.queries&&e.queries.elementStart(e,c),c}(o,i,s,0,e,t,r):i.data[o];xn(c,!0);const u=c.mergedAttrs;null!==u&&Uo(a,l,u);const d=c.classes;null!==d&&Lc(a,l,d);const f=c.styles;null!==f&&Np(a,l,f),64!=(64&c.flags)&&Jo(i,s,l,c),0===K.lFrame.elementDepthCount&&st(l,s),K.lFrame.elementDepthCount++,wo(c)&&(zc(i,s,c),function(n,e,t){if(Hl(e)){const s=e.directiveEnd;for(let i=e.directiveStart;i<s;i++){const o=n.data[i];o.contentQueries&&o.contentQueries(1,t[i],i)}}}(i,c,s)),null!==r&&Qc(s,c)}function ga(){let n=je();Ql()?K.lFrame.isParent=!1:(n=n.parent,xn(n,!1));const e=n;K.lFrame.elementDepthCount--;const t=ie();t.firstCreatePass&&(No(t,n),Hl(n)&&t.queries.elementEnd(n)),null!=e.classesWithoutHost&&function(n){return 0!=(16&n.flags)}(e)&&yu(t,e,A(),e.classesWithoutHost,!0),null!=e.stylesWithoutHost&&function(n){return 0!=(32&n.flags)}(e)&&yu(t,e,A(),e.stylesWithoutHost,!1)}function Eu(n,e,t,r){pa(n,e,t,r),ga()}function Tu(n){return!!n&&"function"==typeof n.then}const km=function(n){return!!n&&"function"==typeof n.subscribe};function Vm(n=1){return function(n){return(K.lFrame.contextLView=function(n,e){for(;n>0;)e=e[15],n--;return e}(n,K.lFrame.contextLView))[8]}(n)}function d0(n,e=""){const t=A(),r=ie(),s=n+20,i=r.firstCreatePass?hs(r,s,1,e,null):r.data[s],o=t[s]=function(n,e){return Fe(n)?n.createText(e):n.createTextNode(e)}(t[J],e);Jo(r,t,o,i),xn(i,!1)}const Nr=void 0;var lA=["en",[["a","p"],["AM","PM"],Nr],[["AM","PM"],Nr,Nr],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Nr,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Nr,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Nr,"{1} 'at' {0}",Nr],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function(n){const e=Math.floor(Math.abs(n)),t=n.toString().replace(/^[^.]*\.?/,"").length;return 1===e&&0===t?1:5}];let Ls={};function P0(n){return n in Ls||(Ls[n]=de.ng&&de.ng.common&&de.ng.common.locales&&de.ng.common.locales[n]),Ls[n]}var P=(()=>((P=P||{})[P.LocaleId=0]="LocaleId",P[P.DayPeriodsFormat=1]="DayPeriodsFormat",P[P.DayPeriodsStandalone=2]="DayPeriodsStandalone",P[P.DaysFormat=3]="DaysFormat",P[P.DaysStandalone=4]="DaysStandalone",P[P.MonthsFormat=5]="MonthsFormat",P[P.MonthsStandalone=6]="MonthsStandalone",P[P.Eras=7]="Eras",P[P.FirstDayOfWeek=8]="FirstDayOfWeek",P[P.WeekendRange=9]="WeekendRange",P[P.DateFormat=10]="DateFormat",P[P.TimeFormat=11]="TimeFormat",P[P.DateTimeFormat=12]="DateTimeFormat",P[P.NumberSymbols=13]="NumberSymbols",P[P.NumberFormats=14]="NumberFormats",P[P.CurrencyCode=15]="CurrencyCode",P[P.CurrencySymbol=16]="CurrencySymbol",P[P.CurrencyName=17]="CurrencyName",P[P.Currencies=18]="Currencies",P[P.Directionality=19]="Directionality",P[P.PluralCase=20]="PluralCase",P[P.ExtraData=21]="ExtraData",P))();const ya="en-US";let F0=ya;function Cu(n){At(n,"Expected localeId to be defined"),"string"==typeof n&&(F0=n.toLowerCase().replace(/_/g,"-"))}class iy{}const ay="ngComponent";class cw{resolveComponentFactory(e){throw function(n){const e=Error(`No component factory found for ${ee(n)}. Did you add it to @NgModule.entryComponents?`);return e[ay]=n,e}(e)}}let Ps=(()=>{class n{}return n.NULL=new cw,n})();function _a(...n){}function Fs(n,e){return new un(Rt(n,e))}const fw=function(){return Fs(je(),A())};let un=(()=>{class n{constructor(t){this.nativeElement=t}}return n.__NG_ELEMENT_ID__=fw,n})();function ly(n){return n instanceof un?n.nativeElement:n}class xa{}let Mu=(()=>{class n{}return n.\u0275prov=se({token:n,providedIn:"root",factory:()=>null}),n})();class Pu{constructor(e){this.full=e,this.major=e.split(".")[0],this.minor=e.split(".")[1],this.patch=e.split(".").slice(2).join(".")}}const uy=new Pu("12.2.17");class dy{constructor(){}supports(e){return Ri(e)}create(e){return new Ew(e)}}const yw=(n,e)=>e;class Ew{constructor(e){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=e||yw}forEachItem(e){let t;for(t=this._itHead;null!==t;t=t._next)e(t)}forEachOperation(e){let t=this._itHead,r=this._removalsHead,s=0,i=null;for(;t||r;){const o=!r||t&&t.currentIndex<hy(r,s,i)?t:r,a=hy(o,s,i),l=o.currentIndex;if(o===r)s--,r=r._nextRemoved;else if(t=t._next,null==o.previousIndex)s++;else{i||(i=[]);const c=a-s,u=l-s;if(c!=u){for(let f=0;f<c;f++){const h=f<i.length?i[f]:i[f]=0,p=h+f;u<=p&&p<c&&(i[f]=h+1)}i[o.previousIndex]=u-c}}a!==l&&e(o,a,l)}}forEachPreviousItem(e){let t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachMovedItem(e){let t;for(t=this._movesHead;null!==t;t=t._nextMoved)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}forEachIdentityChange(e){let t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)e(t)}diff(e){if(null==e&&(e=[]),!Ri(e))throw new Error(`Error trying to diff '${ee(e)}'. Only arrays and iterables are allowed`);return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let s,i,o,t=this._itHead,r=!1;if(Array.isArray(e)){this.length=e.length;for(let a=0;a<this.length;a++)i=e[a],o=this._trackByFn(a,i),null!==t&&Object.is(t.trackById,o)?(r&&(t=this._verifyReinsertion(t,i,o,a)),Object.is(t.item,i)||this._addIdentityChange(t,i)):(t=this._mismatch(t,i,o,a),r=!0),t=t._next}else s=0,function(n,e){if(Array.isArray(n))for(let t=0;t<n.length;t++)e(n[t]);else{const t=n[Ts()]();let r;for(;!(r=t.next()).done;)e(r.value)}}(e,a=>{o=this._trackByFn(s,a),null!==t&&Object.is(t.trackById,o)?(r&&(t=this._verifyReinsertion(t,a,o,s)),Object.is(t.item,a)||this._addIdentityChange(t,a)):(t=this._mismatch(t,a,o,s),r=!0),t=t._next,s++}),this.length=s;return this._truncate(t),this.collection=e,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let e;for(e=this._previousItHead=this._itHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;null!==e;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;null!==e;e=e._nextMoved)e.previousIndex=e.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(e,t,r,s){let i;return null===e?i=this._itTail:(i=e._prev,this._remove(e)),null!==(e=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,i,s)):null!==(e=null===this._linkedRecords?null:this._linkedRecords.get(r,s))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,i,s)):e=this._addAfter(new Tw(t,r),i,s),e}_verifyReinsertion(e,t,r,s){let i=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null);return null!==i?e=this._reinsertAfter(i,e._prev,s):e.currentIndex!=s&&(e.currentIndex=s,this._addToMoves(e,s)),e}_truncate(e){for(;null!==e;){const t=e._next;this._addToRemovals(this._unlink(e)),e=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(e,t,r){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(e);const s=e._prevRemoved,i=e._nextRemoved;return null===s?this._removalsHead=i:s._nextRemoved=i,null===i?this._removalsTail=s:i._prevRemoved=s,this._insertAfter(e,t,r),this._addToMoves(e,r),e}_moveAfter(e,t,r){return this._unlink(e),this._insertAfter(e,t,r),this._addToMoves(e,r),e}_addAfter(e,t,r){return this._insertAfter(e,t,r),this._additionsTail=null===this._additionsTail?this._additionsHead=e:this._additionsTail._nextAdded=e,e}_insertAfter(e,t,r){const s=null===t?this._itHead:t._next;return e._next=s,e._prev=t,null===s?this._itTail=e:s._prev=e,null===t?this._itHead=e:t._next=e,null===this._linkedRecords&&(this._linkedRecords=new fy),this._linkedRecords.put(e),e.currentIndex=r,e}_remove(e){return this._addToRemovals(this._unlink(e))}_unlink(e){null!==this._linkedRecords&&this._linkedRecords.remove(e);const t=e._prev,r=e._next;return null===t?this._itHead=r:t._next=r,null===r?this._itTail=t:r._prev=t,e}_addToMoves(e,t){return e.previousIndex===t||(this._movesTail=null===this._movesTail?this._movesHead=e:this._movesTail._nextMoved=e),e}_addToRemovals(e){return null===this._unlinkedRecords&&(this._unlinkedRecords=new fy),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}_addIdentityChange(e,t){return e.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=e:this._identityChangesTail._nextIdentityChange=e,e}}class Tw{constructor(e,t){this.item=e,this.trackById=t,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class Dw{constructor(){this._head=null,this._tail=null}add(e){null===this._head?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}get(e,t){let r;for(r=this._head;null!==r;r=r._nextDup)if((null===t||t<=r.currentIndex)&&Object.is(r.trackById,e))return r;return null}remove(e){const t=e._prevDup,r=e._nextDup;return null===t?this._head=r:t._nextDup=r,null===r?this._tail=t:r._prevDup=t,null===this._head}}class fy{constructor(){this.map=new Map}put(e){const t=e.trackById;let r=this.map.get(t);r||(r=new Dw,this.map.set(t,r)),r.add(e)}get(e,t){const s=this.map.get(e);return s?s.get(e,t):null}remove(e){const t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function hy(n,e,t){const r=n.previousIndex;if(null===r)return r;let s=0;return t&&r<t.length&&(s=t[r]),r+e+s}class py{constructor(){}supports(e){return e instanceof Map||fu(e)}create(){return new vw}}class vw{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(e){let t;for(t=this._mapHead;null!==t;t=t._next)e(t)}forEachPreviousItem(e){let t;for(t=this._previousMapHead;null!==t;t=t._nextPrevious)e(t)}forEachChangedItem(e){let t;for(t=this._changesHead;null!==t;t=t._nextChanged)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}diff(e){if(e){if(!(e instanceof Map||fu(e)))throw new Error(`Error trying to diff '${ee(e)}'. Only maps and objects are allowed`)}else e=new Map;return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let t=this._mapHead;if(this._appendAfter=null,this._forEach(e,(r,s)=>{if(t&&t.key===s)this._maybeAddToChanges(t,r),this._appendAfter=t,t=t._next;else{const i=this._getOrCreateRecordForKey(s,r);t=this._insertBeforeOrAppend(t,i)}}),t){t._prev&&(t._prev._next=null),this._removalsHead=t;for(let r=t;null!==r;r=r._nextRemoved)r===this._mapHead&&(this._mapHead=null),this._records.delete(r.key),r._nextRemoved=r._next,r.previousValue=r.currentValue,r.currentValue=null,r._prev=null,r._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(e,t){if(e){const r=e._prev;return t._next=e,t._prev=r,e._prev=t,r&&(r._next=t),e===this._mapHead&&(this._mapHead=t),this._appendAfter=e,e}return this._appendAfter?(this._appendAfter._next=t,t._prev=this._appendAfter):this._mapHead=t,this._appendAfter=t,null}_getOrCreateRecordForKey(e,t){if(this._records.has(e)){const s=this._records.get(e);this._maybeAddToChanges(s,t);const i=s._prev,o=s._next;return i&&(i._next=o),o&&(o._prev=i),s._next=null,s._prev=null,s}const r=new _w(e);return this._records.set(e,r),r.currentValue=t,this._addToAdditions(r),r}_reset(){if(this.isDirty){let e;for(this._previousMapHead=this._mapHead,e=this._previousMapHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._changesHead;null!==e;e=e._nextChanged)e.previousValue=e.currentValue;for(e=this._additionsHead;null!=e;e=e._nextAdded)e.previousValue=e.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(e,t){Object.is(t,e.currentValue)||(e.previousValue=e.currentValue,e.currentValue=t,this._addToChanges(e))}_addToAdditions(e){null===this._additionsHead?this._additionsHead=this._additionsTail=e:(this._additionsTail._nextAdded=e,this._additionsTail=e)}_addToChanges(e){null===this._changesHead?this._changesHead=this._changesTail=e:(this._changesTail._nextChanged=e,this._changesTail=e)}_forEach(e,t){e instanceof Map?e.forEach(t):Object.keys(e).forEach(r=>t(e[r],r))}}class _w{constructor(e){this.key=e,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function gy(){return new Oi([new dy])}let Oi=(()=>{class n{constructor(t){this.factories=t}static create(t,r){if(null!=r){const s=r.factories.slice();t=t.concat(s)}return new n(t)}static extend(t){return{provide:n,useFactory:r=>n.create(t,r||gy()),deps:[[n,new Rr,new Sn]]}}find(t){const r=this.factories.find(s=>s.supports(t));if(null!=r)return r;throw new Error(`Cannot find a differ supporting object '${t}' of type '${function(n){return n.name||typeof n}(t)}'`)}}return n.\u0275prov=se({token:n,providedIn:"root",factory:gy}),n})();function my(){return new ks([new py])}let ks=(()=>{class n{constructor(t){this.factories=t}static create(t,r){if(r){const s=r.factories.slice();t=t.concat(s)}return new n(t)}static extend(t){return{provide:n,useFactory:r=>n.create(t,r||my()),deps:[[n,new Rr,new Sn]]}}find(t){const r=this.factories.find(s=>s.supports(t));if(r)return r;throw new Error(`Cannot find a differ supporting object '${t}'`)}}return n.\u0275prov=se({token:n,providedIn:"root",factory:my}),n})();function Ca(n,e,t,r,s=!1){for(;null!==t;){const i=e[t.index];if(null!==i&&r.push(Be(i)),tn(i))for(let a=10;a<i.length;a++){const l=i[a],c=l[1].firstChild;null!==c&&Ca(l[1],l,c,r)}const o=t.type;if(8&o)Ca(n,e,t.child,r);else if(32&o){const a=Dc(t,e);let l;for(;l=a();)r.push(l)}else if(16&o){const a=Fp(e,t);if(Array.isArray(a))r.push(...a);else{const l=Di(e[16]);Ca(l[1],l,a,r,!0)}}t=s?t.projectionNext:t.next}return r}class Bi{constructor(e,t){this._lView=e,this._cdRefInjectingView=t,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const e=this._lView,t=e[1];return Ca(t,e,t.firstChild,[])}get context(){return this._lView[8]}set context(e){this._lView[8]=e}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const e=this._lView[3];if(tn(e)){const t=e[8],r=t?t.indexOf(this):-1;r>-1&&(bc(e,r),Ar(t,r))}this._attachedToViewContainer=!1}bp(this._lView[1],this._lView)}onDestroy(e){bg(this._lView[1],this._lView,null,e)}markForCheck(){!function(n){for(;n;){n[2]|=64;const e=Di(n);if(K_(n)&&!e)return n;n=e}}(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){nu(this._lView[1],this._lView,this.context)}checkNoChanges(){!function(n,e,t){Po(!0);try{nu(n,e,t)}finally{Po(!1)}}(this._lView[1],this._lView,this.context)}attachToViewContainerRef(){if(this._appRef)throw new Error("This view is already attached directly to the ApplicationRef!");this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function(n,e){vi(n,e,e[J],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new Error("This view is already attached to a ViewContainer!");this._appRef=e}}class Cw extends Bi{constructor(e){super(e),this._view=e}detectChanges(){Fg(this._view)}checkNoChanges(){!function(n){Po(!0);try{Fg(n)}finally{Po(!1)}}(this._view)}get context(){return null}}const Rw=[new py],Mw=new Oi([new dy]),Pw=new ks(Rw),kw=function(){return ba(je(),A())};let Yn=(()=>{class n{}return n.__NG_ELEMENT_ID__=kw,n})();const Nw=Yn,Ow=class extends Nw{constructor(e,t,r){super(),this._declarationLView=e,this._declarationTContainer=t,this.elementRef=r}createEmbeddedView(e){const t=this._declarationTContainer.tViews,r=bi(this._declarationLView,t,e,16,null,t.declTNode,null,null,null,null);r[17]=this._declarationLView[this._declarationTContainer.index];const i=this._declarationLView[19];return null!==i&&(r[19]=i.createEmbeddedView(t)),Si(t,r,e),new Bi(r)}};function ba(n,e){return 4&n.type?new Ow(e,n,Fs(n,e)):null}class Or{}const $w=function(){return Ty(je(),A())};let Fn=(()=>{class n{}return n.__NG_ELEMENT_ID__=$w,n})();const jw=Fn,yy=class extends jw{constructor(e,t,r){super(),this._lContainer=e,this._hostTNode=t,this._hostLView=r}get element(){return Fs(this._hostTNode,this._hostLView)}get injector(){return new rs(this._hostTNode,this._hostLView)}get parentInjector(){const e=Ho(this._hostTNode,this._hostLView);if(zh(e)){const t=ns(e,this._hostLView),r=ts(e);return new rs(t[1].data[r+8],t)}return new rs(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){const t=Ey(this._lContainer);return null!==t&&t[e]||null}get length(){return this._lContainer.length-10}createEmbeddedView(e,t,r){const s=e.createEmbeddedView(t||{});return this.insert(s,r),s}createComponent(e,t,r,s,i){const o=r||this.parentInjector;if(!i&&null==e.ngModule&&o){const l=o.get(Or,null);l&&(i=l)}const a=e.create(o,s,void 0,i);return this.insert(a.hostView,t),a}insert(e,t){const r=e._lView,s=r[1];if(function(n){return tn(n[3])}(r)){const u=this.indexOf(e);if(-1!==u)this.detach(u);else{const d=r[3],f=new yy(d,d[6],d[3]);f.detach(f.indexOf(e))}}const i=this._adjustIndex(t),o=this._lContainer;!function(n,e,t,r){const s=10+r,i=t.length;r>0&&(t[s-1][4]=e),r<i-10?(e[4]=t[s],Wo(t,10+r,e)):(t.push(e),e[4]=null),e[3]=t;const o=e[17];null!==o&&t!==o&&function(n,e){const t=n[9];e[16]!==e[3][3][16]&&(n[2]=!0),null===t?n[9]=[e]:t.push(e)}(o,e);const a=e[19];null!==a&&a.insertView(n),e[2]|=128}(s,r,o,i);const a=Ac(i,o),l=r[J],c=Xo(l,o[7]);return null!==c&&function(n,e,t,r,s,i){r[0]=s,r[6]=e,vi(n,r,t,1,s,i)}(s,o[6],l,r,c,a),e.attachToViewContainerRef(),Wo(Fu(o),i,e),e}move(e,t){return this.insert(e,t)}indexOf(e){const t=Ey(this._lContainer);return null!==t?t.indexOf(e):-1}remove(e){const t=this._adjustIndex(e,-1),r=bc(this._lContainer,t);r&&(Ar(Fu(this._lContainer),t),bp(r[1],r))}detach(e){const t=this._adjustIndex(e,-1),r=bc(this._lContainer,t);return r&&null!=Ar(Fu(this._lContainer),t)?new Bi(r):null}_adjustIndex(e,t=0){return null==e?this.length+t:e}};function Ey(n){return n[8]}function Fu(n){return n[8]||(n[8]=[])}function Ty(n,e){let t;const r=e[n.index];if(tn(r))t=r;else{let s;if(8&n.type)s=Be(r);else{const i=e[J];s=i.createComment("");const o=Rt(n,e);Lr(i,Xo(i,o),s,function(n,e){return Fe(n)?n.nextSibling(e):e.nextSibling}(i,o),!1)}e[n.index]=t=Pg(r,e,s,n),la(e,t)}return new yy(t,n,e)}const Us={};class Uy extends Ps{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){const t=nt(e);return new $y(t,this.ngModule)}}function Vy(n){const e=[];for(let t in n)n.hasOwnProperty(t)&&e.push({propName:n[t],templateName:t});return e}const UR=new ce("SCHEDULER_TOKEN",{providedIn:"root",factory:()=>ng});class $y extends iy{constructor(e,t){super(),this.componentDef=e,this.ngModule=t,this.componentType=e.type,this.selector=function(n){return n.map(Cb).join(",")}(e.selectors),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!t}get inputs(){return Vy(this.componentDef.inputs)}get outputs(){return Vy(this.componentDef.outputs)}create(e,t,r,s){const i=(s=s||this.ngModule)?function(n,e){return{get:(t,r,s)=>{const i=n.get(t,Us,s);return i!==Us||r===Us?i:e.get(t,r,s)}}}(e,s.injector):e,o=i.get(xa,Ph),a=i.get(Mu,null),l=o.createRenderer(null,this.componentDef),c=this.componentDef.selectors[0][0]||"div",u=r?function(n,e,t){if(Fe(n))return n.selectRootElement(e,t===He.ShadowDom);let r="string"==typeof e?n.querySelector(e):e;return r.textContent="",r}(l,r,this.componentDef.encapsulation):Cc(o.createRenderer(null,this.componentDef),c,function(n){const e=n.toLowerCase();return"svg"===e?"http://www.w3.org/2000/svg":"math"===e?"http://www.w3.org/1998/MathML/":null}(c)),d=this.componentDef.onPush?576:528,f=function(n,e){return{components:[],scheduler:n||ng,clean:cS,playerHandler:e||null,flags:0}}(),h=aa(0,null,null,1,0,null,null,null,null,null),p=bi(null,h,f,d,null,null,o,l,a,i);let g,m;Fo(p);try{const E=function(n,e,t,r,s,i){const o=t[1];t[20]=n;const l=hs(o,20,2,"#host",null),c=l.mergedAttrs=e.hostAttrs;null!==c&&(ca(l,c,!0),null!==n&&(Uo(s,n,c),null!==l.classes&&Lc(s,n,l.classes),null!==l.styles&&Np(s,n,l.styles)));const u=r.createRenderer(n,e),d=bi(t,_g(e),null,e.onPush?64:16,t[20],l,r,u,i||null,null);return o.firstCreatePass&&(jo(ci(l,t),o,e.type),Rg(o,l),Lg(l,t.length,1)),la(t,d),t[20]=d}(u,this.componentDef,p,o,l);if(u)if(r)Uo(l,u,["ng-version",uy.full]);else{const{attrs:T,classes:D}=function(n){const e=[],t=[];let r=1,s=2;for(;r<n.length;){let i=n[r];if("string"==typeof i)2===s?""!==i&&e.push(i,n[++r]):8===s&&t.push(i);else{if(!rn(s))break;s=i}r++}return{attrs:e,classes:t}}(this.componentDef.selectors[0]);T&&Uo(l,u,T),D&&D.length>0&&Lc(l,u,D.join(" "))}if(m=Yl(h,20),void 0!==t){const T=m.projection=[];for(let D=0;D<this.ngContentSelectors.length;D++){const x=t[D];T.push(null!=x?Array.from(x):null)}}g=function(n,e,t,r,s){const i=t[1],o=function(n,e,t){const r=je();n.firstCreatePass&&(t.providersResolver&&t.providersResolver(t),Mg(n,r,e,ps(n,e,1,null),t));const s=ui(e,n,r.directiveStart,r);st(s,e);const i=Rt(r,e);return i&&st(i,e),s}(i,t,e);if(r.components.push(o),n[8]=o,s&&s.forEach(l=>l(o,e)),e.contentQueries){const l=je();e.contentQueries(1,o,l.directiveStart)}const a=je();return!i.firstCreatePass||null===e.hostBindings&&null===e.hostAttrs||(lr(a.index),Ag(t[1],a,0,a.directiveStart,a.directiveEnd,e),wg(e,o)),o}(E,this.componentDef,p,f,[kS]),Si(h,p,null)}finally{ko()}return new HR(this.componentType,g,Fs(m,p),p,m)}}class HR extends class{}{constructor(e,t,r,s,i){super(),this.location=r,this._rootLView=s,this._tNode=i,this.instance=t,this.hostView=this.changeDetectorRef=new Cw(s),this.componentType=e}get injector(){return new rs(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}}const Vs=new Map;class KR extends Or{constructor(e,t){super(),this._parent=t,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new Uy(this);const r=Bt(e),s=function(n){return n[O_]||null}(e);s&&Cu(s),this._bootstrapComponents=wn(r.bootstrap),this._r3Injector=Hg(e,t,[{provide:Or,useValue:this},{provide:Ps,useValue:this.componentFactoryResolver}],ee(e)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(e)}get(e,t=xe.THROW_IF_NOT_FOUND,r=$.Default){return e===xe||e===Or||e===ms?this:this._r3Injector.get(e,t,r)}destroy(){const e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}}class Yu extends class{}{constructor(e){super(),this.moduleType=e,null!==Bt(e)&&function(n){const e=new Set;!function t(r){const s=Bt(r,!0),i=s.id;null!==i&&(function(n,e,t){if(e&&e!==t)throw new Error(`Duplicate module registered for ${n} - ${ee(e)} vs ${ee(e.name)}`)}(i,Vs.get(i),r),Vs.set(i,r));const o=wn(s.imports);for(const a of o)e.has(a)||(e.add(a),t(a))}(n)}(e)}create(e){return new KR(this.moduleType,e)}}function qu(n){return e=>{setTimeout(n,void 0,e)}}const qn=class extends wl{constructor(e=!1){super(),this.__isAsync=e}emit(e){super.next(e)}subscribe(e,t,r){var s,i,o;let a=e,l=t||(()=>null),c=r;if(e&&"object"==typeof e){const d=e;a=null===(s=d.next)||void 0===s?void 0:s.bind(d),l=null===(i=d.error)||void 0===i?void 0:i.bind(d),c=null===(o=d.complete)||void 0===o?void 0:o.bind(d)}this.__isAsync&&(l=qu(l),a&&(a=qu(a)),c&&(c=qu(c)));const u=super.subscribe({next:a,error:l,complete:c});return e instanceof Ne&&e.add(u),u}};function uL(){return this._results[Ts()]()}class Ra{constructor(e=!1){this._emitDistinctChangesOnly=e,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const t=Ts(),r=Ra.prototype;r[t]||(r[t]=uL)}get changes(){return this._changes||(this._changes=new qn)}get(e){return this._results[e]}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,t){return this._results.reduce(e,t)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(e,t){const r=this;r.dirty=!1;const s=$t(e);(this._changesDetected=!function(n,e,t){if(n.length!==e.length)return!1;for(let r=0;r<n.length;r++){let s=n[r],i=e[r];if(t&&(s=t(s),i=t(i)),i!==s)return!1}return!0}(r._results,s,t))&&(r._results=s,r.length=s.length,r.last=s[this.length-1],r.first=s[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}Symbol;class zu{constructor(e){this.queryList=e,this.matches=null}clone(){return new zu(this.queryList)}setDirty(){this.queryList.setDirty()}}class Qu{constructor(e=[]){this.queries=e}createEmbeddedView(e){const t=e.queries;if(null!==t){const r=null!==e.contentQueries?e.contentQueries[0]:t.length,s=[];for(let i=0;i<r;i++){const o=t.getByIndex(i);s.push(this.queries[o.indexInDeclarationView].clone())}return new Qu(s)}return null}insertView(e){this.dirtyQueriesWithMatches(e)}detachView(e){this.dirtyQueriesWithMatches(e)}dirtyQueriesWithMatches(e){for(let t=0;t<this.queries.length;t++)null!==nE(e,t).matches&&this.queries[t].setDirty()}}class zy{constructor(e,t,r=null){this.predicate=e,this.flags=t,this.read=r}}class Xu{constructor(e=[]){this.queries=e}elementStart(e,t){for(let r=0;r<this.queries.length;r++)this.queries[r].elementStart(e,t)}elementEnd(e){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(e)}embeddedTView(e){let t=null;for(let r=0;r<this.length;r++){const s=null!==t?t.length:0,i=this.getByIndex(r).embeddedTView(e,s);i&&(i.indexInDeclarationView=r,null!==t?t.push(i):t=[i])}return null!==t?new Xu(t):null}template(e,t){for(let r=0;r<this.queries.length;r++)this.queries[r].template(e,t)}getByIndex(e){return this.queries[e]}get length(){return this.queries.length}track(e){this.queries.push(e)}}class Ju{constructor(e,t=-1){this.metadata=e,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=t}elementStart(e,t){this.isApplyingToNode(t)&&this.matchTNode(e,t)}elementEnd(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}template(e,t){this.elementStart(e,t)}embeddedTView(e,t){return this.isApplyingToNode(e)?(this.crossesNgTemplate=!0,this.addMatch(-e.index,t),new Ju(this.metadata)):null}isApplyingToNode(e){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const t=this._declarationNodeIndex;let r=e.parent;for(;null!==r&&8&r.type&&r.index!==t;)r=r.parent;return t===(null!==r?r.index:-1)}return this._appliesToNextNode}matchTNode(e,t){const r=this.metadata.predicate;if(Array.isArray(r))for(let s=0;s<r.length;s++){const i=r[s];this.matchTNodeWithReadOption(e,t,hL(t,i)),this.matchTNodeWithReadOption(e,t,Go(t,e,i,!1,!1))}else r===Yn?4&t.type&&this.matchTNodeWithReadOption(e,t,-1):this.matchTNodeWithReadOption(e,t,Go(t,e,r,!1,!1))}matchTNodeWithReadOption(e,t,r){if(null!==r){const s=this.metadata.read;if(null!==s)if(s===un||s===Fn||s===Yn&&4&t.type)this.addMatch(t.index,-2);else{const i=Go(t,e,s,!1,!1);null!==i&&this.addMatch(t.index,i)}else this.addMatch(t.index,r)}}addMatch(e,t){null===this.matches?this.matches=[e,t]:this.matches.push(e,t)}}function hL(n,e){const t=n.localNames;if(null!==t)for(let r=0;r<t.length;r+=2)if(t[r]===e)return t[r+1];return null}function gL(n,e,t,r){return-1===t?function(n,e){return 11&n.type?Fs(n,e):4&n.type?ba(n,e):null}(e,n):-2===t?function(n,e,t){return t===un?Fs(e,n):t===Yn?ba(e,n):t===Fn?Ty(e,n):void 0}(n,e,r):ui(n,n[1],t,e)}function Qy(n,e,t,r){const s=e[19].queries[r];if(null===s.matches){const i=n.data,o=t.matches,a=[];for(let l=0;l<o.length;l+=2){const c=o[l];a.push(c<0?null:gL(e,i[c],o[l+1],t.metadata.read))}s.matches=a}return s.matches}function Zu(n,e,t,r){const s=n.queries.getByIndex(t),i=s.matches;if(null!==i){const o=Qy(n,e,s,t);for(let a=0;a<i.length;a+=2){const l=i[a];if(l>0)r.push(o[a/2]);else{const c=i[a+1],u=e[-l];for(let d=10;d<u.length;d++){const f=u[d];f[17]===f[3]&&Zu(f[1],f,c,r)}if(null!==u[9]){const d=u[9];for(let f=0;f<d.length;f++){const h=d[f];Zu(h[1],h,c,r)}}}}}return r}function Xy(n){const e=A(),t=ie(),r=Vh();ec(r+1);const s=nE(t,r);if(n.dirty&&Fh(e)===(2==(2&s.metadata.flags))){if(null===s.matches)n.reset([]);else{const i=s.crossesNgTemplate?Zu(t,e,r,[]):Qy(t,e,s,r);n.reset(i,ly),n.notifyOnChanges()}return!0}return!1}function Jy(n,e,t){const r=ie();r.firstCreatePass&&(function(n,e,t){null===n.queries&&(n.queries=new Xu),n.queries.track(new Ju(e,t))}(r,new zy(n,e,t),-1),2==(2&e)&&(r.staticViewQueries=!0)),function(n,e,t){const r=new Ra(4==(4&t));bg(n,e,r,r.destroy),null===e[19]&&(e[19]=new Qu),e[19].queries.push(new zu(r))}(r,A(),e)}function nE(n,e){return n.queries.getByIndex(e)}const Pa=new ce("Application Initializer");let Hs=(()=>{class n{constructor(t){this.appInits=t,this.resolve=_a,this.reject=_a,this.initialized=!1,this.done=!1,this.donePromise=new Promise((r,s)=>{this.resolve=r,this.reject=s})}runInitializers(){if(this.initialized)return;const t=[],r=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let s=0;s<this.appInits.length;s++){const i=this.appInits[s]();if(Tu(i))t.push(i);else if(km(i)){const o=new Promise((a,l)=>{i.subscribe({complete:a,error:l})});t.push(o)}}Promise.all(t).then(()=>{r()}).catch(s=>{this.reject(s)}),0===t.length&&r(),this.initialized=!0}}return n.\u0275fac=function(t){return new(t||n)(W(Pa,8))},n.\u0275prov=se({token:n,factory:n.\u0275fac}),n})();const Qi=new ce("AppId"),YL={provide:Qi,useFactory:function(){return`${id()}${id()}${id()}`},deps:[]};function id(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const DE=new ce("Platform Initializer"),Fa=new ce("Platform ID"),qL=new ce("appBootstrapListener");let od=(()=>{class n{log(t){console.log(t)}warn(t){console.warn(t)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=se({token:n,factory:n.\u0275fac}),n})();const pr=new ce("LocaleId"),vE=new ce("DefaultCurrencyCode");class QL{constructor(e,t){this.ngModuleFactory=e,this.componentFactories=t}}const ad=function(n){return new Yu(n)},XL=ad,JL=function(n){return Promise.resolve(ad(n))},_E=function(n){const e=ad(n),r=wn(Bt(n).declarations).reduce((s,i)=>{const o=nt(i);return o&&s.push(new $y(o)),s},[]);return new QL(e,r)},ZL=_E,eM=function(n){return Promise.resolve(_E(n))};let Na=(()=>{class n{constructor(){this.compileModuleSync=XL,this.compileModuleAsync=JL,this.compileModuleAndAllComponentsSync=ZL,this.compileModuleAndAllComponentsAsync=eM}clearCache(){}clearCacheFor(t){}getModuleId(t){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=se({token:n,factory:n.\u0275fac}),n})();const rM=(()=>Promise.resolve(0))();function ld(n){"undefined"==typeof Zone?rM.then(()=>{n&&n.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",n)}class et{constructor({enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:t=!1,shouldCoalesceRunChangeDetection:r=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new qn(!1),this.onMicrotaskEmpty=new qn(!1),this.onStable=new qn(!1),this.onError=new qn(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const s=this;s._nesting=0,s._outer=s._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(s._inner=s._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(s._inner=s._inner.fork(Zone.longStackTraceZoneSpec)),s.shouldCoalesceEventChangeDetection=!r&&t,s.shouldCoalesceRunChangeDetection=r,s.lastRequestAnimationFrameId=-1,s.nativeRequestAnimationFrame=function(){let n=de.requestAnimationFrame,e=de.cancelAnimationFrame;if("undefined"!=typeof Zone&&n&&e){const t=n[Zone.__symbol__("OriginalDelegate")];t&&(n=t);const r=e[Zone.__symbol__("OriginalDelegate")];r&&(e=r)}return{nativeRequestAnimationFrame:n,nativeCancelAnimationFrame:e}}().nativeRequestAnimationFrame,function(n){const e=()=>{!function(n){n.isCheckStableRunning||-1!==n.lastRequestAnimationFrameId||(n.lastRequestAnimationFrameId=n.nativeRequestAnimationFrame.call(de,()=>{n.fakeTopEventTask||(n.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{n.lastRequestAnimationFrameId=-1,ud(n),n.isCheckStableRunning=!0,cd(n),n.isCheckStableRunning=!1},void 0,()=>{},()=>{})),n.fakeTopEventTask.invoke()}),ud(n))}(n)};n._inner=n._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(t,r,s,i,o,a)=>{try{return xE(n),t.invokeTask(s,i,o,a)}finally{(n.shouldCoalesceEventChangeDetection&&"eventTask"===i.type||n.shouldCoalesceRunChangeDetection)&&e(),CE(n)}},onInvoke:(t,r,s,i,o,a,l)=>{try{return xE(n),t.invoke(s,i,o,a,l)}finally{n.shouldCoalesceRunChangeDetection&&e(),CE(n)}},onHasTask:(t,r,s,i)=>{t.hasTask(s,i),r===s&&("microTask"==i.change?(n._hasPendingMicrotasks=i.microTask,ud(n),cd(n)):"macroTask"==i.change&&(n.hasPendingMacrotasks=i.macroTask))},onHandleError:(t,r,s,i)=>(t.handleError(s,i),n.runOutsideAngular(()=>n.onError.emit(i)),!1)})}(s)}static isInAngularZone(){return!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!et.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(et.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(e,t,r){return this._inner.run(e,t,r)}runTask(e,t,r,s){const i=this._inner,o=i.scheduleEventTask("NgZoneEvent: "+s,e,iM,_a,_a);try{return i.runTask(o,t,r)}finally{i.cancelTask(o)}}runGuarded(e,t,r){return this._inner.runGuarded(e,t,r)}runOutsideAngular(e){return this._outer.run(e)}}const iM={};function cd(n){if(0==n._nesting&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function ud(n){n.hasPendingMicrotasks=!!(n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&-1!==n.lastRequestAnimationFrameId)}function xE(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function CE(n){n._nesting--,cd(n)}class lM{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new qn,this.onMicrotaskEmpty=new qn,this.onStable=new qn,this.onError=new qn}run(e,t,r){return e.apply(t,r)}runGuarded(e,t,r){return e.apply(t,r)}runOutsideAngular(e){return e()}runTask(e,t,r,s){return e.apply(t,r)}}let dd=(()=>{class n{constructor(t){this._ngZone=t,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),t.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{et.assertNotInAngularZone(),ld(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())ld(()=>{for(;0!==this._callbacks.length;){let t=this._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb(this._didWork)}this._didWork=!1});else{let t=this.getPendingTasks();this._callbacks=this._callbacks.filter(r=>!r.updateCb||!r.updateCb(t)||(clearTimeout(r.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(t=>({source:t.source,creationLocation:t.creationLocation,data:t.data})):[]}addCallback(t,r,s){let i=-1;r&&r>0&&(i=setTimeout(()=>{this._callbacks=this._callbacks.filter(o=>o.timeoutId!==i),t(this._didWork,this.getPendingTasks())},r)),this._callbacks.push({doneCb:t,timeoutId:i,updateCb:s})}whenStable(t,r,s){if(s&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(t,r,s),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(t,r,s){return[]}}return n.\u0275fac=function(t){return new(t||n)(W(et))},n.\u0275prov=se({token:n,factory:n.\u0275fac}),n})(),bE=(()=>{class n{constructor(){this._applications=new Map,fd.addToWindow(this)}registerApplication(t,r){this._applications.set(t,r)}unregisterApplication(t){this._applications.delete(t)}unregisterAllApplications(){this._applications.clear()}getTestability(t){return this._applications.get(t)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(t,r=!0){return fd.findTestabilityInTree(this,t,r)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=se({token:n,factory:n.\u0275fac}),n})();class cM{addToWindow(e){}findTestabilityInTree(e,t,r){return null}}let fd=new cM,SE=!0,IE=!1;let hn;const wE=new ce("AllowMultipleToken");function RE(n,e,t=[]){const r=`Platform: ${e}`,s=new ce(r);return(i=[])=>{let o=LE();if(!o||o.injector.get(wE,!1))if(n)n(t.concat(i).concat({provide:s,useValue:!0}));else{const a=t.concat(i).concat({provide:s,useValue:!0},{provide:Ii,useValue:"platform"});!function(n){if(hn&&!hn.destroyed&&!hn.injector.get(wE,!1))throw new Error("There can be only one platform. Destroy the previous one to create a new one.");hn=n.get(ME);const e=n.get(DE,null);e&&e.forEach(t=>t())}(xe.create({providers:a,name:r}))}return function(n){const e=LE();if(!e)throw new Error("No platform exists!");if(!e.injector.get(n,null))throw new Error("A platform with a different configuration has been created. Please destroy it first.");return e}(s)}}function LE(){return hn&&!hn.destroyed?hn:null}let ME=(()=>{class n{constructor(t){this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(t,r){const a=function(n,e){let t;return t="noop"===n?new lM:("zone.js"===n?void 0:n)||new et({enableLongStackTrace:(IE=!0,SE),shouldCoalesceEventChangeDetection:!!(null==e?void 0:e.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==e?void 0:e.ngZoneRunCoalescing)}),t}(r?r.ngZone:void 0,{ngZoneEventCoalescing:r&&r.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:r&&r.ngZoneRunCoalescing||!1}),l=[{provide:et,useValue:a}];return a.run(()=>{const c=xe.create({providers:l,parent:this.injector,name:t.moduleType.name}),u=t.create(c),d=u.injector.get(Fr,null);if(!d)throw new Error("No ErrorHandler. Is platform module (BrowserModule) included?");return a.runOutsideAngular(()=>{const f=a.onError.subscribe({next:h=>{d.handleError(h)}});u.onDestroy(()=>{hd(this._modules,u),f.unsubscribe()})}),function(n,e,t){try{const r=t();return Tu(r)?r.catch(s=>{throw e.runOutsideAngular(()=>n.handleError(s)),s}):r}catch(r){throw e.runOutsideAngular(()=>n.handleError(r)),r}}(d,a,()=>{const f=u.injector.get(Hs);return f.runInitializers(),f.donePromise.then(()=>(Cu(u.injector.get(pr,ya)||ya),this._moduleDoBootstrap(u),u))})})}bootstrapModule(t,r=[]){const s=PE({},r);return function(n,e,t){const r=new Yu(t);return Promise.resolve(r)}(0,0,t).then(i=>this.bootstrapModuleFactory(i,s))}_moduleDoBootstrap(t){const r=t.injector.get(Xi);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(s=>r.bootstrap(s));else{if(!t.instance.ngDoBootstrap)throw new Error(`The module ${ee(t.instance.constructor)} was bootstrapped, but it does not declare "@NgModule.bootstrap" components nor a "ngDoBootstrap" method. Please define one of these.`);t.instance.ngDoBootstrap(r)}this._modules.push(t)}onDestroy(t){this._destroyListeners.push(t)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Error("The platform has already been destroyed!");this._modules.slice().forEach(t=>t.destroy()),this._destroyListeners.forEach(t=>t()),this._destroyed=!0}get destroyed(){return this._destroyed}}return n.\u0275fac=function(t){return new(t||n)(W(xe))},n.\u0275prov=se({token:n,factory:n.\u0275fac}),n})();function PE(n,e){return Array.isArray(e)?e.reduce(PE,n):Object.assign(Object.assign({},n),e)}let Xi=(()=>{class n{constructor(t,r,s,i,o){this._zone=t,this._injector=r,this._exceptionHandler=s,this._componentFactoryResolver=i,this._initStatus=o,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const a=new dt(c=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{c.next(this._stable),c.complete()})}),l=new dt(c=>{let u;this._zone.runOutsideAngular(()=>{u=this._zone.onStable.subscribe(()=>{et.assertNotInAngularZone(),ld(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,c.next(!0))})})});const d=this._zone.onUnstable.subscribe(()=>{et.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{c.next(!1)}))});return()=>{u.unsubscribe(),d.unsubscribe()}});this.isStable=function(...n){let e=Number.POSITIVE_INFINITY,t=null,r=n[n.length-1];return ch(r)?(t=n.pop(),n.length>1&&"number"==typeof n[n.length-1]&&(e=n.pop())):"number"==typeof r&&(e=n.pop()),null===t&&1===n.length&&n[0]instanceof dt?n[0]:function(n=Number.POSITIVE_INFINITY){return Ll(sh,n)}(e)(ph(n,t))}(a,l.pipe(n=>gh()(function(n,e){return function(r){let s;s="function"==typeof n?n:function(){return n};const i=Object.create(r,E_);return i.source=r,i.subjectFactory=s,i}}(x_)(n))))}bootstrap(t,r){if(!this._initStatus.done)throw new Error("Cannot bootstrap as there are still asynchronous initializers running. Bootstrap components in the `ngDoBootstrap` method of the root module.");let s;s=t instanceof iy?t:this._componentFactoryResolver.resolveComponentFactory(t),this.componentTypes.push(s.componentType);const i=function(n){return n.isBoundToModule}(s)?void 0:this._injector.get(Or),a=s.create(xe.NULL,[],r||s.selector,i),l=a.location.nativeElement,c=a.injector.get(dd,null),u=c&&a.injector.get(bE);return c&&u&&u.registerApplication(l,c),a.onDestroy(()=>{this.detachView(a.hostView),hd(this.components,a),u&&u.unregisterApplication(l)}),this._loadComponent(a),a}tick(){if(this._runningTick)throw new Error("ApplicationRef.tick is called recursively");try{this._runningTick=!0;for(let t of this._views)t.detectChanges()}catch(t){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(t))}finally{this._runningTick=!1}}attachView(t){const r=t;this._views.push(r),r.attachToAppRef(this)}detachView(t){const r=t;hd(this._views,r),r.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView),this.tick(),this.components.push(t),this._injector.get(qL,[]).concat(this._bootstrapListeners).forEach(s=>s(t))}ngOnDestroy(){this._views.slice().forEach(t=>t.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return n.\u0275fac=function(t){return new(t||n)(W(et),W(xe),W(Fr),W(Ps),W(Hs))},n.\u0275prov=se({token:n,factory:n.\u0275fac}),n})();function hd(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}const NM=RE(null,"core",[{provide:Fa,useValue:"unknown"},{provide:ME,deps:[xe]},{provide:bE,deps:[]},{provide:od,deps:[]}]),$M=[{provide:Xi,useClass:Xi,deps:[et,xe,Fr,Ps,Hs]},{provide:UR,deps:[et],useFactory:function(n){let e=[];return n.onStable.subscribe(()=>{for(;e.length;)e.pop()()}),function(t){e.push(t)}}},{provide:Hs,useClass:Hs,deps:[[new Sn,Pa]]},{provide:Na,useClass:Na,deps:[]},YL,{provide:Oi,useFactory:function(){return Mw},deps:[]},{provide:ks,useFactory:function(){return Pw},deps:[]},{provide:pr,useFactory:function(n){return Cu(n=n||"undefined"!=typeof $localize&&$localize.locale||ya),n},deps:[[new yi(pr),new Sn,new Rr]]},{provide:vE,useValue:"USD"}];let jM=(()=>{class n{constructor(t){}}return n.\u0275fac=function(t){return new(t||n)(W(Xi))},n.\u0275mod=vr({type:n}),n.\u0275inj=Un({providers:$M}),n})(),Wa=null;function no(){return Wa}const lt=new ce("DocumentToken");var Ue=(()=>((Ue=Ue||{})[Ue.Zero=0]="Zero",Ue[Ue.One=1]="One",Ue[Ue.Two=2]="Two",Ue[Ue.Few=3]="Few",Ue[Ue.Many=4]="Many",Ue[Ue.Other=5]="Other",Ue))();const X1=function(n){return function(n){const e=function(n){return n.toLowerCase().replace(/_/g,"-")}(n);let t=P0(e);if(t)return t;const r=e.split("-")[0];if(t=P0(r),t)return t;if("en"===r)return lA;throw new Error(`Missing locale data for the locale "${n}".`)}(n)[P.PluralCase]};class nl{}let SP=(()=>{class n extends nl{constructor(t){super(),this.locale=t}getPluralCategory(t,r){switch(X1(r||this.locale)(t)){case Ue.Zero:return"zero";case Ue.One:return"one";case Ue.Two:return"two";case Ue.Few:return"few";case Ue.Many:return"many";default:return"other"}}}return n.\u0275fac=function(t){return new(t||n)(W(pr))},n.\u0275prov=se({token:n,factory:n.\u0275fac}),n})();function yT(n,e){e=encodeURIComponent(e);for(const t of n.split(";")){const r=t.indexOf("="),[s,i]=-1==r?[t,""]:[t.slice(0,r),t.slice(r+1)];if(s.trim()===e)return decodeURIComponent(i)}return null}let TT=(()=>{class n{constructor(t,r){this._viewContainer=t,this._context=new MP,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=r}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){DT("ngIfThen",t),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){DT("ngIfElse",t),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(t,r){return!0}}return n.\u0275fac=function(t){return new(t||n)(ne(Fn),ne(Yn))},n.\u0275dir=Ot({type:n,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),n})();class MP{constructor(){this.$implicit=null,this.ngIf=null}}function DT(n,e){if(e&&!e.createEmbeddedView)throw new Error(`${n} must be a TemplateRef, but received '${ee(e)}'.`)}let sF=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=vr({type:n}),n.\u0275inj=Un({providers:[{provide:nl,useClass:SP}]}),n})();class bT{}class Vd extends class extends class{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function(n){Wa||(Wa=n)}(new Vd)}onAndCancel(e,t,r){return e.addEventListener(t,r,!1),()=>{e.removeEventListener(t,r,!1)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,t){return(t=t||this.getDefaultDocument()).createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return"window"===t?window:"document"===t?e:"body"===t?e.body:null}getBaseHref(e){const t=(io=io||document.querySelector("base"),io?io.getAttribute("href"):null);return null==t?null:function(n){rl=rl||document.createElement("a"),rl.setAttribute("href",n);const e=rl.pathname;return"/"===e.charAt(0)?e:`/${e}`}(t)}resetBaseElement(){io=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return yT(document.cookie,e)}}let rl,io=null;const ST=new ce("TRANSITION_ID"),hF=[{provide:Pa,useFactory:function(n,e,t){return()=>{t.get(Hs).donePromise.then(()=>{const r=no(),s=e.querySelectorAll(`style[ng-transition="${n}"]`);for(let i=0;i<s.length;i++)r.remove(s[i])})}},deps:[ST,lt,xe],multi:!0}];class $d{static init(){!function(n){fd=n}(new $d)}addToWindow(e){de.getAngularTestability=(r,s=!0)=>{const i=e.findTestabilityInTree(r,s);if(null==i)throw new Error("Could not find testability for element.");return i},de.getAllAngularTestabilities=()=>e.getAllTestabilities(),de.getAllAngularRootElements=()=>e.getAllRootElements(),de.frameworkStabilizers||(de.frameworkStabilizers=[]),de.frameworkStabilizers.push(r=>{const s=de.getAllAngularTestabilities();let i=s.length,o=!1;const a=function(l){o=o||l,i--,0==i&&r(o)};s.forEach(function(l){l.whenStable(a)})})}findTestabilityInTree(e,t,r){if(null==t)return null;const s=e.getTestability(t);return null!=s?s:r?no().isShadowRoot(t)?this.findTestabilityInTree(e,t.host,!0):this.findTestabilityInTree(e,t.parentElement,!0):null}}let pF=(()=>{class n{build(){return new XMLHttpRequest}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=se({token:n,factory:n.\u0275fac}),n})();const oo=new ce("EventManagerPlugins");let il=(()=>{class n{constructor(t,r){this._zone=r,this._eventNameToPlugin=new Map,t.forEach(s=>s.manager=this),this._plugins=t.slice().reverse()}addEventListener(t,r,s){return this._findPluginFor(r).addEventListener(t,r,s)}addGlobalEventListener(t,r,s){return this._findPluginFor(r).addGlobalEventListener(t,r,s)}getZone(){return this._zone}_findPluginFor(t){const r=this._eventNameToPlugin.get(t);if(r)return r;const s=this._plugins;for(let i=0;i<s.length;i++){const o=s[i];if(o.supports(t))return this._eventNameToPlugin.set(t,o),o}throw new Error(`No event manager plugin found for event ${t}`)}}return n.\u0275fac=function(t){return new(t||n)(W(oo),W(et))},n.\u0275prov=se({token:n,factory:n.\u0275fac}),n})();class Hd{constructor(e){this._doc=e}addGlobalEventListener(e,t,r){const s=no().getGlobalEventTarget(this._doc,e);if(!s)throw new Error(`Unsupported event target ${s} for event ${t}`);return this.addEventListener(s,t,r)}}let AT=(()=>{class n{constructor(){this._stylesSet=new Set}addStyles(t){const r=new Set;t.forEach(s=>{this._stylesSet.has(s)||(this._stylesSet.add(s),r.add(s))}),this.onStylesAdded(r)}onStylesAdded(t){}getAllStyles(){return Array.from(this._stylesSet)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=se({token:n,factory:n.\u0275fac}),n})(),ao=(()=>{class n extends AT{constructor(t){super(),this._doc=t,this._hostNodes=new Map,this._hostNodes.set(t.head,[])}_addStylesToHost(t,r,s){t.forEach(i=>{const o=this._doc.createElement("style");o.textContent=i,s.push(r.appendChild(o))})}addHost(t){const r=[];this._addStylesToHost(this._stylesSet,t,r),this._hostNodes.set(t,r)}removeHost(t){const r=this._hostNodes.get(t);r&&r.forEach(wT),this._hostNodes.delete(t)}onStylesAdded(t){this._hostNodes.forEach((r,s)=>{this._addStylesToHost(t,s,r)})}ngOnDestroy(){this._hostNodes.forEach(t=>t.forEach(wT))}}return n.\u0275fac=function(t){return new(t||n)(W(lt))},n.\u0275prov=se({token:n,factory:n.\u0275fac}),n})();function wT(n){no().remove(n)}const jd={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},Gd=/%COMP%/g;function ol(n,e,t){for(let r=0;r<e.length;r++){let s=e[r];Array.isArray(s)?ol(n,s,t):(s=s.replace(Gd,n),t.push(s))}return t}function MT(n){return e=>{if("__ngUnwrap__"===e)return n;!1===n(e)&&(e.preventDefault(),e.returnValue=!1)}}let Kd=(()=>{class n{constructor(t,r,s){this.eventManager=t,this.sharedStylesHost=r,this.appId=s,this.rendererByCompId=new Map,this.defaultRenderer=new Wd(t)}createRenderer(t,r){if(!t||!r)return this.defaultRenderer;switch(r.encapsulation){case He.Emulated:{let s=this.rendererByCompId.get(r.id);return s||(s=new wF(this.eventManager,this.sharedStylesHost,r,this.appId),this.rendererByCompId.set(r.id,s)),s.applyToHost(t),s}case 1:case He.ShadowDom:return new RF(this.eventManager,this.sharedStylesHost,t,r);default:if(!this.rendererByCompId.has(r.id)){const s=ol(r.id,r.styles,[]);this.sharedStylesHost.addStyles(s),this.rendererByCompId.set(r.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return n.\u0275fac=function(t){return new(t||n)(W(il),W(ao),W(Qi))},n.\u0275prov=se({token:n,factory:n.\u0275fac}),n})();class Wd{constructor(e){this.eventManager=e,this.data=Object.create(null)}destroy(){}createElement(e,t){return t?document.createElementNS(jd[t]||t,e):document.createElement(e)}createComment(e){return document.createComment(e)}createText(e){return document.createTextNode(e)}appendChild(e,t){e.appendChild(t)}insertBefore(e,t,r){e&&e.insertBefore(t,r)}removeChild(e,t){e&&e.removeChild(t)}selectRootElement(e,t){let r="string"==typeof e?document.querySelector(e):e;if(!r)throw new Error(`The selector "${e}" did not match any elements`);return t||(r.textContent=""),r}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,r,s){if(s){t=s+":"+t;const i=jd[s];i?e.setAttributeNS(i,t,r):e.setAttribute(t,r)}else e.setAttribute(t,r)}removeAttribute(e,t,r){if(r){const s=jd[r];s?e.removeAttributeNS(s,t):e.removeAttribute(`${r}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,r,s){s&(Pt.DashCase|Pt.Important)?e.style.setProperty(t,r,s&Pt.Important?"important":""):e.style[t]=r}removeStyle(e,t,r){r&Pt.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,r){e[t]=r}setValue(e,t){e.nodeValue=t}listen(e,t,r){return"string"==typeof e?this.eventManager.addGlobalEventListener(e,t,MT(r)):this.eventManager.addEventListener(e,t,MT(r))}}class wF extends Wd{constructor(e,t,r,s){super(e),this.component=r;const i=ol(s+"-"+r.id,r.styles,[]);t.addStyles(i),this.contentAttr=function(n){return"_ngcontent-%COMP%".replace(Gd,n)}(s+"-"+r.id),this.hostAttr=function(n){return"_nghost-%COMP%".replace(Gd,n)}(s+"-"+r.id)}applyToHost(e){super.setAttribute(e,this.hostAttr,"")}createElement(e,t){const r=super.createElement(e,t);return super.setAttribute(r,this.contentAttr,""),r}}class RF extends Wd{constructor(e,t,r,s){super(e),this.sharedStylesHost=t,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const i=ol(s.id,s.styles,[]);for(let o=0;o<i.length;o++){const a=document.createElement("style");a.textContent=i[o],this.shadowRoot.appendChild(a)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,r){return super.insertBefore(this.nodeOrShadowRoot(e),t,r)}removeChild(e,t){return super.removeChild(this.nodeOrShadowRoot(e),t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}}let LF=(()=>{class n extends Hd{constructor(t){super(t)}supports(t){return!0}addEventListener(t,r,s){return t.addEventListener(r,s,!1),()=>this.removeEventListener(t,r,s)}removeEventListener(t,r,s){return t.removeEventListener(r,s)}}return n.\u0275fac=function(t){return new(t||n)(W(lt))},n.\u0275prov=se({token:n,factory:n.\u0275fac}),n})();const kT=["alt","control","meta","shift"],BF={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},NT={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},UF={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey};let VF=(()=>{class n extends Hd{constructor(t){super(t)}supports(t){return null!=n.parseEventName(t)}addEventListener(t,r,s){const i=n.parseEventName(r),o=n.eventCallback(i.fullKey,s,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>no().onAndCancel(t,i.domEventName,o))}static parseEventName(t){const r=t.toLowerCase().split("."),s=r.shift();if(0===r.length||"keydown"!==s&&"keyup"!==s)return null;const i=n._normalizeKey(r.pop());let o="";if(kT.forEach(l=>{const c=r.indexOf(l);c>-1&&(r.splice(c,1),o+=l+".")}),o+=i,0!=r.length||0===i.length)return null;const a={};return a.domEventName=s,a.fullKey=o,a}static getEventFullKey(t){let r="",s=function(n){let e=n.key;if(null==e){if(e=n.keyIdentifier,null==e)return"Unidentified";e.startsWith("U+")&&(e=String.fromCharCode(parseInt(e.substring(2),16)),3===n.location&&NT.hasOwnProperty(e)&&(e=NT[e]))}return BF[e]||e}(t);return s=s.toLowerCase()," "===s?s="space":"."===s&&(s="dot"),kT.forEach(i=>{i!=s&&UF[i](t)&&(r+=i+".")}),r+=s,r}static eventCallback(t,r,s){return i=>{n.getEventFullKey(i)===t&&s.runGuarded(()=>r(i))}}static _normalizeKey(t){return"esc"===t?"escape":t}}return n.\u0275fac=function(t){return new(t||n)(W(lt))},n.\u0275prov=se({token:n,factory:n.\u0275fac}),n})();const WF=[{provide:Fa,useValue:"browser"},{provide:DE,useValue:function(){Vd.makeCurrent(),$d.init()},multi:!0},{provide:lt,useFactory:function(){return function(n){Kl=n}(document),document},deps:[]}],qF=RE(NM,"browser",WF),zF=[[],{provide:Ii,useValue:"root"},{provide:Fr,useFactory:function(){return new Fr},deps:[]},{provide:oo,useClass:LF,multi:!0,deps:[lt,et,Fa]},{provide:oo,useClass:VF,multi:!0,deps:[lt]},[],{provide:Kd,useClass:Kd,deps:[il,ao,Qi]},{provide:xa,useExisting:Kd},{provide:AT,useExisting:ao},{provide:ao,useClass:ao,deps:[lt]},{provide:dd,useClass:dd,deps:[et]},{provide:il,useClass:il,deps:[oo,et]},{provide:bT,useClass:pF,deps:[]},[]];let QF=(()=>{class n{constructor(t){if(t)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(t){return{ngModule:n,providers:[{provide:Qi,useValue:t.appId},{provide:ST,useExisting:Qi},hF]}}}return n.\u0275fac=function(t){return new(t||n)(W(n,12))},n.\u0275mod=vr({type:n}),n.\u0275inj=Un({providers:zF,imports:[sF,jM]}),n})();function BT(...n){let e=n[n.length-1];return ch(e)?(n.pop(),Rl(n,e)):ph(n)}"undefined"!=typeof window&&window;class ok{constructor(e,t){this.predicate=e,this.thisArg=t}call(e,t){return t.subscribe(new ak(e,this.predicate,this.thisArg))}}class ak extends vt{constructor(e,t,r){super(e),this.predicate=t,this.thisArg=r,this.count=0}_next(e){let t;try{t=this.predicate.call(this.thisArg,e,this.count++)}catch(r){return void this.destination.error(r)}t&&this.destination.next(e)}}class UT{}class VT{}class Xn{constructor(e){this.normalizedNames=new Map,this.lazyUpdate=null,e?this.lazyInit="string"==typeof e?()=>{this.headers=new Map,e.split("\n").forEach(t=>{const r=t.indexOf(":");if(r>0){const s=t.slice(0,r),i=s.toLowerCase(),o=t.slice(r+1).trim();this.maybeSetNormalizedName(s,i),this.headers.has(i)?this.headers.get(i).push(o):this.headers.set(i,[o])}})}:()=>{this.headers=new Map,Object.keys(e).forEach(t=>{let r=e[t];const s=t.toLowerCase();"string"==typeof r&&(r=[r]),r.length>0&&(this.headers.set(s,r),this.maybeSetNormalizedName(t,s))})}:this.headers=new Map}has(e){return this.init(),this.headers.has(e.toLowerCase())}get(e){this.init();const t=this.headers.get(e.toLowerCase());return t&&t.length>0?t[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(e){return this.init(),this.headers.get(e.toLowerCase())||null}append(e,t){return this.clone({name:e,value:t,op:"a"})}set(e,t){return this.clone({name:e,value:t,op:"s"})}delete(e,t){return this.clone({name:e,value:t,op:"d"})}maybeSetNormalizedName(e,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,e)}init(){this.lazyInit&&(this.lazyInit instanceof Xn?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(e=>this.applyUpdate(e)),this.lazyUpdate=null))}copyFrom(e){e.init(),Array.from(e.headers.keys()).forEach(t=>{this.headers.set(t,e.headers.get(t)),this.normalizedNames.set(t,e.normalizedNames.get(t))})}clone(e){const t=new Xn;return t.lazyInit=this.lazyInit&&this.lazyInit instanceof Xn?this.lazyInit:this,t.lazyUpdate=(this.lazyUpdate||[]).concat([e]),t}applyUpdate(e){const t=e.name.toLowerCase();switch(e.op){case"a":case"s":let r=e.value;if("string"==typeof r&&(r=[r]),0===r.length)return;this.maybeSetNormalizedName(e.name,t);const s=("a"===e.op?this.headers.get(t):void 0)||[];s.push(...r),this.headers.set(t,s);break;case"d":const i=e.value;if(i){let o=this.headers.get(t);if(!o)return;o=o.filter(a=>-1===i.indexOf(a)),0===o.length?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,o)}else this.headers.delete(t),this.normalizedNames.delete(t)}}forEach(e){this.init(),Array.from(this.normalizedNames.keys()).forEach(t=>e(this.normalizedNames.get(t),this.headers.get(t)))}}class lk{encodeKey(e){return $T(e)}encodeValue(e){return $T(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}}const uk=/%(\d[a-f0-9])/gi,dk={40:"@","3A":":",24:"$","2C":",","3B":";","2B":"+","3D":"=","3F":"?","2F":"/"};function $T(n){return encodeURIComponent(n).replace(uk,(e,t)=>{var r;return null!==(r=dk[t])&&void 0!==r?r:e})}function HT(n){return`${n}`}class yr{constructor(e={}){if(this.updates=null,this.cloneFrom=null,this.encoder=e.encoder||new lk,e.fromString){if(e.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function(n,e){const t=new Map;return n.length>0&&n.replace(/^\?/,"").split("&").forEach(s=>{const i=s.indexOf("="),[o,a]=-1==i?[e.decodeKey(s),""]:[e.decodeKey(s.slice(0,i)),e.decodeValue(s.slice(i+1))],l=t.get(o)||[];l.push(a),t.set(o,l)}),t}(e.fromString,this.encoder)}else e.fromObject?(this.map=new Map,Object.keys(e.fromObject).forEach(t=>{const r=e.fromObject[t];this.map.set(t,Array.isArray(r)?r:[r])})):this.map=null}has(e){return this.init(),this.map.has(e)}get(e){this.init();const t=this.map.get(e);return t?t[0]:null}getAll(e){return this.init(),this.map.get(e)||null}keys(){return this.init(),Array.from(this.map.keys())}append(e,t){return this.clone({param:e,value:t,op:"a"})}appendAll(e){const t=[];return Object.keys(e).forEach(r=>{const s=e[r];Array.isArray(s)?s.forEach(i=>{t.push({param:r,value:i,op:"a"})}):t.push({param:r,value:s,op:"a"})}),this.clone(t)}set(e,t){return this.clone({param:e,value:t,op:"s"})}delete(e,t){return this.clone({param:e,value:t,op:"d"})}toString(){return this.init(),this.keys().map(e=>{const t=this.encoder.encodeKey(e);return this.map.get(e).map(r=>t+"="+this.encoder.encodeValue(r)).join("&")}).filter(e=>""!==e).join("&")}clone(e){const t=new yr({encoder:this.encoder});return t.cloneFrom=this.cloneFrom||this,t.updates=(this.updates||[]).concat(e),t}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(e=>this.map.set(e,this.cloneFrom.map.get(e))),this.updates.forEach(e=>{switch(e.op){case"a":case"s":const t=("a"===e.op?this.map.get(e.param):void 0)||[];t.push(HT(e.value)),this.map.set(e.param,t);break;case"d":if(void 0===e.value){this.map.delete(e.param);break}{let r=this.map.get(e.param)||[];const s=r.indexOf(HT(e.value));-1!==s&&r.splice(s,1),r.length>0?this.map.set(e.param,r):this.map.delete(e.param)}}}),this.cloneFrom=this.updates=null)}}class fk{constructor(){this.map=new Map}set(e,t){return this.map.set(e,t),this}get(e){return this.map.has(e)||this.map.set(e,e.defaultValue()),this.map.get(e)}delete(e){return this.map.delete(e),this}keys(){return this.map.keys()}}function jT(n){return"undefined"!=typeof ArrayBuffer&&n instanceof ArrayBuffer}function GT(n){return"undefined"!=typeof Blob&&n instanceof Blob}function KT(n){return"undefined"!=typeof FormData&&n instanceof FormData}class lo{constructor(e,t,r,s){let i;if(this.url=t,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=e.toUpperCase(),function(n){switch(n){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||s?(this.body=void 0!==r?r:null,i=s):i=r,i&&(this.reportProgress=!!i.reportProgress,this.withCredentials=!!i.withCredentials,i.responseType&&(this.responseType=i.responseType),i.headers&&(this.headers=i.headers),i.context&&(this.context=i.context),i.params&&(this.params=i.params)),this.headers||(this.headers=new Xn),this.context||(this.context=new fk),this.params){const o=this.params.toString();if(0===o.length)this.urlWithParams=t;else{const a=t.indexOf("?");this.urlWithParams=t+(-1===a?"?":a<t.length-1?"&":"")+o}}else this.params=new yr,this.urlWithParams=t}serializeBody(){return null===this.body?null:jT(this.body)||GT(this.body)||KT(this.body)||function(n){return"undefined"!=typeof URLSearchParams&&n instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof yr?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||KT(this.body)?null:GT(this.body)?this.body.type||null:jT(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof yr?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(e={}){var t;const r=e.method||this.method,s=e.url||this.url,i=e.responseType||this.responseType,o=void 0!==e.body?e.body:this.body,a=void 0!==e.withCredentials?e.withCredentials:this.withCredentials,l=void 0!==e.reportProgress?e.reportProgress:this.reportProgress;let c=e.headers||this.headers,u=e.params||this.params;const d=null!==(t=e.context)&&void 0!==t?t:this.context;return void 0!==e.setHeaders&&(c=Object.keys(e.setHeaders).reduce((f,h)=>f.set(h,e.setHeaders[h]),c)),e.setParams&&(u=Object.keys(e.setParams).reduce((f,h)=>f.set(h,e.setParams[h]),u)),new lo(r,s,o,{params:u,headers:c,context:d,reportProgress:l,responseType:i,withCredentials:a})}}var $e=(()=>(($e=$e||{})[$e.Sent=0]="Sent",$e[$e.UploadProgress=1]="UploadProgress",$e[$e.ResponseHeader=2]="ResponseHeader",$e[$e.DownloadProgress=3]="DownloadProgress",$e[$e.Response=4]="Response",$e[$e.User=5]="User",$e))();class Xd{constructor(e,t=200,r="OK"){this.headers=e.headers||new Xn,this.status=void 0!==e.status?e.status:t,this.statusText=e.statusText||r,this.url=e.url||null,this.ok=this.status>=200&&this.status<300}}class Jd extends Xd{constructor(e={}){super(e),this.type=$e.ResponseHeader}clone(e={}){return new Jd({headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class al extends Xd{constructor(e={}){super(e),this.type=$e.Response,this.body=void 0!==e.body?e.body:null}clone(e={}){return new al({body:void 0!==e.body?e.body:this.body,headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class WT extends Xd{constructor(e){super(e,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${e.url||"(unknown url)"}`:`Http failure response for ${e.url||"(unknown url)"}: ${e.status} ${e.statusText}`,this.error=e.error||null}}function Zd(n,e){return{body:e,headers:n.headers,context:n.context,observe:n.observe,params:n.params,reportProgress:n.reportProgress,responseType:n.responseType,withCredentials:n.withCredentials}}let YT=(()=>{class n{constructor(t){this.handler=t}request(t,r,s={}){let i;if(t instanceof lo)i=t;else{let l,c;l=s.headers instanceof Xn?s.headers:new Xn(s.headers),s.params&&(c=s.params instanceof yr?s.params:new yr({fromObject:s.params})),i=new lo(t,r,void 0!==s.body?s.body:null,{headers:l,context:s.context,params:c,reportProgress:s.reportProgress,responseType:s.responseType||"json",withCredentials:s.withCredentials})}const o=BT(i).pipe(function(n,e){return Ll(n,void 0,1)}(l=>this.handler.handle(l)));if(t instanceof lo||"events"===s.observe)return o;const a=o.pipe(function(n,e){return function(r){return r.lift(new ok(n,undefined))}}(l=>l instanceof al));switch(s.observe||"body"){case"body":switch(i.responseType){case"arraybuffer":return a.pipe(ti(l=>{if(null!==l.body&&!(l.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return l.body}));case"blob":return a.pipe(ti(l=>{if(null!==l.body&&!(l.body instanceof Blob))throw new Error("Response is not a Blob.");return l.body}));case"text":return a.pipe(ti(l=>{if(null!==l.body&&"string"!=typeof l.body)throw new Error("Response is not a string.");return l.body}));default:return a.pipe(ti(l=>l.body))}case"response":return a;default:throw new Error(`Unreachable: unhandled observe type ${s.observe}}`)}}delete(t,r={}){return this.request("DELETE",t,r)}get(t,r={}){return this.request("GET",t,r)}head(t,r={}){return this.request("HEAD",t,r)}jsonp(t,r){return this.request("JSONP",t,{params:(new yr).append(r,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(t,r={}){return this.request("OPTIONS",t,r)}patch(t,r,s={}){return this.request("PATCH",t,Zd(s,r))}post(t,r,s={}){return this.request("POST",t,Zd(s,r))}put(t,r,s={}){return this.request("PUT",t,Zd(s,r))}}return n.\u0275fac=function(t){return new(t||n)(W(UT))},n.\u0275prov=se({token:n,factory:n.\u0275fac}),n})();class qT{constructor(e,t){this.next=e,this.interceptor=t}handle(e){return this.interceptor.intercept(e,this.next)}}const zT=new ce("HTTP_INTERCEPTORS");let gk=(()=>{class n{intercept(t,r){return r.handle(t)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=se({token:n,factory:n.\u0275fac}),n})();const mk=/^\)\]\}',?\n/;let QT=(()=>{class n{constructor(t){this.xhrFactory=t}handle(t){if("JSONP"===t.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new dt(r=>{const s=this.xhrFactory.build();if(s.open(t.method,t.urlWithParams),t.withCredentials&&(s.withCredentials=!0),t.headers.forEach((h,p)=>s.setRequestHeader(h,p.join(","))),t.headers.has("Accept")||s.setRequestHeader("Accept","application/json, text/plain, */*"),!t.headers.has("Content-Type")){const h=t.detectContentTypeHeader();null!==h&&s.setRequestHeader("Content-Type",h)}if(t.responseType){const h=t.responseType.toLowerCase();s.responseType="json"!==h?h:"text"}const i=t.serializeBody();let o=null;const a=()=>{if(null!==o)return o;const h=1223===s.status?204:s.status,p=s.statusText||"OK",g=new Xn(s.getAllResponseHeaders()),m=function(n){return"responseURL"in n&&n.responseURL?n.responseURL:/^X-Request-URL:/m.test(n.getAllResponseHeaders())?n.getResponseHeader("X-Request-URL"):null}(s)||t.url;return o=new Jd({headers:g,status:h,statusText:p,url:m}),o},l=()=>{let{headers:h,status:p,statusText:g,url:m}=a(),E=null;204!==p&&(E=void 0===s.response?s.responseText:s.response),0===p&&(p=E?200:0);let T=p>=200&&p<300;if("json"===t.responseType&&"string"==typeof E){const D=E;E=E.replace(mk,"");try{E=""!==E?JSON.parse(E):null}catch(x){E=D,T&&(T=!1,E={error:x,text:E})}}T?(r.next(new al({body:E,headers:h,status:p,statusText:g,url:m||void 0})),r.complete()):r.error(new WT({error:E,headers:h,status:p,statusText:g,url:m||void 0}))},c=h=>{const{url:p}=a(),g=new WT({error:h,status:s.status||0,statusText:s.statusText||"Unknown Error",url:p||void 0});r.error(g)};let u=!1;const d=h=>{u||(r.next(a()),u=!0);let p={type:$e.DownloadProgress,loaded:h.loaded};h.lengthComputable&&(p.total=h.total),"text"===t.responseType&&!!s.responseText&&(p.partialText=s.responseText),r.next(p)},f=h=>{let p={type:$e.UploadProgress,loaded:h.loaded};h.lengthComputable&&(p.total=h.total),r.next(p)};return s.addEventListener("load",l),s.addEventListener("error",c),s.addEventListener("timeout",c),s.addEventListener("abort",c),t.reportProgress&&(s.addEventListener("progress",d),null!==i&&s.upload&&s.upload.addEventListener("progress",f)),s.send(i),r.next({type:$e.Sent}),()=>{s.removeEventListener("error",c),s.removeEventListener("abort",c),s.removeEventListener("load",l),s.removeEventListener("timeout",c),t.reportProgress&&(s.removeEventListener("progress",d),null!==i&&s.upload&&s.upload.removeEventListener("progress",f)),s.readyState!==s.DONE&&s.abort()}})}}return n.\u0275fac=function(t){return new(t||n)(W(bT))},n.\u0275prov=se({token:n,factory:n.\u0275fac}),n})();const ef=new ce("XSRF_COOKIE_NAME"),tf=new ce("XSRF_HEADER_NAME");class XT{}let Ek=(()=>{class n{constructor(t,r,s){this.doc=t,this.platform=r,this.cookieName=s,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const t=this.doc.cookie||"";return t!==this.lastCookieString&&(this.parseCount++,this.lastToken=yT(t,this.cookieName),this.lastCookieString=t),this.lastToken}}return n.\u0275fac=function(t){return new(t||n)(W(lt),W(Fa),W(ef))},n.\u0275prov=se({token:n,factory:n.\u0275fac}),n})(),nf=(()=>{class n{constructor(t,r){this.tokenService=t,this.headerName=r}intercept(t,r){const s=t.url.toLowerCase();if("GET"===t.method||"HEAD"===t.method||s.startsWith("http://")||s.startsWith("https://"))return r.handle(t);const i=this.tokenService.getToken();return null!==i&&!t.headers.has(this.headerName)&&(t=t.clone({headers:t.headers.set(this.headerName,i)})),r.handle(t)}}return n.\u0275fac=function(t){return new(t||n)(W(XT),W(tf))},n.\u0275prov=se({token:n,factory:n.\u0275fac}),n})(),Tk=(()=>{class n{constructor(t,r){this.backend=t,this.injector=r,this.chain=null}handle(t){if(null===this.chain){const r=this.injector.get(zT,[]);this.chain=r.reduceRight((s,i)=>new qT(s,i),this.backend)}return this.chain.handle(t)}}return n.\u0275fac=function(t){return new(t||n)(W(VT),W(xe))},n.\u0275prov=se({token:n,factory:n.\u0275fac}),n})(),Dk=(()=>{class n{static disable(){return{ngModule:n,providers:[{provide:nf,useClass:gk}]}}static withOptions(t={}){return{ngModule:n,providers:[t.cookieName?{provide:ef,useValue:t.cookieName}:[],t.headerName?{provide:tf,useValue:t.headerName}:[]]}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=vr({type:n}),n.\u0275inj=Un({providers:[nf,{provide:zT,useExisting:nf,multi:!0},{provide:XT,useClass:Ek},{provide:ef,useValue:"XSRF-TOKEN"},{provide:tf,useValue:"X-XSRF-TOKEN"}]}),n})(),vk=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=vr({type:n}),n.\u0275inj=Un({providers:[YT,{provide:UT,useClass:Tk},QT,{provide:VT,useExisting:QT}],imports:[[Dk.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]]}),n})(),_k=(()=>{class n{constructor(t){this.http=t}getStreams(){return BT({scoreUrl:"",NowPlaying:!0,streamingUrl:"https://e765432.xyz/static/dfc5b4a8b3793cb1176ab4a56dfb3e896ed419aa/getdata.php?chid=7112&ip=197.3.35.24",link:"https://11gref-1en.com/7113/index.m3u8",Channel:"7112",isStatic:!1})}getStreamLink(t){return this.http.get(`/api/list/listCasinoProduct?eventId=${t}`)}}return n.\u0275fac=function(t){return new(t||n)(W(YT))},n.\u0275prov=se({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function xk(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var JT={exports:{}};!function(n,e){var r,s,i,o,a;r=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,s=/^(?=([^\/?#]*))\1([^]*)$/,i=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,n.exports=a={buildAbsoluteURL:function(l,c,u){if(u=u||{},l=l.trim(),!(c=c.trim())){if(!u.alwaysNormalize)return l;var d=a.parseURL(l);if(!d)throw new Error("Error trying to parse base URL.");return d.path=a.normalizePath(d.path),a.buildURLFromParts(d)}var f=a.parseURL(c);if(!f)throw new Error("Error trying to parse relative URL.");if(f.scheme)return u.alwaysNormalize?(f.path=a.normalizePath(f.path),a.buildURLFromParts(f)):c;var h=a.parseURL(l);if(!h)throw new Error("Error trying to parse base URL.");if(!h.netLoc&&h.path&&"/"!==h.path[0]){var p=s.exec(h.path);h.netLoc=p[1],h.path=p[2]}h.netLoc&&!h.path&&(h.path="/");var g={scheme:h.scheme,netLoc:f.netLoc,path:null,params:f.params,query:f.query,fragment:f.fragment};if(!f.netLoc&&(g.netLoc=h.netLoc,"/"!==f.path[0]))if(f.path){var m=h.path,E=m.substring(0,m.lastIndexOf("/")+1)+f.path;g.path=a.normalizePath(E)}else g.path=h.path,f.params||(g.params=h.params,f.query||(g.query=h.query));return null===g.path&&(g.path=u.alwaysNormalize?a.normalizePath(f.path):f.path),a.buildURLFromParts(g)},parseURL:function(l){var c=r.exec(l);return c?{scheme:c[1]||"",netLoc:c[2]||"",path:c[3]||"",params:c[4]||"",query:c[5]||"",fragment:c[6]||""}:null},normalizePath:function(l){for(l=l.split("").reverse().join("").replace(i,"");l.length!==(l=l.replace(o,"")).length;);return l.split("").reverse().join("")},buildURLFromParts:function(l){return l.scheme+l.netLoc+l.path+l.params+l.query+l.fragment}}}(JT);var rf=JT.exports;function ZT(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,r)}return t}function Dt(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?ZT(Object(t),!0).forEach(function(r){Ck(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):ZT(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function Ck(n,e,t){return e=function(n){var e=function(n,e){if("object"!=typeof n||null===n)return n;var t=n[Symbol.toPrimitive];if(void 0!==t){var r=t.call(n,e);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(n,"string");return"symbol"==typeof e?e:String(e)}(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function Ye(){return Ye=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Ye.apply(this,arguments)}const O=Number.isFinite||function(n){return"number"==typeof n&&isFinite(n)},Ik=Number.isSafeInteger||function(n){return"number"==typeof n&&Math.abs(n)<=Ak},Ak=Number.MAX_SAFE_INTEGER||9007199254740991;let y=function(n){return n.MEDIA_ATTACHING="hlsMediaAttaching",n.MEDIA_ATTACHED="hlsMediaAttached",n.MEDIA_DETACHING="hlsMediaDetaching",n.MEDIA_DETACHED="hlsMediaDetached",n.BUFFER_RESET="hlsBufferReset",n.BUFFER_CODECS="hlsBufferCodecs",n.BUFFER_CREATED="hlsBufferCreated",n.BUFFER_APPENDING="hlsBufferAppending",n.BUFFER_APPENDED="hlsBufferAppended",n.BUFFER_EOS="hlsBufferEos",n.BUFFER_FLUSHING="hlsBufferFlushing",n.BUFFER_FLUSHED="hlsBufferFlushed",n.MANIFEST_LOADING="hlsManifestLoading",n.MANIFEST_LOADED="hlsManifestLoaded",n.MANIFEST_PARSED="hlsManifestParsed",n.LEVEL_SWITCHING="hlsLevelSwitching",n.LEVEL_SWITCHED="hlsLevelSwitched",n.LEVEL_LOADING="hlsLevelLoading",n.LEVEL_LOADED="hlsLevelLoaded",n.LEVEL_UPDATED="hlsLevelUpdated",n.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",n.LEVELS_UPDATED="hlsLevelsUpdated",n.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",n.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",n.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",n.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",n.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",n.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",n.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",n.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",n.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",n.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",n.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",n.CUES_PARSED="hlsCuesParsed",n.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",n.INIT_PTS_FOUND="hlsInitPtsFound",n.FRAG_LOADING="hlsFragLoading",n.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",n.FRAG_LOADED="hlsFragLoaded",n.FRAG_DECRYPTED="hlsFragDecrypted",n.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",n.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",n.FRAG_PARSING_METADATA="hlsFragParsingMetadata",n.FRAG_PARSED="hlsFragParsed",n.FRAG_BUFFERED="hlsFragBuffered",n.FRAG_CHANGED="hlsFragChanged",n.FPS_DROP="hlsFpsDrop",n.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",n.ERROR="hlsError",n.DESTROYING="hlsDestroying",n.KEY_LOADING="hlsKeyLoading",n.KEY_LOADED="hlsKeyLoaded",n.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",n.BACK_BUFFER_REACHED="hlsBackBufferReached",n}({}),H=function(n){return n.NETWORK_ERROR="networkError",n.MEDIA_ERROR="mediaError",n.KEY_SYSTEM_ERROR="keySystemError",n.MUX_ERROR="muxError",n.OTHER_ERROR="otherError",n}({}),C=function(n){return n.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",n.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",n.KEY_SYSTEM_NO_SESSION="keySystemNoSession",n.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",n.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",n.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",n.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",n.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",n.MANIFEST_LOAD_ERROR="manifestLoadError",n.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",n.MANIFEST_PARSING_ERROR="manifestParsingError",n.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",n.LEVEL_EMPTY_ERROR="levelEmptyError",n.LEVEL_LOAD_ERROR="levelLoadError",n.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",n.LEVEL_PARSING_ERROR="levelParsingError",n.LEVEL_SWITCH_ERROR="levelSwitchError",n.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",n.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",n.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",n.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",n.FRAG_LOAD_ERROR="fragLoadError",n.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",n.FRAG_DECRYPT_ERROR="fragDecryptError",n.FRAG_PARSING_ERROR="fragParsingError",n.FRAG_GAP="fragGap",n.REMUX_ALLOC_ERROR="remuxAllocError",n.KEY_LOAD_ERROR="keyLoadError",n.KEY_LOAD_TIMEOUT="keyLoadTimeOut",n.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",n.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",n.BUFFER_APPEND_ERROR="bufferAppendError",n.BUFFER_APPENDING_ERROR="bufferAppendingError",n.BUFFER_STALLED_ERROR="bufferStalledError",n.BUFFER_FULL_ERROR="bufferFullError",n.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",n.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",n.INTERNAL_EXCEPTION="internalException",n.INTERNAL_ABORTED="aborted",n.UNKNOWN="unknown",n}({});const Hr=function(){},sf={trace:Hr,debug:Hr,log:Hr,warn:Hr,info:Hr,error:Hr};let co=sf;const v=co,Mk=/^(\d+)x(\d+)$/,eD=/(.+?)=(".*?"|.*?)(?:,|$)/g;class Le{constructor(e){"string"==typeof e&&(e=Le.parseAttrList(e));for(const t in e)e.hasOwnProperty(t)&&("X-"===t.substring(0,2)&&(this.clientAttrs=this.clientAttrs||[],this.clientAttrs.push(t)),this[t]=e[t])}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;const r=new Uint8Array(t.length/2);for(let s=0;s<t.length/2;s++)r[s]=parseInt(t.slice(2*s,2*s+2),16);return r}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const r=this[e];return r?parseFloat(r):t}enumeratedString(e){return this[e]}bool(e){return"YES"===this[e]}decimalResolution(e){const t=Mk.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e){let t;const r={};for(eD.lastIndex=0;null!==(t=eD.exec(e));){let i=t[2];0===i.indexOf('"')&&i.lastIndexOf('"')===i.length-1&&(i=i.slice(1,-1)),r[t[1].trim()]=i}return r}}function Pk(n){return"ID"!==n&&"CLASS"!==n&&"START-DATE"!==n&&"DURATION"!==n&&"END-DATE"!==n&&"END-ON-NEXT"!==n}function Fk(n){return"SCTE35-OUT"===n||"SCTE35-IN"===n}class tD{constructor(e,t){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,t){const r=t.attr;for(const s in r)if(Object.prototype.hasOwnProperty.call(e,s)&&e[s]!==r[s]){v.warn(`DATERANGE tag attribute: "${s}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=s;break}e=Ye(new Le({}),r,e)}if(this.attr=e,this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const r=new Date(this.attr["END-DATE"]);O(r.getTime())&&(this._endDate=r)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get startDate(){return this._startDate}get endDate(){if(this._endDate)return this._endDate;const e=this.duration;return null!==e?new Date(this._startDate.getTime()+1e3*e):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(O(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isValid(){return!!this.id&&!this._badValueForSameId&&O(this.startDate.getTime())&&(null===this.duration||this.duration>=0)&&(!this.endOnNext||!!this.class)}}class ll{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}class nD{constructor(e){this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams={audio:null,video:null,audiovideo:null},this.baseurl=e}setByteRange(e,t){const r=e.split("@",2),s=[];s[0]=1===r.length?t?t.byteRangeEndOffset:0:parseInt(r[1]),s[1]=parseInt(r[0])+s[0],this._byteRange=s}get byteRange(){return this._byteRange?this._byteRange:[]}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=rf.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}}class of extends nD{constructor(e,t){super(t),this._decryptdata=null,this.rawProgramDateTime=null,this.programDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.stats=new ll,this.urlId=0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.type=e}get decryptdata(){const{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{const r=Object.keys(this.levelkeys);if(1===r.length)return this._decryptdata=this.levelkeys[r[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(null===this.programDateTime||!O(this.programDateTime))return null;const e=O(this.duration)?this.duration:0;return this.programDateTime+1e3*e}get encrypted(){var e;if(null!=(e=this._decryptdata)&&e.encrypted)return!0;if(this.levelkeys){const t=Object.keys(this.levelkeys),r=t.length;if(r>1||1===r&&this.levelkeys[t[0]].encrypted)return!0}return!1}setKeyFormat(e){if(this.levelkeys){const t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;null==(e=this.loader)||e.abort(),null==(t=this.keyLoader)||t.abort()}setElementaryStreamInfo(e,t,r,s,i,o=!1){const{elementaryStreams:a}=this,l=a[e];l?(l.startPTS=Math.min(l.startPTS,t),l.endPTS=Math.max(l.endPTS,r),l.startDTS=Math.min(l.startDTS,s),l.endDTS=Math.max(l.endDTS,i)):a[e]={startPTS:t,endPTS:r,startDTS:s,endDTS:i,partial:o}}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e.audio=null,e.video=null,e.audiovideo=null}}class kk extends nD{constructor(e,t,r,s,i){super(r),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.stats=new ll,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=s;const o=e.enumeratedString("BYTERANGE");o&&this.setByteRange(o,i),i&&(this.fragOffset=i.fragOffset+i.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}class Ok{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e)return this.advanced=!0,void(this.updated=!0);const t=this.lastPartSn-e.lastPartSn,r=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!r||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||0===t&&r>0,this.misses=this.updated||this.advanced?Math.floor(.6*e.misses):e.misses+1,this.availabilityDelay=e.availabilityDelay}get hasProgramDateTime(){return!!this.fragments.length&&O(this.fragments[this.fragments.length-1].programDateTime)}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||10}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?1e3*(this.driftEnd-this.driftStart)/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var e;return null!=(e=this.fragments)&&e.length?this.fragments[this.fragments.length-1].end:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].index:-1}get lastPartSn(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}function af(n){return Uint8Array.from(atob(n),e=>e.charCodeAt(0))}function rD(n){return Uint8Array.from(unescape(encodeURIComponent(n)),e=>e.charCodeAt(0))}var Me={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Ct_FAIRPLAY="com.apple.streamingkeydelivery",Ct_PLAYREADY="com.microsoft.playready",Ct_WIDEVINE="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed";function sD(n){switch(n){case Ct_FAIRPLAY:return Me.FAIRPLAY;case Ct_PLAYREADY:return Me.PLAYREADY;case Ct_WIDEVINE:return Me.WIDEVINE;case"org.w3.clearkey":return Me.CLEARKEY}}function oD(n){switch(n){case Me.FAIRPLAY:return Ct_FAIRPLAY;case Me.PLAYREADY:return Ct_PLAYREADY;case Me.WIDEVINE:return Ct_WIDEVINE;case Me.CLEARKEY:return"org.w3.clearkey"}}function lf(n){const{drmSystems:e,widevineLicenseUrl:t}=n,r=e?[Me.FAIRPLAY,Me.WIDEVINE,Me.PLAYREADY,Me.CLEARKEY].filter(s=>!!e[s]):[];return!r[Me.WIDEVINE]&&t&&r.push(Me.WIDEVINE),r}const aD="undefined"!=typeof self&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;function jr(n,e,t){return Uint8Array.prototype.slice?n.slice(e,t):new Uint8Array(Array.prototype.slice.call(n,e,t))}const cf=(n,e)=>e+10<=n.length&&73===n[e]&&68===n[e+1]&&51===n[e+2]&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128,lD=(n,e)=>e+10<=n.length&&51===n[e]&&68===n[e+1]&&73===n[e+2]&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128,cl=(n,e)=>{const t=e;let r=0;for(;cf(n,e);)r+=10,r+=ul(n,e+6),lD(n,e+10)&&(r+=10),e+=r;if(r>0)return n.subarray(t,t+r)},ul=(n,e)=>{let t=0;return t=(127&n[e])<<21,t|=(127&n[e+1])<<14,t|=(127&n[e+2])<<7,t|=127&n[e+3],t},Gk=(n,e)=>cf(n,e)&&ul(n,e+6)+10<=n.length-e,cD=n=>n&&"PRIV"===n.key&&"com.apple.streaming.transportStreamTimestamp"===n.info,Wk=n=>{const e=String.fromCharCode(n[0],n[1],n[2],n[3]),t=ul(n,4);return{type:e,size:t,data:n.subarray(10,10+t)}},uD=n=>{let e=0;const t=[];for(;cf(n,e);){const r=ul(n,e+6);e+=10;const s=e+r;for(;e+8<s;){const i=Wk(n.subarray(e)),o=Yk(i);o&&t.push(o),e+=i.size+10}lD(n,e)&&(e+=10)}return t},Yk=n=>"PRIV"===n.type?qk(n):"W"===n.type[0]?Qk(n):zk(n),qk=n=>{if(n.size<2)return;const e=kn(n.data,!0),t=new Uint8Array(n.data.subarray(e.length+1));return{key:n.type,info:e,data:t.buffer}},zk=n=>{if(n.size<2)return;if("TXXX"===n.type){let t=1;const r=kn(n.data.subarray(t),!0);t+=r.length+1;const s=kn(n.data.subarray(t));return{key:n.type,info:r,data:s}}const e=kn(n.data.subarray(1));return{key:n.type,data:e}},Qk=n=>{if("WXXX"===n.type){if(n.size<2)return;let t=1;const r=kn(n.data.subarray(t),!0);t+=r.length+1;const s=kn(n.data.subarray(t));return{key:n.type,info:r,data:s}}const e=kn(n.data);return{key:n.type,data:e}},Xk=n=>{if(8===n.data.byteLength){const e=new Uint8Array(n.data);let r=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return r/=45,1&e[3]&&(r+=47721858.84),Math.round(r)}},kn=(n,e=!1)=>{const t=function(){if(!navigator.userAgent.includes("PlayStation 4"))return!uf&&void 0!==self.TextDecoder&&(uf=new self.TextDecoder("utf-8")),uf}();if(t){const c=t.decode(n);if(e){const u=c.indexOf("\0");return-1!==u?c.substring(0,u):c}return c.replace(/\0/g,"")}const r=n.length;let s,i,o,a="",l=0;for(;l<r;){if(s=n[l++],0===s&&e)return a;if(0!==s&&3!==s)switch(s>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(s);break;case 12:case 13:i=n[l++],a+=String.fromCharCode((31&s)<<6|63&i);break;case 14:i=n[l++],o=n[l++],a+=String.fromCharCode((15&s)<<12|(63&i)<<6|(63&o)<<0)}}return a};let uf;const Nn_hexDump=function(n){let e="";for(let t=0;t<n.length;t++){let r=n[t].toString(16);r.length<2&&(r="0"+r),e+=r}return e},dl=Math.pow(2,32)-1,Zk=[].push,dD={video:1,audio:2,id3:3,text:4};function tt(n){return String.fromCharCode.apply(null,n)}function fD(n,e){const t=n[e]<<8|n[e+1];return t<0?65536+t:t}function q(n,e){const t=hD(n,e);return t<0?4294967296+t:t}function hD(n,e){return n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3]}function df(n,e,t){n[e]=t>>24,n[e+1]=t>>16&255,n[e+2]=t>>8&255,n[e+3]=255&t}function oe(n,e){const t=[];if(!e.length)return t;const r=n.byteLength;for(let s=0;s<r;){const i=q(n,s),a=i>1?s+i:r;if(tt(n.subarray(s+4,s+8))===e[0])if(1===e.length)t.push(n.subarray(s+8,a));else{const l=oe(n.subarray(s+8,a),e.slice(1));l.length&&Zk.apply(t,l)}s=a}return t}function eN(n){const e=[],t=n[0];let r=8;const s=q(n,r);r+=4,r+=0===t?8:16,r+=2;let a=n.length+0;const l=fD(n,r);r+=2;for(let c=0;c<l;c++){let u=r;const d=q(n,u);u+=4;const f=2147483647&d;if((2147483648&d)>>>31==1)return v.warn("SIDX has hierarchical references (not supported)"),null;const p=q(n,u);u+=4,e.push({referenceSize:f,subsegmentDuration:p,info:{duration:p/s,start:a,end:a+f-1}}),a+=f,u+=4,r=u}return{earliestPresentationTime:0,timescale:s,version:t,referencesCount:l,references:e}}function pD(n){const e=[],t=oe(n,["moov","trak"]);for(let s=0;s<t.length;s++){const i=t[s],o=oe(i,["tkhd"])[0];if(o){let a=o[0],l=0===a?12:20;const c=q(o,l),u=oe(i,["mdia","mdhd"])[0];if(u){a=u[0],l=0===a?12:20;const d=q(u,l),f=oe(i,["mdia","hdlr"])[0];if(f){const p={soun:"audio",vide:"video"}[tt(f.subarray(8,12))];if(p){const g=oe(i,["mdia","minf","stbl","stsd"])[0];let m;g&&(m=tt(g.subarray(12,16))),e[c]={timescale:d,type:p},e[p]={timescale:d,id:c,codec:m}}}}}}return oe(n,["moov","mvex","trex"]).forEach(s=>{const i=q(s,4),o=e[i];o&&(o.default={duration:q(s,12),flags:q(s,20)})}),e}function gD(n){const e=oe(n,["schm"])[0];if(e){const t=tt(e.subarray(4,8));if("cbcs"===t||"cenc"===t)return oe(n,["schi","tenc"])[0]}return v.error("[eme] missing 'schm' box"),null}function sN(n){const e=q(n,0);let t=8;1&e&&(t+=4),4&e&&(t+=4);let r=0;const s=q(n,4);for(let i=0;i<s;i++)256&e&&(r+=q(n,t),t+=4),512&e&&(t+=4),1024&e&&(t+=4),2048&e&&(t+=4);return r}function Gr(n,e){const t=new Uint8Array(n.length+e.length);return t.set(n),t.set(e,n.length),t}function mD(n,e){const t=[],r=e.samples,s=e.timescale,i=e.id;let o=!1;return oe(r,["moof"]).map(l=>{const c=l.byteOffset-8;oe(l,["traf"]).map(d=>{const f=oe(d,["tfdt"]).map(h=>{const p=h[0];let g=q(h,4);return 1===p&&(g*=Math.pow(2,32),g+=q(h,8)),g/s})[0];return void 0!==f&&(n=f),oe(d,["tfhd"]).map(h=>{const p=q(h,4),g=16777215&q(h,0);let D=0;const x=0!=(16&g);let _=0;const w=0!=(32&g);let S=8;p===i&&(0!=(1&g)&&(S+=8),0!=(2&g)&&(S+=4),0!=(8&g)&&(D=q(h,S),S+=4),x&&(_=q(h,S),S+=4),w&&(S+=4),"video"===e.type&&(o=function(n){if(!n)return!1;const e=n.indexOf("."),t=e<0?n:n.substring(0,e);return"hvc1"===t||"hev1"===t||"dvh1"===t||"dvhe"===t}(e.codec)),oe(d,["trun"]).map(R=>{const L=R[0],b=16777215&q(R,0),N=0!=(1&b);let F=0;const ue=0!=(4&b),qe=0!=(256&b);let me=0;const Te=0!=(512&b);let Ie=0;const k=0!=(1024&b),V=0!=(2048&b);let De=0;const be=q(R,4);let he=8;N&&(F=q(R,he),he+=4),ue&&(he+=4);let ze=F+c;for(let Xt=0;Xt<be;Xt++){if(qe?(me=q(R,he),he+=4):me=D,Te?(Ie=q(R,he),he+=4):Ie=_,k&&(he+=4),V&&(De=0===L?q(R,he):hD(R,he),he+=4),"video"===e.type){let vn=0;for(;vn<Ie;){const Jt=q(r,ze);ze+=4,lN(o,r[ze])&&yD(r.subarray(ze,ze+Jt),o?2:1,n+De/s,t),ze+=Jt,vn+=Jt+4}}n+=me/s}}))})})}),t}function lN(n,e){if(n){const t=e>>1&63;return 39===t||40===t}return 6==(31&e)}function yD(n,e,t,r){const s=ED(n);let i=0;i+=e;let o=0,a=0,l=!1,c=0;for(;i<s.length;){o=0;do{if(i>=s.length)break;c=s[i++],o+=c}while(255===c);a=0;do{if(i>=s.length)break;c=s[i++],a+=c}while(255===c);const u=s.length-i;if(!l&&4===o&&i<s.length){if(l=!0,181===s[i++]){const f=fD(s,i);if(i+=2,49===f){const h=q(s,i);if(i+=4,1195456820===h){const p=s[i++];if(3===p){const g=s[i++],m=31&g,E=64&g,T=E?2+3*m:0,D=new Uint8Array(T);if(E){D[0]=g;for(let x=1;x<T;x++)D[x]=s[i++]}r.push({type:p,payloadType:o,pts:t,bytes:D})}}}}}else if(5===o&&a<u){if(l=!0,a>16){const d=[];for(let p=0;p<16;p++){const g=s[i++].toString(16);d.push(1==g.length?"0"+g:g),(3===p||5===p||7===p||9===p)&&d.push("-")}const f=a-16,h=new Uint8Array(f);for(let p=0;p<f;p++)h[p]=s[i++];r.push({payloadType:o,pts:t,uuid:d.join(""),userData:kn(h),userDataBytes:h})}}else if(a<u)i+=a;else if(a>u)break}}function ED(n){const e=n.byteLength,t=[];let r=1;for(;r<e-2;)0===n[r]&&0===n[r+1]&&3===n[r+2]?(t.push(r+2),r+=2):r++;if(0===t.length)return n;const s=e-t.length,i=new Uint8Array(s);let o=0;for(r=0;r<s;o++,r++)o===t[0]&&(o++,t.shift()),i[r]=n[o];return i}let fl={};class uo{static clearKeyUriToKeyIdMap(){fl={}}constructor(e,t,r,s=[1],i=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=r,this.keyFormatVersions=s,this.iv=i,this.encrypted=!!e&&"NONE"!==e,this.isCommonEncryption=this.encrypted&&"AES-128"!==e}isSupported(){if(this.method){if("AES-128"===this.method||"NONE"===this.method)return!0;if("identity"===this.keyFormat)return"SAMPLE-AES"===this.method;switch(this.keyFormat){case Ct_FAIRPLAY:case Ct_WIDEVINE:case Ct_PLAYREADY:case"org.w3.clearkey":return-1!==["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if("AES-128"===this.method&&this.uri&&!this.iv){"number"!=typeof e&&("AES-128"===this.method&&!this.iv&&v.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0);const r=function(n){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=n>>8*(15-t)&255;return e}(e);return new uo(this.method,this.uri,"identity",this.keyFormatVersions,r)}const t=function(n){const e=n.split(":");let t=null;if("data"===e[0]&&2===e.length){const r=e[1].split(";"),s=r[r.length-1].split(",");if(2===s.length){const o=s[1];"base64"===s[0]?(r.splice(-1,1),t=af(o)):t=function(n){const e=rD(n).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}(o)}}return t}(this.uri);if(t)switch(this.keyFormat){case Ct_WIDEVINE:this.pssh=t,t.length>=22&&(this.keyId=t.subarray(t.length-22,t.length-6));break;case Ct_PLAYREADY:{const r=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=function(n,e,t){if(16!==n.byteLength)throw new RangeError("Invalid system id");let r,s,i;if(e){r=1,s=new Uint8Array(16*e.length);for(let a=0;a<e.length;a++){const l=e[a];if(16!==l.byteLength)throw new RangeError("Invalid key");s.set(l,16*a)}}else r=0,s=new Uint8Array;r>0?(i=new Uint8Array(4),e.length>0&&new DataView(i.buffer).setUint32(0,e.length,!1)):i=new Uint8Array;const o=new Uint8Array(4);return t&&t.byteLength>0&&new DataView(o.buffer).setUint32(0,t.byteLength,!1),function(n,...e){const t=e.length;let r=8,s=t;for(;s--;)r+=e[s].byteLength;const i=new Uint8Array(r);for(i[0]=r>>24&255,i[1]=r>>16&255,i[2]=r>>8&255,i[3]=255&r,i.set(n,4),s=0,r=8;s<t;s++)i.set(e[s],r),r+=e[s].byteLength;return i}([112,115,115,104],new Uint8Array([r,0,0,0]),n,i,s,o,t||new Uint8Array)}(r,null,t);const s=new Uint16Array(t.buffer,t.byteOffset,t.byteLength/2),i=String.fromCharCode.apply(null,Array.from(s)),o=i.substring(i.indexOf("<"),i.length),c=(new DOMParser).parseFromString(o,"text/xml").getElementsByTagName("KID")[0];if(c){const u=c.childNodes[0]?c.childNodes[0].nodeValue:c.getAttribute("VALUE");if(u){const d=af(u).subarray(0,16);(function(n){const e=function(r,s,i){const o=r[s];r[s]=r[i],r[i]=o};e(n,0,3),e(n,1,2),e(n,4,5),e(n,6,7)})(d),this.keyId=d}}break}default:{let r=t.subarray(0,16);if(16!==r.length){const s=new Uint8Array(16);s.set(r,16-r.length),r=s}this.keyId=r;break}}if(!this.keyId||16!==this.keyId.byteLength){let r=fl[this.uri];if(!r){const s=Object.keys(fl).length%Number.MAX_SAFE_INTEGER;r=new Uint8Array(16),new DataView(r.buffer,12,4).setUint32(0,s),fl[this.uri]=r}this.keyId=r}return this}}const TD=/\{\$([a-zA-Z0-9-_]+)\}/g;function DD(n){return TD.test(n)}function bt(n,e,t){if(null!==n.variableList||n.hasVariableRefs)for(let r=t.length;r--;){const s=t[r],i=e[s];i&&(e[s]=ff(n,i))}}function ff(n,e){if(null!==n.variableList||n.hasVariableRefs){const t=n.variableList;return e.replace(TD,r=>{const s=r.substring(2,r.length-1),i=null==t?void 0:t[s];return void 0===i?(n.playlistParsingError||(n.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${s}"`)),r):i})}return e}function vD(n,e,t){let s,i,r=n.variableList;if(r||(n.variableList=r={}),"QUERYPARAM"in e){s=e.QUERYPARAM;try{const o=new self.URL(t).searchParams;if(!o.has(s))throw new Error(`"${s}" does not match any query parameter in URI: "${t}"`);i=o.get(s)}catch(o){n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${o.message}`))}}else s=e.NAME,i=e.VALUE;s in r?n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${s}"`)):r[s]=i||""}function pN(n,e,t){const r=e.IMPORT;if(t&&r in t){let s=n.variableList;s||(n.variableList=s={}),s[r]=t[r]}else n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${r}"`))}function hl(){if("undefined"!=typeof self)return self.MediaSource||self.WebKitMediaSource}const gN={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}},_D=hl();function hf(n,e){var t;return null!=(t=null==_D?void 0:_D.isTypeSupported(`${e||"video"}/mp4;codecs="${n}"`))&&t}const xD=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,CD=/#EXT-X-MEDIA:(.*)/g,yN=/^#EXT(?:INF|-X-TARGETDURATION):/m,bD=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),EN=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class En{static findGroup(e,t){for(let r=0;r<e.length;r++){const s=e[r];if(s.id===t)return s}}static convertAVC1ToAVCOTI(e){const t=e.split(".");if(t.length>2){let r=t.shift()+".";return r+=parseInt(t.shift()).toString(16),r+=("000"+parseInt(t.shift()).toString(16)).slice(-4),r}return e}static resolve(e,t){return rf.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return yN.test(e)}static parseMasterPlaylist(e,t){const s={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:DD(e)},i=[];let o;for(xD.lastIndex=0;null!=(o=xD.exec(e));)if(o[1]){var a;const c=new Le(o[1]);bt(s,c,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);const u=ff(s,o[2]),d={attrs:c,bitrate:c.decimalInteger("AVERAGE-BANDWIDTH")||c.decimalInteger("BANDWIDTH"),name:c.NAME,url:En.resolve(u,t)},f=c.decimalResolution("RESOLUTION");f&&(d.width=f.width,d.height=f.height),TN((c.CODECS||"").split(/[ ,]+/).filter(h=>h),d),d.videoCodec&&-1!==d.videoCodec.indexOf("avc1")&&(d.videoCodec=En.convertAVC1ToAVCOTI(d.videoCodec)),null!=(a=d.unknownCodecs)&&a.length||i.push(d),s.levels.push(d)}else if(o[3]){const u=o[4];switch(o[3]){case"SESSION-DATA":{const d=new Le(u);bt(s,d,["DATA-ID","LANGUAGE","VALUE","URI"]);const f=d["DATA-ID"];f&&(null===s.sessionData&&(s.sessionData={}),s.sessionData[f]=d);break}case"SESSION-KEY":{const d=SD(u,t,s);d.encrypted&&d.isSupported()?(null===s.sessionKeys&&(s.sessionKeys=[]),s.sessionKeys.push(d)):v.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${u}"`);break}case"DEFINE":{const d=new Le(u);bt(s,d,["NAME","VALUE","QUERYPARAM"]),vD(s,d,t)}break;case"CONTENT-STEERING":{const d=new Le(u);bt(s,d,["SERVER-URI","PATHWAY-ID"]),s.contentSteering={uri:En.resolve(d["SERVER-URI"],t),pathwayId:d["PATHWAY-ID"]||"."};break}case"START":s.startTimeOffset=ID(u)}}return s.levels=i.length>0&&i.length<s.levels.length?i:s.levels,0===s.levels.length&&(s.playlistParsingError=new Error("no levels found in manifest")),s}static parseMasterPlaylistMedia(e,t,r){let s;const i={},o=r.levels,a={AUDIO:o.map(c=>({id:c.attrs.AUDIO,audioCodec:c.audioCodec})),SUBTITLES:o.map(c=>({id:c.attrs.SUBTITLES,textCodec:c.textCodec})),"CLOSED-CAPTIONS":[]};let l=0;for(CD.lastIndex=0;null!==(s=CD.exec(e));){const c=new Le(s[1]),u=c.TYPE;if(u){const d=a[u],f=i[u]||[];i[u]=f,bt(r,c,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);const h={attrs:c,bitrate:0,id:l++,groupId:c["GROUP-ID"]||"",instreamId:c["INSTREAM-ID"],name:c.NAME||c.LANGUAGE||"",type:u,default:c.bool("DEFAULT"),autoselect:c.bool("AUTOSELECT"),forced:c.bool("FORCED"),lang:c.LANGUAGE,url:c.URI?En.resolve(c.URI,t):""};if(null!=d&&d.length){const p=En.findGroup(d,h.groupId)||d[0];AD(h,p,"audioCodec"),AD(h,p,"textCodec")}f.push(h)}}return i}static parseLevelPlaylist(e,t,r,s,i,o){const a=new Ok(t),l=a.fragments;let m,E,T,c=null,u=0,d=0,f=0,h=0,p=null,g=new of(s,t),D=-1,x=!1;for(bD.lastIndex=0,a.m3u8=e,a.hasVariableRefs=DD(e);null!==(m=bD.exec(e));){x&&(x=!1,g=new of(s,t),g.start=f,g.sn=u,g.cc=h,g.level=r,c&&(g.initSegment=c,g.rawProgramDateTime=c.rawProgramDateTime,c.rawProgramDateTime=null));const R=m[1];if(R){g.duration=parseFloat(R);const L=(" "+m[2]).slice(1);g.title=L||null,g.tagList.push(L?["INF",R,L]:["INF",R])}else if(m[3]){if(O(g.duration)){g.start=f,T&&LD(g,T,a),g.sn=u,g.level=r,g.cc=h,g.urlId=i,l.push(g);const L=(" "+m[3]).slice(1);g.relurl=ff(a,L),wD(g,p),p=g,f+=g.duration,u++,d=0,x=!0}}else if(m[4]){const L=(" "+m[4]).slice(1);p?g.setByteRange(L,p):g.setByteRange(L)}else if(m[5])g.rawProgramDateTime=(" "+m[5]).slice(1),g.tagList.push(["PROGRAM-DATE-TIME",g.rawProgramDateTime]),-1===D&&(D=l.length);else{if(m=m[0].match(EN),!m){v.warn("No matches on slow regex match for level playlist!");continue}for(E=1;E<m.length&&void 0===m[E];E++);const L=(" "+m[E]).slice(1),b=(" "+m[E+1]).slice(1),N=m[E+2]?(" "+m[E+2]).slice(1):"";switch(L){case"PLAYLIST-TYPE":a.type=b.toUpperCase();break;case"MEDIA-SEQUENCE":u=a.startSN=parseInt(b);break;case"SKIP":{const F=new Le(b);bt(a,F,["RECENTLY-REMOVED-DATERANGES"]);const ue=F.decimalInteger("SKIPPED-SEGMENTS");if(O(ue)){a.skippedSegments=ue;for(let me=ue;me--;)l.unshift(null);u+=ue}const qe=F.enumeratedString("RECENTLY-REMOVED-DATERANGES");qe&&(a.recentlyRemovedDateranges=qe.split("\t"));break}case"TARGETDURATION":a.targetduration=Math.max(parseInt(b),1);break;case"VERSION":a.version=parseInt(b);break;case"EXTM3U":break;case"ENDLIST":a.live=!1;break;case"#":(b||N)&&g.tagList.push(N?[b,N]:[b]);break;case"DISCONTINUITY":h++,g.tagList.push(["DIS"]);break;case"GAP":g.gap=!0,g.tagList.push([L]);break;case"BITRATE":g.tagList.push([L,b]);break;case"DATERANGE":{const F=new Le(b);bt(a,F,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),bt(a,F,F.clientAttrs);const ue=new tD(F,a.dateRanges[F.ID]);ue.isValid||a.skippedSegments?a.dateRanges[ue.id]=ue:v.warn(`Ignoring invalid DATERANGE tag: "${b}"`),g.tagList.push(["EXT-X-DATERANGE",b]);break}case"DEFINE":{const F=new Le(b);bt(a,F,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in F?pN(a,F,o):vD(a,F,t)}break;case"DISCONTINUITY-SEQUENCE":h=parseInt(b);break;case"KEY":{const F=SD(b,t,a);if(F.isSupported()){if("NONE"===F.method){T=void 0;break}T||(T={}),T[F.keyFormat]&&(T=Ye({},T)),T[F.keyFormat]=F}else v.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${b}"`);break}case"START":a.startTimeOffset=ID(b);break;case"MAP":{const F=new Le(b);if(bt(a,F,["BYTERANGE","URI"]),g.duration){const ue=new of(s,t);RD(ue,F,r,T),c=ue,g.initSegment=c,c.rawProgramDateTime&&!g.rawProgramDateTime&&(g.rawProgramDateTime=c.rawProgramDateTime)}else RD(g,F,r,T),c=g,x=!0;break}case"SERVER-CONTROL":{const F=new Le(b);a.canBlockReload=F.bool("CAN-BLOCK-RELOAD"),a.canSkipUntil=F.optionalFloat("CAN-SKIP-UNTIL",0),a.canSkipDateRanges=a.canSkipUntil>0&&F.bool("CAN-SKIP-DATERANGES"),a.partHoldBack=F.optionalFloat("PART-HOLD-BACK",0),a.holdBack=F.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{const F=new Le(b);a.partTarget=F.decimalFloatingPoint("PART-TARGET");break}case"PART":{let F=a.partList;F||(F=a.partList=[]);const ue=d>0?F[F.length-1]:void 0,qe=d++,me=new Le(b);bt(a,me,["BYTERANGE","URI"]);const Te=new kk(me,g,t,qe,ue);F.push(Te),g.duration+=Te.duration;break}case"PRELOAD-HINT":{const F=new Le(b);bt(a,F,["URI"]),a.preloadHint=F;break}case"RENDITION-REPORT":{const F=new Le(b);bt(a,F,["URI"]),a.renditionReports=a.renditionReports||[],a.renditionReports.push(F);break}default:v.warn(`line parsed but not handled: ${m}`)}}}p&&!p.relurl?(l.pop(),f-=p.duration,a.partList&&(a.fragmentHint=p)):a.partList&&(wD(g,p),g.cc=h,a.fragmentHint=g,T&&LD(g,T,a));const _=l.length,w=l[0],S=l[_-1];if(f+=a.skippedSegments*a.targetduration,f>0&&_&&S){a.averagetargetduration=f/_;const R=S.sn;a.endSN="initSegment"!==R?R:0,a.live||(S.endList=!0),w&&(a.startCC=w.cc)}else a.endSN=0,a.startCC=0;return a.fragmentHint&&(f+=a.fragmentHint.duration),a.totalduration=f,a.endCC=h,D>0&&function(n,e){let t=n[e];for(let r=e;r--;){const s=n[r];if(!s)return;s.programDateTime=t.programDateTime-1e3*s.duration,t=s}}(l,D),a}}function SD(n,e,t){var r,s;const i=new Le(n);bt(t,i,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);const o=null!=(r=i.METHOD)?r:"",a=i.URI,l=i.hexadecimalInteger("IV"),c=i.KEYFORMATVERSIONS,u=null!=(s=i.KEYFORMAT)?s:"identity";a&&i.IV&&!l&&v.error(`Invalid IV: ${i.IV}`);const d=a?En.resolve(a,e):"",f=(c||"1").split("/").map(Number).filter(Number.isFinite);return new uo(o,d,u,f,l)}function ID(n){const t=new Le(n).decimalFloatingPoint("TIME-OFFSET");return O(t)?t:null}function TN(n,e){["video","audio","text"].forEach(t=>{const r=n.filter(s=>function(n,e){const t=gN[e];return!!t&&!0===t[n.slice(0,4)]}(s,t));if(r.length){const s=r.filter(i=>0===i.lastIndexOf("avc1",0)||0===i.lastIndexOf("mp4a",0));e[`${t}Codec`]=s.length>0?s[0]:r[0],n=n.filter(i=>-1===r.indexOf(i))}}),e.unknownCodecs=n}function AD(n,e,t){const r=e[t];r&&(n[t]=r)}function wD(n,e){n.rawProgramDateTime?n.programDateTime=Date.parse(n.rawProgramDateTime):null!=e&&e.programDateTime&&(n.programDateTime=e.endProgramDateTime),O(n.programDateTime)||(n.programDateTime=null,n.rawProgramDateTime=null)}function RD(n,e,t,r){n.relurl=e.URI,e.BYTERANGE&&n.setByteRange(e.BYTERANGE),n.level=t,n.sn="initSegment",r&&(n.levelkeys=r),n.initSegment=null}function LD(n,e,t){n.levelkeys=e;const{encryptedFragments:r}=t;(!r.length||r[r.length-1].levelkeys!==e)&&Object.keys(e).some(s=>e[s].isCommonEncryption)&&r.push(n)}function MD(n){const{type:e}=n;switch(e){case"audioTrack":return"audio";case"subtitleTrack":return"subtitle";default:return"main"}}function pf(n,e){let t=n.url;return(void 0===t||0===t.indexOf("data:"))&&(t=e.url),t}class vN{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.LEVEL_LOADING,this.onLevelLoading,this),e.on(y.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(y.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}unregisterListeners(){const{hls:e}=this;e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.LEVEL_LOADING,this.onLevelLoading,this),e.off(y.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(y.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}createInternalLoader(e){const t=this.hls.config,o=new(t.pLoader||t.loader)(t);return this.loaders[e.type]=o,o}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:r}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:"manifest",url:r,deliveryDirectives:null})}onLevelLoading(e,t){const{id:r,level:s,url:i,deliveryDirectives:o}=t;this.load({id:r,level:s,responseType:"text",type:"level",url:i,deliveryDirectives:o})}onAudioTrackLoading(e,t){const{id:r,groupId:s,url:i,deliveryDirectives:o}=t;this.load({id:r,groupId:s,level:null,responseType:"text",type:"audioTrack",url:i,deliveryDirectives:o})}onSubtitleTrackLoading(e,t){const{id:r,groupId:s,url:i,deliveryDirectives:o}=t;this.load({id:r,groupId:s,level:null,responseType:"text",type:"subtitleTrack",url:i,deliveryDirectives:o})}load(e){var t;const r=this.hls.config;let i,s=this.getInternalLoader(e);if(s){const c=s.context;if(c&&c.url===e.url)return void v.trace("[playlist-loader]: playlist request ongoing");v.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),s.abort()}if(i="manifest"===e.type?r.manifestLoadPolicy.default:Ye({},r.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),s=this.createInternalLoader(e),null!=(t=e.deliveryDirectives)&&t.part){let c;if("level"===e.type&&null!==e.level?c=this.hls.levels[e.level].details:"audioTrack"===e.type&&null!==e.id?c=this.hls.audioTracks[e.id].details:"subtitleTrack"===e.type&&null!==e.id&&(c=this.hls.subtitleTracks[e.id].details),c){const u=c.partTarget,d=c.targetduration;if(u&&d){const f=1e3*Math.max(3*u,.8*d);i=Ye({},i,{maxTimeToFirstByteMs:Math.min(f,i.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(f,i.maxTimeToFirstByteMs)})}}}const o=i.errorRetry||i.timeoutRetry||{};s.load(e,{loadPolicy:i,timeout:i.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},{onSuccess:(c,u,d,f)=>{const h=this.getInternalLoader(d);this.resetInternalLoader(d.type);const p=c.data;0===p.indexOf("#EXTM3U")?(u.parsing.start=performance.now(),En.isMediaPlaylist(p)?this.handleTrackOrLevelPlaylist(c,u,d,f||null,h):this.handleMasterPlaylist(c,u,d,f)):this.handleManifestParsingError(c,d,new Error("no EXTM3U delimiter"),f||null,u)},onError:(c,u,d,f)=>{this.handleNetworkError(u,d,!1,c,f)},onTimeout:(c,u,d)=>{this.handleNetworkError(u,d,!0,void 0,c)}})}handleMasterPlaylist(e,t,r,s){const i=this.hls,o=e.data,a=pf(e,r),l=En.parseMasterPlaylist(o,a);if(l.playlistParsingError)return void this.handleManifestParsingError(e,r,l.playlistParsingError,s,t);const{contentSteering:c,levels:u,sessionData:d,sessionKeys:f,startTimeOffset:h,variableList:p}=l;this.variableList=p;const{AUDIO:g=[],SUBTITLES:m,"CLOSED-CAPTIONS":E}=En.parseMasterPlaylistMedia(o,a,l);g.length&&!g.some(D=>!D.url)&&u[0].audioCodec&&!u[0].attrs.AUDIO&&(v.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),g.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Le({}),bitrate:0,url:""})),i.trigger(y.MANIFEST_LOADED,{levels:u,audioTracks:g,subtitles:m,captions:E,contentSteering:c,url:a,stats:t,networkDetails:s,sessionData:d,sessionKeys:f,startTimeOffset:h,variableList:p})}handleTrackOrLevelPlaylist(e,t,r,s,i){const o=this.hls,{id:a,level:l,type:c}=r,u=pf(e,r),d=O(a)?a:0,f=O(l)?l:d,h=MD(r),p=En.parseLevelPlaylist(e.data,u,f,h,d,this.variableList);if("manifest"===c){const g={attrs:new Le({}),bitrate:0,details:p,name:"",url:u};o.trigger(y.MANIFEST_LOADED,{levels:[g],audioTracks:[],url:u,stats:t,networkDetails:s,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),r.levelDetails=p,this.handlePlaylistLoaded(p,e,t,r,s,i)}handleManifestParsingError(e,t,r,s,i){this.hls.trigger(y.ERROR,{type:H.NETWORK_ERROR,details:C.MANIFEST_PARSING_ERROR,fatal:"manifest"===t.type,url:e.url,err:r,error:r,reason:r.message,response:e,context:t,networkDetails:s,stats:i})}handleNetworkError(e,t,r=!1,s,i){let o=`A network ${r?"timeout":"error"+(s?" (status "+s.code+")":"")} occurred while loading ${e.type}`;"level"===e.type?o+=`: ${e.level} id: ${e.id}`:("audioTrack"===e.type||"subtitleTrack"===e.type)&&(o+=` id: ${e.id} group-id: "${e.groupId}"`);const a=new Error(o);v.warn(`[playlist-loader]: ${o}`);let l=C.UNKNOWN,c=!1;const u=this.getInternalLoader(e);switch(e.type){case"manifest":l=r?C.MANIFEST_LOAD_TIMEOUT:C.MANIFEST_LOAD_ERROR,c=!0;break;case"level":l=r?C.LEVEL_LOAD_TIMEOUT:C.LEVEL_LOAD_ERROR,c=!1;break;case"audioTrack":l=r?C.AUDIO_TRACK_LOAD_TIMEOUT:C.AUDIO_TRACK_LOAD_ERROR,c=!1;break;case"subtitleTrack":l=r?C.SUBTITLE_TRACK_LOAD_TIMEOUT:C.SUBTITLE_LOAD_ERROR,c=!1}u&&this.resetInternalLoader(e.type);const d={type:H.NETWORK_ERROR,details:l,fatal:c,url:e.url,loader:u,context:e,error:a,networkDetails:t,stats:i};s&&(d.response=Dt({url:(null==t?void 0:t.url)||e.url,data:void 0},s)),this.hls.trigger(y.ERROR,d)}handlePlaylistLoaded(e,t,r,s,i,o){const a=this.hls,{type:l,level:c,id:u,groupId:d,deliveryDirectives:f}=s,h=pf(t,s),p=MD(s),g="number"==typeof s.level&&"main"===p?c:void 0;if(!e.fragments.length){const E=new Error("No Segments found in Playlist");return void a.trigger(y.ERROR,{type:H.NETWORK_ERROR,details:C.LEVEL_EMPTY_ERROR,fatal:!1,url:h,error:E,reason:E.message,response:t,context:s,level:g,parent:p,networkDetails:i,stats:r})}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));const m=e.playlistParsingError;if(m)a.trigger(y.ERROR,{type:H.NETWORK_ERROR,details:C.LEVEL_PARSING_ERROR,fatal:!1,url:h,error:m,reason:m.message,response:t,context:s,level:g,parent:p,networkDetails:i,stats:r});else switch(e.live&&o&&(o.getCacheAge&&(e.ageHeader=o.getCacheAge()||0),(!o.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),l){case"manifest":case"level":a.trigger(y.LEVEL_LOADED,{details:e,level:g||0,id:u||0,stats:r,networkDetails:i,deliveryDirectives:f});break;case"audioTrack":a.trigger(y.AUDIO_TRACK_LOADED,{details:e,id:u||0,groupId:d||"",stats:r,networkDetails:i,deliveryDirectives:f});break;case"subtitleTrack":a.trigger(y.SUBTITLE_TRACK_LOADED,{details:e,id:u||0,groupId:d||"",stats:r,networkDetails:i,deliveryDirectives:f})}}}function PD(n,e){let t;try{t=new Event("addtrack")}catch(r){t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=n,e.dispatchEvent(t)}function FD(n,e){const t=n.mode;if("disabled"===t&&(n.mode="hidden"),n.cues&&!n.cues.getCueById(e.id))try{if(n.addCue(e),!n.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(r){v.debug(`[texttrack-utils]: ${r}`);try{const s=new self.TextTrackCue(e.startTime,e.endTime,e.text);s.id=e.id,n.addCue(s)}catch(s){v.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${s}`)}}"disabled"===t&&(n.mode=t)}function Ks(n){const e=n.mode;if("disabled"===e&&(n.mode="hidden"),n.cues)for(let t=n.cues.length;t--;)n.removeCue(n.cues[t]);"disabled"===e&&(n.mode=e)}function gf(n,e,t,r){const s=n.mode;if("disabled"===s&&(n.mode="hidden"),n.cues&&n.cues.length>0){const i=function(n,e,t){const r=[],s=function(n,e){if(e<n[0].startTime)return 0;const t=n.length-1;if(e>n[t].endTime)return-1;let r=0,s=t;for(;r<=s;){const i=Math.floor((s+r)/2);if(e<n[i].startTime)s=i-1;else{if(!(e>n[i].startTime&&r<t))return i;r=i+1}}return n[r].startTime-e<e-n[s].startTime?r:s}(n,e);if(s>-1)for(let i=s,o=n.length;i<o;i++){const a=n[i];if(a.startTime>=e&&a.endTime<=t)r.push(a);else if(a.startTime>t)return r}return r}(n.cues,e,t);for(let o=0;o<i.length;o++)(!r||r(i[o]))&&n.removeCue(i[o])}"disabled"===s&&(n.mode=s)}var Tn_emsg="https://aomedia.org/emsg/ID3";function mf(){if("undefined"!=typeof self)return self.VTTCue||self.TextTrackCue}function kD(n,e,t,r,s){let i=new n(e,t,"");try{i.value=r,s&&(i.type=s)}catch(o){i=new n(e,t,JSON.stringify(s?Dt({type:s},r):r))}return i}const pl=(()=>{const n=mf();try{n&&new n(0,Number.POSITIVE_INFINITY,"")}catch(e){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function yf(n,e){return n.getTime()/1e3-e}function bN(n){return Uint8Array.from(n.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}class SN{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null}_registerListeners(){const{hls:e}=this;e.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(y.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(y.LEVEL_UPDATED,this.onLevelUpdated,this)}_unregisterListeners(){const{hls:e}=this;e.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(y.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(y.LEVEL_UPDATED,this.onLevelUpdated,this)}onMediaAttached(e,t){this.media=t.media}onMediaDetaching(){!this.id3Track||(Ks(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const r=e[t];if("metadata"===r.kind&&"id3"===r.label)return PD(r,this.media),r}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:r,enableID3MetadataCues:s}}}=this;if(!r&&!s)return;const{samples:i}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const o=mf();if(o)for(let a=0;a<i.length;a++){const l=i[a].type;if(l===Tn_emsg&&!r||!s)continue;const c=uD(i[a].data);if(c){const u=i[a].pts;let d=u+i[a].duration;d>pl&&(d=pl),d-u<=0&&(d=u+.25);for(let h=0;h<c.length;h++){const p=c[h];if(!cD(p)){this.updateId3CueEnds(u,l);const g=kD(o,u,d,p,l);g&&this.id3Track.addCue(g)}}}}}updateId3CueEnds(e,t){var r;const s=null==(r=this.id3Track)?void 0:r.cues;if(s)for(let i=s.length;i--;){const o=s[i];o.type===t&&o.startTime<e&&o.endTime===pl&&(o.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:r,type:s}){const{id3Track:i,hls:o}=this;if(!o)return;const{config:{enableEmsgMetadataCues:a,enableID3MetadataCues:l}}=o;if(i&&(a||l)){let c;c="audio"===s?u=>"org.id3"===u.type&&l:"video"===s?u=>u.type===Tn_emsg&&a:u=>"org.id3"===u.type&&l||u.type===Tn_emsg&&a,gf(i,t,r,c)}}onLevelUpdated(e,{details:t}){if(!this.media||!t.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{dateRangeCuesAppended:r,id3Track:s}=this,{dateRanges:i}=t,o=Object.keys(i);if(s){const u=Object.keys(r).filter(d=>!o.includes(d));for(let d=u.length;d--;){const f=u[d];Object.keys(r[f].cues).forEach(h=>{s.removeCue(r[f].cues[h])}),delete r[f]}}const a=t.fragments[t.fragments.length-1];if(0===o.length||!O(null==a?void 0:a.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const l=a.programDateTime/1e3-a.start,c=mf();for(let u=0;u<o.length;u++){const d=o[u],f=i[d],h=r[d],p=(null==h?void 0:h.cues)||{};let g=(null==h?void 0:h.durationKnown)||!1;const m=yf(f.startDate,l);let E=pl;const T=f.endDate;if(T)E=yf(T,l),g=!0;else if(f.endOnNext&&!g){const x=o.reduce((_,w)=>{const S=i[w];return S.class===f.class&&S.id!==w&&S.startDate>f.startDate&&_.push(S),_},[]).sort((_,w)=>_.startDate.getTime()-w.startDate.getTime())[0];x&&(E=yf(x.startDate,l),g=!0)}const D=Object.keys(f.attr);for(let x=0;x<D.length;x++){const _=D[x];if(!Pk(_))continue;const w=p[_];if(w)g&&!h.durationKnown&&(w.endTime=E);else if(c){let S=f.attr[_];Fk(_)&&(S=bN(S));const R=kD(c,m,E,{key:_,data:S},"com.apple.quicktime.HLS");R&&(R.id=d,this.id3Track.addCue(R),p[_]=R)}}r[d]={cues:p,dateRange:f,durationKnown:g}}}}class IN{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=()=>this.timeupdate(),this.hls=e,this.config=e.config,this.registerListeners()}get latency(){return this._latency||0}get maxLatency(){const{config:e,levelDetails:t}=this;return void 0!==e.liveMaxLatencyDuration?e.liveMaxLatencyDuration:t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const{levelDetails:e}=this;if(null===e)return null;const{holdBack:t,partHoldBack:r,targetduration:s}=e,{liveSyncDuration:i,liveSyncDurationCount:o,lowLatencyMode:a}=this.config,l=this.hls.userConfig;let c=a&&r||t;return(l.liveSyncDuration||l.liveSyncDurationCount||0===c)&&(c=void 0!==i?i:o*s),c+Math.min(1*this.stallCount,s)}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency,r=this.levelDetails;if(null===e||null===t||null===r)return null;const s=r.edge,a=s-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.min(Math.max(s-r.totalduration,e-t-this.edgeStalled),a)}get drift(){const{levelDetails:e}=this;return null===e?1:e.drift}get edgeStalled(){const{levelDetails:e}=this;return null===e?0:Math.max(e.age-3*(this.config.lowLatencyMode&&e.partTarget||e.targetduration),0)}get forwardBufferLength(){const{media:e,levelDetails:t}=this;if(!e||!t)return 0;const r=e.buffered.length;return(r?e.buffered.end(r-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null}registerListeners(){this.hls.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(y.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(y.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(y.ERROR,this.onError,this)}unregisterListeners(){this.hls.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(y.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(y.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(y.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)}onManifestLoading(){this.levelDetails=null,this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){this.levelDetails=t,t.advanced&&this.timeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)}onError(e,t){var r;t.details===C.BUFFER_STALLED_ERROR&&(this.stallCount++,null!=(r=this.levelDetails)&&r.live&&v.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))}timeupdate(){const{media:e,levelDetails:t}=this;if(!e||!t)return;this.currentTime=e.currentTime;const r=this.computeLatency();if(null===r)return;this._latency=r;const{lowLatencyMode:s,maxLiveSyncPlaybackRate:i}=this.config;if(!s||1===i)return;const o=this.targetLatency;if(null===o)return;const a=r-o,l=Math.min(this.maxLatency,o+t.targetduration);if(t.live&&a<l&&a>.05&&this.forwardBufferLength>1){const u=Math.min(2,Math.max(1,i)),d=Math.round(2/(1+Math.exp(-.75*a-this.edgeStalled))*20)/20;e.playbackRate=Math.min(u,Math.max(1,d))}else 1!==e.playbackRate&&0!==e.playbackRate&&(e.playbackRate=1)}estimateLiveEdge(){const{levelDetails:e}=this;return null===e?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return null===e?null:e-this.currentTime}}const Ef=["NONE","TYPE-0","TYPE-1",null];class ND{constructor(e,t,r){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=r}addDirectives(e){const t=new self.URL(e);return void 0!==this.msn&&t.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class ho{constructor(e){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.unknownCodecs=e.unknownCodecs,this.codecSet=[e.videoCodec,e.audioCodec].filter(t=>t).join(",").replace(/\.[^.,]+/g,"")}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get attrs(){return this._attrs[this._urlId]}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get uri(){return this.url[this._urlId]||""}get urlId(){return this._urlId}set urlId(e){const t=e%this.url.length;this._urlId!==t&&(this.fragmentError=0,this.loadError=0,this.details=void 0,this._urlId=t)}get audioGroupId(){var e;return null==(e=this.audioGroupIds)?void 0:e[this.urlId]}get textGroupId(){var e;return null==(e=this.textGroupIds)?void 0:e[this.urlId]}addFallback(e){this.url.push(e.url),this._attrs.push(e.attrs)}}function Tf(n,e){const t=e.startPTS;if(O(t)){let s,r=0;e.sn>n.sn?(r=t-n.start,s=n):(r=n.start-t,s=e),s.duration!==r&&(s.duration=r)}else e.start=e.sn>n.sn?n.cc===e.cc&&n.minEndPTS?n.start+(n.minEndPTS-n.start):n.start+n.duration:Math.max(n.start-e.duration,0)}function OD(n,e,t,r,s,i){r-t<=0&&(v.warn("Fragment should have a positive duration",e),r=t+e.duration,i=s+e.duration);let a=t,l=r;const c=e.startPTS,u=e.endPTS;if(O(c)){const m=Math.abs(c-t);e.deltaPTS=O(e.deltaPTS)?Math.max(m,e.deltaPTS):m,a=Math.max(t,c),t=Math.min(t,c),s=Math.min(s,e.startDTS),l=Math.min(r,u),r=Math.max(r,u),i=Math.max(i,e.endDTS)}const d=t-e.start;0!==e.start&&(e.start=t),e.duration=r-e.start,e.startPTS=t,e.maxStartPTS=a,e.startDTS=s,e.endPTS=r,e.minEndPTS=l,e.endDTS=i;const f=e.sn;if(!n||f<n.startSN||f>n.endSN)return 0;let h;const p=f-n.startSN,g=n.fragments;for(g[p]=e,h=p;h>0;h--)Tf(g[h],g[h-1]);for(h=p;h<g.length-1;h++)Tf(g[h],g[h+1]);return n.fragmentHint&&Tf(g[g.length-1],n.fragmentHint),n.PTSKnown=n.alignedSliding=!0,d}function BD(n,e){const t=e.startSN+e.skippedSegments-n.startSN,r=n.fragments;t<0||t>=r.length||Df(e,r[t].start)}function Df(n,e){if(e){const t=n.fragments;for(let r=n.skippedSegments;r<t.length;r++)t[r].start+=e;n.fragmentHint&&(n.fragmentHint.start+=e)}}function UD(n,e,t){var r;return null!=n&&n.details?VD(null==(r=n.details)?void 0:r.partList,e,t):null}function VD(n,e,t){if(n)for(let r=n.length;r--;){const s=n[r];if(s.index===t&&s.fragment.sn===e)return s}return null}function gl(n){switch(n.details){case C.FRAG_LOAD_TIMEOUT:case C.KEY_LOAD_TIMEOUT:case C.LEVEL_LOAD_TIMEOUT:case C.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function $D(n,e){const t=gl(e);return n.default[(t?"timeout":"error")+"Retry"]}function vf(n,e){const t="linear"===n.backoff?1:Math.pow(2,e);return Math.min(t*n.retryDelayMs,n.maxRetryDelayMs)}function HD(n){return Dt(Dt({},n),{errorRetry:null,timeoutRetry:null})}function ml(n,e,t,r){return!!n&&e<n.maxNumRetry&&(function(n){return 0===n&&!1===navigator.onLine||!!n&&(n<400||n>499)}(r)||!!t)}const jD_search=function(n,e){let t=0,r=n.length-1,s=null,i=null;for(;t<=r;){s=(t+r)/2|0,i=n[s];const o=e(i);if(o>0)t=s+1;else{if(!(o<0))return i;r=s-1}}return null};function po(n,e,t=0,r=0){let s=null;if(n?s=e[n.sn-e[0].sn+1]||null:0===t&&0===e[0].start&&(s=e[0]),s&&0===_f(t,r,s))return s;const i=jD_search(e,_f.bind(null,t,r));return!i||i===n&&s?s:i}function _f(n=0,e=0,t){if(t.start<=n&&t.start+t.duration>n)return 0;const r=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-r<=n?1:t.start-r>n&&t.start?-1:0}function ON(n,e,t){const r=1e3*Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return(t.endProgramDateTime||0)-r>n}function $N(n,e,t){if(performance.now()-n.lastErrorPerfMs>3e5)return!0;const r=n.details;if(e.details===C.FRAG_GAP&&r&&e.frag){const i=po(null,r.fragments,e.frag.start);if(i&&!i.gap)return!0}if(t&&n.errors.length<t.errors.length){const s=n.errors[n.errors.length-1];if(r&&s.frag&&e.frag&&Math.abs(s.frag.start-e.frag.start)>3*r.targetduration)return!0}return!1}class xf{constructor(e,t){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=v.log.bind(v,`${t}:`),this.warn=v.warn.bind(v,`${t}:`),this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){clearTimeout(this.timer),this.timer=-1}startLoad(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t){const r=null==t?void 0:t.renditionReports;if(r){let s=-1;for(let i=0;i<r.length;i++){const o=r[i];let a;try{a=new self.URL(o.URI,t.url).href}catch(l){v.warn(`Could not construct new URL for Rendition Report: ${l}`),a=o.URI||""}if(a===e){s=i;break}a===e.substring(0,a.length)&&(s=i)}if(-1!==s){const i=r[s],o=parseInt(i["LAST-MSN"])||(null==t?void 0:t.lastPartSn);let a=parseInt(i["LAST-PART"])||(null==t?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){const l=Math.min(t.age-t.partTarget,t.targetduration);a>=0&&l>t.partTarget&&(a+=1)}return new ND(o,a>=0?a:void 0,"")}}}loadPlaylist(e){-1===this.requestScheduled&&(this.requestScheduled=self.performance.now())}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}shouldReloadPlaylist(e){return-1===this.timer&&-1===this.requestScheduled&&this.shouldLoadPlaylist(e)}playlistLoaded(e,t,r){const{details:s,stats:i}=t,o=self.performance.now(),a=i.loading.first?Math.max(0,o-i.loading.first):0;if(s.advancedDateTime=Date.now()-a,s.live||null!=r&&r.live){if(s.reloaded(r),r&&this.log(`live playlist ${e} ${s.advanced?"REFRESHED "+s.lastPartSn+"-"+s.lastPartIndex:s.updated?"UPDATED":"MISSED"}`),r&&s.fragments.length>0&&function(n,e){let t=null;const r=n.fragments;for(let l=r.length-1;l>=0;l--){const c=r[l].initSegment;if(c){t=c;break}}n.fragmentHint&&delete n.fragmentHint.endPTS;let i,s=0;if(function(n,e,t){const r=e.skippedSegments,s=Math.max(n.startSN,e.startSN)-e.startSN,i=(n.fragmentHint?1:0)+(r?e.endSN:Math.min(n.endSN,e.endSN))-e.startSN,o=e.startSN-n.startSN,a=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=n.fragmentHint?n.fragments.concat(n.fragmentHint):n.fragments;for(let c=s;c<=i;c++){const u=l[o+c];let d=a[c];r&&!d&&c<r&&(d=e.fragments[c]=u),u&&d&&t(u,d)}}(n,e,(l,c)=>{l.relurl&&(s=l.cc-c.cc),O(l.startPTS)&&O(l.endPTS)&&(c.start=c.startPTS=l.startPTS,c.startDTS=l.startDTS,c.maxStartPTS=l.maxStartPTS,c.endPTS=l.endPTS,c.endDTS=l.endDTS,c.minEndPTS=l.minEndPTS,c.duration=l.endPTS-l.startPTS,c.duration&&(i=c),e.PTSKnown=e.alignedSliding=!0),c.elementaryStreams=l.elementaryStreams,c.loader=l.loader,c.stats=l.stats,c.urlId=l.urlId,l.initSegment&&(c.initSegment=l.initSegment,t=l.initSegment)}),t&&(e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments).forEach(c=>{var u;(!c.initSegment||c.initSegment.relurl===(null==(u=t)?void 0:u.relurl))&&(c.initSegment=t)}),e.skippedSegments)if(e.deltaUpdateFailed=e.fragments.some(l=>!l),e.deltaUpdateFailed){v.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let l=e.skippedSegments;l--;)e.fragments.shift();e.startSN=e.fragments[0].sn,e.startCC=e.fragments[0].cc}else e.canSkipDateRanges&&(e.dateRanges=function(n,e,t){const r=Ye({},n);return t&&t.forEach(s=>{delete r[s]}),Object.keys(e).forEach(s=>{const i=new tD(e[s].attr,r[s]);i.isValid?r[s]=i:v.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${JSON.stringify(e[s].attr)}"`)}),r}(n.dateRanges,e.dateRanges,e.recentlyRemovedDateranges));const o=e.fragments;if(s){v.warn("discontinuity sliding from playlist, take drift into account");for(let l=0;l<o.length;l++)o[l].cc+=s}e.skippedSegments&&(e.startCC=e.fragments[0].cc),function(n,e,t){if(n&&e){let r=0;for(let s=0,i=n.length;s<=i;s++){const o=n[s],a=e[s+r];o&&a&&o.index===a.index&&o.fragment.sn===a.fragment.sn?((c=a).elementaryStreams=(l=o).elementaryStreams,c.stats=l.stats):r--}}var l,c}(n.partList,e.partList),i?OD(e,i,i.startPTS,i.endPTS,i.startDTS,i.endDTS):BD(n,e),o.length&&(e.totalduration=e.edge-o[0].start),e.driftStartTime=n.driftStartTime,e.driftStart=n.driftStart;const a=e.advancedDateTime;if(e.advanced&&a){const l=e.edge;e.driftStart||(e.driftStartTime=a,e.driftStart=l),e.driftEndTime=a,e.driftEnd=l}else e.driftEndTime=n.driftEndTime,e.driftEnd=n.driftEnd,e.advancedDateTime=n.advancedDateTime}(r,s),!this.canLoad||!s.live)return;let l,c,u;if(s.canBlockReload&&s.endSN&&s.advanced){const m=this.hls.config.lowLatencyMode,E=s.lastPartSn,T=s.endSN,D=s.lastPartIndex,_=E===T,w=m?0:D;-1!==D?(c=_?T+1:E,u=_?w:D+1):c=T+1;const S=s.age;let L=Math.min(S+s.ageHeader-s.partTarget,1.5*s.targetduration);if(L>0){if(r&&L>r.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${r.tuneInGoal} to: ${L} with playlist age: ${s.age}`),L=0;else{const b=Math.floor(L/s.targetduration);c+=b,void 0!==u&&(u+=Math.round(L%s.targetduration/s.partTarget)),this.log(`CDN Tune-in age: ${s.ageHeader}s last advanced ${S.toFixed(2)}s goal: ${L} skip sn ${b} to part ${u}`)}s.tuneInGoal=L}if(l=this.getDeliveryDirectives(s,t.deliveryDirectives,c,u),m||!_)return void this.loadPlaylist(l)}else(s.canBlockReload||s.canSkipUntil)&&(l=this.getDeliveryDirectives(s,t.deliveryDirectives,c,u));const d=this.hls.mainForwardBufferInfo,p=function(n,e=1/0){let t=1e3*n.targetduration;if(n.updated){const r=n.fragments,s=4;if(r.length&&t*s>e){const i=1e3*r[r.length-1].duration;i<t&&(t=i)}}else t/=2;return Math.round(t)}(s,1e3*(s.edge-(d?d.end-d.len:0)));s.updated&&o>this.requestScheduled+p&&(this.requestScheduled=i.loading.start),void 0!==c&&s.canBlockReload?this.requestScheduled=i.loading.first+p-(1e3*s.partTarget||1e3):-1===this.requestScheduled||this.requestScheduled+p<o?this.requestScheduled=o:this.requestScheduled-o<=0&&(this.requestScheduled+=p);let g=this.requestScheduled-o;g=Math.max(0,g),this.log(`reload live playlist ${e} in ${Math.round(g)} ms`),this.timer=self.setTimeout(()=>this.loadPlaylist(l),g)}else this.clearTimer()}getDeliveryDirectives(e,t,r,s){let i=function(n,e){const{canSkipUntil:t,canSkipDateRanges:r,endSN:s}=n;return t&&(void 0!==e?e-s:0)<t?r?"v2":"YES":""}(e,r);return null!=t&&t.skip&&e.deltaUpdateFailed&&(r=t.msn,s=t.part,i=""),new ND(r,s,i)}checkRetry(e){const t=e.details,r=gl(e),s=e.errorAction,{action:i,retryCount:o=0,retryConfig:a}=s||{},l=!!s&&!!a&&(5===i||!s.resolved&&2===i);if(l){var c;if(this.requestScheduled=-1,o>=a.maxNumRetry)return!1;if(r&&null!=(c=e.context)&&c.deliveryDirectives)this.warn(`Retrying playlist loading ${o+1}/${a.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const u=vf(a,o);this.timer=self.setTimeout(()=>this.loadPlaylist(),u),this.warn(`Retrying playlist loading ${o+1}/${a.maxNumRetry} after "${t}" in ${u}ms`)}e.levelRetry=!0,s.resolved=!0}return l}}let Cf;class HN extends xf{constructor(e,t){super(e,"[level-controller]"),this._levels=[],this._firstLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(y.LEVEL_LOADED,this.onLevelLoaded,this),e.on(y.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(y.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(y.FRAG_LOADED,this.onFragLoaded,this),e.on(y.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(y.LEVEL_LOADED,this.onLevelLoaded,this),e.off(y.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(y.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(y.FRAG_LOADED,this.onFragLoaded,this),e.off(y.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}startLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.startLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[]}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const r=[],s={};let i;t.levels.forEach(o=>{var a;const l=o.attrs;-1!==(null==(a=o.audioCodec)?void 0:a.indexOf("mp4a.40.34"))&&(Cf||(Cf=/chrome|firefox/i.test(navigator.userAgent)),Cf&&(o.audioCodec=void 0));const{AUDIO:c,CODECS:u,"FRAME-RATE":d,"PATHWAY-ID":f,RESOLUTION:h,SUBTITLES:p}=l,m=`${f||"."}-${o.bitrate}-${h}-${d}-${u}`;i=s[m],i?i.addFallback(o):(i=new ho(o),s[m]=i,r.push(i)),yl(i,"audio",c),yl(i,"text",p)}),this.filterAndSortMediaOptions(r,t)}filterAndSortMediaOptions(e,t){let r=[],s=[],i=!1,o=!1,a=!1,l=e.filter(({audioCodec:h,videoCodec:p,width:g,height:m,unknownCodecs:E})=>(i||(i=!(!g||!m)),o||(o=!!p),a||(a=!!h),!(null!=E&&E.length)&&(!h||hf(h,"audio"))&&(!p||hf(p,"video"))));if((i||o)&&a&&(l=l.filter(({videoCodec:h,width:p,height:g})=>!!h||!(!p||!g))),0===l.length)return void Promise.resolve().then(()=>{if(this.hls){const h=new Error("no level with compatible codecs found in manifest");this.hls.trigger(y.ERROR,{type:H.MEDIA_ERROR,details:C.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:h,reason:h.message})}});t.audioTracks&&(r=t.audioTracks.filter(h=>!h.audioCodec||hf(h.audioCodec,"audio")),GD(r)),t.subtitles&&(s=t.subtitles,GD(s));const c=l.slice(0);l.sort((h,p)=>h.attrs["HDCP-LEVEL"]!==p.attrs["HDCP-LEVEL"]?(h.attrs["HDCP-LEVEL"]||"")>(p.attrs["HDCP-LEVEL"]||"")?1:-1:h.bitrate!==p.bitrate?h.bitrate-p.bitrate:h.attrs["FRAME-RATE"]!==p.attrs["FRAME-RATE"]?h.attrs.decimalFloatingPoint("FRAME-RATE")-p.attrs.decimalFloatingPoint("FRAME-RATE"):h.attrs.SCORE!==p.attrs.SCORE?h.attrs.decimalFloatingPoint("SCORE")-p.attrs.decimalFloatingPoint("SCORE"):i&&h.height!==p.height?h.height-p.height:0);let u=c[0];if(this.steering&&(l=this.steering.filterParsedLevels(l),l.length!==c.length))for(let h=0;h<c.length;h++)if(c[h].pathwayId===l[0].pathwayId){u=c[h];break}this._levels=l;for(let h=0;h<l.length;h++)if(l[h]===u){this._firstLevel=h,this.log(`manifest loaded, ${l.length} level(s) found, first bitrate: ${u.bitrate}`);break}const f={levels:l,audioTracks:r,subtitleTracks:s,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:a,video:o,altAudio:!(a&&!o)&&r.some(h=>!!h.url)};this.hls.trigger(y.MANIFEST_PARSED,f),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}get levels(){return 0===this._levels.length?null:this._levels}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(0===t.length)return;if(e<0||e>=t.length){const u=new Error("invalid level idx"),d=e<0;if(this.hls.trigger(y.ERROR,{type:H.OTHER_ERROR,details:C.LEVEL_SWITCH_ERROR,level:e,fatal:d,error:u,reason:u.message}),d)return;e=Math.min(e,t.length-1)}const r=this.currentLevelIndex,s=this.currentLevel,i=s?s.attrs["PATHWAY-ID"]:void 0,o=t[e],a=o.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=o,r===e&&o.details&&s&&i===a)return;this.log(`Switching to level ${e}${a?" with Pathway "+a:""} from level ${r}${i?" with Pathway "+i:""}`);const l=Ye({},o,{level:e,maxBitrate:o.maxBitrate,attrs:o.attrs,uri:o.uri,urlId:o.urlId});delete l._attrs,delete l._urlId,this.hls.trigger(y.LEVEL_SWITCHING,l);const c=o.details;if(!c||c.live){const u=this.switchParams(o.uri,null==s?void 0:s.details);this.loadPlaylist(u)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(void 0===this._startLevel){const e=this.hls.config.startLevel;return void 0!==e?e:this._firstLevel}return this._startLevel}set startLevel(e){this._startLevel=e}onError(e,t){t.fatal||!t.context||"level"===t.context.type&&t.context.level===this.level&&this.checkRetry(t)}onFragLoaded(e,{frag:t}){if(void 0!==t&&"main"===t.type){const r=this._levels[t.level];void 0!==r&&(r.loadError=0)}}onLevelLoaded(e,t){var r;const{level:s,details:i}=t,o=this._levels[s];var a;if(!o)return this.warn(`Invalid level index ${s}`),void(null!=(a=t.deliveryDirectives)&&a.skip&&(i.deltaUpdateFailed=!0));s===this.currentLevelIndex?(0===o.fragmentError&&(o.loadError=0),this.playlistLoaded(s,t,o.details)):null!=(r=t.deliveryDirectives)&&r.skip&&(i.deltaUpdateFailed=!0)}onAudioTrackSwitched(e,t){const r=this.currentLevel;if(!r)return;const s=this.hls.audioTracks[t.id].groupId;if(r.audioGroupIds&&r.audioGroupId!==s){let i=-1;for(let o=0;o<r.audioGroupIds.length;o++)if(r.audioGroupIds[o]===s){i=o;break}-1!==i&&i!==r.urlId&&(r.urlId=i,this.canLoad&&this.startLoad())}}loadPlaylist(e){super.loadPlaylist();const t=this.currentLevelIndex,r=this.currentLevel;if(r&&this.shouldLoadPlaylist(r)){const s=r.urlId;let i=r.uri;if(e)try{i=e.addDirectives(i)}catch(a){this.warn(`Could not construct new URL with HLS Delivery Directives: ${a}`)}const o=r.attrs["PATHWAY-ID"];this.log(`Loading level index ${t}${void 0!==(null==e?void 0:e.msn)?" at sn "+e.msn+" part "+e.part:""} with${o?" Pathway "+o:""} URI ${s+1}/${r.url.length} ${i}`),this.clearTimer(),this.hls.trigger(y.LEVEL_LOADING,{url:i,level:t,id:s,deliveryDirectives:e||null})}}get nextLoadLevel(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}removeLevel(e,t){const r=(i,o)=>o!==t,s=this._levels.filter((i,o)=>o!==e||(i.url.length>1&&void 0!==t?(i.url=i.url.filter(r),i.audioGroupIds&&(i.audioGroupIds=i.audioGroupIds.filter(r)),i.textGroupIds&&(i.textGroupIds=i.textGroupIds.filter(r)),i.urlId=0,!0):(this.steering&&this.steering.removeLevel(i),!1)));this.hls.trigger(y.LEVELS_UPDATED,{levels:s})}onLevelsUpdated(e,{levels:t}){t.forEach((r,s)=>{const{details:i}=r;null!=i&&i.fragments&&i.fragments.forEach(o=>{o.level=s})}),this._levels=t}}function yl(n,e,t){!t||("audio"===e?(n.audioGroupIds||(n.audioGroupIds=[]),n.audioGroupIds[n.url.length-1]=t):"text"===e&&(n.textGroupIds||(n.textGroupIds=[]),n.textGroupIds[n.url.length-1]=t))}function GD(n){const e={};n.forEach(t=>{const r=t.groupId||"";t.id=e[r]=e[r]||0,e[r]++})}class jN{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(y.BUFFER_APPENDED,this.onBufferAppended,this),e.on(y.FRAG_BUFFERED,this.onFragBuffered,this),e.on(y.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:e}=this;e.off(y.BUFFER_APPENDED,this.onBufferAppended,this),e.off(y.FRAG_BUFFERED,this.onFragBuffered,this),e.off(y.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const r=this.activePartLists[t];if(r)for(let s=r.length;s--;){const i=r[s];if(!i)break;const o=i.end;if(i.start<=e&&null!==o&&e<=o)return i}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){const{fragments:r}=this,s=Object.keys(r);for(let i=s.length;i--;){const o=r[s[i]];if((null==o?void 0:o.body.type)===t&&o.buffered){const a=o.body;if(a.start<=e&&e<=a.end)return a}}return null}detectEvictedFragments(e,t,r,s){this.timeRanges&&(this.timeRanges[e]=t);const i=(null==s?void 0:s.fragment.sn)||-1;Object.keys(this.fragments).forEach(o=>{const a=this.fragments[o];if(!a||i>=a.body.sn)return;if(!a.buffered&&!a.loaded)return void(a.body.type===r&&this.removeFragment(a.body));const l=a.range[e];!l||l.time.some(c=>{const u=!this.isTimeBuffered(c.startPTS,c.endPTS,t);return u&&this.removeFragment(a.body),u})})}detectPartialFragments(e){const t=this.timeRanges,{frag:r,part:s}=e;if(!t||"initSegment"===r.sn)return;const i=Ws(r),o=this.fragments[i];if(!o||o.buffered&&r.gap)return;const a=!r.relurl;Object.keys(t).forEach(l=>{const c=r.elementaryStreams[l];c&&(o.range[l]=this.getBufferedTimes(r,s,a||!0===c.partial,t[l]))}),o.loaded=null,Object.keys(o.range).length?(o.buffered=!0,(o.body.endList=r.endList||o.body.endList)&&(this.endListFragments[o.body.type]=o),El(o)||this.removeParts(r.sn-1,r.type)):this.removeFragment(o.body)}removeParts(e,t){const r=this.activePartLists[t];!r||(this.activePartLists[t]=r.filter(s=>s.fragment.sn>=e))}fragBuffered(e,t){const r=Ws(e);let s=this.fragments[r];!s&&t&&(s=this.fragments[r]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),s&&(s.loaded=null,s.buffered=!0)}getBufferedTimes(e,t,r,s){const i={time:[],partial:r},o=e.start,a=e.end,l=e.minEndPTS||a,c=e.maxStartPTS||o;for(let u=0;u<s.length;u++){const d=s.start(u)-this.bufferPadding,f=s.end(u)+this.bufferPadding;if(c>=d&&l<=f){i.time.push({startPTS:Math.max(o,s.start(u)),endPTS:Math.min(a,s.end(u))});break}if(o<f&&a>d)i.partial=!0,i.time.push({startPTS:Math.max(o,s.start(u)),endPTS:Math.min(a,s.end(u))});else if(a<=d)break}return i}getPartialFragment(e){let r,s,i,t=null,o=0;const{bufferPadding:a,fragments:l}=this;return Object.keys(l).forEach(c=>{const u=l[c];!u||El(u)&&(s=u.body.start-a,i=u.body.end+a,e>=s&&e<=i&&(r=Math.min(e-s,i-e),o<=r&&(t=u.body,o=r)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return void 0!==t&&(t.buffered||El(t))}getState(e){const t=Ws(e),r=this.fragments[t];return r?r.buffered?El(r)?"PARTIAL":"OK":"APPENDING":"NOT_LOADED"}isTimeBuffered(e,t,r){let s,i;for(let o=0;o<r.length;o++){if(s=r.start(o)-this.bufferPadding,i=r.end(o)+this.bufferPadding,e>=s&&t<=i)return!0;if(t<=s)return!1}return!1}onFragLoaded(e,t){const{frag:r,part:s}=t;if("initSegment"===r.sn||r.bitrateTest)return;const i=s?null:t,o=Ws(r);this.fragments[o]={body:r,appendedPTS:null,loaded:i,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:r,part:s,timeRanges:i}=t;if("initSegment"===r.sn)return;const o=r.type;if(s){let a=this.activePartLists[o];a||(this.activePartLists[o]=a=[]),a.push(s)}this.timeRanges=i,Object.keys(i).forEach(a=>{this.detectEvictedFragments(a,i[a],o,s)})}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=Ws(e);return!!this.fragments[t]}hasParts(e){var t;return!(null==(t=this.activePartLists[e])||!t.length)}removeFragmentsInRange(e,t,r,s,i){s&&!this.hasGaps||Object.keys(this.fragments).forEach(o=>{const a=this.fragments[o];if(!a)return;const l=a.body;l.type!==r||s&&!l.gap||l.start<t&&l.end>e&&(a.buffered||i)&&this.removeFragment(l)})}removeFragment(e){const t=Ws(e);e.stats.loaded=0,e.clearElementaryStreamInfo();const r=this.activePartLists[e.type];if(r){const s=e.sn;this.activePartLists[e.type]=r.filter(i=>i.fragment.sn!==s)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1}}function El(n){var e,t,r;return n.buffered&&(n.body.gap||(null==(e=n.range.video)?void 0:e.partial)||(null==(t=n.range.audio)?void 0:t.partial)||(null==(r=n.range.audiovideo)?void 0:r.partial))}function Ws(n){return`${n.type}_${n.level}_${n.urlId}_${n.sn}`}const KD=Math.pow(2,17);class GN{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const r=e.url;if(!r)return Promise.reject(new Jn({type:H.NETWORK_ERROR,details:C.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error("Fragment does not have a "+(r?"part list":"url")),networkDetails:null}));this.abort();const s=this.config,i=s.fLoader,o=s.loader;return new Promise((a,l)=>{if(this.loader&&this.loader.destroy(),e.gap){if(e.tagList.some(h=>"GAP"===h[0]))return void l(YD(e));e.gap=!1}const c=this.loader=e.loader=i?new i(s):new o(s),u=WD(e),d=HD(s.fragLoadPolicy.default),f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:"initSegment"===e.sn?1/0:KD};e.stats=c.stats,c.load(u,f,{onSuccess:(h,p,g,m)=>{this.resetLoader(e,c);let E=h.data;g.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(E.slice(0,16)),E=E.slice(16)),a({frag:e,part:null,payload:E,networkDetails:m})},onError:(h,p,g,m)=>{this.resetLoader(e,c),l(new Jn({type:H.NETWORK_ERROR,details:C.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:Dt({url:r,data:void 0},h),error:new Error(`HTTP Error ${h.code} ${h.text}`),networkDetails:g,stats:m}))},onAbort:(h,p,g)=>{this.resetLoader(e,c),l(new Jn({type:H.NETWORK_ERROR,details:C.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:g,stats:h}))},onTimeout:(h,p,g)=>{this.resetLoader(e,c),l(new Jn({type:H.NETWORK_ERROR,details:C.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${f.timeout}ms`),networkDetails:g,stats:h}))},onProgress:(h,p,g,m)=>{t&&t({frag:e,part:null,payload:g,networkDetails:m})}})})}loadPart(e,t,r){this.abort();const s=this.config,i=s.fLoader,o=s.loader;return new Promise((a,l)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap)return void l(YD(e,t));const c=this.loader=e.loader=i?new i(s):new o(s),u=WD(e,t),d=HD(s.fragLoadPolicy.default),f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:KD};t.stats=c.stats,c.load(u,f,{onSuccess:(h,p,g,m)=>{this.resetLoader(e,c),this.updateStatsFromPart(e,t);const E={frag:e,part:t,payload:h.data,networkDetails:m};r(E),a(E)},onError:(h,p,g,m)=>{this.resetLoader(e,c),l(new Jn({type:H.NETWORK_ERROR,details:C.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:Dt({url:u.url,data:void 0},h),error:new Error(`HTTP Error ${h.code} ${h.text}`),networkDetails:g,stats:m}))},onAbort:(h,p,g)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,c),l(new Jn({type:H.NETWORK_ERROR,details:C.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:g,stats:h}))},onTimeout:(h,p,g)=>{this.resetLoader(e,c),l(new Jn({type:H.NETWORK_ERROR,details:C.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${f.timeout}ms`),networkDetails:g,stats:h}))}})})}updateStatsFromPart(e,t){const r=e.stats,s=t.stats,i=s.total;if(r.loaded+=s.loaded,i){const l=Math.round(e.duration/t.duration),c=Math.min(Math.round(r.loaded/i),l),d=(l-c)*Math.round(r.loaded/c);r.total=r.loaded+d}else r.total=Math.max(r.loaded,r.total);const o=r.loading,a=s.loading;o.start?o.first+=a.first-a.start:(o.start=a.start,o.first=a.first),o.end=a.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function WD(n,e=null){const t=e||n,r={frag:n,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},s=t.byteRangeStartOffset,i=t.byteRangeEndOffset;if(O(s)&&O(i)){var o;let a=s,l=i;if("initSegment"===n.sn&&"AES-128"===(null==(o=n.decryptdata)?void 0:o.method)){const c=i-s;c%16&&(l=i+(16-c%16)),0!==s&&(r.resetIV=!0,a=s-16)}r.rangeStart=a,r.rangeEnd=l}return r}function YD(n,e){const t=new Error(`GAP ${n.gap?"tag":"attribute"} found`),r={type:H.MEDIA_ERROR,details:C.FRAG_GAP,fatal:!1,frag:n,error:t,networkDetails:null};return e&&(r.part=e),(e||n).stats.aborted=!0,new Jn(r)}class Jn extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class KN{constructor(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const t in this.keyUriToKeyInfo){const r=this.keyUriToKeyInfo[t].loader;if(r){if(e&&e!==r.context.frag.type)return;r.abort()}}}detach(){for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(e,t=C.KEY_LOAD_ERROR,r,s,i){return new Jn({type:H.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:i,error:r,networkDetails:s})}loadClear(e,t){if(this.emeController&&this.config.emeEnabled){const{sn:r,cc:s}=e;for(let i=0;i<t.length;i++){const o=t[i];if(s<=o.cc&&("initSegment"===r||"initSegment"===o.sn||r<o.sn)){this.emeController.selectKeySystemFormat(o).then(a=>{o.setKeyFormat(a)});break}}}}load(e){return!e.decryptdata&&e.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var r,s;t&&e.setKeyFormat(t);const i=e.decryptdata;if(!i){const c=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,C.KEY_LOAD_ERROR,c))}const o=i.uri;if(!o)return Promise.reject(this.createKeyLoadError(e,C.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${o}"`)));let a=this.keyUriToKeyInfo[o];if(null!=(r=a)&&r.decryptdata.key)return i.key=a.decryptdata.key,Promise.resolve({frag:e,keyInfo:a});var l;if(null!=(s=a)&&s.keyLoadPromise)switch(null==(l=a.mediaKeySessionContext)?void 0:l.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return a.keyLoadPromise.then(c=>(i.key=c.keyInfo.decryptdata.key,{frag:e,keyInfo:a}))}switch(a=this.keyUriToKeyInfo[o]={decryptdata:i,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},i.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return"identity"===i.keyFormat?this.loadKeyHTTP(a,e):this.loadKeyEME(a,e);case"AES-128":return this.loadKeyHTTP(a,e);default:return Promise.reject(this.createKeyLoadError(e,C.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${i.method}"`)))}}loadKeyEME(e,t){const r={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){const s=this.emeController.loadKey(r);if(s)return(e.keyLoadPromise=s.then(i=>(e.mediaKeySessionContext=i,r))).catch(i=>{throw e.keyLoadPromise=null,i})}return Promise.resolve(r)}loadKeyHTTP(e,t){const r=this.config,i=new(0,r.loader)(r);return t.keyLoader=e.loader=i,e.keyLoadPromise=new Promise((o,a)=>{const l={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},c=r.keyLoadPolicy.default;i.load(l,{loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},{onSuccess:(f,h,p,g)=>{const{frag:m,keyInfo:E,url:T}=p;if(!m.decryptdata||E!==this.keyUriToKeyInfo[T])return a(this.createKeyLoadError(m,C.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),g));E.decryptdata.key=m.decryptdata.key=new Uint8Array(f.data),m.keyLoader=null,E.loader=null,o({frag:m,keyInfo:E})},onError:(f,h,p,g)=>{this.resetLoader(h),a(this.createKeyLoadError(t,C.KEY_LOAD_ERROR,new Error(`HTTP Error ${f.code} loading key ${f.text}`),p,Dt({url:l.url,data:void 0},f)))},onTimeout:(f,h,p)=>{this.resetLoader(h),a(this.createKeyLoadError(t,C.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),p))},onAbort:(f,h,p)=>{this.resetLoader(h),a(this.createKeyLoadError(t,C.INTERNAL_ABORTED,new Error("key loading aborted"),p))}})})}resetLoader(e){const{frag:t,keyInfo:r,url:s}=e,i=r.loader;t.keyLoader===i&&(t.keyLoader=null,r.loader=null),delete this.keyUriToKeyInfo[s],i&&i.destroy()}}const YN={length:0,start:()=>0,end:()=>0};class Ce{static isBuffered(e,t){try{if(e){const r=Ce.getBuffered(e);for(let s=0;s<r.length;s++)if(t>=r.start(s)&&t<=r.end(s))return!0}}catch(r){}return!1}static bufferInfo(e,t,r){try{if(e){const s=Ce.getBuffered(e),i=[];let o;for(o=0;o<s.length;o++)i.push({start:s.start(o),end:s.end(o)});return this.bufferedInfo(i,t,r)}}catch(s){}return{len:0,start:t,end:t,nextStart:void 0}}static bufferedInfo(e,t,r){t=Math.max(0,t),e.sort(function(c,u){return c.start-u.start||u.end-c.end});let s=[];if(r)for(let c=0;c<e.length;c++){const u=s.length;if(u){const d=s[u-1].end;e[c].start-d<r?e[c].end>d&&(s[u-1].end=e[c].end):s.push(e[c])}else s.push(e[c])}else s=e;let o,i=0,a=t,l=t;for(let c=0;c<s.length;c++){const u=s[c].start,d=s[c].end;if(t+r>=u&&t<d)a=u,l=d,i=l-t;else if(t+r<u){o=u;break}}return{len:i,start:a||0,end:l||0,nextStart:o}}static getBuffered(e){try{return e.buffered}catch(t){return v.log("failed to get media.buffered",t),YN}}}class bf{constructor(e,t,r,s=0,i=-1,o=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=e,this.sn=t,this.id=r,this.size=s,this.part=i,this.partial=o}}function qD(n,e){let t=null;for(let r=0,s=n.length;r<s;r++){const i=n[r];if(i&&i.cc===e){t=i;break}}return t}function zD(n,e){if(n){const t=n.start+e;n.start=n.startPTS=t,n.endPTS=t+n.duration}}function Sf(n,e){const t=e.fragments;for(let r=0,s=t.length;r<s;r++)zD(t[r],n);e.fragmentHint&&zD(e.fragmentHint,n),e.alignedSliding=!0}function QD(n,e){if(!n.hasProgramDateTime||!e.hasProgramDateTime)return;const t=n.fragments,r=e.fragments;if(!t.length||!r.length)return;const i=r[Math.round(r.length/2)-1],o=qD(t,i.cc)||t[Math.round(t.length/2)-1],a=i.programDateTime,l=o.programDateTime;null!==a&&null!==l&&Sf((l-a)/1e3-(o.start-i.start),n)}class ZN{constructor(e,t){this.subtle=void 0,this.aesIV=void 0,this.subtle=e,this.aesIV=t}decrypt(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)}}class eO{constructor(e,t){this.subtle=void 0,this.key=void 0,this.subtle=e,this.key=t}expandKey(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}class nO{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),r=new Uint32Array(4);for(let s=0;s<4;s++)r[s]=t.getUint32(4*s);return r}initTable(){const e=this.sBox,t=this.invSBox,r=this.subMix,s=r[0],i=r[1],o=r[2],a=r[3],l=this.invSubMix,c=l[0],u=l[1],d=l[2],f=l[3],h=new Uint32Array(256);let p=0,g=0,m=0;for(m=0;m<256;m++)h[m]=m<128?m<<1:m<<1^283;for(m=0;m<256;m++){let E=g^g<<1^g<<2^g<<3^g<<4;E=E>>>8^255&E^99,e[p]=E,t[E]=p;const T=h[p],D=h[T],x=h[D];let _=257*h[E]^16843008*E;s[p]=_<<24|_>>>8,i[p]=_<<16|_>>>16,o[p]=_<<8|_>>>24,a[p]=_,_=16843009*x^65537*D^257*T^16843008*p,c[E]=_<<24|_>>>8,u[E]=_<<16|_>>>16,d[E]=_<<8|_>>>24,f[E]=_,p?(p=T^h[h[h[x^T]]],g^=h[h[g]]):p=g=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let r=!0,s=0;for(;s<t.length&&r;)r=t[s]===this.key[s],s++;if(r)return;this.key=t;const i=this.keySize=t.length;if(4!==i&&6!==i&&8!==i)throw new Error("Invalid aes key size="+i);const o=this.ksRows=4*(i+6+1);let a,l;const c=this.keySchedule=new Uint32Array(o),u=this.invKeySchedule=new Uint32Array(o),d=this.sBox,f=this.rcon,h=this.invSubMix,p=h[0],g=h[1],m=h[2],E=h[3];let T,D;for(a=0;a<o;a++)a<i?T=c[a]=t[a]:(D=T,a%i==0?(D=D<<8|D>>>24,D=d[D>>>24]<<24|d[D>>>16&255]<<16|d[D>>>8&255]<<8|d[255&D],D^=f[a/i|0]<<24):i>6&&a%i==4&&(D=d[D>>>24]<<24|d[D>>>16&255]<<16|d[D>>>8&255]<<8|d[255&D]),c[a]=T=(c[a-i]^D)>>>0);for(l=0;l<o;l++)a=o-l,D=3&l?c[a]:c[a-4],u[l]=l<4||a<=4?D:p[d[D>>>24]]^g[d[D>>>16&255]]^m[d[D>>>8&255]]^E[d[255&D]],u[l]=u[l]>>>0}networkToHostOrderSwap(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24}decrypt(e,t,r){const s=this.keySize+6,i=this.invKeySchedule,o=this.invSBox,a=this.invSubMix,l=a[0],c=a[1],u=a[2],d=a[3],f=this.uint8ArrayToUint32Array_(r);let h=f[0],p=f[1],g=f[2],m=f[3];const E=new Int32Array(e),T=new Int32Array(E.length);let D,x,_,w,S,R,L,b,N,F,ue,qe,me,Te;const Ie=this.networkToHostOrderSwap;for(;t<E.length;){for(N=Ie(E[t]),F=Ie(E[t+1]),ue=Ie(E[t+2]),qe=Ie(E[t+3]),S=N^i[0],R=qe^i[1],L=ue^i[2],b=F^i[3],me=4,Te=1;Te<s;Te++)D=l[S>>>24]^c[R>>16&255]^u[L>>8&255]^d[255&b]^i[me],x=l[R>>>24]^c[L>>16&255]^u[b>>8&255]^d[255&S]^i[me+1],_=l[L>>>24]^c[b>>16&255]^u[S>>8&255]^d[255&R]^i[me+2],w=l[b>>>24]^c[S>>16&255]^u[R>>8&255]^d[255&L]^i[me+3],S=D,R=x,L=_,b=w,me+=4;D=o[S>>>24]<<24^o[R>>16&255]<<16^o[L>>8&255]<<8^o[255&b]^i[me],x=o[R>>>24]<<24^o[L>>16&255]<<16^o[b>>8&255]<<8^o[255&S]^i[me+1],_=o[L>>>24]<<24^o[b>>16&255]<<16^o[S>>8&255]<<8^o[255&R]^i[me+2],w=o[b>>>24]<<24^o[S>>16&255]<<16^o[R>>8&255]<<8^o[255&L]^i[me+3],T[t]=Ie(D^h),T[t+1]=Ie(w^p),T[t+2]=Ie(_^g),T[t+3]=Ie(x^m),h=N,p=F,g=ue,m=qe,t+=4}return T.buffer}}class If{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const r=self.crypto;r&&(this.subtle=r.subtle||r.webkitSubtle)}catch(r){}null===this.subtle&&(this.useSoftware=!0)}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const r=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?function(n){const e=n.byteLength,t=e&&new DataView(n.buffer).getUint8(e-1);return t?jr(n,0,e-t):n}(r):r}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,r){return this.useSoftware?new Promise((s,i)=>{this.softwareDecrypt(new Uint8Array(e),t,r);const o=this.flush();o?s(o.buffer):i(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,r)}softwareDecrypt(e,t,r){const{currentIV:s,currentResult:i,remainderData:o}=this;this.logOnce("JS AES decrypt"),o&&(e=Gr(o,e),this.remainderData=null);const a=this.getValidChunk(e);if(!a.length)return null;s&&(r=s);let l=this.softwareDecrypter;l||(l=this.softwareDecrypter=new nO),l.expandKey(t);const c=i;return this.currentResult=l.decrypt(a.buffer,0,r),this.currentIV=jr(a,-16).buffer,c||null}webCryptoDecrypt(e,t,r){const s=this.subtle;return(this.key!==t||!this.fastAesKey)&&(this.key=t,this.fastAesKey=new eO(s,t)),this.fastAesKey.expandKey().then(i=>s?(this.logOnce("WebCrypto AES decrypt"),new ZN(s,new Uint8Array(r)).decrypt(e.buffer,i)):Promise.reject(new Error("web crypto not initialized"))).catch(i=>(v.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${i.name}: ${i.message}`),this.onWebCryptoError(e,t,r)))}onWebCryptoError(e,t,r){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,r);const s=this.flush();if(s)return s.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")}getValidChunk(e){let t=e;const r=e.length-e.length%16;return r!==e.length&&(t=jr(e,0,r),this.remainderData=jr(e,r)),t}logOnce(e){!this.logEnabled||(v.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}class Af extends class{constructor(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)}clearNextTick(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)}tick(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}{constructor(e,t,r,s,i){super(),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state="STOPPED",this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.loadedmetadata=!1,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.onvseeking=null,this.onvended=null,this.logPrefix="",this.log=void 0,this.warn=void 0,this.playlistType=i,this.logPrefix=s,this.log=v.log.bind(v,`${s}:`),this.warn=v.warn.bind(v,`${s}:`),this.hls=e,this.fragmentLoader=new GN(e.config),this.keyLoader=r,this.fragmentTracker=t,this.config=e.config,this.decrypter=new If(e.config),e.on(y.MANIFEST_LOADED,this.onManifestLoaded,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;null!=e&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state="STOPPED"}_streamEnded(e,t){if(t.live||e.nextStart||!e.end||!this.media)return!1;const r=t.partList;if(null!=r&&r.length){const i=r[r.length-1];return Ce.isBuffered(this.media,i.start+i.duration/2)}return this.fragmentTracker.isEndListAppended(t.fragments[t.fragments.length-1].type)}getLevelDetails(){var e;if(this.levels&&null!==this.levelLastLoaded)return null==(e=this.levels[this.levelLastLoaded])?void 0:e.details}onMediaAttached(e,t){const r=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),r.addEventListener("seeking",this.onvseeking),r.addEventListener("ended",this.onvended);const s=this.config;this.levels&&s.autoStartLoad&&"STOPPED"===this.state&&this.startLoad(s.startPosition)}onMediaDetaching(){const e=this.media;null!=e&&e.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&this.onvseeking&&this.onvended&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}onMediaSeeking(){const{config:e,fragCurrent:t,media:r,mediaBuffer:s,state:i}=this,o=r?r.currentTime:0,a=Ce.bufferInfo(s||r,o,e.maxBufferHole);if(this.log(`media seeking to ${O(o)?o.toFixed(3):o}, state: ${i}`),"ENDED"===this.state)this.resetLoadingState();else if(t){const l=e.maxFragLookUpTolerance,c=t.start-l,u=t.start+t.duration+l;if(!a.len||u<a.start||c>a.end){const d=o>u;(o<c||d)&&(d&&t.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),t.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}r&&(this.fragmentTracker.removeFragmentsInRange(o,1/0,this.playlistType,!0),this.lastCurrentTime=o),!this.loadedmetadata&&!a.len&&(this.nextLoadPosition=this.startPosition=o),this.tickImmediate()}onMediaEnded(){this.startPosition=this.lastCurrentTime=0}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset,this.initPTS=[]}onHandlerDestroying(){this.stopLoad(),super.onHandlerDestroying()}onHandlerDestroyed(){this.state="STOPPED",this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,r){this._loadFragForPlayback(e,t,r)}_loadFragForPlayback(e,t,r){this._doFragLoad(e,t,r,i=>{if(this.fragContextChanged(e))return this.warn(`Fragment ${e.sn}${i.part?" p: "+i.part.index:""} of level ${e.level} was dropped during download.`),void this.fragmentTracker.removeFragment(e);e.stats.chunkCount++,this._handleFragmentLoadProgress(i)}).then(i=>{if(!i)return;const o=this.state;this.fragContextChanged(e)?("FRAG_LOADING"===o||!this.fragCurrent&&"PARSING"===o)&&(this.fragmentTracker.removeFragment(e),this.state="IDLE"):("payload"in i&&(this.log(`Loaded fragment ${e.sn} of level ${e.level}`),this.hls.trigger(y.FRAG_LOADED,i)),this._handleFragmentLoadComplete(i))}).catch(i=>{"STOPPED"===this.state||"ERROR"===this.state||(this.warn(i),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:r}=this;if("APPENDING"===r.getState(e)){const o=this.getFwdBufferInfo(this.mediaBuffer,e.type),a=Math.max(e.duration,o?o.len:this.config.maxBufferLength);this.reduceMaxBufferLength(a)&&r.removeFragment(e)}else 0===(null==(t=this.mediaBuffer)?void 0:t.buffered.length)?r.removeAllFragments():r.hasParts(e.type)&&(r.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),"PARTIAL"===r.getState(e)&&r.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}flushMainBuffer(e,t,r=null){e-t&&this.hls.trigger(y.BUFFER_FLUSHING,{startOffset:e,endOffset:t,type:r})}_loadInitSegment(e,t){this._doFragLoad(e,t).then(r=>{if(!r||this.fragContextChanged(e)||!this.levels)throw new Error("init load aborted");return r}).then(r=>{const{hls:s}=this,{payload:i}=r,o=e.decryptdata;if(i&&i.byteLength>0&&o&&o.key&&o.iv&&"AES-128"===o.method){const a=self.performance.now();return this.decrypter.decrypt(new Uint8Array(i),o.key.buffer,o.iv.buffer).catch(l=>{throw s.trigger(y.ERROR,{type:H.MEDIA_ERROR,details:C.FRAG_DECRYPT_ERROR,fatal:!1,error:l,reason:l.message,frag:e}),l}).then(l=>{const c=self.performance.now();return s.trigger(y.FRAG_DECRYPTED,{frag:e,payload:l,stats:{tstart:a,tdecrypt:c}}),r.payload=l,r})}return r}).then(r=>{const{fragCurrent:s,hls:i,levels:o}=this;if(!o)throw new Error("init load aborted, missing levels");const a=e.stats;this.state="IDLE",t.fragmentError=0,e.data=new Uint8Array(r.payload),a.parsing.start=a.buffering.start=self.performance.now(),a.parsing.end=a.buffering.end=self.performance.now(),r.frag===s&&i.trigger(y.FRAG_BUFFERED,{stats:a,frag:s,part:null,id:e.type}),this.tick()}).catch(r=>{"STOPPED"===this.state||"ERROR"===this.state||(this.warn(r),this.resetFragmentLoading(e))})}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.level!==t.level||e.sn!==t.sn||e.urlId!==t.urlId}fragBufferedComplete(e,t){var r,s,i,o;const a=this.mediaBuffer?this.mediaBuffer:this.media;this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${"main"===this.playlistType?"level":"track"} ${e.level} (frag:[${(null!=(r=e.startPTS)?r:NaN).toFixed(3)}-${(null!=(s=e.endPTS)?s:NaN).toFixed(3)}] > buffer:${a?function(n){let e="";const t=n.length;for(let r=0;r<t;r++)e+=`[${n.start(r).toFixed(3)}-${n.end(r).toFixed(3)}]`;return e}(Ce.getBuffered(a)):"(detached)"})`),this.state="IDLE",a&&(!this.loadedmetadata&&"main"==e.type&&a.buffered.length&&(null==(i=this.fragCurrent)?void 0:i.sn)===(null==(o=this.fragPrevious)?void 0:o.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())}seekToStartPos(){}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:r,part:s,partsLoaded:i}=e,o=!i||0===i.length||i.some(l=>!l),a=new bf(r.level,r.sn,r.stats.chunkCount+1,0,s?s.index:-1,!o);t.flush(a)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,r=null,s){var i;const o=null==t?void 0:t.details;if(!this.levels||!o)throw new Error(`frag load aborted, missing level${o?"":" detail"}s`);let a=null;if(!e.encrypted||null!=(i=e.decryptdata)&&i.key?!e.encrypted&&o.encryptedFragments.length&&this.keyLoader.loadClear(e,o.encryptedFragments):(this.log(`Loading key for ${e.sn} of [${o.startSN}-${o.endSN}], ${"[stream-controller]"===this.logPrefix?"level":"track"} ${e.level}`),this.state="KEY_LOADING",this.fragCurrent=e,a=this.keyLoader.load(e).then(u=>{if(!this.fragContextChanged(u.frag))return this.hls.trigger(y.KEY_LOADED,u),"KEY_LOADING"===this.state&&(this.state="IDLE"),u}),this.hls.trigger(y.KEY_LOADING,{frag:e}),null===this.fragCurrent&&(a=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))),r=Math.max(e.start,r||0),this.config.lowLatencyMode&&"initSegment"!==e.sn){const u=o.partList;if(u&&s){r>e.end&&o.fragmentHint&&(e=o.fragmentHint);const d=this.getNextPart(u,e,r);if(d>-1){const f=u[d];let h;return this.log(`Loading part sn: ${e.sn} p: ${f.index} cc: ${e.cc} of playlist [${o.startSN}-${o.endSN}] parts [0-${d}-${u.length-1}] ${"[stream-controller]"===this.logPrefix?"level":"track"}: ${e.level}, target: ${parseFloat(r.toFixed(3))}`),this.nextLoadPosition=f.start+f.duration,this.state="FRAG_LOADING",h=a?a.then(p=>!p||this.fragContextChanged(p.frag)?null:this.doFragPartsLoad(e,f,t,s)).catch(p=>this.handleFragLoadError(p)):this.doFragPartsLoad(e,f,t,s).catch(p=>this.handleFragLoadError(p)),this.hls.trigger(y.FRAG_LOADING,{frag:e,part:f,targetBufferTime:r}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):h}if(!e.url||this.loadedEndOfParts(u,r))return Promise.resolve(null)}}this.log(`Loading fragment ${e.sn} cc: ${e.cc} ${o?"of ["+o.startSN+"-"+o.endSN+"] ":""}${"[stream-controller]"===this.logPrefix?"level":"track"}: ${e.level}, target: ${parseFloat(r.toFixed(3))}`),O(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state="FRAG_LOADING";const l=this.config.progressive;let c;return c=l&&a?a.then(u=>!u||this.fragContextChanged(null==u?void 0:u.frag)?null:this.fragmentLoader.load(e,s)).catch(u=>this.handleFragLoadError(u)):Promise.all([this.fragmentLoader.load(e,l?s:void 0),a]).then(([u])=>(!l&&u&&s&&s(u),u)).catch(u=>this.handleFragLoadError(u)),this.hls.trigger(y.FRAG_LOADING,{frag:e,targetBufferTime:r}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):c}doFragPartsLoad(e,t,r,s){return new Promise((i,o)=>{var a;const l=[],c=null==(a=r.details)?void 0:a.partList,u=d=>{this.fragmentLoader.loadPart(e,d,s).then(f=>{l[d.index]=f;const h=f.part;this.hls.trigger(y.FRAG_LOADED,f);const p=UD(r,e.sn,d.index+1)||VD(c,e.sn,d.index+1);if(!p)return i({frag:e,part:h,partsLoaded:l});u(p)}).catch(o)};u(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;e.data&&t.details===C.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(y.ERROR,t)}else this.hls.trigger(y.ERROR,{type:H.OTHER_ERROR,details:C.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||"PARSING"!==this.state)return void(!this.fragCurrent&&"STOPPED"!==this.state&&"ERROR"!==this.state&&(this.state="IDLE"));const{frag:r,part:s,level:i}=t,o=self.performance.now();r.stats.parsing.end=o,s&&(s.stats.parsing.end=o),this.updateLevelTiming(r,s,i,e.partial)}getCurrentContext(e){const{levels:t,fragCurrent:r}=this,{level:s,sn:i,part:o}=e;if(null==t||!t[s])return this.warn(`Levels object was unset while buffering fragment ${i} of level ${s}. The current chunk will not be buffered.`),null;const a=t[s],l=o>-1?UD(a,i,o):null,c=l?l.fragment:function(n,e,t){if(null==n||!n.details)return null;const r=n.details;let s=r.fragments[e-r.startSN];return s||(s=r.fragmentHint,s&&s.sn===e)?s:e<r.startSN&&t&&t.sn===e?t:null}(a,i,r);return c?(r&&r!==c&&(c.stats=r.stats),{frag:c,part:l,level:a}):null}bufferFragmentData(e,t,r,s,i){var o;if(!e||"PARSING"!==this.state)return;const{data1:a,data2:l}=e;let c=a;if(a&&l&&(c=Gr(a,l)),null!=(o=c)&&o.length&&(this.hls.trigger(y.BUFFER_APPENDING,{type:e.type,frag:t,part:r,chunkMeta:s,parent:t.type,data:c}),e.dropped&&e.independent&&!r)){if(i)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!Ce.isBuffered(t,t.currentTime))return void this.flushMainBuffer(0,e.start);const r=t.currentTime,s=Ce.bufferInfo(t,r,0),o=Math.min(2*this.config.maxFragLookUpTolerance,.25*e.duration),a=Math.max(Math.min(e.start-o,s.end-o),r+o);e.start-a>o&&this.flushMainBuffer(a,e.start)}getFwdBufferInfo(e,t){const r=this.getLoadPosition();return O(r)?this.getFwdBufferInfoAtPos(e,r,t):null}getFwdBufferInfoAtPos(e,t,r){const{config:{maxBufferHole:s}}=this,i=Ce.bufferInfo(e,t,s);if(0===i.len&&void 0!==i.nextStart){const o=this.fragmentTracker.getBufferedFrag(t,r);if(o&&i.nextStart<o.end)return Ce.bufferInfo(e,t,Math.max(i.nextStart,s))}return i}getMaxBufferLength(e){const{config:t}=this;let r;return r=e?Math.max(8*t.maxBufferSize/e,t.maxBufferLength):t.maxBufferLength,Math.min(r,t.maxMaxBufferLength)}reduceMaxBufferLength(e){const t=this.config;return t.maxMaxBufferLength>=(e||t.maxBufferLength)&&(t.maxMaxBufferLength/=2,this.warn(`Reduce max buffer length to ${t.maxMaxBufferLength}s`),!0)}getAppendedFrag(e,t="main"){const r=this.fragmentTracker.getAppendedFrag(e,"main");return r&&"fragment"in r?r.fragment:r}getNextFragment(e,t){const r=t.fragments,s=r.length;if(!s)return null;const{config:i}=this,o=r[0].start;let a;if(t.live){const l=i.initialLiveManifestSize;if(s<l)return this.warn(`Not enough fragments to start playback (have: ${s}, need: ${l})`),null;!t.PTSKnown&&!this.startFragRequested&&-1===this.startPosition&&(a=this.getInitialLiveFragment(t,r),this.startPosition=a?this.hls.liveSyncPosition||a.start:e)}else e<=o&&(a=r[0]);return a||(a=this.getFragmentAtPosition(e,i.lowLatencyMode?t.partEnd:t.fragmentEnd,t)),this.mapToInitFragWhenRequired(a)}isLoopLoading(e,t){const r=this.fragmentTracker.getState(e);return("OK"===r||"PARTIAL"===r&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,r,s,i){const o=e.gap,a=this.getNextFragment(this.nextLoadPosition,t);if(null===a)return a;if(e=a,o&&e&&!e.gap&&r.nextStart){const l=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,r.nextStart,s);if(null!==l&&r.len+l.len>=i)return this.log(`buffer full after gaps in "${s}" playlist starting at sn: ${e.sn}`),null}return e}mapToInitFragWhenRequired(e){return null==e||!e.initSegment||null!=e&&e.initSegment.data||this.bitrateTest?e:e.initSegment}getNextPart(e,t,r){let s=-1,i=!1,o=!0;for(let a=0,l=e.length;a<l;a++){const c=e[a];if(o=o&&!c.independent,s>-1&&r<c.start)break;const u=c.loaded;u?s=-1:(i||c.independent||o)&&c.fragment===t&&(s=a),i=u}return s}loadedEndOfParts(e,t){const r=e[e.length-1];return r&&t>r.start&&r.loaded}getInitialLiveFragment(e,t){const r=this.fragPrevious;let s=null;if(r){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${r.programDateTime}`),s=function(n,e,t){if(null===e||!Array.isArray(n)||!n.length||!O(e))return null;if(e<(n[0].programDateTime||0))return null;if(e>=(n[n.length-1].endProgramDateTime||0))return null;t=t||0;for(let i=0;i<n.length;++i){const o=n[i];if(ON(e,t,o))return o}return null}(t,r.endProgramDateTime,this.config.maxFragLookUpTolerance)),!s){const i=r.sn+1;if(i>=e.startSN&&i<=e.endSN){const o=t[i-e.startSN];r.cc===o.cc&&(s=o,this.log(`Live playlist, switching playlist, load frag with next SN: ${s.sn}`))}s||(s=function(n,e){return jD_search(n,t=>t.cc<e?1:t.cc>e?-1:0)}(t,r.cc),s&&this.log(`Live playlist, switching playlist, load frag with same CC: ${s.sn}`))}}else{const i=this.hls.liveSyncPosition;null!==i&&(s=this.getFragmentAtPosition(i,this.bitrateTest?e.fragmentEnd:e.edge,e))}return s}getFragmentAtPosition(e,t,r){const{config:s}=this;let{fragPrevious:i}=this,{fragments:o,endSN:a}=r;const{fragmentHint:l}=r,c=s.maxFragLookUpTolerance,u=r.partList,d=!!(s.lowLatencyMode&&null!=u&&u.length&&l);let f;if(d&&l&&!this.bitrateTest&&(o=o.concat(l),a=l.sn),f=e<t?po(i,o,e,e>t-c?0:c):o[o.length-1],f){const h=f.sn-r.startSN,p=this.fragmentTracker.getState(f);if(("OK"===p||"PARTIAL"===p&&f.gap)&&(i=f),i&&f.sn===i.sn&&(!d||u[0].fragment.sn>f.sn)&&i&&f.level===i.level){const m=o[h+1];f=f.sn<a&&"OK"!==this.fragmentTracker.getState(m)?m:null}}return f}synchronizeToLiveEdge(e){const{config:t,media:r}=this;if(!r)return;const s=this.hls.liveSyncPosition,i=r.currentTime,a=e.edge,l=i>=e.fragments[0].start-t.maxFragLookUpTolerance&&i<=a;if(null!==s&&r.duration>s&&(i<s||!l)){const c=void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;(!l&&r.readyState<4||i<a-c)&&(this.loadedmetadata||(this.nextLoadPosition=s),r.readyState&&(this.warn(`Playback: ${i.toFixed(3)} is located too far from the end of live sliding playlist: ${a}, reset currentTime to : ${s.toFixed(3)}`),r.currentTime=s))}}alignPlaylists(e,t){const{levels:r,levelLastLoaded:s,fragPrevious:i}=this,o=null!==s?r[s]:null,a=e.fragments.length;if(!a)return this.warn("No fragments in live playlist"),0;const l=e.fragments[0].start,c=!t,u=e.alignedSliding&&O(l);if(c||!u&&!l){!function(n,e,t){!e||(function(n,e,t){if(function(n,e,t){return!(!e.details||!(t.endCC>t.startCC||n&&n.cc<t.startCC))}(n,t,e)){const r=function(n,e,t=0){const r=n.fragments,s=e.fragments;if(!s.length||!r.length)return void v.log("No fragments to align");const i=qD(r,s[0].cc);if(i&&(!i||i.startPTS))return i;v.log("No frag in previous level to align on")}(t.details,e);r&&O(r.start)&&(v.log(`Adjusting PTS using last level due to CC increase within current level ${e.url}`),Sf(r.start,e))}}(n,t,e),!t.alignedSliding&&e.details&&function(n,e){if(!e.fragments.length||!n.hasProgramDateTime||!e.hasProgramDateTime)return;const t=e.fragments[0].programDateTime,r=n.fragments[0].programDateTime,s=(r-t)/1e3+e.fragments[0].start;s&&O(s)&&(v.log(`Adjusting PTS using programDateTime delta ${r-t}ms, sliding:${s.toFixed(3)} ${n.url} `),Sf(s,n))}(t,e.details),!t.alignedSliding&&e.details&&!t.skippedSegments&&BD(e.details,t))}(i,o,e);const d=e.fragments[0].start;return this.log(`Live playlist sliding: ${d.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} prev-sn: ${i?i.sn:"na"} fragments: ${a}`),d}return l}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,3*e.partTarget)}setStartPosition(e,t){let r=this.startPosition;if(r<t&&(r=-1),-1===r||-1===this.lastCurrentTime){const s=null!==this.startTimeOffset,i=s?this.startTimeOffset:e.startTimeOffset;null!==i&&O(i)?(r=t+i,i<0&&(r+=e.totalduration),r=Math.min(Math.max(t,r),t+e.totalduration),this.log(`Start time offset ${i} found in ${s?"multivariant":"media"} playlist, adjust startPosition to ${r}`),this.startPosition=r):e.live?r=this.hls.liveSyncPosition||t:this.startPosition=r=0,this.lastCurrentTime=r}this.nextLoadPosition=r}getLoadPosition(){const{media:e}=this;let t=0;return this.loadedmetadata&&e?t=e.currentTime:this.nextLoadPosition&&(t=this.nextLoadPosition),t}handleFragLoadAborted(e,t){this.transmuxer&&"initSegment"!==e.sn&&e.stats.aborted&&(this.warn(`Fragment ${e.sn}${t?" part "+t.index:""} of level ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&"FRAG_LOADING_WAITING_RETRY"!==this.state)&&(this.state="IDLE")}onFragmentOrKeyLoadError(e,t){if(t.chunkMeta&&!t.frag){const d=this.getCurrentContext(t.chunkMeta);d&&(t.frag=d.frag)}const r=t.frag;if(!r||r.type!==e||!this.levels)return;var s;if(this.fragContextChanged(r))return void this.warn(`Frag load error must match current frag to retry ${r.url} > ${null==(s=this.fragCurrent)?void 0:s.url}`);const i=t.details===C.FRAG_GAP;i&&this.fragmentTracker.fragBuffered(r,!0);const o=t.errorAction,{action:a,retryCount:l=0,retryConfig:c}=o||{};if(o&&5===a&&c){var u;this.resetStartWhenNotLoaded(null!=(u=this.levelLastLoaded)?u:r.level);const d=vf(c,l);this.warn(`Fragment ${r.sn} of ${e} ${r.level} errored with ${t.details}, retrying loading ${l+1}/${c.maxNumRetry} in ${d}ms`),o.resolved=!0,this.retryDate=self.performance.now()+d,this.state="FRAG_LOADING_WAITING_RETRY"}else c&&o?(this.resetFragmentErrors(e),l<c.maxNumRetry?i||(o.resolved=!0):v.warn(`${t.details} reached or exceeded max retry (${l})`)):this.state=2===(null==o?void 0:o.action)?"WAITING_LEVEL":"ERROR";this.tickImmediate()}reduceLengthAndFlushBuffer(e){if("PARSING"===this.state||"PARSED"===this.state){const t=e.parent,r=this.getFwdBufferInfo(this.mediaBuffer,t),s=r&&r.len>.5;s&&this.reduceMaxBufferLength(r.len);const i=!s;return i&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${t} buffer`),e.frag&&(this.fragmentTracker.removeFragment(e.frag),this.nextLoadPosition=e.frag.start),this.resetLoadingState(),i}return!1}resetFragmentErrors(e){"audio"===e&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),"STOPPED"!==this.state&&(this.state="IDLE")}afterBufferFlushed(e,t,r){if(!e)return;const s=Ce.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,s,r),"ENDED"===this.state&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state="IDLE"}resetStartWhenNotLoaded(e){if(!this.loadedmetadata){this.startFragRequested=!1;const t=this.levels?this.levels[e].details:null;null!=t&&t.live?(this.startPosition=-1,this.setStartPosition(t,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){var t;this.warn(`The loading context changed while buffering fragment ${e.sn} of level ${e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(null!=(t=this.levelLastLoaded)?t:e.level),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,r,s){var i;const o=r.details;if(o){if(Object.keys(e.elementaryStreams).reduce((l,c)=>{const u=e.elementaryStreams[c];if(u){const d=u.endPTS-u.startPTS;if(d<=0)return this.warn(`Could not parse fragment ${e.sn} ${c} duration reliably (${d})`),l||!1;const f=s?0:OD(o,e,u.startPTS,u.endPTS,u.startDTS,u.endDTS);return this.hls.trigger(y.LEVEL_PTS_UPDATED,{details:o,level:r,drift:f,type:c,frag:e,start:u.startPTS,end:u.endPTS}),!0}return l},!1))r.fragmentError=0;else if(null===(null==(i=this.transmuxer)?void 0:i.error)){const l=new Error(`Found no media in fragment ${e.sn} of level ${e.level} resetting transmuxer to fallback to playlist timing`);if(0===r.fragmentError&&(r.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)),this.warn(l.message),this.hls.trigger(y.ERROR,{type:H.MEDIA_ERROR,details:C.FRAG_PARSING_ERROR,fatal:!1,error:l,frag:e,reason:`Found no media in msn ${e.sn} of level "${r.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state="PARSED",this.hls.trigger(y.FRAG_PARSED,{frag:e,part:t})}else this.warn("level.details undefined")}resetTransmuxer(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)}recoverWorkerError(e){var t,r,s;"demuxerWorker"===e.event&&(this.fragmentTracker.removeAllFragments(),this.resetTransmuxer(),this.resetStartWhenNotLoaded(null!=(t=null!=(r=this.levelLastLoaded)?r:null==(s=this.fragCurrent)?void 0:s.level)?t:0),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function XD(){return self.SourceBuffer||self.WebKitSourceBuffer}function On(n="",e=9e4){return{type:n,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class JD{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,r,s){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,r){}demux(e,t){this.cachedData&&(e=Gr(this.cachedData,e),this.cachedData=null);let i,r=cl(e,0),s=r?r.length:0;const o=this._audioTrack,a=this._id3Track,l=r?(n=>{const e=uD(n);for(let t=0;t<e.length;t++){const r=e[t];if(cD(r))return Xk(r)}})(r):void 0,c=e.length;for((null===this.basePTS||0===this.frameIndex&&O(l))&&(this.basePTS=uO(l,t,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),r&&r.length>0&&a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:"org.id3",duration:Number.POSITIVE_INFINITY});s<c;){if(this.canParse(e,s)){const u=this.appendFrame(o,e,s);u?(this.frameIndex++,this.lastPTS=u.sample.pts,s+=u.length,i=s):s=c}else Gk(e,s)?(r=cl(e,s),a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:"org.id3",duration:Number.POSITIVE_INFINITY}),s+=r.length,i=s):s++;if(s===c&&i!==c){const u=jr(e,i);this.cachedData=this.cachedData?Gr(this.cachedData,u):u}}return{audioTrack:o,videoTrack:On(),id3Track:a,textTrack:On()}}demuxSampleAes(e,t,r){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:On(),id3Track:this._id3Track,textTrack:On()}}destroy(){}}const uO=(n,e,t)=>O(n)?90*n:9e4*e+(t?9e4*t.baseTime/t.timescale:0);function ZD(n,e){return 255===n[e]&&240==(246&n[e+1])}function ev(n,e){return 1&n[e+1]?7:9}function wf(n,e){return(3&n[e+3])<<11|n[e+4]<<3|(224&n[e+5])>>>5}function Dl(n,e){return e+1<n.length&&ZD(n,e)}function pO(n,e){if(Dl(n,e)){const t=ev(n,e);if(e+t>=n.length)return!1;const r=wf(n,e);if(r<=t)return!1;const s=e+r;return s===n.length||Dl(n,s)}return!1}function tv(n,e,t,r,s){if(!n.samplerate){const i=function(n,e,t,r){let s,i,o,a;const l=navigator.userAgent.toLowerCase(),c=r,u=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];s=1+((192&e[t+2])>>>6);const d=(60&e[t+2])>>>2;if(!(d>u.length-1))return o=(1&e[t+2])<<2,o|=(192&e[t+3])>>>6,v.log(`manifest codec:${r}, ADTS type:${s}, samplingIndex:${d}`),/firefox/i.test(l)?d>=6?(s=5,a=new Array(4),i=d-3):(s=2,a=new Array(2),i=d):-1!==l.indexOf("android")?(s=2,a=new Array(2),i=d):(s=5,a=new Array(4),r&&(-1!==r.indexOf("mp4a.40.29")||-1!==r.indexOf("mp4a.40.5"))||!r&&d>=6?i=d-3:((r&&-1!==r.indexOf("mp4a.40.2")&&(d>=6&&1===o||/vivaldi/i.test(l))||!r&&1===o)&&(s=2,a=new Array(2)),i=d)),a[0]=s<<3,a[0]|=(14&d)>>1,a[1]|=(1&d)<<7,a[1]|=o<<3,5===s&&(a[1]|=(14&i)>>1,a[2]=(1&i)<<7,a[2]|=8,a[3]=0),{config:a,samplerate:u[d],channelCount:o,codec:"mp4a.40."+s,manifestCodec:c};n.trigger(y.ERROR,{type:H.MEDIA_ERROR,details:C.FRAG_PARSING_ERROR,fatal:!0,reason:`invalid ADTS sampling index:${d}`})}(e,t,r,s);if(!i)return;n.config=i.config,n.samplerate=i.samplerate,n.channelCount=i.channelCount,n.codec=i.codec,n.manifestCodec=i.manifestCodec,v.log(`parsed codec:${n.codec}, rate:${i.samplerate}, channels:${i.channelCount}`)}}function nv(n){return 9216e4/n}function rv(n,e,t,r,s){const o=r+s*nv(n.samplerate),a=function(n,e){const t=ev(n,e);if(e+t<=n.length){const r=wf(n,e)-t;if(r>0)return{headerLength:t,frameLength:r}}}(e,t);let l;if(a){const{frameLength:d,headerLength:f}=a,h=f+d,p=Math.max(0,t+h-e.length);p?(l=new Uint8Array(h-f),l.set(e.subarray(t+f,e.length),0)):l=e.subarray(t+f,t+h);const g={unit:l,pts:o};return p||n.samples.push(g),{sample:g,length:h,missing:p}}const c=e.length-t;return l=new Uint8Array(c),l.set(e.subarray(t,e.length),0),{sample:{unit:l,pts:o},length:c,missing:-1}}const yO=/\/emsg[-/]ID3/i;let vl=null;const TO=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],DO=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],vO=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],_O=[0,1,1,4];function sv(n,e,t,r,s){if(t+24>e.length)return;const i=iv(e,t);if(i&&t+i.frameLength<=e.length){const a=r+s*(9e4*i.samplesPerFrame/i.sampleRate),l={unit:e.subarray(t,t+i.frameLength),pts:a,dts:a};return n.config=[],n.channelCount=i.channelCount,n.samplerate=i.sampleRate,n.samples.push(l),{sample:l,length:i.frameLength,missing:0}}}function iv(n,e){const t=n[e+1]>>3&3,r=n[e+1]>>1&3,s=n[e+2]>>4&15,i=n[e+2]>>2&3;if(1!==t&&0!==s&&15!==s&&3!==i){const a=n[e+3]>>6,c=1e3*TO[14*(3===t?3-r:3===r?3:4)+s-1],d=DO[3*(3===t?0:2===t?1:2)+i],f=3===a?1:2,h=vO[t][r],p=_O[r],g=8*h*p,m=Math.floor(h*c/d+(n[e+2]>>1&1))*p;if(null===vl){const D=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);vl=D?parseInt(D[1]):0}return!!vl&&vl<=87&&2===r&&c>=224e3&&0===a&&(n[e+3]=128|n[e+3]),{sampleRate:d,channelCount:f,frameLength:m,samplesPerFrame:g}}}function Rf(n,e){return 255===n[e]&&224==(224&n[e+1])&&0!=(6&n[e+1])}function ov(n,e){return e+1<n.length&&Rf(n,e)}function CO(n,e){if(e+1<n.length&&Rf(n,e)){const t=4,r=iv(n,e);let s=t;null!=r&&r.frameLength&&(s=r.frameLength);const i=e+s;return i===n.length||ov(n,i)}return!1}class av{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,r=e.byteLength-t,s=new Uint8Array(4),i=Math.min(4,t);if(0===i)throw new Error("no bytes available");s.set(e.subarray(r,r+i)),this.word=new DataView(s.buffer).getUint32(0),this.bitsAvailable=8*i,this.bytesAvailable-=i}skipBits(e){let t;e=Math.min(e,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(t=(e-=this.bitsAvailable)>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const r=this.word>>>32-t;if(e>32&&v.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return t=e-t,t>0&&this.bitsAvailable?r<<t|this.readBits(t):r}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(0!=(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return 1===this.readBits(1)}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}skipScalingList(e){let s,t=8,r=8;for(let i=0;i<e;i++)0!==r&&(s=this.readEG(),r=(t+s+256)%256),t=0===r?t:r}readSPS(){let i,o,a,e=0,t=0,r=0,s=0;const l=this.readUByte.bind(this),c=this.readBits.bind(this),u=this.readUEG.bind(this),d=this.readBoolean.bind(this),f=this.skipBits.bind(this),h=this.skipEG.bind(this),p=this.skipUEG.bind(this),g=this.skipScalingList.bind(this);l();const m=l();if(c(5),f(3),l(),p(),100===m||110===m||122===m||244===m||44===m||83===m||86===m||118===m||128===m){const w=u();if(3===w&&f(1),p(),p(),f(1),d())for(o=3!==w?8:12,a=0;a<o;a++)d()&&g(a<6?16:64)}p();const E=u();if(0===E)u();else if(1===E)for(f(1),h(),h(),i=u(),a=0;a<i;a++)h();p(),f(1);const T=u(),D=u(),x=c(1);0===x&&f(1),f(1),d()&&(e=u(),t=u(),r=u(),s=u());let _=[1,1];if(d()&&d())switch(l()){case 1:_=[1,1];break;case 2:_=[12,11];break;case 3:_=[10,11];break;case 4:_=[16,11];break;case 5:_=[40,33];break;case 6:_=[24,11];break;case 7:_=[20,11];break;case 8:_=[32,11];break;case 9:_=[80,33];break;case 10:_=[18,11];break;case 11:_=[15,11];break;case 12:_=[64,33];break;case 13:_=[160,99];break;case 14:_=[4,3];break;case 15:_=[3,2];break;case 16:_=[2,1];break;case 255:_=[l()<<8|l(),l()<<8|l()]}return{width:Math.ceil(16*(T+1)-2*e-2*t),height:(2-x)*(D+1)*16-(x?2:4)*(r+s),pixelRatio:_}}readSliceType(){return this.readUByte(),this.readUEG(),this.readUEG()}}class bO{constructor(e,t,r){this.keyData=void 0,this.decrypter=void 0,this.keyData=r,this.decrypter=new If(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer)}decryptAacSample(e,t,r){const s=e[t].unit;if(s.length<=16)return;const i=s.subarray(16,s.length-s.length%16),o=i.buffer.slice(i.byteOffset,i.byteOffset+i.length);this.decryptBuffer(o).then(a=>{const l=new Uint8Array(a);s.set(l,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,r)})}decryptAacSamples(e,t,r){for(;;t++){if(t>=e.length)return void r();if(!(e[t].unit.length<32||(this.decryptAacSample(e,t,r),this.decrypter.isSync())))return}}getAvcEncryptedData(e){const t=16*Math.floor((e.length-48)/160)+16,r=new Int8Array(t);let s=0;for(let i=32;i<e.length-16;i+=160,s+=16)r.set(e.subarray(i,i+16),s);return r}getAvcDecryptedUnit(e,t){const r=new Uint8Array(t);let s=0;for(let i=32;i<e.length-16;i+=160,s+=16)e.set(r.subarray(s,s+16),i);return e}decryptAvcSample(e,t,r,s,i){const o=ED(i.data),a=this.getAvcEncryptedData(o);this.decryptBuffer(a.buffer).then(l=>{i.data=this.getAvcDecryptedUnit(o,l),this.decrypter.isSync()||this.decryptAvcSamples(e,t,r+1,s)})}decryptAvcSamples(e,t,r,s){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,r=0){if(t>=e.length)return void s();const i=e[t].units;for(;!(r>=i.length);r++){const o=i[r];if(!(o.data.length<=48||1!==o.type&&5!==o.type||(this.decryptAvcSample(e,t,r,s,o),this.decrypter.isSync())))return}}}}const ut=188;class Er{constructor(e,t,r){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=e,this.config=t,this.typeSupported=r}static probe(e){const t=Er.syncOffset(e);return t>0&&v.warn(`MPEG2-TS detected but first sync word found @ offset ${t}`),-1!==t}static syncOffset(e){const t=e.length;let r=Math.min(940,e.length-ut)+1,s=0;for(;s<r;){let i=!1,o=-1,a=0;for(let l=s;l<t;l+=ut){if(71!==e[l]){if(a)return-1;break}if(a++,-1===o&&(o=l,0!==o&&(r=Math.min(o+18612,e.length-ut)+1)),i||(i=0===Lf(e,l)),i&&a>1&&(0===o&&a>2||l+ut>r))return o}s++}return-1}static createTrack(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:dD[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===e?t:void 0}}resetInitSegment(e,t,r,s){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=Er.createTrack("video"),this._audioTrack=Er.createTrack("audio",s),this._id3Track=Er.createTrack("id3"),this._txtTrack=Er.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=r,this._duration=s}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_avcTrack:t,_id3Track:r}=this;e&&(e.pesData=null),t&&(t.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null}demux(e,t,r=!1,s=!1){let i;r||(this.sampleAes=null);const o=this._avcTrack,a=this._audioTrack,l=this._id3Track,c=this._txtTrack;let u=o.pid,d=o.pesData,f=a.pid,h=l.pid,p=a.pesData,g=l.pesData,m=null,E=this.pmtParsed,T=this._pmtId,D=e.length;if(this.remainderData&&(D=(e=Gr(this.remainderData,e)).length,this.remainderData=null),D<ut&&!s)return this.remainderData=e,{audioTrack:a,videoTrack:o,id3Track:l,textTrack:c};const x=Math.max(0,Er.syncOffset(e));D-=(D-x)%ut,D<e.byteLength&&!s&&(this.remainderData=new Uint8Array(e.buffer,D,e.buffer.byteLength-D));let _=0;for(let S=x;S<D;S+=ut)if(71===e[S]){const R=!!(64&e[S+1]),L=Lf(e,S);let N;if((48&e[S+3])>>4>1){if(N=S+5+e[S+4],N===S+ut)continue}else N=S+4;switch(L){case u:R&&(d&&(i=Ys(d))&&this.parseAVCPES(o,c,i,!1),d={data:[],size:0}),d&&(d.data.push(e.subarray(N,S+ut)),d.size+=S+ut-N);break;case f:if(R){if(p&&(i=Ys(p)))switch(a.segmentCodec){case"aac":this.parseAACPES(a,i);break;case"mp3":this.parseMPEGPES(a,i)}p={data:[],size:0}}p&&(p.data.push(e.subarray(N,S+ut)),p.size+=S+ut-N);break;case h:R&&(g&&(i=Ys(g))&&this.parseID3PES(l,i),g={data:[],size:0}),g&&(g.data.push(e.subarray(N,S+ut)),g.size+=S+ut-N);break;case 0:R&&(N+=e[N]+1),T=this._pmtId=SO(e,N);break;case T:{R&&(N+=e[N]+1);const F=IO(e,N,this.typeSupported,r);u=F.avc,u>0&&(o.pid=u),f=F.audio,f>0&&(a.pid=f,a.segmentCodec=F.segmentCodec),h=F.id3,h>0&&(l.pid=h),null!==m&&!E&&(v.warn(`MPEG-TS PMT found at ${S} after unknown PID '${m}'. Backtracking to sync byte @${x} to parse all TS packets.`),m=null,S=x-188),E=this.pmtParsed=!0;break}case 17:case 8191:break;default:m=L}}else _++;if(_>0){const S=new Error(`Found ${_} TS packet/s that do not start with 0x47`);this.observer.emit(y.ERROR,y.ERROR,{type:H.MEDIA_ERROR,details:C.FRAG_PARSING_ERROR,fatal:!1,error:S,reason:S.message})}o.pesData=d,a.pesData=p,l.pesData=g;const w={audioTrack:a,videoTrack:o,id3Track:l,textTrack:c};return s&&this.extractRemainingSamples(w),w}flush(){const{remainderData:e}=this;let t;return this.remainderData=null,t=e?this.demux(e,-1,!1,!0):{videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:r,id3Track:s,textTrack:i}=e,o=r.pesData,a=t.pesData,l=s.pesData;let c;if(o&&(c=Ys(o))?(this.parseAVCPES(r,i,c,!0),r.pesData=null):r.pesData=o,a&&(c=Ys(a))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,c);break;case"mp3":this.parseMPEGPES(t,c)}t.pesData=null}else null!=a&&a.size&&v.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=a;l&&(c=Ys(l))?(this.parseID3PES(s,c),s.pesData=null):s.pesData=l}demuxSampleAes(e,t,r){const s=this.demux(e,r,!0,!this.config.progressive),i=this.sampleAes=new bO(this.observer,this.config,t);return this.decrypt(s,i)}decrypt(e,t){return new Promise(r=>{const{audioTrack:s,videoTrack:i}=e;s.samples&&"aac"===s.segmentCodec?t.decryptAacSamples(s.samples,0,()=>{i.samples?t.decryptAvcSamples(i.samples,0,0,()=>{r(e)}):r(e)}):i.samples&&t.decryptAvcSamples(i.samples,0,0,()=>{r(e)})})}destroy(){this._duration=0}parseAVCPES(e,t,r,s){const i=this.parseAVCNALu(e,r.data);let a,o=this.avcSample,l=!1;r.data=null,o&&i.length&&!e.audFound&&(go(o,e),o=this.avcSample=_l(!1,r.pts,r.dts,"")),i.forEach(c=>{var u;switch(c.type){case 1:{let f=!1;a=!0;const h=c.data;if(l&&h.length>4){const p=new av(h).readSliceType();(2===p||4===p||7===p||9===p)&&(f=!0)}var d;f&&null!=(d=o)&&d.frame&&!o.key&&(go(o,e),o=this.avcSample=null),o||(o=this.avcSample=_l(!0,r.pts,r.dts,"")),o.frame=!0,o.key=f;break}case 5:a=!0,null!=(u=o)&&u.frame&&!o.key&&(go(o,e),o=this.avcSample=null),o||(o=this.avcSample=_l(!0,r.pts,r.dts,"")),o.key=!0,o.frame=!0;break;case 6:a=!0,yD(c.data,1,r.pts,t.samples);break;case 7:if(a=!0,l=!0,!e.sps){const f=c.data,p=new av(f).readSPS();e.width=p.width,e.height=p.height,e.pixelRatio=p.pixelRatio,e.sps=[f],e.duration=this._duration;const g=f.subarray(1,4);let m="avc1.";for(let E=0;E<3;E++){let T=g[E].toString(16);T.length<2&&(T="0"+T),m+=T}e.codec=m}break;case 8:a=!0,e.pps||(e.pps=[c.data]);break;case 9:a=!1,e.audFound=!0,o&&go(o,e),o=this.avcSample=_l(!1,r.pts,r.dts,"");break;case 12:a=!0;break;default:a=!1,o&&(o.debug+="unknown NAL "+c.type+" ")}o&&a&&o.units.push(c)}),s&&o&&(go(o,e),this.avcSample=null)}getLastNalUnit(e){var t;let s,r=this.avcSample;if((!r||0===r.units.length)&&(r=e[e.length-1]),null!=(t=r)&&t.units){const i=r.units;s=i[i.length-1]}return s}parseAVCNALu(e,t){const r=t.byteLength;let s=e.naluState||0;const i=s,o=[];let l,c,u,a=0,d=-1,f=0;for(-1===s&&(d=0,f=31&t[0],s=0,a=1);a<r;)if(l=t[a++],s)if(1!==s)if(l)if(1===l){if(d>=0){const h={data:t.subarray(d,a-s-1),type:f};o.push(h)}else{const h=this.getLastNalUnit(e.samples);if(h&&(i&&a<=4-i&&h.state&&(h.data=h.data.subarray(0,h.data.byteLength-i)),c=a-s-1,c>0)){const p=new Uint8Array(h.data.byteLength+c);p.set(h.data,0),p.set(t.subarray(0,c),h.data.byteLength),h.data=p,h.state=0}}a<r?(u=31&t[a],d=a,f=u,s=0):s=-1}else s=0;else s=3;else s=l?0:2;else s=l?0:1;if(d>=0&&s>=0){const h={data:t.subarray(d,r),type:f,state:s};o.push(h)}if(0===o.length){const h=this.getLastNalUnit(e.samples);if(h){const p=new Uint8Array(h.data.byteLength+t.byteLength);p.set(h.data,0),p.set(t,h.data.byteLength),h.data=p}}return e.naluState=s,o}parseAACPES(e,t){let r=0;const s=this.aacOverFlow;let o,a,l,i=t.data;if(s){this.aacOverFlow=null;const d=s.missing,f=s.sample.unit.byteLength;if(-1===d){const h=new Uint8Array(f+i.byteLength);h.set(s.sample.unit,0),h.set(i,f),i=h}else{const h=f-d;s.sample.unit.set(i.subarray(0,d),h),e.samples.push(s.sample),r=s.missing}}for(o=r,a=i.length;o<a-1&&!Dl(i,o);o++);if(o!==r){let d;const f=o<a-1;d=f?`AAC PES did not start with ADTS header,offset:${o}`:"No ADTS header found in AAC PES";const h=new Error(d);if(v.warn(`parsing error: ${d}`),this.observer.emit(y.ERROR,y.ERROR,{type:H.MEDIA_ERROR,details:C.FRAG_PARSING_ERROR,fatal:!1,levelRetry:f,error:h,reason:d}),!f)return}if(tv(e,this.observer,i,o,this.audioCodec),void 0!==t.pts)l=t.pts;else{if(!s)return void v.warn("[tsdemuxer]: AAC PES unknown PTS");{const d=nv(e.samplerate);l=s.sample.pts+d}}let u,c=0;for(;o<a;){if(u=rv(e,i,o,l,c),o+=u.length,u.missing){this.aacOverFlow=u;break}for(c++;o<a-1&&!Dl(i,o);o++);}}parseMPEGPES(e,t){const r=t.data,s=r.length;let i=0,o=0;const a=t.pts;if(void 0!==a)for(;o<s;)if(ov(r,o)){const l=sv(e,r,o,a,i);if(!l)break;o+=l.length,i++}else o++;else v.warn("[tsdemuxer]: MPEG PES unknown PTS")}parseID3PES(e,t){if(void 0===t.pts)return void v.warn("[tsdemuxer]: ID3 PES unknown PTS");const r=Ye({},t,{type:this._avcTrack?Tn_emsg:"org.id3",duration:Number.POSITIVE_INFINITY});e.samples.push(r)}}function _l(n,e,t,r){return{key:n,frame:!1,pts:e,dts:t,units:[],debug:r,length:0}}function Lf(n,e){return((31&n[e+1])<<8)+n[e+2]}function SO(n,e){return(31&n[e+10])<<8|n[e+11]}function IO(n,e,t,r){const s={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},o=e+3+((15&n[e+1])<<8|n[e+2])-4;for(e+=12+((15&n[e+10])<<8|n[e+11]);e<o;){const l=Lf(n,e);switch(n[e]){case 207:if(!r){v.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===s.audio&&(s.audio=l);break;case 21:-1===s.id3&&(s.id3=l);break;case 219:if(!r){v.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===s.avc&&(s.avc=l);break;case 3:case 4:!0!==t.mpeg&&!0!==t.mp3?v.log("MPEG audio found, not supported in this browser"):-1===s.audio&&(s.audio=l,s.segmentCodec="mp3");break;case 36:v.warn("Unsupported HEVC stream type found")}e+=5+((15&n[e+3])<<8|n[e+4])}return s}function Ys(n){let t,r,s,i,o,e=0;const a=n.data;if(!n||0===n.size)return null;for(;a[0].length<19&&a.length>1;){const c=new Uint8Array(a[0].length+a[1].length);c.set(a[0]),c.set(a[1],a[0].length),a[0]=c,a.splice(1,1)}if(t=a[0],(t[0]<<16)+(t[1]<<8)+t[2]===1){if(r=(t[4]<<8)+t[5],r&&r>n.size-6)return null;const c=t[7];192&c&&(i=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2,64&c?(o=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2,i-o>54e5&&(v.warn(`${Math.round((i-o)/9e4)}s delta between PTS and DTS, align them`),i=o)):o=i),s=t[8];let u=s+9;if(n.size<=u)return null;n.size-=u;const d=new Uint8Array(n.size);for(let f=0,h=a.length;f<h;f++){t=a[f];let p=t.byteLength;if(u){if(u>p){u-=p;continue}t=t.subarray(u),p-=u,u=0}d.set(t,e),e+=p}return r&&(r-=s+3),{data:d,pts:i,dts:o,len:r}}return null}function go(n,e){if(n.units.length&&n.frame){if(void 0===n.pts){const t=e.samples,r=t.length;if(!r)return void e.dropped++;{const s=t[r-1];n.pts=s.pts,n.dts=s.dts}}e.samples.push(n)}n.debug.length&&v.log(n.pts+"/"+n.dts+":"+n.debug)}class lv{static getSilentFrame(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}}}const Tr=Math.pow(2,32)-1;let qs=(()=>{class n{static init(){let t;for(t in n.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},n.types)n.types.hasOwnProperty(t)&&(n.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);const r=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),s=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);n.HDLR_TYPES={video:r,audio:s};const i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),o=new Uint8Array([0,0,0,0,0,0,0,0]);n.STTS=n.STSC=n.STCO=o,n.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),n.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),n.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),n.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const a=new Uint8Array([105,115,111,109]),l=new Uint8Array([97,118,99,49]),c=new Uint8Array([0,0,0,1]);n.FTYP=n.box(n.types.ftyp,a,c,a,l),n.DINF=n.box(n.types.dinf,n.box(n.types.dref,i))}static box(t,...r){let s=8,i=r.length;const o=i;for(;i--;)s+=r[i].byteLength;const a=new Uint8Array(s);for(a[0]=s>>24&255,a[1]=s>>16&255,a[2]=s>>8&255,a[3]=255&s,a.set(t,4),i=0,s=8;i<o;i++)a.set(r[i],s),s+=r[i].byteLength;return a}static hdlr(t){return n.box(n.types.hdlr,n.HDLR_TYPES[t])}static mdat(t){return n.box(n.types.mdat,t)}static mdhd(t,r){r*=t;const s=Math.floor(r/(Tr+1)),i=Math.floor(r%(Tr+1));return n.box(n.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,s>>24,s>>16&255,s>>8&255,255&s,i>>24,i>>16&255,i>>8&255,255&i,85,196,0,0]))}static mdia(t){return n.box(n.types.mdia,n.mdhd(t.timescale,t.duration),n.hdlr(t.type),n.minf(t))}static mfhd(t){return n.box(n.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}static minf(t){return n.box(n.types.minf,"audio"===t.type?n.box(n.types.smhd,n.SMHD):n.box(n.types.vmhd,n.VMHD),n.DINF,n.stbl(t))}static moof(t,r,s){return n.box(n.types.moof,n.mfhd(t),n.traf(s,r))}static moov(t){let r=t.length;const s=[];for(;r--;)s[r]=n.trak(t[r]);return n.box.apply(null,[n.types.moov,n.mvhd(t[0].timescale,t[0].duration)].concat(s).concat(n.mvex(t)))}static mvex(t){let r=t.length;const s=[];for(;r--;)s[r]=n.trex(t[r]);return n.box.apply(null,[n.types.mvex,...s])}static mvhd(t,r){r*=t;const s=Math.floor(r/(Tr+1)),i=Math.floor(r%(Tr+1)),o=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,s>>24,s>>16&255,s>>8&255,255&s,i>>24,i>>16&255,i>>8&255,255&i,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return n.box(n.types.mvhd,o)}static sdtp(t){const r=t.samples||[],s=new Uint8Array(4+r.length);let i,o;for(i=0;i<r.length;i++)o=r[i].flags,s[i+4]=o.dependsOn<<4|o.isDependedOn<<2|o.hasRedundancy;return n.box(n.types.sdtp,s)}static stbl(t){return n.box(n.types.stbl,n.stsd(t),n.box(n.types.stts,n.STTS),n.box(n.types.stsc,n.STSC),n.box(n.types.stsz,n.STSZ),n.box(n.types.stco,n.STCO))}static avc1(t){let i,o,a,r=[],s=[];for(i=0;i<t.sps.length;i++)o=t.sps[i],a=o.byteLength,r.push(a>>>8&255),r.push(255&a),r=r.concat(Array.prototype.slice.call(o));for(i=0;i<t.pps.length;i++)o=t.pps[i],a=o.byteLength,s.push(a>>>8&255),s.push(255&a),s=s.concat(Array.prototype.slice.call(o));const l=n.box(n.types.avcC,new Uint8Array([1,r[3],r[4],r[5],255,224|t.sps.length].concat(r).concat([t.pps.length]).concat(s))),c=t.width,u=t.height,d=t.pixelRatio[0],f=t.pixelRatio[1];return n.box(n.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,c>>8&255,255&c,u>>8&255,255&u,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),l,n.box(n.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),n.box(n.types.pasp,new Uint8Array([d>>24,d>>16&255,d>>8&255,255&d,f>>24,f>>16&255,f>>8&255,255&f])))}static esds(t){const r=t.config.length;return new Uint8Array([0,0,0,0,3,23+r,0,1,0,4,15+r,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([r]).concat(t.config).concat([6,1,2]))}static mp4a(t){const r=t.samplerate;return n.box(n.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,r>>8&255,255&r,0,0]),n.box(n.types.esds,n.esds(t)))}static mp3(t){const r=t.samplerate;return n.box(n.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,r>>8&255,255&r,0,0]))}static stsd(t){return n.box(n.types.stsd,n.STSD,"audio"===t.type?"mp3"===t.segmentCodec&&"mp3"===t.codec?n.mp3(t):n.mp4a(t):n.avc1(t))}static tkhd(t){const r=t.id,s=t.duration*t.timescale,i=t.width,o=t.height,a=Math.floor(s/(Tr+1)),l=Math.floor(s%(Tr+1));return n.box(n.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,l>>24,l>>16&255,l>>8&255,255&l,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,255&i,0,0,o>>8&255,255&o,0,0]))}static traf(t,r){const s=n.sdtp(t),i=t.id,o=Math.floor(r/(Tr+1)),a=Math.floor(r%(Tr+1));return n.box(n.types.traf,n.box(n.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i])),n.box(n.types.tfdt,new Uint8Array([1,0,0,0,o>>24,o>>16&255,o>>8&255,255&o,a>>24,a>>16&255,a>>8&255,255&a])),n.trun(t,s.length+16+20+8+16+8+8),s)}static trak(t){return t.duration=t.duration||4294967295,n.box(n.types.trak,n.tkhd(t),n.mdia(t))}static trex(t){const r=t.id;return n.box(n.types.trex,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(t,r){const s=t.samples||[],i=s.length,o=12+16*i,a=new Uint8Array(o);let l,c,u,d,f,h;for(a.set(["video"===t.type?1:0,0,15,1,i>>>24&255,i>>>16&255,i>>>8&255,255&i,(r+=8+o)>>>24&255,r>>>16&255,r>>>8&255,255&r],0),l=0;l<i;l++)c=s[l],u=c.duration,d=c.size,f=c.flags,h=c.cts,a.set([u>>>24&255,u>>>16&255,u>>>8&255,255&u,d>>>24&255,d>>>16&255,d>>>8&255,255&d,f.isLeading<<2|f.dependsOn,f.isDependedOn<<6|f.hasRedundancy<<4|f.paddingValue<<1|f.isNonSync,61440&f.degradPrio,15&f.degradPrio,h>>>24&255,h>>>16&255,h>>>8&255,255&h],12+16*l);return n.box(n.types.trun,a)}static initSegment(t){n.types||n.init();const r=n.moov(t),s=new Uint8Array(n.FTYP.byteLength+r.byteLength);return s.set(n.FTYP),s.set(r,n.FTYP.byteLength),s}}return n.types=void 0,n.HDLR_TYPES=void 0,n.STTS=void 0,n.STSC=void 0,n.STCO=void 0,n.STSZ=void 0,n.VMHD=void 0,n.SMHD=void 0,n.STSD=void 0,n.FTYP=void 0,n.DINF=void 0,n})();function Mf(n,e,t=1,r=!1){const s=n*e*t;return r?Math.round(s):s}function mo(n,e=!1){return Mf(n,1e3,1/9e4,e)}let Zn,xl=null,Pf=null;class Ff{constructor(e,t,r,s=""){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=e,this.config=t,this.typeSupported=r,this.ISGenerated=!1,null===xl){const o=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);xl=o?parseInt(o[1]):0}if(null===Pf){const i=navigator.userAgent.match(/Safari\/(\d+)/i);Pf=i?parseInt(i[1]):0}}destroy(){}resetTimeStamp(e){v.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){v.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){v.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1}getVideoStartPts(e){let t=!1;const r=e.reduce((s,i)=>{const o=i.pts-s;return o<-4294967296?(t=!0,zt(s,i.pts)):o>0?s:i.pts},e[0].pts);return t&&v.debug("PTS rollover detected"),r}remux(e,t,r,s,i,o,a,l){let c,u,d,f,h,p,g=i,m=i;const T=t.pid>-1,D=t.samples.length,x=e.samples.length>0,_=a&&D>0||D>1;if((!(e.pid>-1)||x)&&(!T||_)||this.ISGenerated||a){this.ISGenerated||(d=this.generateIS(e,t,i,o));const S=this.isVideoContiguous;let L,R=-1;if(_&&(R=function(n){for(let e=0;e<n.length;e++)if(n[e].key)return e;return-1}(t.samples),!S&&this.config.forceKeyFrameOnDiscontinuity))if(p=!0,R>0){v.warn(`[mp4-remuxer]: Dropped ${R} out of ${D} video samples due to a missing keyframe`);const b=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(R),t.dropped+=R,m+=(t.samples[0].pts-b)/t.inputTimeScale,L=m}else-1===R&&(v.warn(`[mp4-remuxer]: No keyframe found out of ${D} video samples`),p=!1);if(this.ISGenerated){if(x&&_){const b=this.getVideoStartPts(t.samples),F=(zt(e.samples[0].pts,b)-b)/t.inputTimeScale;g+=Math.max(0,F),m+=Math.max(0,-F)}if(x){if(e.samplerate||(v.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),d=this.generateIS(e,t,i,o)),u=this.remuxAudio(e,g,this.isAudioContiguous,o,T||_||"audio"===l?m:void 0),_){const b=u?u.endPTS-u.startPTS:0;t.inputTimeScale||(v.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),d=this.generateIS(e,t,i,o)),c=this.remuxVideo(t,m,S,b)}}else _&&(c=this.remuxVideo(t,m,S,0));c&&(c.firstKeyFrame=R,c.independent=-1!==R,c.firstKeyFramePTS=L)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(r.samples.length&&(h=dv(r,i,this._initPTS,this._initDTS)),s.samples.length&&(f=fv(s,i,this._initPTS))),{audio:u,video:c,initSegment:d,independent:p,text:f,id3:h}}generateIS(e,t,r,s){const i=e.samples,o=t.samples,a=this.typeSupported,l={},c=this._initPTS;let f,h,p,u=!c||s,d="audio/mp4";if(u&&(f=h=1/0),e.config&&i.length&&("mp3"===(e.timescale=e.samplerate,e.segmentCodec)&&(a.mpeg?(d="audio/mpeg",e.codec=""):a.mp3&&(e.codec="mp3")),l.audio={id:"audio",container:d,codec:e.codec,initSegment:"mp3"===e.segmentCodec&&a.mpeg?new Uint8Array(0):qs.initSegment([e]),metadata:{channelCount:e.channelCount}},u&&(p=e.inputTimeScale,c&&p===c.timescale?u=!1:f=h=i[0].pts-Math.round(p*r))),t.sps&&t.pps&&o.length&&(t.timescale=t.inputTimeScale,l.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:qs.initSegment([t]),metadata:{width:t.width,height:t.height}},u))if(p=t.inputTimeScale,c&&p===c.timescale)u=!1;else{const g=this.getVideoStartPts(o),m=Math.round(p*r);h=Math.min(h,zt(o[0].dts,g)-m),f=Math.min(f,g-m)}if(Object.keys(l).length)return this.ISGenerated=!0,u?(this._initPTS={baseTime:f,timescale:p},this._initDTS={baseTime:h,timescale:p}):f=p=void 0,{tracks:l,initPTS:f,timescale:p}}remuxVideo(e,t,r,s){const i=e.inputTimeScale,o=e.samples,a=[],l=o.length,c=this._initPTS;let h,p,u=this.nextAvcDts,d=8,f=this.videoSampleDuration,g=Number.POSITIVE_INFINITY,m=Number.NEGATIVE_INFINITY,E=!1;r&&null!==u||(u=t*i-(o[0].pts-zt(o[0].dts,o[0].pts)));const T=c.baseTime*i/c.timescale;for(let k=0;k<l;k++){const V=o[k];V.pts=zt(V.pts-T,u),V.dts=zt(V.dts-T,u),V.dts<o[k>0?k-1:k].dts&&(E=!0)}E&&o.sort(function(k,V){return k.dts-V.dts||k.pts-V.pts}),h=o[0].dts,p=o[o.length-1].dts;const D=p-h,x=D?Math.round(D/(l-1)):f||e.inputTimeScale/30;if(r){const k=h-u,V=k>x,De=k<-1;if((V||De)&&(v.warn(V?`AVC: ${mo(k,!0)} ms (${k}dts) hole between fragments detected, filling it`:`AVC: ${mo(-k,!0)} ms (${k}dts) overlapping between fragments detected`),!De||u>=o[0].pts)){h=u;const be=o[0].pts-k;o[0].dts=h,o[0].pts=be,v.log(`Video: First PTS/DTS adjusted: ${mo(be,!0)}/${mo(h,!0)}, delta: ${mo(k,!0)} ms`)}}h=Math.max(0,h);let _=0,w=0;for(let k=0;k<l;k++){const V=o[k],De=V.units,be=De.length;let he=0;for(let ze=0;ze<be;ze++)he+=De[ze].data.length;w+=he,_+=be,V.length=he,V.dts=Math.max(V.dts,h),g=Math.min(V.pts,g),m=Math.max(V.pts,m)}p=o[l-1].dts;const S=w+4*_+8;let R;try{R=new Uint8Array(S)}catch(k){return void this.observer.emit(y.ERROR,y.ERROR,{type:H.MUX_ERROR,details:C.REMUX_ALLOC_ERROR,fatal:!1,error:k,bytes:S,reason:`fail allocating video mdat ${S}`})}const L=new DataView(R.buffer);L.setUint32(0,S),R.set(qs.types.mdat,4);let b=!1,N=Number.POSITIVE_INFINITY,F=Number.POSITIVE_INFINITY,ue=Number.NEGATIVE_INFINITY,qe=Number.NEGATIVE_INFINITY;for(let k=0;k<l;k++){const V=o[k],De=V.units;let he,be=0;for(let Xt=0,vn=De.length;Xt<vn;Xt++){const Jt=De[Xt],Wr=Jt.data,eh=Jt.data.byteLength;L.setUint32(d,eh),d+=4,R.set(Wr,d),d+=eh,be+=4+eh}if(k<l-1)f=o[k+1].dts-V.dts,he=o[k+1].pts-V.pts;else{const Xt=this.config,vn=k>0?V.dts-o[k-1].dts:x;if(he=k>0?V.pts-o[k-1].pts:x,Xt.stretchShortVideoTrack&&null!==this.nextAudioPts){const Jt=Math.floor(Xt.maxBufferHole*i),Wr=(s?g+s*i:this.nextAudioPts)-V.pts;Wr>Jt?(f=Wr-vn,f<0?f=vn:b=!0,v.log(`[mp4-remuxer]: It is approximately ${Wr/90} ms to the next segment; using duration ${f/90} ms for the last video frame.`)):f=vn}else f=vn}const ze=Math.round(V.pts-V.dts);N=Math.min(N,f),ue=Math.max(ue,f),F=Math.min(F,he),qe=Math.max(qe,he),a.push(new hv(V.key,f,be,ze))}if(a.length)if(xl){if(xl<70){const k=a[0].flags;k.dependsOn=2,k.isNonSync=0}}else if(Pf&&qe-F<ue-N&&x/ue<.025&&0===a[0].cts){v.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let k=h;for(let V=0,De=a.length;V<De;V++){const be=k+a[V].duration,he=k+a[V].cts;a[V].duration=V<De-1?be+a[V+1].cts-he:V?a[V-1].duration:x,a[V].cts=0,k=be}}f=b||!f?x:f,this.nextAvcDts=u=p+f,this.videoSampleDuration=f,this.isVideoContiguous=!0;const Ie={data1:qs.moof(e.sequenceNumber++,h,Ye({},e,{samples:a})),data2:R,startPTS:g/i,endPTS:(m+f)/i,startDTS:h/i,endDTS:u/i,type:"video",hasAudio:!1,hasVideo:!0,nb:a.length,dropped:e.dropped};return e.samples=[],e.dropped=0,Ie}remuxAudio(e,t,r,s,i){const o=e.inputTimeScale,l=o/(e.samplerate?e.samplerate:o),c="aac"===e.segmentCodec?1024:1152,u=c*l,d=this._initPTS,f="mp3"===e.segmentCodec&&this.typeSupported.mpeg,h=[],p=void 0!==i;let g=e.samples,m=f?0:8,E=this.nextAudioPts||-1;const T=t*o,D=d.baseTime*o/d.timescale;if(this.isAudioContiguous=r=r||g.length&&E>0&&(s&&Math.abs(T-E)<9e3||Math.abs(zt(g[0].pts-D,T)-E)<20*u),g.forEach(function(Te){Te.pts=zt(Te.pts-D,T)}),!r||E<0){if(g=g.filter(Te=>Te.pts>=0),!g.length)return;E=0===i?0:s&&!p?Math.max(0,T):g[0].pts}if("aac"===e.segmentCodec){const Te=this.config.maxAudioFramesDrift;for(let Ie=0,k=E;Ie<g.length;Ie++){const V=g[Ie],De=V.pts,be=De-k,he=Math.abs(1e3*be/o);if(be<=-Te*u&&p)0===Ie&&(v.warn(`Audio frame @ ${(De/o).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*be/o)} ms.`),this.nextAudioPts=E=k=De);else if(be>=Te*u&&he<1e4&&p){let ze=Math.round(be/u);k=De-ze*u,k<0&&(ze--,k+=u),0===Ie&&(this.nextAudioPts=E=k),v.warn(`[mp4-remuxer]: Injecting ${ze} audio frame @ ${(k/o).toFixed(3)}s due to ${Math.round(1e3*be/o)} ms gap.`);for(let Xt=0;Xt<ze;Xt++){const vn=Math.max(k,0);let Jt=lv.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);Jt||(v.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),Jt=V.unit.subarray()),g.splice(Ie,0,{unit:Jt,pts:vn}),k+=u,Ie++}}V.pts=k,k+=u}}let w,x=null,_=null,S=0,R=g.length;for(;R--;)S+=g[R].unit.byteLength;for(let Te=0,Ie=g.length;Te<Ie;Te++){const k=g[Te],V=k.unit;let De=k.pts;if(null!==_)h[Te-1].duration=Math.round((De-_)/l);else{if(r&&"aac"===e.segmentCodec&&(De=E),x=De,!(S>0))return;S+=m;try{w=new Uint8Array(S)}catch(he){return void this.observer.emit(y.ERROR,y.ERROR,{type:H.MUX_ERROR,details:C.REMUX_ALLOC_ERROR,fatal:!1,error:he,bytes:S,reason:`fail allocating audio mdat ${S}`})}f||(new DataView(w.buffer).setUint32(0,S),w.set(qs.types.mdat,4))}w.set(V,m);const be=V.byteLength;m+=be,h.push(new hv(!0,c,be,0)),_=De}const L=h.length;if(!L)return;this.nextAudioPts=E=_+l*h[h.length-1].duration;const N=f?new Uint8Array(0):qs.moof(e.sequenceNumber++,x/l,Ye({},e,{samples:h}));e.samples=[];const F=x/o,ue=E/o,me={data1:N,data2:w,startPTS:F,endPTS:ue,startDTS:F,endDTS:ue,type:"audio",hasAudio:!0,hasVideo:!1,nb:L};return this.isAudioContiguous=!0,me}remuxEmptyAudio(e,t,r,s){const i=e.inputTimeScale,l=this.nextAudioPts,c=this._initDTS,u=9e4*c.baseTime/c.timescale,d=(null!==l?l:s.startDTS*i)+u,h=i/(e.samplerate?e.samplerate:i)*1024,p=Math.ceil((s.endDTS*i+u-d)/h),g=lv.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(v.warn("[mp4-remuxer]: remux empty Audio"),!g)return void v.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");const m=[];for(let E=0;E<p;E++){const T=d+E*h;m.push({unit:g,pts:T,dts:T})}return e.samples=m,this.remuxAudio(e,t,r,!1)}}function zt(n,e){let t;if(null===e)return n;for(t=e<n?-8589934592:8589934592;Math.abs(n-e)>4294967296;)n+=t;return n}function dv(n,e,t,r){const s=n.samples.length;if(!s)return;const i=n.inputTimeScale;for(let a=0;a<s;a++){const l=n.samples[a];l.pts=zt(l.pts-t.baseTime*i/t.timescale,e*i)/i,l.dts=zt(l.dts-r.baseTime*i/r.timescale,e*i)/i}const o=n.samples;return n.samples=[],{samples:o}}function fv(n,e,t){const r=n.samples.length;if(!r)return;const s=n.inputTimeScale;for(let o=0;o<r;o++){const a=n.samples[o];a.pts=zt(a.pts-t.baseTime*s/t.timescale,e*s)/s}n.samples.sort((o,a)=>o.pts-a.pts);const i=n.samples;return n.samples=[],{samples:i}}class hv{constructor(e,t,r,s){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=t,this.size=r,this.cts=s,this.flags=new FO(e)}}class FO{constructor(e){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=e?2:1,this.isNonSync=e?0:1}}function pv(n,e){const t=null==n?void 0:n.codec;return t&&t.length>4?t:"hvc1"===t||"hev1"===t?"hvc1.1.6.L120.90":"av01"===t?"av01.0.04M.08":"avc1"===t||"video"===e?"avc1.42e01e":"mp4a.40.5"}try{Zn=self.performance.now.bind(self.performance)}catch(n){v.debug("Unable to use Performance API on this environment"),Zn="undefined"!=typeof self&&self.Date.now}const kf=[{demux:class{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,r,s){const i=this.videoTrack=On("video",1),o=this.audioTrack=On("audio",1),a=this.txtTrack=On("text",1);if(this.id3Track=On("id3",1),this.timeOffset=0,null==e||!e.byteLength)return;const l=pD(e);if(l.video){const{id:c,timescale:u,codec:d}=l.video;i.id=c,i.timescale=a.timescale=u,i.codec=d}if(l.audio){const{id:c,timescale:u,codec:d}=l.audio;o.id=c,o.timescale=u,o.codec=d}a.id=dD.text,i.sampleDuration=0,i.duration=o.duration=s}resetContiguity(){this.remainderData=null}static probe(e){return oe(e=e.length>16384?e.subarray(0,16384):e,["moof"]).length>0}demux(e,t){this.timeOffset=t;let r=e;const s=this.videoTrack,i=this.txtTrack;if(this.config.progressive){this.remainderData&&(r=Gr(this.remainderData,e));const a=function(n){const e={valid:null,remainder:null},t=oe(n,["moof"]);if(!t)return e;if(t.length<2)return e.remainder=n,e;const r=t[t.length-1];return e.valid=jr(n,0,r.byteOffset-8),e.remainder=jr(n,r.byteOffset-8),e}(r);this.remainderData=a.remainder,s.samples=a.valid||new Uint8Array}else s.samples=r;const o=this.extractID3Track(s,t);return i.samples=mD(t,s),{videoTrack:s,audioTrack:this.audioTrack,id3Track:o,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,r=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const s=this.extractID3Track(t,this.timeOffset);return r.samples=mD(e,t),{videoTrack:t,audioTrack:On(),id3Track:s,textTrack:On()}}extractID3Track(e,t){const r=this.id3Track;if(e.samples.length){const s=oe(e.samples,["emsg"]);s&&s.forEach(i=>{const o=function(n){const e=n[0];let t="",r="",s=0,i=0,o=0,a=0,l=0,c=0;if(0===e){for(;"\0"!==tt(n.subarray(c,c+1));)t+=tt(n.subarray(c,c+1)),c+=1;for(t+=tt(n.subarray(c,c+1)),c+=1;"\0"!==tt(n.subarray(c,c+1));)r+=tt(n.subarray(c,c+1)),c+=1;r+=tt(n.subarray(c,c+1)),c+=1,s=q(n,12),i=q(n,16),a=q(n,20),l=q(n,24),c=28}else if(1===e){c+=4,s=q(n,c),c+=4;const d=q(n,c);c+=4;const f=q(n,c);for(c+=4,o=2**32*d+f,Ik(o)||(o=Number.MAX_SAFE_INTEGER,v.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),a=q(n,c),c+=4,l=q(n,c),c+=4;"\0"!==tt(n.subarray(c,c+1));)t+=tt(n.subarray(c,c+1)),c+=1;for(t+=tt(n.subarray(c,c+1)),c+=1;"\0"!==tt(n.subarray(c,c+1));)r+=tt(n.subarray(c,c+1)),c+=1;r+=tt(n.subarray(c,c+1)),c+=1}return{schemeIdUri:t,value:r,timeScale:s,presentationTime:o,presentationTimeDelta:i,eventDuration:a,id:l,payload:n.subarray(c,n.byteLength)}}(i);if(yO.test(o.schemeIdUri)){const a=O(o.presentationTime)?o.presentationTime/o.timeScale:t+o.presentationTimeDelta/o.timeScale;let l=4294967295===o.eventDuration?Number.POSITIVE_INFINITY:o.eventDuration/o.timeScale;l<=.001&&(l=Number.POSITIVE_INFINITY);const c=o.payload;r.samples.push({data:c,len:c.byteLength,dts:a,pts:a,type:Tn_emsg,duration:l})}})}return r}demuxSampleAes(e,t,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){}},remux:class{constructor(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}destroy(){}resetTimeStamp(e){this.initPTS=e,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(e,t,r,s){this.audioCodec=t,this.videoCodec=r,this.generateInitSegment(function(n,e){if(!n||!e)return n;const t=e.keyId;return t&&e.isCommonEncryption&&oe(n,["moov","trak"]).forEach(s=>{const o=oe(s,["mdia","minf","stbl","stsd"])[0].subarray(8);let a=oe(o,["enca"]);const l=a.length>0;l||(a=oe(o,["encv"])),a.forEach(c=>{oe(c.subarray(l?28:78),["sinf"]).forEach(f=>{const h=gD(f);if(h){const p=h.subarray(8,24);p.some(g=>0!==g)||(v.log(`[eme] Patching keyId in 'enc${l?"a":"v"}>sinf>>tenc' box: ${Nn_hexDump(p)} -> ${Nn_hexDump(t)}`),h.set(t,8))}})})}),n}(e,s)),this.emitInitSegment=!0}generateInitSegment(e){let{audioCodec:t,videoCodec:r}=this;if(null==e||!e.byteLength)return this.initTracks=void 0,void(this.initData=void 0);const s=this.initData=pD(e);t||(t=pv(s.audio,"audio")),r||(r=pv(s.video,"video"));const i={};s.audio&&s.video?i.audiovideo={container:"video/mp4",codec:t+","+r,initSegment:e,id:"main"}:s.audio?i.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:s.video?i.video={container:"video/mp4",codec:r,initSegment:e,id:"main"}:v.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=i}remux(e,t,r,s,i,o){var a,l;let{initPTS:c,lastEndTime:u}=this;const d={audio:void 0,video:void 0,text:s,id3:r,initSegment:void 0};O(u)||(u=this.lastEndTime=i||0);const f=t.samples;if(null==f||!f.length)return d;const h={initPTS:void 0,timescale:1};let p=this.initData;if(null!=(a=p)&&a.length||(this.generateInitSegment(f),p=this.initData),null==(l=p)||!l.length)return v.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),d;this.emitInitSegment&&(h.tracks=this.initTracks,this.emitInitSegment=!1);const g=function(n,e){let t=0,r=0,s=0;const i=oe(n,["moof","traf"]);for(let o=0;o<i.length;o++){const a=i[o],l=oe(a,["tfhd"])[0],u=e[q(l,4)];if(!u)continue;const d=u.default,f=q(l,0)|(null==d?void 0:d.flags);let h=null==d?void 0:d.duration;8&f&&(h=q(l,2&f?12:8));const p=u.timescale||9e4,g=oe(a,["trun"]);for(let m=0;m<g.length;m++)t=sN(g[m]),!t&&h&&(t=h*q(g[m],4)),"video"===u.type?r+=t/p:"audio"===u.type&&(s+=t/p)}if(0===r&&0===s){let o=0;const a=oe(n,["sidx"]);for(let l=0;l<a.length;l++){const c=eN(a[l]);null!=c&&c.references&&(o+=c.references.reduce((u,d)=>u+d.info.duration||0,0))}return o}return r||s}(f,p),m=function(n,e){return oe(e,["moof","traf"]).reduce((t,r)=>{const s=oe(r,["tfdt"])[0],i=s[0],o=oe(r,["tfhd"]).reduce((a,l)=>{const c=q(l,4),u=n[c];if(u){let d=q(s,4);if(1===i){if(d===dl)return v.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),a;d*=dl+1,d+=q(s,8)}const h=d/(u.timescale||9e4);if(O(h)&&(null===a||h<a))return h}return a},null);return null!==o&&O(o)&&(null===t||o<t)?o:t},null)}(p,f),E=null===m?i:m;(function(n,e,t,r){if(null===n)return!0;const s=Math.max(r,1);return Math.abs(e-n.baseTime/n.timescale-t)>s}(c,E,i,g)||h.timescale!==c.timescale&&o)&&(h.initPTS=E-i,c&&1===c.timescale&&v.warn("Adjusting initPTS by "+(h.initPTS-c.baseTime)),this.initPTS=c={baseTime:h.initPTS,timescale:1});const T=e?E-c.baseTime/c.timescale:u,D=T+g;(function(n,e,t){oe(e,["moof","traf"]).forEach(r=>{oe(r,["tfhd"]).forEach(s=>{const i=q(s,4),o=n[i];if(!o)return;const a=o.timescale||9e4;oe(r,["tfdt"]).forEach(l=>{const c=l[0];let u=q(l,4);if(0===c)u-=t*a,u=Math.max(u,0),df(l,4,u);else{u*=Math.pow(2,32),u+=q(l,8),u-=t*a,u=Math.max(u,0);const d=Math.floor(u/(dl+1)),f=Math.floor(u%(dl+1));df(l,4,d),df(l,8,f)}})})})})(p,f,c.baseTime/c.timescale),g>0?this.lastEndTime=D:(v.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const x=!!p.audio,_=!!p.video;let w="";x&&(w+="audio"),_&&(w+="video");const S={data1:f,startPTS:T,startDTS:T,endPTS:D,endDTS:D,type:w,hasAudio:x,hasVideo:_,nb:1,dropped:0};return d.audio="audio"===S.type?S:void 0,d.video="audio"!==S.type?S:void 0,d.initSegment=h,d.id3=dv(r,i,c,c),s.samples.length&&(d.text=fv(s,i,c)),d}}},{demux:Er,remux:Ff},{demux:class extends JD{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,r,s){super.resetInitSegment(e,t,r,s),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;let r=(cl(e,0)||[]).length;for(let s=e.length;r<s;r++)if(pO(e,r))return v.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return function(n,e){return function(n,e){return e+5<n.length}(n,e)&&ZD(n,e)&&wf(n,e)<=n.length-e}(e,t)}appendFrame(e,t,r){tv(e,this.observer,t,r,e.manifestCodec);const s=rv(e,t,r,this.basePTS,this.frameIndex);if(s&&0===s.missing)return s}},remux:Ff},{demux:class extends JD{resetInitSegment(e,t,r,s){super.resetInitSegment(e,t,r,s),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;let r=(cl(e,0)||[]).length;for(let s=e.length;r<s;r++)if(CO(e,r))return v.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return function(n,e){return Rf(n,e)&&4<=n.length-e}(e,t)}appendFrame(e,t,r){if(null!==this.basePTS)return sv(e,t,r,this.basePTS,this.frameIndex)}},remux:Ff}];class gv{constructor(e,t,r,s,i){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=r,this.vendor=s,this.id=i}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,r,s){const i=r.transmuxing;i.executeStart=Zn();let o=new Uint8Array(e);const{currentTransmuxState:a,transmuxConfig:l}=this;s&&(this.currentTransmuxState=s);const{contiguous:c,discontinuity:u,trackSwitch:d,accurateTimeOffset:f,timeOffset:h,initSegmentChange:p}=s||a,{audioCodec:g,videoCodec:m,defaultInitPts:E,duration:T,initSegmentData:D}=l,x=function(n,e){let t=null;return n.byteLength>0&&null!=e&&null!=e.key&&null!==e.iv&&null!=e.method&&(t=e),t}(o,t);if(x&&"AES-128"===x.method){const R=this.getDecrypter();if(!R.isSync())return this.decryptionPromise=R.webCryptoDecrypt(o,x.key.buffer,x.iv.buffer).then(L=>{const b=this.push(L,null,r);return this.decryptionPromise=null,b}),this.decryptionPromise;{let L=R.softwareDecrypt(o,x.key.buffer,x.iv.buffer);if(r.part>-1&&(L=R.flush()),!L)return i.executeEnd=Zn(),Nf(r);o=new Uint8Array(L)}}const _=this.needsProbing(u,d);if(_){const R=this.configureTransmuxer(o);if(R)return v.warn(`[transmuxer] ${R.message}`),this.observer.emit(y.ERROR,y.ERROR,{type:H.MEDIA_ERROR,details:C.FRAG_PARSING_ERROR,fatal:!1,error:R,reason:R.message}),i.executeEnd=Zn(),Nf(r)}(u||d||p||_)&&this.resetInitSegment(D,g,m,T,t),(u||p||_)&&this.resetInitialTimestamp(E),c||this.resetContiguity();const w=this.transmux(o,x,h,f,r),S=this.currentTransmuxState;return S.contiguous=!0,S.discontinuity=!1,S.trackSwitch=!1,i.executeEnd=Zn(),w}flush(e){const t=e.transmuxing;t.executeStart=Zn();const{decrypter:r,currentTransmuxState:s,decryptionPromise:i}=this;if(i)return i.then(()=>this.flush(e));const o=[],{timeOffset:a}=s;if(r){const d=r.flush();d&&o.push(this.push(d,null,e))}const{demuxer:l,remuxer:c}=this;if(!l||!c)return t.executeEnd=Zn(),[Nf(e)];const u=l.flush(a);return Cl(u)?u.then(d=>(this.flushRemux(o,d,e),o)):(this.flushRemux(o,u,e),o)}flushRemux(e,t,r){const{audioTrack:s,videoTrack:i,id3Track:o,textTrack:a}=t,{accurateTimeOffset:l,timeOffset:c}=this.currentTransmuxState;v.log(`[transmuxer.ts]: Flushed fragment ${r.sn}${r.part>-1?" p: "+r.part:""} of level ${r.level}`);const u=this.remuxer.remux(s,i,o,a,c,l,!0,this.id);e.push({remuxResult:u,chunkMeta:r}),r.transmuxing.executeEnd=Zn()}resetInitialTimestamp(e){const{demuxer:t,remuxer:r}=this;!t||!r||(t.resetTimeStamp(e),r.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,r,s,i){const{demuxer:o,remuxer:a}=this;!o||!a||(o.resetInitSegment(e,t,r,s),a.resetInitSegment(e,t,r,i))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,r,s,i){let o;return o=t&&"SAMPLE-AES"===t.method?this.transmuxSampleAes(e,t,r,s,i):this.transmuxUnencrypted(e,r,s,i),o}transmuxUnencrypted(e,t,r,s){const{audioTrack:i,videoTrack:o,id3Track:a,textTrack:l}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(i,o,a,l,t,r,!1,this.id),chunkMeta:s}}transmuxSampleAes(e,t,r,s,i){return this.demuxer.demuxSampleAes(e,t,r).then(o=>({remuxResult:this.remuxer.remux(o.audioTrack,o.videoTrack,o.id3Track,o.textTrack,r,s,!1,this.id),chunkMeta:i}))}configureTransmuxer(e){const{config:t,observer:r,typeSupported:s,vendor:i}=this;let o;for(let d=0,f=kf.length;d<f;d++)if(kf[d].demux.probe(e)){o=kf[d];break}if(!o)return new Error("Failed to find demuxer by probing fragment data");const a=this.demuxer,l=this.remuxer,c=o.remux,u=o.demux;(!l||!(l instanceof c))&&(this.remuxer=new c(r,t,s,i)),(!a||!(a instanceof u))&&(this.demuxer=new u(r,t,s),this.probe=u.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new If(this.config)),e}}const Nf=n=>({remuxResult:{},chunkMeta:n});function Cl(n){return"then"in n&&n.then instanceof Function}class BO{constructor(e,t,r,s,i){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=r,this.duration=s,this.defaultInitPts=i||null}}class UO{constructor(e,t,r,s,i,o){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=r,this.trackSwitch=s,this.timeOffset=i,this.initSegmentChange=o}}var mv={exports:{}};!function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}function s(l,c,u){this.fn=l,this.context=c,this.once=u||!1}function i(l,c,u,d,f){if("function"!=typeof u)throw new TypeError("The listener must be a function");var h=new s(u,d||l,f),p=t?t+c:c;return l._events[p]?l._events[p].fn?l._events[p]=[l._events[p],h]:l._events[p].push(h):(l._events[p]=h,l._eventsCount++),l}function o(l,c){0==--l._eventsCount?l._events=new r:delete l._events[c]}function a(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(t=!1)),a.prototype.eventNames=function(){var u,d,c=[];if(0===this._eventsCount)return c;for(d in u=this._events)e.call(u,d)&&c.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(u)):c},a.prototype.listeners=function(c){var d=this._events[t?t+c:c];if(!d)return[];if(d.fn)return[d.fn];for(var f=0,h=d.length,p=new Array(h);f<h;f++)p[f]=d[f].fn;return p},a.prototype.listenerCount=function(c){var d=this._events[t?t+c:c];return d?d.fn?1:d.length:0},a.prototype.emit=function(c,u,d,f,h,p){var g=t?t+c:c;if(!this._events[g])return!1;var T,D,m=this._events[g],E=arguments.length;if(m.fn){switch(m.once&&this.removeListener(c,m.fn,void 0,!0),E){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,u),!0;case 3:return m.fn.call(m.context,u,d),!0;case 4:return m.fn.call(m.context,u,d,f),!0;case 5:return m.fn.call(m.context,u,d,f,h),!0;case 6:return m.fn.call(m.context,u,d,f,h,p),!0}for(D=1,T=new Array(E-1);D<E;D++)T[D-1]=arguments[D];m.fn.apply(m.context,T)}else{var _,x=m.length;for(D=0;D<x;D++)switch(m[D].once&&this.removeListener(c,m[D].fn,void 0,!0),E){case 1:m[D].fn.call(m[D].context);break;case 2:m[D].fn.call(m[D].context,u);break;case 3:m[D].fn.call(m[D].context,u,d);break;case 4:m[D].fn.call(m[D].context,u,d,f);break;default:if(!T)for(_=1,T=new Array(E-1);_<E;_++)T[_-1]=arguments[_];m[D].fn.apply(m[D].context,T)}}return!0},a.prototype.on=function(c,u,d){return i(this,c,u,d,!1)},a.prototype.once=function(c,u,d){return i(this,c,u,d,!0)},a.prototype.removeListener=function(c,u,d,f){var h=t?t+c:c;if(!this._events[h])return this;if(!u)return o(this,h),this;var p=this._events[h];if(p.fn)p.fn===u&&(!f||p.once)&&(!d||p.context===d)&&o(this,h);else{for(var g=0,m=[],E=p.length;g<E;g++)(p[g].fn!==u||f&&!p[g].once||d&&p[g].context!==d)&&m.push(p[g]);m.length?this._events[h]=1===m.length?m[0]:m:o(this,h)}return this},a.prototype.removeAllListeners=function(c){var u;return c?this._events[u=t?t+c:c]&&o(this,u):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,n.exports=a}(mv);var Of=xk(mv.exports);const Bf=hl()||{isTypeSupported:()=>!1};class yv{constructor(e,t,r,s){this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;const i=e.config;this.hls=e,this.id=t,this.useWorker=!!i.enableWorker,this.onTransmuxComplete=r,this.onFlush=s;const o=(c,u)=>{(u=u||{}).frag=this.frag,u.id=this.id,c===y.ERROR&&(this.error=u.error),this.hls.trigger(c,u)};this.observer=new Of,this.observer.on(y.FRAG_DECRYPTED,o),this.observer.on(y.ERROR,o);const a={mp4:Bf.isTypeSupported("video/mp4"),mpeg:Bf.isTypeSupported("audio/mpeg"),mp3:Bf.isTypeSupported('audio/mp4; codecs="mp3"')},l=navigator.vendor;if(!this.useWorker||"undefined"==typeof Worker||!i.workerPath&&"function"!=typeof __HLS_WORKER_BUNDLE__)this.transmuxer=new gv(this.observer,a,i,l,t);else try{i.workerPath?(v.log(`loading Web Worker ${i.workerPath} for "${t}"`),this.workerContext=function(n){const e=new self.URL(n,self.location.href).href;return{worker:new self.Worker(e),scriptURL:e}}(i.workerPath)):(v.log(`injecting Web Worker for "${t}"`),this.workerContext=function(){const n=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),e=self.URL.createObjectURL(n);return{worker:new self.Worker(e),objectURL:e}}()),this.onwmsg=d=>this.onWorkerMessage(d);const{worker:u}=this.workerContext;u.addEventListener("message",this.onwmsg),u.onerror=d=>{const f=new Error(`${d.message}  (${d.filename}:${d.lineno})`);i.enableWorker=!1,v.warn(`Error in "${t}" Web Worker, fallback to inline`),this.hls.trigger(y.ERROR,{type:H.OTHER_ERROR,details:C.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:f})},u.postMessage({cmd:"init",typeSupported:a,vendor:l,id:t,config:JSON.stringify(i)})}catch(u){v.warn(`Error setting up "${t}" Web Worker, fallback to inline`,u),this.resetWorker(),this.error=null,this.transmuxer=new gv(this.observer,a,i,l,t)}}resetWorker(){if(this.workerContext){const{worker:e,objectURL:t}=this.workerContext;t&&self.URL.revokeObjectURL(t),e.removeEventListener("message",this.onwmsg),e.onerror=null,e.terminate(),this.workerContext=null}}destroy(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null}push(e,t,r,s,i,o,a,l,c,u){var d,f;c.transmuxing.start=self.performance.now();const{transmuxer:h}=this,p=o?o.start:i.start,g=i.decryptdata,m=this.frag,E=!(m&&i.cc===m.cc),T=!(m&&c.level===m.level),D=m?c.sn-m.sn:-1,x=this.part?c.part-this.part.index:-1,w=!T&&(1===D||0===D&&(1===x||0===D&&c.id>1&&c.id===(null==m?void 0:m.stats.chunkCount)&&x<=0)),S=self.performance.now();(T||D||0===i.stats.parsing.start)&&(i.stats.parsing.start=S),o&&(x||!w)&&(o.stats.parsing.start=S);const R=!(m&&(null==(d=i.initSegment)?void 0:d.url)===(null==(f=m.initSegment)?void 0:f.url)),L=new UO(E,w,l,T,p,R);if(!w||E||R){v.log(`[transmuxer-interface, ${i.type}]: Starting new transmux session for sn: ${c.sn} p: ${c.part} level: ${c.level} id: ${c.id}\n        discontinuity: ${E}\n        trackSwitch: ${T}\n        contiguous: ${w}\n        accurateTimeOffset: ${l}\n        timeOffset: ${p}\n        initSegmentChange: ${R}`);const b=new BO(r,s,t,a,u);this.configureTransmuxer(b)}if(this.frag=i,this.part=o,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:e,decryptdata:g,chunkMeta:c,state:L},e instanceof ArrayBuffer?[e]:[]);else if(h){const b=h.push(e,g,c,L);Cl(b)?(h.async=!0,b.then(N=>{this.handleTransmuxComplete(N)}).catch(N=>{this.transmuxerError(N,c,"transmuxer-interface push error")})):(h.async=!1,this.handleTransmuxComplete(b))}}flush(e){e.transmuxing.start=self.performance.now();const{transmuxer:t}=this;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:e});else if(t){let r=t.flush(e);Cl(r)||t.async?(Cl(r)||(r=Promise.resolve(r)),r.then(i=>{this.handleFlushResult(i,e)}).catch(i=>{this.transmuxerError(i,e,"transmuxer-interface flush error")})):this.handleFlushResult(r,e)}}transmuxerError(e,t,r){!this.hls||(this.error=e,this.hls.trigger(y.ERROR,{type:H.MEDIA_ERROR,details:C.FRAG_PARSING_ERROR,chunkMeta:t,fatal:!1,error:e,err:e,reason:r}))}handleFlushResult(e,t){e.forEach(r=>{this.handleTransmuxComplete(r)}),this.onFlush(t)}onWorkerMessage(e){const t=e.data,r=this.hls;switch(t.event){case"init":{var s;const i=null==(s=this.workerContext)?void 0:s.objectURL;i&&self.URL.revokeObjectURL(i);break}case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;case"workerLog":v[t.data.logType]&&v[t.data.logType](t.data.message);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,r.trigger(t.event,t.data)}}configureTransmuxer(e){const{transmuxer:t}=this;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:e}):t&&t.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}class GO{constructor(e,t,r,s){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=e,this.media=t,this.fragmentTracker=r,this.hls=s}destroy(){this.media=null,this.hls=this.fragmentTracker=null}poll(e,t){const{config:r,media:s,stalled:i}=this;if(null===s)return;const{currentTime:o,seeking:a}=s,l=this.seeking&&!a,c=!this.seeking&&a;if(this.seeking=a,o!==e){if(this.moved=!0,null!==i){if(this.stallReported){const E=self.performance.now()-i;v.warn(`playback not stuck anymore @${o}, after ${Math.round(E)}ms`),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if(c||l)return void(this.stalled=null);if(s.paused&&!a||s.ended||0===s.playbackRate||!Ce.getBuffered(s).length)return;const u=Ce.bufferInfo(s,o,0),f=u.nextStart||0;if(!(u.len>0||f))return;if(a){const E=u.len>2,T=!f||t&&t.start<=o||f-o>2&&!this.fragmentTracker.getPartialFragment(o);if(E||T)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var h;const E=Math.max(f,u.start||0)-o,T=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,x=(null==T||null==(h=T.details)?void 0:h.live)?2*T.details.targetduration:2,_=this.fragmentTracker.getPartialFragment(o);if(E>0&&(E<=x||_))return void this._trySkipBufferHole(_)}const p=self.performance.now();if(null===i)return void(this.stalled=p);const g=p-i;if(!a&&g>=250&&(this._reportStall(u),!this.media))return;const m=Ce.bufferInfo(s,o,r.maxBufferHole);this._tryFixBufferStall(m,g)}_tryFixBufferStall(e,t){const{config:r,fragmentTracker:s,media:i}=this;if(null===i)return;const o=i.currentTime,a=s.getPartialFragment(o);a&&(this._trySkipBufferHole(a)||!this.media)||(e.len>r.maxBufferHole||e.nextStart&&e.nextStart-o<r.maxBufferHole)&&t>1e3*r.highBufferWatchdogPeriod&&(v.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}_reportStall(e){const{hls:t,media:r,stallReported:s}=this;if(!s&&r){this.stallReported=!0;const i=new Error(`Playback stalling at @${r.currentTime} due to low buffer (${JSON.stringify(e)})`);v.warn(i.message),t.trigger(y.ERROR,{type:H.MEDIA_ERROR,details:C.BUFFER_STALLED_ERROR,fatal:!1,error:i,buffer:e.len})}}_trySkipBufferHole(e){const{config:t,hls:r,media:s}=this;if(null===s)return 0;const i=s.currentTime,o=Ce.bufferInfo(s,i,0),a=i<o.start?o.start:o.nextStart;if(a){const l=o.len<=t.maxBufferHole,c=o.len>0&&o.len<1&&s.readyState<3,u=a-i;if(u>0&&(l||c)){if(u>t.maxBufferHole){const{fragmentTracker:f}=this;let h=!1;if(0===i){const p=f.getAppendedFrag(0,"main");p&&a<p.end&&(h=!0)}if(!h){const p=e||f.getAppendedFrag(i,"main");if(p){let g=!1,m=p.end;for(;m<a;){const E=f.getPartialFragment(m);if(!E){g=!0;break}m+=E.duration}if(g)return 0}}}const d=Math.max(a+.05,i+.1);if(v.warn(`skipping hole, adjusting currentTime from ${i} to ${d}`),this.moved=!0,this.stalled=null,s.currentTime=d,e&&!e.gap){const f=new Error(`fragment loaded with buffer holes, seeking from ${i} to ${d}`);r.trigger(y.ERROR,{type:H.MEDIA_ERROR,details:C.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:f,reason:f.message,frag:e})}return d}}return 0}_tryNudgeBuffer(){const{config:e,hls:t,media:r,nudgeRetry:s}=this;if(null===r)return;const i=r.currentTime;if(this.nudgeRetry++,s<e.nudgeMaxRetry){const o=i+(s+1)*e.nudgeOffset,a=new Error(`Nudging 'currentTime' from ${i} to ${o}`);v.warn(a.message),r.currentTime=o,t.trigger(y.ERROR,{type:H.MEDIA_ERROR,details:C.BUFFER_NUDGE_ON_STALL,error:a,fatal:!1})}else{const o=new Error(`Playhead still not moving while enough data buffered @${i} after ${e.nudgeMaxRetry} nudges`);v.error(o.message),t.trigger(y.ERROR,{type:H.MEDIA_ERROR,details:C.BUFFER_STALLED_ERROR,error:o,fatal:!0})}}}class WO extends Af{constructor(e,t,r){super(e,t,r,"[stream-controller]","main"),this.audioCodecSwap=!1,this.gapController=null,this.level=-1,this._forceStartLoad=!1,this.altAudio=!1,this.audioOnly=!1,this.fragPlaying=null,this.onvplaying=null,this.onvseeked=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.MANIFEST_PARSED,this.onManifestParsed,this),e.on(y.LEVEL_LOADING,this.onLevelLoading,this),e.on(y.LEVEL_LOADED,this.onLevelLoaded,this),e.on(y.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(y.ERROR,this.onError,this),e.on(y.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(y.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(y.BUFFER_CREATED,this.onBufferCreated,this),e.on(y.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(y.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(y.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.MANIFEST_PARSED,this.onManifestParsed,this),e.off(y.LEVEL_LOADED,this.onLevelLoaded,this),e.off(y.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(y.ERROR,this.onError,this),e.off(y.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(y.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(y.BUFFER_CREATED,this.onBufferCreated,this),e.off(y.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(y.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(y.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this._unregisterListeners(),this.onMediaDetaching()}startLoad(e){if(this.levels){const{lastCurrentTime:t,hls:r}=this;if(this.stopLoad(),this.setInterval(100),this.level=-1,!this.startFragRequested){let s=r.startLevel;-1===s&&(r.config.testBandwidth&&this.levels.length>1?(s=0,this.bitrateTest=!0):s=r.nextAutoLevel),this.level=r.nextLoadLevel=s,this.loadedmetadata=!1}t>0&&-1===e&&(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t),this.state="IDLE",this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this._forceStartLoad=!0,this.state="STOPPED"}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case"WAITING_LEVEL":{var e;const{levels:r,level:s}=this,i=null==r||null==(e=r[s])?void 0:e.details;if(i&&(!i.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(i))break;this.state="IDLE";break}if(this.hls.nextLoadLevel!==this.level){this.state="IDLE";break}break}case"FRAG_LOADING_WAITING_RETRY":{var t;const r=self.performance.now(),s=this.retryDate;(!s||r>=s||null!=(t=this.media)&&t.seeking)&&(this.resetStartWhenNotLoaded(this.level),this.state="IDLE")}}"IDLE"===this.state&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){super.onTickEnd(),this.checkBuffer(),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:r,media:s}=this,{config:i,nextLoadLevel:o}=e;if(null===t||!s&&(this.startFragRequested||!i.startFragPrefetch)||this.altAudio&&this.audioOnly||null==r||!r[o])return;const a=r[o],l=this.getMainFwdBufferInfo();if(null===l)return;const c=this.getLevelDetails();if(c&&this._streamEnded(l,c)){const m={};return this.altAudio&&(m.type="video"),this.hls.trigger(y.BUFFER_EOS,m),void(this.state="ENDED")}e.loadLevel!==o&&-1===e.manualLevel&&this.log(`Adapting to level ${o} from level ${this.level}`),this.level=e.nextLoadLevel=o;const u=a.details;if(!u||"WAITING_LEVEL"===this.state||u.live&&this.levelLastLoaded!==o)return this.level=o,void(this.state="WAITING_LEVEL");const d=l.len,f=this.getMaxBufferLength(a.maxBitrate);if(d>=f)return;this.backtrackFragment&&this.backtrackFragment.start>l.end&&(this.backtrackFragment=null);const h=this.backtrackFragment?this.backtrackFragment.start:l.end;let p=this.getNextFragment(h,u);if(this.couldBacktrack&&!this.fragPrevious&&p&&"initSegment"!==p.sn&&"OK"!==this.fragmentTracker.getState(p)){var g;const E=(null!=(g=this.backtrackFragment)?g:p).sn-u.startSN,T=u.fragments[E-1];T&&p.cc===T.cc&&(p=T,this.fragmentTracker.removeFragment(T))}else this.backtrackFragment&&l.len&&(this.backtrackFragment=null);if(p&&this.isLoopLoading(p,h)){if(!p.gap){const E=this.audioOnly&&!this.altAudio?"audio":"video",T=("video"===E?this.videoBuffer:this.mediaBuffer)||this.media;T&&this.afterBufferFlushed(T,E,"main")}p=this.getNextFragmentLoopLoading(p,u,l,"main",f)}!p||(p.initSegment&&!p.initSegment.data&&!this.bitrateTest&&(p=p.initSegment),this.loadFragment(p,a,h))}loadFragment(e,t,r){const s=this.fragmentTracker.getState(e);this.fragCurrent=e,"NOT_LOADED"===s||"PARTIAL"===s?"initSegment"===e.sn?this._loadInitSegment(e,t):this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):(this.startFragRequested=!0,super.loadFragment(e,t,r)):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,"main")}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(null!=t&&t.readyState){let r;const s=this.getAppendedFrag(t.currentTime);s&&s.start>1&&this.flushMainBuffer(0,s.start-1);const i=this.getLevelDetails();if(null!=i&&i.live){const a=this.getMainFwdBufferInfo();if(!a||a.len<2*i.targetduration)return}if(!t.paused&&e){const l=e[this.hls.nextLoadLevel],c=this.fragLastKbps;r=c&&this.fragCurrent?this.fragCurrent.duration*l.maxBitrate/(1e3*c)+1:0}else r=0;const o=this.getBufferedFrag(t.currentTime+r);if(o){const a=this.followingBufferedFrag(o);if(a){this.abortCurrentFrag();const c=a.duration,u=Math.max(o.end,(a.maxStartPTS?a.maxStartPTS:a.start)+Math.min(Math.max(c-this.config.maxFragLookUpTolerance,.5*c),.75*c));this.flushMainBuffer(u,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case"KEY_LOADING":case"FRAG_LOADING":case"FRAG_LOADING_WAITING_RETRY":case"PARSING":case"PARSED":this.state="IDLE"}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const r=t.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),r.addEventListener("playing",this.onvplaying),r.addEventListener("seeked",this.onvseeked),this.gapController=new GO(this.config,r,this.fragmentTracker,this.hls)}onMediaDetaching(){const{media:e}=this;e&&this.onvplaying&&this.onvseeked&&(e.removeEventListener("playing",this.onvplaying),e.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),super.onMediaDetaching()}onMediaPlaying(){this.tick()}onMediaSeeked(){const e=this.media,t=e?e.currentTime:null;O(t)&&this.log(`Media seeked to ${t.toFixed(3)}`);const r=this.getMainFwdBufferInfo();null!==r&&0!==r.len?this.tick():this.warn(`Main forward buffer length on "seeked" event ${r?r.len:"empty"})`)}onManifestLoading(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(y.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.levels=this.fragPlaying=this.backtrackFragment=null,this.altAudio=this.audioOnly=!1}onManifestParsed(e,t){let i,r=!1,s=!1;t.levels.forEach(o=>{i=o.audioCodec,i&&(-1!==i.indexOf("mp4a.40.2")&&(r=!0),-1!==i.indexOf("mp4a.40.5")&&(s=!0))}),this.audioCodecSwitch=r&&s&&!function(){var n;const e=XD();return"function"==typeof(null==e||null==(n=e.prototype)?void 0:n.changeType)}(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:r}=this;if(!r||"IDLE"!==this.state)return;const s=r[t.level];(!s.details||s.details.live&&this.levelLastLoaded!==t.level||this.waitForCdnTuneIn(s.details))&&(this.state="WAITING_LEVEL")}onLevelLoaded(e,t){var r;const{levels:s}=this,i=t.level,o=t.details,a=o.totalduration;if(!s)return void this.warn(`Levels were reset while loading level ${i}`);this.log(`Level ${i} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""}, cc [${o.startCC}, ${o.endCC}] duration:${a}`);const l=s[i],c=this.fragCurrent;c&&("FRAG_LOADING"===this.state||"FRAG_LOADING_WAITING_RETRY"===this.state)&&(c.level!==t.level||c.urlId!==l.urlId)&&c.loader&&this.abortCurrentFrag();let u=0;if(o.live||null!=(r=l.details)&&r.live){if(this.checkLiveUpdate(o),o.deltaUpdateFailed)return;u=this.alignPlaylists(o,l.details)}if(l.details=o,this.levelLastLoaded=i,this.hls.trigger(y.LEVEL_UPDATED,{details:o,level:i}),"WAITING_LEVEL"===this.state){if(this.waitForCdnTuneIn(o))return;this.state="IDLE"}this.startFragRequested?o.live&&this.synchronizeToLiveEdge(o):this.setStartPosition(o,u),this.tick()}_handleFragmentLoadProgress(e){var t;const{frag:r,part:s,payload:i}=e,{levels:o}=this;if(!o)return void this.warn(`Levels were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);const a=o[r.level],l=a.details;if(!l)return this.warn(`Dropping fragment ${r.sn} of level ${r.level} after level details were reset`),void this.fragmentTracker.removeFragment(r);const c=a.videoCodec,u=l.PTSKnown||!l.live,d=null==(t=r.initSegment)?void 0:t.data,f=this._getAudioCodec(a),h=this.transmuxer=this.transmuxer||new yv(this.hls,"main",this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),p=s?s.index:-1,m=new bf(r.level,r.sn,r.stats.chunkCount,i.byteLength,p,-1!==p);h.push(i,d,f,c,r,s,l.totalduration,u,m,this.initPTS[r.cc])}onAudioTrackSwitching(e,t){const r=this.altAudio;if(!t.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const o=this.fragCurrent;o&&(this.log("Switching to main audio track, cancel main fragment load"),o.abortRequests(),this.fragmentTracker.removeFragment(o)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();const i=this.hls;r&&(i.trigger(y.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),i.trigger(y.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const s=!!this.hls.audioTracks[t.id].url;if(s){const i=this.videoBuffer;i&&this.mediaBuffer!==i&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=i)}this.altAudio=s,this.tick()}onBufferCreated(e,t){const r=t.tracks;let s,i,o=!1;for(const a in r){const l=r[a];if("main"===l.id){if(i=a,s=l,"video"===a){const c=r[a];c&&(this.videoBuffer=c.buffer)}}else o=!0}o&&s?(this.log(`Alternate track found, use ${i}.buffered to schedule main fragment loading`),this.mediaBuffer=s.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:r,part:s}=t;if(r&&"main"!==r.type)return;if(this.fragContextChanged(r))return this.warn(`Fragment ${r.sn}${s?" p: "+s.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}`),void("PARSED"===this.state&&(this.state="IDLE"));const i=s?s.stats:r.stats;this.fragLastKbps=Math.round(8*i.total/(i.buffering.end-i.loading.first)),"initSegment"!==r.sn&&(this.fragPrevious=r),this.fragBufferedComplete(r,s)}onError(e,t){var r;if(t.fatal)this.state="ERROR";else switch(t.details){case C.FRAG_GAP:case C.FRAG_PARSING_ERROR:case C.FRAG_DECRYPT_ERROR:case C.FRAG_LOAD_ERROR:case C.FRAG_LOAD_TIMEOUT:case C.KEY_LOAD_ERROR:case C.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError("main",t);break;case C.LEVEL_LOAD_ERROR:case C.LEVEL_LOAD_TIMEOUT:case C.LEVEL_PARSING_ERROR:!t.levelRetry&&"WAITING_LEVEL"===this.state&&"level"===(null==(r=t.context)?void 0:r.type)&&(this.state="IDLE");break;case C.BUFFER_FULL_ERROR:if(!t.parent||"main"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case C.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}checkBuffer(){const{media:e,gapController:t}=this;e&&t&&e.readyState&&(!this.loadedmetadata&&Ce.getBuffered(e).length||t.poll(this.lastCurrentTime,"IDLE"!==this.state?this.fragCurrent:null),this.lastCurrentTime=e.currentTime)}onFragLoadEmergencyAborted(){this.state="IDLE",this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()}onBufferFlushed(e,{type:t}){("audio"!==t||this.audioOnly&&!this.altAudio)&&this.afterBufferFlushed(("video"===t?this.videoBuffer:this.mediaBuffer)||this.media,t,"main")}onLevelsUpdated(e,t){this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let r=this.startPosition;if(r>=0&&t<r){if(e.seeking)return void this.log(`could not seek to ${r}, already seeking at ${t}`);const s=Ce.getBuffered(e),o=(s.length?s.start(0):0)-r;o>0&&(o<this.config.maxBufferHole||o<this.config.maxFragLookUpTolerance)&&(this.log(`adjusting start position by ${o} to match buffer start`),r+=o,this.startPosition=r),this.log(`seek to target start position ${r} from current time ${t}`),e.currentTime=r}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(r=>{const{hls:s}=this;if(!r||this.fragContextChanged(e))return;t.fragmentError=0,this.state="IDLE",this.startFragRequested=!1,this.bitrateTest=!1;const i=e.stats;i.parsing.start=i.parsing.end=i.buffering.start=i.buffering.end=self.performance.now(),s.trigger(y.FRAG_LOADED,r),e.bitrateTest=!1})}_handleTransmuxComplete(e){var t;const r="main",{hls:s}=this,{remuxResult:i,chunkMeta:o}=e,a=this.getCurrentContext(o);if(!a)return void this.resetWhenMissingContext(o);const{frag:l,part:c,level:u}=a,{video:d,text:f,id3:h,initSegment:p}=i,{details:g}=u,m=this.altAudio?void 0:i.audio;if(this.fragContextChanged(l))this.fragmentTracker.removeFragment(l);else{if(this.state="PARSING",p){if(null!=p&&p.tracks){const D=l.initSegment||l;this._bufferInitSegment(u,p.tracks,D,o),s.trigger(y.FRAG_PARSING_INIT_SEGMENT,{frag:D,id:r,tracks:p.tracks})}const E=p.initPTS,T=p.timescale;O(E)&&(this.initPTS[l.cc]={baseTime:E,timescale:T},s.trigger(y.INIT_PTS_FOUND,{frag:l,id:r,initPTS:E,timescale:T}))}if(d&&g&&"initSegment"!==l.sn){const E=g.fragments[l.sn-1-g.startSN],T=l.sn===g.startSN,D=!E||l.cc>E.cc;if(!1!==i.independent){const{startPTS:x,endPTS:_,startDTS:w,endDTS:S}=d;if(c)c.elementaryStreams[d.type]={startPTS:x,endPTS:_,startDTS:w,endDTS:S};else if(d.firstKeyFrame&&d.independent&&1===o.id&&!D&&(this.couldBacktrack=!0),d.dropped&&d.independent){const R=this.getMainFwdBufferInfo(),L=(R?R.end:this.getLoadPosition())+this.config.maxBufferHole,b=d.firstKeyFramePTS?d.firstKeyFramePTS:x;if(!T&&L<b-this.config.maxBufferHole&&!D)return void this.backtrack(l);D&&(l.gap=!0),l.setElementaryStreamInfo(d.type,l.start,_,l.start,S,!0)}l.setElementaryStreamInfo(d.type,x,_,w,S),this.backtrackFragment&&(this.backtrackFragment=l),this.bufferFragmentData(d,l,c,o,T||D)}else{if(!T&&!D)return void this.backtrack(l);l.gap=!0}}if(m){const{startPTS:E,endPTS:T,startDTS:D,endDTS:x}=m;c&&(c.elementaryStreams.audio={startPTS:E,endPTS:T,startDTS:D,endDTS:x}),l.setElementaryStreamInfo("audio",E,T,D,x),this.bufferFragmentData(m,l,c,o)}g&&null!=h&&null!=(t=h.samples)&&t.length&&s.trigger(y.FRAG_PARSING_METADATA,{id:r,frag:l,details:g,samples:h.samples}),g&&f&&s.trigger(y.FRAG_PARSING_USERDATA,{id:r,frag:l,details:g,samples:f.samples})}}_bufferInitSegment(e,t,r,s){if("PARSING"!==this.state)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&delete t.audio;const{audio:i,video:o,audiovideo:a}=t;if(i){let l=e.audioCodec;const c=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(l&&(l=-1!==l.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),1!==i.metadata.channelCount&&-1===c.indexOf("firefox")&&(l="mp4a.40.5")),-1!==c.indexOf("android")&&"audio/mpeg"!==i.container&&(l="mp4a.40.2",this.log(`Android: force audio codec to ${l}`)),e.audioCodec&&e.audioCodec!==l&&this.log(`Swapping manifest audio codec "${e.audioCodec}" for "${l}"`),i.levelCodec=l,i.id="main",this.log(`Init audio buffer, container:${i.container}, codecs[selected/level/parsed]=[${l||""}/${e.audioCodec||""}/${i.codec}]`)}o&&(o.levelCodec=e.videoCodec,o.id="main",this.log(`Init video buffer, container:${o.container}, codecs[level/parsed]=[${e.videoCodec||""}/${o.codec}]`)),a&&this.log(`Init audiovideo buffer, container:${a.container}, codecs[level/parsed]=[${e.attrs.CODECS||""}/${a.codec}]`),this.hls.trigger(y.BUFFER_CODECS,t),Object.keys(t).forEach(l=>{const u=t[l].initSegment;null!=u&&u.byteLength&&this.hls.trigger(y.BUFFER_APPENDING,{type:l,data:u,frag:r,part:null,chunkMeta:s,parent:r.type})}),this.tick()}getMainFwdBufferInfo(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,"main")}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state="IDLE"}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&!1===e.seeking){const r=e.currentTime;if(Ce.isBuffered(e,r)?t=this.getAppendedFrag(r):Ce.isBuffered(e,r+.1)&&(t=this.getAppendedFrag(r+.1)),t){this.backtrackFragment=null;const s=this.fragPlaying,i=t.level;(!s||t.sn!==s.sn||s.level!==i||t.urlId!==s.urlId)&&(this.fragPlaying=t,this.hls.trigger(y.FRAG_CHANGED,{frag:t}),(!s||s.level!==i)&&this.hls.trigger(y.LEVEL_SWITCHED,{level:i}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){const e=this.media;return e?this.fragPlaying||this.getAppendedFrag(e.currentTime):null}get currentProgramDateTime(){const e=this.media;if(e){const t=e.currentTime,r=this.currentFrag;if(r&&O(t)&&O(r.programDateTime))return new Date(r.programDateTime+1e3*(t-r.start))}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class zs{constructor(e,t=0,r=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=r}sample(e,t){const r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class YO{constructor(e,t,r,s=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new zs(e),this.fast_=new zs(t),this.defaultTTFB_=s,this.ttfb_=new zs(e)}update(e,t){const{slow_:r,fast_:s,ttfb_:i}=this;r.halfLife!==e&&(this.slow_=new zs(e,r.getEstimate(),r.getTotalWeight())),s.halfLife!==t&&(this.fast_=new zs(t,s.getEstimate(),s.getTotalWeight())),i.halfLife!==e&&(this.ttfb_=new zs(e,i.getEstimate(),i.getTotalWeight()))}sample(e,t){const s=(e=Math.max(e,this.minDelayMs_))/1e3,i=8*t/s;this.fast_.sample(s,i),this.slow_.sample(s,i)}sampleTTFB(e){const t=e/1e3,r=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(r,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}destroy(){}}class Ev{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let r;return e.length?(r=1===e.length?e[0]:function(n,e){const t=new Uint8Array(e);let r=0;for(let s=0;s<n.length;s++){const i=n[s];t.set(i,r),r+=i.length}return t}(e,t),this.reset(),r):new Uint8Array(0)}reset(){this.chunks.length=0,this.dataLength=0}}function Dv(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!JO(n[t].attrs,e[t].attrs))return!1;return!0}function JO(n,e){const t=n["STABLE-RENDITION-ID"];return t?t===e["STABLE-RENDITION-ID"]:!["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED"].some(r=>n[r]!==e[r])}class eB{constructor(e){this.buffered=void 0;const t=(r,s,i)=>{if((s>>>=0)>i-1)throw new DOMException(`Failed to execute '${r}' on 'TimeRanges': The index provided (${s}) is greater than the maximum bound (${i})`);return e[s][r]};this.buffered={get length(){return e.length},end:r=>t("end",r,e.length),start:r=>t("start",r,e.length)}}}function Vf(n){const e=[];for(let t=0;t<n.length;t++){const r=n[t];("subtitles"===r.kind||"captions"===r.kind)&&r.label&&e.push(n[t])}return e}class nB{constructor(e){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=e}append(e,t){const r=this.queues[t];r.push(e),1===r.length&&this.buffers[t]&&this.executeNext(t)}insertAbort(e,t){this.queues[t].unshift(e),this.executeNext(t)}appendBlocker(e){let t;const r=new Promise(i=>{t=i});return this.append({execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}},e),r}executeNext(e){const{buffers:t,queues:r}=this,s=t[e],i=r[e];if(i.length){const o=i[0];try{o.execute()}catch(a){v.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),o.onError(a),null!=s&&s.updating||(i.shift(),this.executeNext(e))}}}shiftAndExecuteNext(e){this.queues[e].shift(),this.executeNext(e)}current(e){return this.queues[e][0]}}const _v=hl(),xv=/([ha]vc.)(?:\.[^.,]+)+/,Cv={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},bv=function(e){let t=e;return Cv.hasOwnProperty(e)&&(t=Cv[e]),String.fromCharCode(t)},er=100,sB={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},iB={17:2,18:4,21:6,22:8,23:10,19:13,20:15},oB={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},aB={25:2,26:4,29:6,30:8,31:10,27:13,28:15},lB=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class cB{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const r="function"==typeof t?t():t;v.log(`${this.time} [${e}] ${r}`)}}}const Kr=function(e){const t=[];for(let r=0;r<e.length;r++)t.push(e[r].toString(16));return t};class Sv{constructor(e,t,r,s,i){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=e||"white",this.underline=t||!1,this.italics=r||!1,this.background=s||"black",this.flash=i||!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let r=0;r<t.length;r++){const s=t[r];e.hasOwnProperty(s)&&(this[s]=e[s])}}isDefault(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class uB{constructor(e,t,r,s,i,o){this.uchar=void 0,this.penState=void 0,this.uchar=e||" ",this.penState=new Sv(t,r,s,i,o)}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return" "===this.uchar&&this.penState.isDefault()}}class dB{constructor(e){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(let t=0;t<er;t++)this.chars.push(new uB);this.logger=e,this.pos=0,this.currPenState=new Sv}equals(e){let t=!0;for(let r=0;r<er;r++)if(!this.chars[r].equals(e.chars[r])){t=!1;break}return t}copy(e){for(let t=0;t<er;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<er;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>er&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=er)}moveCursor(e){const t=this.pos+e;if(e>1)for(let r=this.pos+1;r<t+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=bv(e);this.pos>=er?this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))}clearFromPos(e){let t;for(t=e;t<er;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let r=0;r<er;r++){const s=this.chars[r].uchar;" "!==s&&(t=!1),e.push(s)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class $f{constructor(e){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(let t=0;t<15;t++)this.rows.push(new dB(e));this.logger=e,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}reset(){for(let e=0;e<15;e++)this.rows[e].clear();this.currRow=14}equals(e){let t=!0;for(let r=0;r<15;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t}copy(e){for(let t=0;t<15;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<15;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+JSON.stringify(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let a=0;a<15;a++)this.rows[a].clear();const i=this.currRow+1-this.nrRollUpRows,o=this.lastOutputScreen;if(o){const a=o.rows[i].cueStartTime,l=this.logger.time;if(a&&null!==l&&a<l)for(let c=0;c<this.nrRollUpRows;c++)this.rows[t-this.nrRollUpRows+c+1].copy(o.rows[i+c])}}this.currRow=t;const r=this.rows[this.currRow];if(null!==e.indent){const o=Math.max(e.indent-1,0);r.setCursor(e.indent),e.color=r.chars[o].penState.foreground}this.setPen({foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1})}setBkgData(e){this.logger.log(2,()=>"bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(null===this.nrRollUpRows)return void this.logger.log(3,"roll_up but nrRollUpRows not set yet");this.logger.log(1,()=>this.getDisplayText());const t=this.rows.splice(this.currRow+1-this.nrRollUpRows,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let r="",s=-1;for(let i=0;i<15;i++){const o=this.rows[i].getTextString();o&&(s=i+1,t.push(e?"Row "+s+": '"+o+"'":o.trim()))}return t.length>0&&(r=e?"["+t.join(" | ")+"]":t.join("\n")),r}getTextAndFormat(){return this.rows}}class Iv{constructor(e,t,r){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new $f(r),this.nonDisplayedMemory=new $f(r),this.lastOutputScreen=new $f(r),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=r}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let r=0;r<e.length;r++)this.writeScreen.insertChar(e[r]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),("MODE_PAINT-ON"===this.mode||"MODE_ROLL-UP"===this.mode)&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{const r=Math.floor(e/2)-16;t.foreground=["white","green","blue","cyan","red","yellow","magenta"][r]}this.logger.log(2,"MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class Av{constructor(e,t,r){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;const s=new cB;this.channels=[null,new Iv(e,t,s),new Iv(e+1,r,s)],this.cmdHistory={a:null,b:null},this.logger=s}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){let r,s,i,o=!1;this.logger.time=e;for(let a=0;a<t.length;a+=2)if(s=127&t[a],i=127&t[a+1],0!==s||0!==i){if(this.logger.log(3,"["+Kr([t[a],t[a+1]])+"] -> ("+Kr([s,i])+")"),r=this.parseCmd(s,i),r||(r=this.parseMidrow(s,i)),r||(r=this.parsePAC(s,i)),r||(r=this.parseBackgroundAttributes(s,i)),!r&&(o=this.parseChars(s,i),o)){const l=this.currentChannel;l&&l>0?this.channels[l].insertChars(o):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!r&&!o&&this.logger.log(2,"Couldn't parse cleaned data "+Kr([s,i])+" orig: "+Kr([t[a],t[a+1]]))}}parseCmd(e,t){const{cmdHistory:r}=this;if(!((20===e||28===e||21===e||29===e)&&t>=32&&t<=47||(23===e||31===e)&&t>=33&&t<=35))return!1;if(wv(e,t,r))return Qs(null,null,r),this.logger.log(3,"Repeated command ("+Kr([e,t])+") is dropped"),!0;const o=20===e||21===e||23===e?1:2,a=this.channels[o];return 20===e||21===e||28===e||29===e?32===t?a.ccRCL():33===t?a.ccBS():34===t?a.ccAOF():35===t?a.ccAON():36===t?a.ccDER():37===t?a.ccRU(2):38===t?a.ccRU(3):39===t?a.ccRU(4):40===t?a.ccFON():41===t?a.ccRDC():42===t?a.ccTR():43===t?a.ccRTD():44===t?a.ccEDM():45===t?a.ccCR():46===t?a.ccENM():47===t&&a.ccEOC():a.ccTO(t-32),Qs(e,t,r),this.currentChannel=o,!0}parseMidrow(e,t){let r=0;if((17===e||25===e)&&t>=32&&t<=47){if(r=17===e?1:2,r!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const s=this.channels[r];return!!s&&(s.ccMIDROW(t),this.logger.log(3,"MIDROW ("+Kr([e,t])+")"),!0)}return!1}parsePAC(e,t){let r;const s=this.cmdHistory;if(!((e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127||(16===e||24===e)&&t>=64&&t<=95))return!1;if(wv(e,t,s))return Qs(null,null,s),!0;const a=e<=23?1:2;r=t>=64&&t<=95?1===a?sB[e]:oB[e]:1===a?iB[e]:aB[e];const l=this.channels[a];return!!l&&(l.setPAC(this.interpretPAC(r,t)),Qs(e,t,s),this.currentChannel=a,!0)}interpretPAC(e,t){let r;const s={color:null,italics:!1,indent:null,underline:!1,row:e};return r=t>95?t-96:t-64,s.underline=1==(1&r),r<=13?s.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(s.italics=!0,s.color="white"):s.indent=4*Math.floor((r-16)/2),s}parseChars(e,t){let r,s=null,i=null;if(e>=25?(r=2,i=e-8):(r=1,i=e),i>=17&&i<=19){let o;o=17===i?t+80:18===i?t+112:t+144,this.logger.log(2,"Special char '"+bv(o)+"' in channel "+r),s=[o]}else e>=32&&e<=127&&(s=0===t?[e]:[e,t]);if(s){const o=Kr(s);this.logger.log(3,"Char codes =  "+o.join(",")),Qs(e,t,this.cmdHistory)}return s}parseBackgroundAttributes(e,t){if(!((16===e||24===e)&&t>=32&&t<=47||(23===e||31===e)&&t>=45&&t<=47))return!1;let i;const o={};return 16===e||24===e?(i=Math.floor((t-32)/2),o.background=lB[i],t%2==1&&(o.background=o.background+"_semi")):45===t?o.background="transparent":(o.foreground="black",47===t&&(o.underline=!0)),this.channels[e<=23?1:2].setBkgData(o),Qs(e,t,this.cmdHistory),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}this.cmdHistory={a:null,b:null}}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const r=this.channels[t];r&&r.cueSplitAtTime(e)}}}function Qs(n,e,t){t.a=n,t.b=e}function wv(n,e,t){return t.a===n&&t.b===e}class bl{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,r){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}var Hf=function(){if("undefined"!=typeof self&&self.VTTCue)return self.VTTCue;const n=["","lr","rl"],e=["start","middle","end","left","right"];function t(a,l){if("string"!=typeof l||!Array.isArray(a))return!1;const c=l.toLowerCase();return!!~a.indexOf(c)&&c}function s(a){return t(e,a)}function i(a,...l){let c=1;for(;c<arguments.length;c++){const u=arguments[c];for(const d in u)a[d]=u[d]}return a}function o(a,l,c){const u=this,d={enumerable:!0};u.hasBeenReset=!1;let f="",h=!1,p=a,g=l,m=c,E=null,T="",D=!0,x="auto",_="start",w=50,S="middle",R=50,L="middle";Object.defineProperty(u,"id",i({},d,{get:function(){return f},set:function(b){f=""+b}})),Object.defineProperty(u,"pauseOnExit",i({},d,{get:function(){return h},set:function(b){h=!!b}})),Object.defineProperty(u,"startTime",i({},d,{get:function(){return p},set:function(b){if("number"!=typeof b)throw new TypeError("Start time must be set to a number.");p=b,this.hasBeenReset=!0}})),Object.defineProperty(u,"endTime",i({},d,{get:function(){return g},set:function(b){if("number"!=typeof b)throw new TypeError("End time must be set to a number.");g=b,this.hasBeenReset=!0}})),Object.defineProperty(u,"text",i({},d,{get:function(){return m},set:function(b){m=""+b,this.hasBeenReset=!0}})),Object.defineProperty(u,"region",i({},d,{get:function(){return E},set:function(b){E=b,this.hasBeenReset=!0}})),Object.defineProperty(u,"vertical",i({},d,{get:function(){return T},set:function(b){const N=function(a){return t(n,a)}(b);if(!1===N)throw new SyntaxError("An invalid or illegal string was specified.");T=N,this.hasBeenReset=!0}})),Object.defineProperty(u,"snapToLines",i({},d,{get:function(){return D},set:function(b){D=!!b,this.hasBeenReset=!0}})),Object.defineProperty(u,"line",i({},d,{get:function(){return x},set:function(b){if("number"!=typeof b&&"auto"!==b)throw new SyntaxError("An invalid number or illegal string was specified.");x=b,this.hasBeenReset=!0}})),Object.defineProperty(u,"lineAlign",i({},d,{get:function(){return _},set:function(b){const N=s(b);if(!N)throw new SyntaxError("An invalid or illegal string was specified.");_=N,this.hasBeenReset=!0}})),Object.defineProperty(u,"position",i({},d,{get:function(){return w},set:function(b){if(b<0||b>100)throw new Error("Position must be between 0 and 100.");w=b,this.hasBeenReset=!0}})),Object.defineProperty(u,"positionAlign",i({},d,{get:function(){return S},set:function(b){const N=s(b);if(!N)throw new SyntaxError("An invalid or illegal string was specified.");S=N,this.hasBeenReset=!0}})),Object.defineProperty(u,"size",i({},d,{get:function(){return R},set:function(b){if(b<0||b>100)throw new Error("Size must be between 0 and 100.");R=b,this.hasBeenReset=!0}})),Object.defineProperty(u,"align",i({},d,{get:function(){return L},set:function(b){const N=s(b);if(!N)throw new SyntaxError("An invalid or illegal string was specified.");L=N,this.hasBeenReset=!0}})),u.displayState=void 0}return o.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},o}();class fB{decode(e,t){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function Lv(n){function e(r,s,i,o){return 3600*(0|r)+60*(0|s)+(0|i)+parseFloat(o||0)}const t=n.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class hB{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&""!==t&&(this.values[e]=t)}get(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,r){for(let s=0;s<r.length;++s)if(t===r[s]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const r=parseFloat(t);if(r>=0&&r<=100)return this.set(e,r),!0}return!1}}function Mv(n,e,t,r){const s=r?n.split(r):[n];for(const i in s){if("string"!=typeof s[i])continue;const o=s[i].split(t);2===o.length&&e(o[0],o[1])}}const jf=new Hf(0,0,""),Sl="middle"===jf.align?"middle":"center";function pB(n,e,t){const r=n;function s(){const a=Lv(n);if(null===a)throw new Error("Malformed timestamp: "+r);return n=n.replace(/^[^\sa-zA-Z-]+/,""),a}function o(){n=n.replace(/^\s+/,"")}if(o(),e.startTime=s(),o(),"--\x3e"!==n.slice(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+r);n=n.slice(3),o(),e.endTime=s(),o(),function(a,l){const c=new hB;Mv(a,function(f,h){let p;switch(f){case"region":for(let g=t.length-1;g>=0;g--)if(t[g].id===h){c.set(f,t[g].region);break}break;case"vertical":c.alt(f,h,["rl","lr"]);break;case"line":p=h.split(","),c.integer(f,p[0]),c.percent(f,p[0])&&c.set("snapToLines",!1),c.alt(f,p[0],["auto"]),2===p.length&&c.alt("lineAlign",p[1],["start",Sl,"end"]);break;case"position":p=h.split(","),c.percent(f,p[0]),2===p.length&&c.alt("positionAlign",p[1],["start",Sl,"end","line-left","line-right","auto"]);break;case"size":c.percent(f,h);break;case"align":c.alt(f,h,["start",Sl,"end","left","right"])}},/:/,/\s/),l.region=c.get("region",null),l.vertical=c.get("vertical","");let u=c.get("line","auto");"auto"===u&&-1===jf.line&&(u=-1),l.line=u,l.lineAlign=c.get("lineAlign","start"),l.snapToLines=c.get("snapToLines",!0),l.size=c.get("size",100),l.align=c.get("align",Sl);let d=c.get("position","auto");"auto"===d&&50===jf.position&&(d="start"===l.align||"left"===l.align?0:"end"===l.align||"right"===l.align?100:50),l.position=d}(n,e)}function Pv(n){return n.replace(/<br(?: \/)?>/gi,"\n")}class gB{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new fB,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;function r(){let i=t.buffer,o=0;for(i=Pv(i);o<i.length&&"\r"!==i[o]&&"\n"!==i[o];)++o;const a=i.slice(0,o);return"\r"===i[o]&&++o,"\n"===i[o]&&++o,t.buffer=i.slice(o),a}function s(i){Mv(i,function(o,a){},/:/)}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{let i="";if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;i=r();const a=i.match(/^(\xef\xbb\xbf)?WEBVTT([ \t].*)?$/);if(null==a||!a[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let o=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(o?o=!1:i=r(),t.state){case"HEADER":/:/.test(i)?s(i):i||(t.state="ID");continue;case"NOTE":i||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(i)){t.state="NOTE";break}if(!i)continue;if(t.cue=new Hf(0,0,""),t.state="CUE",-1===i.indexOf("--\x3e")){t.cue.id=i;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{pB(i,t.cue,t.regionList)}catch(a){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const a=-1!==i.indexOf("--\x3e");if(!i||a&&(o=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(null===t.cue)continue;t.cue.text&&(t.cue.text+="\n"),t.cue.text+=i}continue;case"BADCUE":i||(t.state="ID")}}}catch(i){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||"HEADER"===e.state)&&(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state||"BADWEBVTT"===e.state)throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const mB=/\r\n|\n\r|\n|\r/g,Gf=function(e,t,r=0){return e.slice(r,r+t.length)===t},Kf=function(e){let t=5381,r=e.length;for(;r;)t=33*t^e.charCodeAt(--r);return(t>>>0).toString()};function Wf(n,e,t){return Kf(n.toString())+Kf(e.toString())+Kf(t)}const Yf="stpp.ttml.im1t",Fv=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,kv=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,DB={left:"start",center:"center",right:"end",start:"start",end:"end"};function Nv(n,e,t,r){const s=oe(new Uint8Array(n),["mdat"]);if(0===s.length)return void r(new Error("Could not parse IMSC1 mdat"));const i=s.map(a=>kn(a)),o=function(n,e,t=1,r=!1){return Mf(n,1,1/t,r)}(e.baseTime,0,e.timescale);try{i.forEach(a=>t(function(n,e){const s=(new DOMParser).parseFromString(n,"text/xml").getElementsByTagName("tt")[0];if(!s)throw new Error("Invalid ttml");const i={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},o=Object.keys(i).reduce((d,f)=>(d[f]=s.getAttribute(`ttp:${f}`)||i[f],d),{}),a="preserve"!==s.getAttribute("xml:space"),l=Ov(qf(s,"styling","style")),c=Ov(qf(s,"layout","region")),u=qf(s,"body","[begin]");return[].map.call(u,d=>{const f=Bv(d,a);if(!f||!d.hasAttribute("begin"))return null;const h=Qf(d.getAttribute("begin"),o),p=Qf(d.getAttribute("dur"),o);let g=Qf(d.getAttribute("end"),o);if(null===h)throw Uv(d);if(null===g){if(null===p)throw Uv(d);g=h+p}const m=new Hf(h-e,g-e,f);m.id=Wf(m.startTime,m.endTime,m.text);const D=function(n,e,t){const r="http://www.w3.org/ns/ttml#styling";let s=null;const o=null!=n&&n.hasAttribute("style")?n.getAttribute("style"):null;return o&&t.hasOwnProperty(o)&&(s=t[o]),["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce((a,l)=>{const c=zf(e,r,l)||zf(n,r,l)||zf(s,r,l);return c&&(a[l]=c),a},{})}(c[d.getAttribute("region")],l[d.getAttribute("style")],l),{textAlign:x}=D;if(x){const _=DB[x];_&&(m.lineAlign=_),m.align=x}return Ye(m,D),m}).filter(d=>null!==d)}(a,o)))}catch(a){r(a)}}function qf(n,e,t){const r=n.getElementsByTagName(e)[0];return r?[].slice.call(r.querySelectorAll(t)):[]}function Ov(n){return n.reduce((e,t)=>{const r=t.getAttribute("xml:id");return r&&(e[r]=t),e},{})}function Bv(n,e){return[].slice.call(n.childNodes).reduce((t,r,s)=>{var i;return"br"===r.nodeName&&s?t+"\n":null!=(i=r.childNodes)&&i.length?Bv(r,e):e?t+r.textContent.trim().replace(/\s+/g," "):t+r.textContent},"")}function zf(n,e,t){return n&&n.hasAttributeNS(e,t)?n.getAttributeNS(e,t):null}function Uv(n){return new Error(`Could not parse ttml timestamp ${n}`)}function Qf(n,e){if(!n)return null;let t=Lv(n);return null===t&&(Fv.test(n)?t=function(n,e){const t=Fv.exec(n);return 3600*(0|t[1])+60*(0|t[2])+(0|t[3])+((0|t[4])+(0|t[5])/e.subFrameRate)/e.frameRate}(n,e):kv.test(n)&&(t=function(n,e){const t=kv.exec(n),r=Number(t[1]);switch(t[2]){case"h":return 3600*r;case"m":return 60*r;case"ms":return 1e3*r;case"f":return r/e.frameRate;case"t":return r/e.tickRate}return r}(n,e))),t}function SB(n,e){return!!n&&n.label===e.name&&!(n.textTrack1||n.textTrack2)}function IB(n,e,t,r){return Math.min(e,r)-Math.max(n,t)}class Xf{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(y.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(y.MANIFEST_PARSED,this.onManifestParsed,this),e.on(y.BUFFER_CODECS,this.onBufferCodecs,this),e.on(y.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(y.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(y.MANIFEST_PARSED,this.onManifestParsed,this),e.off(y.BUFFER_CODECS,this.onBufferCodecs,this),e.off(y.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const r=this.hls.levels[t.droppedLevel];this.isLevelAllowed(r)&&this.restrictedLevels.push({bitrate:r.bitrate,height:r.height,width:r.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null}onManifestParsed(e,t){const r=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,r.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping()}detectPlayerSize(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){const e=this.hls.levels;if(e.length){const t=this.hls;t.autoLevelCapping=this.getMaxLevel(e.length-1),t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const r=t.filter((s,i)=>this.isLevelAllowed(s)&&i<=e);return this.clientRect=null,Xf.getMaxLevelByMediaSize(r,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const r=e.getBoundingClientRect();t.width=r.width,t.height=r.height,!t.width&&!t.height&&(t.width=r.right-r.left||e.width||0,t.height=r.bottom-r.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch(t){}return e}isLevelAllowed(e){return!this.restrictedLevels.some(r=>e.bitrate===r.bitrate&&e.width===r.width&&e.height===r.height)}static getMaxLevelByMediaSize(e,t,r){if(null==e||!e.length)return-1;const s=(o,a)=>!a||o.width!==a.width||o.height!==a.height;let i=e.length-1;for(let o=0;o<e.length;o+=1){const a=e[o];if((a.width>=t||a.height>=r)&&s(a,e[o+1])){i=o;break}}return i}}const Il="[eme]";let wB=(()=>{class n{constructor(t){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=n.CDMCleanupPromise?[n.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=v.debug.bind(v,Il),this.log=v.log.bind(v,Il),this.warn=v.warn.bind(v,Il),this.error=v.error.bind(v,Il),this.hls=t,this.config=t.config,this.registerListeners()}destroy(){this.unregisterListeners(),this.onMediaDetached();const t=this.config;t.requestMediaKeySystemAccessFunc=null,t.licenseXhrSetup=t.licenseResponseCallback=void 0,t.drmSystems=t.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null}registerListeners(){this.hls.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(y.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(y.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(y.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(y.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(y.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(y.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(t){const{drmSystems:r,widevineLicenseUrl:s}=this.config,i=r[t];if(i)return i.licenseUrl;if(t===Me.WIDEVINE&&s)return s;throw new Error(`no license server URL configured for key-system "${t}"`)}getServerCertificateUrl(t){const{drmSystems:r}=this.config,s=r[t];if(s)return s.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${t}"]`)}attemptKeySystemAccess(t){const r=this.hls.levels,s=(a,l,c)=>!!a&&c.indexOf(a)===l,i=r.map(a=>a.audioCodec).filter(s),o=r.map(a=>a.videoCodec).filter(s);return i.length+o.length===0&&o.push("avc1.42e01e"),new Promise((a,l)=>{const c=u=>{const d=u.shift();this.getMediaKeysPromise(d,i,o).then(f=>a({keySystem:d,mediaKeys:f})).catch(f=>{u.length?c(u):l(f instanceof Qt?f:new Qt({type:H.KEY_SYSTEM_ERROR,details:C.KEY_SYSTEM_NO_ACCESS,error:f,fatal:!0},f.message))})};c(t)})}requestMediaKeySystemAccess(t,r){const{requestMediaKeySystemAccessFunc:s}=this.config;if("function"!=typeof s){let i=`Configured requestMediaKeySystemAccess is not a function ${s}`;return null===aD&&"http:"===self.location.protocol&&(i=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(i))}return s(t,r)}getMediaKeysPromise(t,r,s){const i=function(n,e,t,r){let s;switch(n){case Me.FAIRPLAY:s=["cenc","sinf"];break;case Me.WIDEVINE:case Me.PLAYREADY:s=["cenc"];break;case Me.CLEARKEY:s=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${n}`)}return function(n,e,t,r){return[{initDataTypes:n,persistentState:r.persistentState||"not-allowed",distinctiveIdentifier:r.distinctiveIdentifier||"not-allowed",sessionTypes:r.sessionTypes||[r.sessionType||"temporary"],audioCapabilities:e.map(i=>({contentType:`audio/mp4; codecs="${i}"`,robustness:r.audioRobustness||"",encryptionScheme:r.audioEncryptionScheme||null})),videoCapabilities:t.map(i=>({contentType:`video/mp4; codecs="${i}"`,robustness:r.videoRobustness||"",encryptionScheme:r.videoEncryptionScheme||null}))}]}(s,e,t,r)}(t,r,s,this.config.drmSystemOptions),o=this.keySystemAccessPromises[t];let a=null==o?void 0:o.keySystemAccess;if(!a){this.log(`Requesting encrypted media "${t}" key-system access with config: ${JSON.stringify(i)}`),a=this.requestMediaKeySystemAccess(t,i);const l=this.keySystemAccessPromises[t]={keySystemAccess:a};return a.catch(c=>{this.log(`Failed to obtain access to key-system "${t}": ${c}`)}),a.then(c=>{this.log(`Access for key-system "${c.keySystem}" obtained`);const u=this.fetchServerCertificate(t);return this.log(`Create media-keys for "${t}"`),l.mediaKeys=c.createMediaKeys().then(d=>(this.log(`Media-keys created for "${t}"`),u.then(f=>f?this.setMediaKeysServerCertificate(d,t,f):d))),l.mediaKeys.catch(d=>{this.error(`Failed to create media-keys for "${t}"}: ${d}`)}),l.mediaKeys})}return a.then(()=>o.mediaKeys)}createMediaKeySessionContext({decryptdata:t,keySystem:r,mediaKeys:s}){this.log(`Creating key-system session "${r}" keyId: ${Nn_hexDump(t.keyId||[])}`);const i=s.createSession(),o={decryptdata:t,keySystem:r,mediaKeys:s,mediaKeysSession:i,keyStatus:"status-pending"};return this.mediaKeySessions.push(o),o}renewKeySession(t){const r=t.decryptdata;if(r.pssh){const s=this.createMediaKeySessionContext(t),i=this.getKeyIdString(r);this.keyIdToKeySessionPromise[i]=this.generateRequestWithPreferredKeySession(s,"cenc",r.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(t)}getKeyIdString(t){if(!t)throw new Error("Could not read keyId of undefined decryptdata");if(null===t.keyId)throw new Error("keyId is null");return Nn_hexDump(t.keyId)}updateKeySession(t,r){var s;const i=t.mediaKeysSession;return this.log(`Updating key-session "${i.sessionId}" for keyID ${Nn_hexDump((null==(s=t.decryptdata)?void 0:s.keyId)||[])}\n      } (data length: ${r&&r.byteLength})`),i.update(r)}selectKeySystemFormat(t){const r=Object.keys(t.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${t.sn} ${t.type}: ${t.level}) key formats ${r.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(r)),this.keyFormatPromise}getKeyFormatPromise(t){return new Promise((r,s)=>{const i=lf(this.config),o=t.map(sD).filter(a=>!!a&&-1!==i.indexOf(a));return this.getKeySystemSelectionPromise(o).then(({keySystem:a})=>{const l=oD(a);l?r(l):s(new Error(`Unable to find format for key-system "${a}"`))}).catch(s)})}loadKey(t){const r=t.keyInfo.decryptdata,s=this.getKeyIdString(r),i=`(keyId: ${s} format: "${r.keyFormat}" method: ${r.method} uri: ${r.uri})`;this.log(`Starting session for key ${i}`);let o=this.keyIdToKeySessionPromise[s];return o||(o=this.keyIdToKeySessionPromise[s]=this.getKeySystemForKeyPromise(r).then(({keySystem:a,mediaKeys:l})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${t.frag.sn} ${t.frag.type}: ${t.frag.level} using key ${i}`),this.attemptSetMediaKeys(a,l).then(()=>{this.throwIfDestroyed();const c=this.createMediaKeySessionContext({keySystem:a,mediaKeys:l,decryptdata:r});return this.generateRequestWithPreferredKeySession(c,"cenc",r.pssh,"playlist-key")}))),o.catch(a=>this.handleError(a))),o}throwIfDestroyed(t="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(t){!this.hls||(this.error(t.message),this.hls.trigger(y.ERROR,t instanceof Qt?t.data:{type:H.KEY_SYSTEM_ERROR,details:C.KEY_SYSTEM_NO_KEYS,error:t,fatal:!0}))}getKeySystemForKeyPromise(t){const r=this.getKeyIdString(t),s=this.keyIdToKeySessionPromise[r];if(!s){const i=sD(t.keyFormat),o=i?[i]:lf(this.config);return this.attemptKeySystemAccess(o)}return s}getKeySystemSelectionPromise(t){if(t.length||(t=lf(this.config)),0===t.length)throw new Qt({type:H.KEY_SYSTEM_ERROR,details:C.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${JSON.stringify({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(t)}_onMediaEncrypted(t){const{initDataType:r,initData:s}=t;if(this.debug(`"${t.type}" event: init data type: "${r}"`),null===s)return;let i,o;if("sinf"===r&&this.config.drmSystems[Me.FAIRPLAY]){const d=tt(new Uint8Array(s));try{const f=af(JSON.parse(d).sinf),h=gD(new Uint8Array(f));if(!h)return;i=h.subarray(8,24),o=Me.FAIRPLAY}catch(f){return void this.warn('Failed to parse sinf "encrypted" event message initData')}}else{const d=function(n){if(!(n instanceof ArrayBuffer)||n.byteLength<32)return null;const e={version:0,systemId:"",kids:null,data:null},t=new DataView(n),r=t.getUint32(0);if(n.byteLength!==r&&r>44||1886614376!==t.getUint32(4)||(e.version=t.getUint32(8)>>>24,e.version>1))return null;e.systemId=Nn_hexDump(new Uint8Array(n,12,16));const i=t.getUint32(28);if(0===e.version){if(r-32<i)return null;e.data=new Uint8Array(n,32,i)}else if(1===e.version){e.kids=[];for(let o=0;o<i;o++)e.kids.push(new Uint8Array(n,32+16*o,16))}return e}(s);if(null===d)return;0===d.version&&"edef8ba979d64acea3c827dcd51d21ed"===d.systemId&&d.data&&(i=d.data.subarray(8,24)),o=function(n){if("edef8ba979d64acea3c827dcd51d21ed"===n)return Me.WIDEVINE}(d.systemId)}if(!o||!i)return;const a=Nn_hexDump(i),{keyIdToKeySessionPromise:l,mediaKeySessions:c}=this;let u=l[a];for(let d=0;d<c.length;d++){const f=c[d],h=f.decryptdata;if(h.pssh||!h.keyId)continue;const p=Nn_hexDump(h.keyId);if(a===p||-1!==h.uri.replace(/-/g,"").indexOf(a)){u=l[p],delete l[p],h.pssh=new Uint8Array(s),h.keyId=i,u=l[a]=u.then(()=>this.generateRequestWithPreferredKeySession(f,r,s,"encrypted-event-key-match"));break}}u||(u=l[a]=this.getKeySystemSelectionPromise([o]).then(({keySystem:d,mediaKeys:f})=>{var h;this.throwIfDestroyed();const p=new uo("ISO-23001-7",a,null!=(h=oD(d))?h:"");return p.pssh=new Uint8Array(s),p.keyId=i,this.attemptSetMediaKeys(d,f).then(()=>{this.throwIfDestroyed();const g=this.createMediaKeySessionContext({decryptdata:p,keySystem:d,mediaKeys:f});return this.generateRequestWithPreferredKeySession(g,r,s,"encrypted-event-no-match")})})),u.catch(d=>this.handleError(d))}_onWaitingForKey(t){this.log(`"${t.type}" event`)}attemptSetMediaKeys(t,r){const s=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${t}"`);const i=Promise.all(s).then(()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(r)});return this.setMediaKeysQueue.push(i),i.then(()=>{this.log(`Media-keys set for "${t}"`),s.push(i),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(o=>-1===s.indexOf(o))})}generateRequestWithPreferredKeySession(t,r,s,i){var o,a;const l=null==(o=this.config.drmSystems)||null==(a=o[t.keySystem])?void 0:a.generateRequest;if(l)try{const h=l.call(this.hls,r,s,t);if(!h)throw new Error("Invalid response from configured generateRequest filter");r=h.initDataType,s=t.decryptdata.pssh=h.initData?new Uint8Array(h.initData):null}catch(h){var c;if(this.warn(h.message),null!=(c=this.hls)&&c.config.debug)throw h}if(null===s)return this.log(`Skipping key-session request for "${i}" (no initData)`),Promise.resolve(t);const u=this.getKeyIdString(t.decryptdata);this.log(`Generating key-session request for "${i}": ${u} (init data type: ${r} length: ${s?s.byteLength:null})`);const d=new Of;t.mediaKeysSession.onmessage=h=>{const p=t.mediaKeysSession;if(!p)return void d.emit("error",new Error("invalid state"));const{messageType:g,message:m}=h;this.log(`"${g}" message event for session "${p.sessionId}" message size: ${m.byteLength}`),"license-request"===g||"license-renewal"===g?this.renewLicense(t,m).catch(E=>{this.handleError(E),d.emit("error",E)}):"license-release"===g?t.keySystem===Me.FAIRPLAY&&(this.updateKeySession(t,rD("acknowledged")),this.removeSession(t)):this.warn(`unhandled media key message type "${g}"`)},t.mediaKeysSession.onkeystatuseschange=h=>{if(!t.mediaKeysSession)return void d.emit("error",new Error("invalid state"));this.onKeyStatusChange(t);const g=t.keyStatus;d.emit("keyStatus",g),"expired"===g&&(this.warn(`${t.keySystem} expired for key ${u}`),this.renewKeySession(t))};const f=new Promise((h,p)=>{d.on("error",p),d.on("keyStatus",g=>{g.startsWith("usable")?h():"output-restricted"===g?p(new Qt({type:H.KEY_SYSTEM_ERROR,details:C.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):"internal-error"===g?p(new Qt({type:H.KEY_SYSTEM_ERROR,details:C.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${g}"`)):"expired"===g?p(new Error("key expired while generating request")):this.warn(`unhandled key status change "${g}"`)})});return t.mediaKeysSession.generateRequest(r,s).then(()=>{var h;this.log(`Request generated for key-session "${null==(h=t.mediaKeysSession)?void 0:h.sessionId}" keyId: ${u}`)}).catch(h=>{throw new Qt({type:H.KEY_SYSTEM_ERROR,details:C.KEY_SYSTEM_NO_SESSION,error:h,fatal:!1},`Error generating key-session request: ${h}`)}).then(()=>f).catch(h=>{throw d.removeAllListeners(),this.removeSession(t),h}).then(()=>(d.removeAllListeners(),t))}onKeyStatusChange(t){t.mediaKeysSession.keyStatuses.forEach((r,s)=>{this.log(`key status change "${r}" for keyStatuses keyId: ${Nn_hexDump("buffer"in s?new Uint8Array(s.buffer,s.byteOffset,s.byteLength):new Uint8Array(s))} session keyId: ${Nn_hexDump(new Uint8Array(t.decryptdata.keyId||[]))} uri: ${t.decryptdata.uri}`),t.keyStatus=r})}fetchServerCertificate(t){const r=this.config,i=new(0,r.loader)(r),o=this.getServerCertificateUrl(t);return o?(this.log(`Fetching serverCertificate for "${t}"`),new Promise((a,l)=>{const c={responseType:"arraybuffer",url:o},u=r.certLoadPolicy.default;i.load(c,{loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},{onSuccess:(h,p,g,m)=>{a(h.data)},onError:(h,p,g,m)=>{l(new Qt({type:H.KEY_SYSTEM_ERROR,details:C.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:g,response:Dt({url:c.url,data:void 0},h)},`"${t}" certificate request failed (${o}). Status: ${h.code} (${h.text})`))},onTimeout:(h,p,g)=>{l(new Qt({type:H.KEY_SYSTEM_ERROR,details:C.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:g,response:{url:c.url,data:void 0}},`"${t}" certificate request timed out (${o})`))},onAbort:(h,p,g)=>{l(new Error("aborted"))}})})):Promise.resolve()}setMediaKeysServerCertificate(t,r,s){return new Promise((i,o)=>{t.setServerCertificate(s).then(a=>{this.log(`setServerCertificate ${a?"success":"not supported by CDM"} (${null==s?void 0:s.byteLength}) on "${r}"`),i(t)}).catch(a=>{o(new Qt({type:H.KEY_SYSTEM_ERROR,details:C.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:a,fatal:!0},a.message))})})}renewLicense(t,r){return this.requestLicense(t,new Uint8Array(r)).then(s=>this.updateKeySession(t,new Uint8Array(s)).catch(i=>{throw new Qt({type:H.KEY_SYSTEM_ERROR,details:C.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:i,fatal:!0},i.message)}))}setupLicenseXHR(t,r,s,i){const o=this.config.licenseXhrSetup;return o?Promise.resolve().then(()=>{if(!s.decryptdata)throw new Error("Key removed");return o.call(this.hls,t,r,s,i)}).catch(a=>{if(!s.decryptdata)throw a;return t.open("POST",r,!0),o.call(this.hls,t,r,s,i)}).then(a=>(t.readyState||t.open("POST",r,!0),{xhr:t,licenseChallenge:a||i})):(t.open("POST",r,!0),Promise.resolve({xhr:t,licenseChallenge:i}))}requestLicense(t,r){const s=this.config.keyLoadPolicy.default;return new Promise((i,o)=>{const a=this.getLicenseServerUrl(t.keySystem);this.log(`Sending license request to URL: ${a}`);const l=new XMLHttpRequest;l.responseType="arraybuffer",l.onreadystatechange=()=>{if(!this.hls||!t.mediaKeysSession)return o(new Error("invalid state"));if(4===l.readyState)if(200===l.status){this._requestLicenseFailureCount=0;let c=l.response;this.log(`License received ${c instanceof ArrayBuffer?c.byteLength:c}`);const u=this.config.licenseResponseCallback;if(u)try{c=u.call(this.hls,l,a,t)}catch(d){this.error(d)}i(c)}else{const c=s.errorRetry,u=c?c.maxNumRetry:0;this._requestLicenseFailureCount++,this._requestLicenseFailureCount>u||l.status>=400&&l.status<500?o(new Qt({type:H.KEY_SYSTEM_ERROR,details:C.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:l,response:{url:a,data:void 0,code:l.status,text:l.statusText}},`License Request XHR failed (${a}). Status: ${l.status} (${l.statusText})`)):(this.warn(`Retrying license request, ${u-this._requestLicenseFailureCount+1} attempts left`),this.requestLicense(t,r).then(i,o))}},t.licenseXhr&&t.licenseXhr.readyState!==XMLHttpRequest.DONE&&t.licenseXhr.abort(),t.licenseXhr=l,this.setupLicenseXHR(l,a,t,r).then(({xhr:c,licenseChallenge:u})=>{c.send(u)})})}onMediaAttached(t,r){if(!this.config.emeEnabled)return;const s=r.media;this.media=s,s.addEventListener("encrypted",this.onMediaEncrypted),s.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){const t=this.media,r=this.mediaKeySessions;t&&(t.removeEventListener("encrypted",this.onMediaEncrypted),t.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},uo.clearKeyUriToKeyIdMap();const s=r.length;n.CDMCleanupPromise=Promise.all(r.map(i=>this.removeSession(i)).concat(null==t?void 0:t.setMediaKeys(null).catch(i=>{this.log(`Could not clear media keys: ${i}. media.src: ${null==t?void 0:t.src}`)}))).then(()=>{s&&(this.log("finished closing key sessions and clearing media keys"),r.length=0)}).catch(i=>{this.log(`Could not close sessions and clear media keys: ${i}. media.src: ${null==t?void 0:t.src}`)})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(t,{sessionKeys:r}){if(r&&this.config.emeEnabled&&!this.keyFormatPromise){const s=r.reduce((i,o)=>(-1===i.indexOf(o.keyFormat)&&i.push(o.keyFormat),i),[]);this.log(`Selecting key-system from session-keys ${s.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(s)}}removeSession(t){const{mediaKeysSession:r,licenseXhr:s}=t;if(r){this.log(`Remove licenses and keys and close session ${r.sessionId}`),r.onmessage=null,r.onkeystatuseschange=null,s&&s.readyState!==XMLHttpRequest.DONE&&s.abort(),t.mediaKeysSession=t.decryptdata=t.licenseXhr=void 0;const i=this.mediaKeySessions.indexOf(t);return i>-1&&this.mediaKeySessions.splice(i,1),r.remove().catch(o=>{this.log(`Could not remove session: ${o}`)}).then(()=>r.close()).catch(o=>{this.log(`Could not close session: ${o}`)})}}}return n.CDMCleanupPromise=void 0,n})();class Qt extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}class Dr{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=s=>{try{this.apply(s,{ot:"m",su:!this.initialized})}catch(i){v.warn("Could not generate manifest CMCD data.",i)}},this.applyFragmentData=s=>{try{const i=s.frag,o=this.hls.levels[i.level],a=this.getObjectType(i),l={d:1e3*i.duration,ot:a};("v"===a||"a"===a||"av"==a)&&(l.br=o.bitrate/1e3,l.tb=this.getTopBandwidth(a)/1e3,l.bl=this.getBufferLength(a)),this.apply(s,l)}catch(i){v.warn("Could not generate segment CMCD data.",i)}},this.hls=e;const t=this.config=e.config,{cmcd:r}=t;null!=r&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=r.sessionId||Dr.uuid(),this.cid=r.contentId,this.useHeaders=!0===r.useHeaders,this.registerListeners())}registerListeners(){const e=this.hls;e.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(y.MEDIA_DETACHED,this.onMediaDetached,this),e.on(y.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(y.MEDIA_DETACHED,this.onMediaDetached,this),e.off(y.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){!this.media||(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var r,s;this.audioBuffer=null==(r=t.tracks.audio)?void 0:r.buffer,this.videoBuffer=null==(s=t.tracks.video)?void 0:s.buffer}createData(){var e;return{v:1,sf:"h",sid:this.sid,cid:this.cid,pr:null==(e=this.media)?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){if(Ye(t,this.createData()),this.starved&&("i"===t.ot||"v"===t.ot||"av"===t.ot)&&(t.bs=!0,t.su=!0,this.starved=!1),null==t.su&&(t.su=this.buffering),this.useHeaders){const s=Dr.toHeaders(t);if(!Object.keys(s).length)return;e.headers||(e.headers={}),Ye(e.headers,s)}else{const s=Dr.toQuery(t);if(!s)return;e.url=Dr.appendQueryToUri(e.url,s)}}getObjectType(e){const{type:t}=e;return"subtitle"===t?"tt":"initSegment"===e.sn?"i":"audio"===t?"a":"main"===t?this.hls.audioTracks.length?"v":"av":void 0}getTopBandwidth(e){let r,t=0;const s=this.hls;if("a"===e)r=s.audioTracks;else{const i=s.maxAutoLevel;r=s.levels.slice(0,i>-1?i+1:s.levels.length)}for(const i of r)i.bitrate>t&&(t=i.bitrate);return t>0?t:NaN}getBufferLength(e){const t=this.hls.media,r="a"===e?this.audioBuffer:this.videoBuffer;return r&&t?1e3*Ce.bufferInfo(r,t.currentTime,this.config.maxBufferHole).len:NaN}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,r=e||this.config.loader;return class{constructor(i){this.loader=void 0,this.loader=new r(i)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(i,o,a){t(i),this.loader.load(i,o,a)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,r=e||this.config.loader;return class{constructor(i){this.loader=void 0,this.loader=new r(i)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(i,o,a){t(i),this.loader.load(i,o,a)}}}static uuid(){const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}static serialize(e){const t=[],r=c=>!Number.isNaN(c)&&null!=c&&""!==c&&!1!==c,s=c=>Math.round(c),i=c=>100*s(c/100),a={br:s,d:s,bl:i,dl:i,mtp:i,nor:c=>encodeURIComponent(c),rtp:i,tb:s},l=Object.keys(e||{}).sort();for(const c of l){let u=e[c];if(!r(u)||"v"===c&&1===u||"pr"==c&&1===u)continue;const d=a[c];d&&(u=d(u));const f=typeof u;let h;h="ot"===c||"sf"===c||"st"===c?`${c}=${u}`:"boolean"===f?c:"number"===f?`${c}=${u}`:`${c}=${JSON.stringify(u)}`,t.push(h)}return t.join(",")}static toHeaders(e){const t=Object.keys(e),r={},s=["Object","Request","Session","Status"],i=[{},{},{},{}],o={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3};for(const a of t)i[null!=o[a]?o[a]:1][a]=e[a];for(let a=0;a<i.length;a++){const l=Dr.serialize(i[a]);l&&(r[`CMCD-${s[a]}`]=l)}return r}static toQuery(e){return`CMCD=${encodeURIComponent(Dr.serialize(e))}`}static appendQueryToUri(e,t){if(!t)return e;const r=e.includes("?")?"&":"?";return`${e}${r}${t}`}}function $v(n,e,t,r){!n||Object.keys(e).forEach(s=>{const i=n.filter(o=>o.groupId===s).map(o=>{const a=Ye({},o);return a.details=void 0,a.attrs=new Le(a.attrs),a.url=a.attrs.URI=Hv(o.url,o.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),a.groupId=a.attrs["GROUP-ID"]=e[s],a.attrs["PATHWAY-ID"]=r,a});n.push(...i)})}function Hv(n,e,t,r){const{HOST:s,PARAMS:i,[t]:o}=r;let a;e&&(a=null==o?void 0:o[e],a&&(n=a));const l=new self.URL(n);return s&&!a&&(l.host=s),i&&Object.keys(i).sort().forEach(c=>{c&&l.searchParams.set(c,i[c])}),l.href}const FB=/^age:\s*[\d.]+\s*$/im;class jv{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new ll,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,4!==e.readyState&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=r,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e)return;const r=this.loader=new self.XMLHttpRequest,s=this.stats;s.loading.first=0,s.loaded=0,s.aborted=!1;const i=this.xhrSetup;i?Promise.resolve().then(()=>{if(!this.stats.aborted)return i(r,t.url)}).catch(o=>(r.open("GET",t.url,!0),i(r,t.url))).then(()=>{this.stats.aborted||this.openAndSendXhr(r,t,e)}).catch(o=>{this.callbacks.onError({code:r.status,text:o.message},t,r,s)}):this.openAndSendXhr(r,t,e)}openAndSendXhr(e,t,r){e.readyState||e.open("GET",t.url,!0);const s=this.context.headers,{maxTimeToFirstByteMs:i,maxLoadTimeMs:o}=r.loadPolicy;if(s)for(const a in s)e.setRequestHeader(a,s[a]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),r.timeout=i&&O(i)?i:o,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:r}=this;if(!e||!t)return;const s=t.readyState,i=this.config;if(!r.aborted&&s>=2&&(0===r.loading.first&&(r.loading.first=Math.max(self.performance.now(),r.loading.start),i.timeout!==i.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),i.timeout=i.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.loadPolicy.maxLoadTimeMs-(r.loading.first-r.loading.start)))),4===s)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const o=t.status,a="text"!==t.responseType;if(o>=200&&o<300&&(a&&t.response||null!==t.responseText)){r.loading.end=Math.max(self.performance.now(),r.loading.first);const l=a?t.response:t.responseText;if(r.loaded=r.total="arraybuffer"===t.responseType?l.byteLength:l.length,r.bwEstimate=8e3*r.total/(r.loading.end-r.loading.first),!this.callbacks)return;const u=this.callbacks.onProgress;if(u&&u(r,e,l,t),!this.callbacks)return;this.callbacks.onSuccess({url:t.responseURL,data:l,code:o},r,e,t)}else{const l=i.loadPolicy.errorRetry;ml(l,r.retry,!1,o)?this.retry(l):(v.error(`${o} while loading ${e.url}`),this.callbacks.onError({code:o,text:t.statusText},e,t,r))}}}loadtimeout(){var e;const t=null==(e=this.config)?void 0:e.loadPolicy.timeoutRetry;if(ml(t,this.stats.retry,!0))this.retry(t);else{v.warn(`timeout while loading ${this.context.url}`);const s=this.callbacks;s&&(this.abortInternal(),s.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:r}=this;this.retryDelay=vf(e,r.retry),r.retry++,v.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t.url}, retrying ${r.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&FB.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const NB=/(\d+)-(\d+)\/(\d+)/;class Gv{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||VB,this.controller=new self.AbortController,this.stats=new ll}destroy(){this.loader=this.callbacks=null,this.abortInternal()}abortInternal(){const e=this.response;null!=e&&e.ok||(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,r){const s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();const i=function(n,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(Ye({},n.headers))};return n.rangeEnd&&t.headers.set("Range","bytes="+n.rangeStart+"-"+String(n.rangeEnd-1)),t}(e,this.controller.signal),o=r.onProgress,a="arraybuffer"===e.responseType,l=a?"byteLength":"length",{maxTimeToFirstByteMs:c,maxLoadTimeMs:u}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=r,this.request=this.fetchSetup(e,i),self.clearTimeout(this.requestTimeout),t.timeout=c&&O(c)?c:u,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),r.onTimeout(s,e,this.response)},t.timeout),self.fetch(this.request).then(d=>{this.response=this.loader=d;const f=Math.max(self.performance.now(),s.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=u,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),r.onTimeout(s,e,this.response)},u-(f-s.loading.start)),!d.ok){const{status:h,statusText:p}=d;throw new $B(p||"fetch, bad network response",h,d)}return s.loading.first=f,s.total=function(n){const e=n.get("Content-Range");if(e){const r=function(n){const e=NB.exec(n);if(e)return parseInt(e[2])-parseInt(e[1])+1}(e);if(O(r))return r}const t=n.get("Content-Length");if(t)return parseInt(t)}(d.headers)||s.total,o&&O(t.highWaterMark)?this.loadProgressively(d,s,e,t.highWaterMark,o):a?d.arrayBuffer():"json"===e.responseType?d.json():d.text()}).then(d=>{const{response:f}=this;self.clearTimeout(this.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first);const h=d[l];h&&(s.loaded=s.total=h);const p={url:f.url,data:d,code:f.status};o&&!O(t.highWaterMark)&&o(s,e,d,f),r.onSuccess(p,s,e,f)}).catch(d=>{self.clearTimeout(this.requestTimeout),s.aborted||r.onError({code:d&&d.code||0,text:d?d.message:null},e,d?d.details:null,s)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,r,s=0,i){const o=new Ev,a=e.body.getReader(),l=()=>a.read().then(c=>{if(c.done)return o.dataLength&&i(t,r,o.flush(),e),Promise.resolve(new ArrayBuffer(0));const u=c.value,d=u.length;return t.loaded+=d,d<s||o.dataLength?(o.push(u),o.dataLength>=s&&i(t,r,o.flush(),e)):i(t,r,u,e),l()}).catch(()=>Promise.reject());return l()}}function VB(n,e){return new self.Request(n.url,e)}class $B extends Error{constructor(e,t,r){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=r}}const HB=/\s/,jB={newCue(n,e,t,r){const s=[];let i,o,a,l,c;const u=self.VTTCue||self.TextTrackCue;for(let f=0;f<r.rows.length;f++)if(i=r.rows[f],a=!0,l=0,c="",!i.isEmpty()){var d;for(let g=0;g<i.chars.length;g++)HB.test(i.chars[g].uchar)&&a?l++:(c+=i.chars[g].uchar,a=!1);i.cueStartTime=e,e===t&&(t+=1e-4),l>=16?l--:l++;const h=Pv(c.trim()),p=Wf(e,t,h);null!=n&&null!=(d=n.cues)&&d.getCueById(p)||(o=new u(e,t,h),o.id=p,o.line=f+1,o.align="left",o.position=10+Math.min(80,10*Math.floor(8*l/32)),s.push(o))}return n&&s.length&&(s.sort((f,h)=>"auto"===f.line||"auto"===h.line?0:f.line>8&&h.line>8?h.line-f.line:f.line-h.line),s.forEach(f=>FD(n,f))),s}},KB=Dt(Dt({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:jv,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:class{constructor(e){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=-1,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=e;const t=e.config;this.bwEstimator=new YO(t.abrEwmaSlowVoD,t.abrEwmaFastVoD,t.abrEwmaDefaultEstimate),this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(y.FRAG_LOADING,this.onFragLoading,this),e.on(y.FRAG_LOADED,this.onFragLoaded,this),e.on(y.FRAG_BUFFERED,this.onFragBuffered,this),e.on(y.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(y.LEVEL_LOADED,this.onLevelLoaded,this)}unregisterListeners(){const{hls:e}=this;e.off(y.FRAG_LOADING,this.onFragLoading,this),e.off(y.FRAG_LOADED,this.onFragLoaded,this),e.off(y.FRAG_BUFFERED,this.onFragBuffered,this),e.off(y.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(y.LEVEL_LOADED,this.onLevelLoaded,this)}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null}onFragLoading(e,t){var r;const s=t.frag;this.ignoreFragment(s)||(this.fragCurrent=s,this.partCurrent=null!=(r=t.part)?r:null,this.clearTimer(),this.timer=self.setInterval(this.onCheck,100))}onLevelSwitching(e,t){this.clearTimer()}getTimeToLoadFrag(e,t,r,s){return e+r/t+(s?this.lastLevelLoadSec:0)}onLevelLoaded(e,t){const r=this.hls.config,{total:s,bwEstimate:i}=t.stats;O(s)&&O(i)&&(this.lastLevelLoadSec=8*s/i),t.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD)}_abandonRulesCheck(){const{fragCurrent:e,partCurrent:t,hls:r}=this,{autoLevelEnabled:s,media:i}=r;if(!e||!i)return;const o=performance.now(),a=t?t.stats:e.stats,l=t?t.duration:e.duration,c=o-a.loading.start;if(a.aborted||a.loaded&&a.loaded===a.total||0===e.level)return this.clearTimer(),void(this._nextAutoLevel=-1);if(!s||i.paused||!i.playbackRate||!i.readyState)return;const u=r.mainForwardBufferInfo;if(null===u)return;const d=this.bwEstimator.getEstimateTTFB(),f=Math.abs(i.playbackRate);if(c<=Math.max(d,l/(2*f)*1e3))return;const h=u.len/f;if(h>=2*l/f)return;const p=a.loading.first?a.loading.first-a.loading.start:-1,g=a.loaded&&p>-1,m=this.bwEstimator.getEstimate(),{levels:E,minAutoLevel:T}=r,x=a.total||Math.max(a.loaded,Math.round(l*E[e.level].maxBitrate/8));let _=c-p;_<1&&g&&(_=Math.min(c,8*a.loaded/m));const w=g?1e3*a.loaded/_:0,S=w?(x-a.loaded)/w:8*x/m+d/1e3;if(S<=h)return;const R=w?8*w:m;let b,L=Number.POSITIVE_INFINITY;for(b=e.level-1;b>T&&(L=this.getTimeToLoadFrag(d/1e3,R,l*E[b].maxBitrate,!E[b].details),!(L<h));b--);L>=S||L>10*l||(r.nextLoadLevel=b,g?this.bwEstimator.sample(c-Math.min(d,p),a.loaded):this.bwEstimator.sampleTTFB(c),this.clearTimer(),v.warn(`[abr] Fragment ${e.sn}${t?" part "+t.index:""} of level ${e.level} is loading too slowly;\n      Time to underbuffer: ${h.toFixed(3)} s\n      Estimated load time for current fragment: ${S.toFixed(3)} s\n      Estimated load time for down switch fragment: ${L.toFixed(3)} s\n      TTFB estimate: ${p}\n      Current BW estimate: ${O(m)?(m/1024).toFixed(3):"Unknown"} Kb/s\n      New BW estimate: ${(this.bwEstimator.getEstimate()/1024).toFixed(3)} Kb/s\n      Aborting and switching to level ${b}`),e.loader&&(this.fragCurrent=this.partCurrent=null,e.abortRequests()),r.trigger(y.FRAG_LOAD_EMERGENCY_ABORTED,{frag:e,part:t,stats:a}))}onFragLoaded(e,{frag:t,part:r}){const s=r?r.stats:t.stats;if("main"===t.type&&this.bwEstimator.sampleTTFB(s.loading.first-s.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),this.lastLoadedFragLevel=t.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){const o=this.hls.levels[t.level],a=(o.loaded?o.loaded.bytes:0)+s.loaded,l=(o.loaded?o.loaded.duration:0)+(r?r.duration:t.duration);o.loaded={bytes:a,duration:l},o.realBitrate=Math.round(8*a/l)}t.bitrateTest&&(this.onFragBuffered(y.FRAG_BUFFERED,{stats:s,frag:t,part:r,id:t.type}),t.bitrateTest=!1)}}onFragBuffered(e,t){const{frag:r,part:s}=t,i=null!=s&&s.stats.loaded?s.stats:r.stats;if(i.aborted||this.ignoreFragment(r))return;const o=i.parsing.end-i.loading.start-Math.min(i.loading.first-i.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(o,i.loaded),i.bwEstimate=this.bwEstimator.getEstimate(),this.bitrateTestDelay=r.bitrateTest?o/1e3:0}ignoreFragment(e){return"main"!==e.type||"initSegment"===e.sn}clearTimer(){self.clearInterval(this.timer)}get nextAutoLevel(){const e=this._nextAutoLevel;if(-1!==e&&!this.bwEstimator.canEstimate())return e;let r=this.getNextABRAutoLevel();if(-1!==e){const s=this.hls.levels;if(s.length>Math.max(e,r)&&s[e].loadError<=s[r].loadError)return e}return-1!==e&&(r=Math.min(e,r)),r}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:r}=this,{maxAutoLevel:s,config:i,minAutoLevel:o,media:a}=r,l=t?t.duration:e?e.duration:0,c=a&&0!==a.playbackRate?Math.abs(a.playbackRate):1,u=this.bwEstimator?this.bwEstimator.getEstimate():i.abrEwmaDefaultEstimate,d=r.mainForwardBufferInfo,f=(d?d.len:0)/c;let h=this.findBestLevel(u,o,s,f,i.abrBandWidthFactor,i.abrBandWidthUpFactor);if(h>=0)return h;v.trace(`[abr] ${f?"rebuffering expected":"buffer is empty"}, finding optimal quality level`);let p=l?Math.min(l,i.maxStarvationDelay):i.maxStarvationDelay,g=i.abrBandWidthFactor,m=i.abrBandWidthUpFactor;if(!f){const E=this.bitrateTestDelay;E&&(p=(l?Math.min(l,i.maxLoadingDelay):i.maxLoadingDelay)-E,v.trace(`[abr] bitrate test took ${Math.round(1e3*E)}ms, set first fragment max fetchDuration to ${Math.round(1e3*p)} ms`),g=m=1)}return h=this.findBestLevel(u,o,s,f+p,g,m),Math.max(h,0)}findBestLevel(e,t,r,s,i,o){var a;const{fragCurrent:l,partCurrent:c,lastLoadedFragLevel:u}=this,{levels:d}=this.hls,f=d[u],h=!(null==f||null==(a=f.details)||!a.live),p=null==f?void 0:f.codecSet,g=c?c.duration:l?l.duration:0,m=this.bwEstimator.getEstimateTTFB()/1e3;let E=t,T=-1;for(let D=r;D>=t;D--){const x=d[D];if(!x||p&&x.codecSet!==p){x&&(E=Math.min(D,E),T=Math.max(D,T));continue}-1!==T&&v.trace(`[abr] Skipped level(s) ${E}-${T} with CODECS:"${d[T].attrs.CODECS}"; not compatible with "${f.attrs.CODECS}"`);const _=x.details,w=(c?null==_?void 0:_.partTarget:null==_?void 0:_.averagetargetduration)||g;let S;S=D<=u?i*e:o*e;const R=d[D].maxBitrate,L=this.getTimeToLoadFrag(m,S,R*w,void 0===_);if(v.trace(`[abr] level:${D} adjustedbw-bitrate:${Math.round(S-R)} avgDuration:${w.toFixed(1)} maxFetchDuration:${s.toFixed(1)} fetchDuration:${L.toFixed(1)}`),S>R&&(0===L||!O(L)||h&&!this.bitrateTestDelay||L<s))return D}return-1}set nextAutoLevel(e){this._nextAutoLevel=e}},bufferController:class{constructor(e){this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=()=>{const{media:t,mediaSource:r}=this;v.log("[buffer-controller]: Media source opened"),t&&(t.removeEventListener("emptied",this._onMediaEmptied),this.updateMediaElementDuration(),this.hls.trigger(y.MEDIA_ATTACHED,{media:t})),r&&r.removeEventListener("sourceopen",this._onMediaSourceOpen),this.checkPendingTracks()},this._onMediaSourceClose=()=>{v.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=()=>{v.log("[buffer-controller]: Media source ended")},this._onMediaEmptied=()=>{const{media:t,_objectUrl:r}=this;t&&t.src!==r&&v.error(`Media element src was set while attaching MediaSource (${r} > ${t.src})`)},this.hls=e,this._initSourceBuffer(),this.registerListeners()}hasSourceTypes(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null}registerListeners(){const{hls:e}=this;e.on(y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.MANIFEST_PARSED,this.onManifestParsed,this),e.on(y.BUFFER_RESET,this.onBufferReset,this),e.on(y.BUFFER_APPENDING,this.onBufferAppending,this),e.on(y.BUFFER_CODECS,this.onBufferCodecs,this),e.on(y.BUFFER_EOS,this.onBufferEos,this),e.on(y.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(y.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(y.FRAG_PARSED,this.onFragParsed,this),e.on(y.FRAG_CHANGED,this.onFragChanged,this)}unregisterListeners(){const{hls:e}=this;e.off(y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.MANIFEST_PARSED,this.onManifestParsed,this),e.off(y.BUFFER_RESET,this.onBufferReset,this),e.off(y.BUFFER_APPENDING,this.onBufferAppending,this),e.off(y.BUFFER_CODECS,this.onBufferCodecs,this),e.off(y.BUFFER_EOS,this.onBufferEos,this),e.off(y.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(y.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(y.FRAG_PARSED,this.onFragParsed,this),e.off(y.FRAG_CHANGED,this.onFragChanged,this)}_initSourceBuffer(){this.sourceBuffer={},this.operationQueue=new nB(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.lastMpegAudioChunk=null}onManifestLoading(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){let r=2;(t.audio&&!t.video||!t.altAudio)&&(r=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=r,v.log(`${this.bufferCodecEventsExpected} bufferCodec event(s) expected`)}onMediaAttaching(e,t){const r=this.media=t.media;if(r&&_v){const s=this.mediaSource=new _v;s.addEventListener("sourceopen",this._onMediaSourceOpen),s.addEventListener("sourceended",this._onMediaSourceEnded),s.addEventListener("sourceclose",this._onMediaSourceClose),r.src=self.URL.createObjectURL(s),this._objectUrl=r.src,r.addEventListener("emptied",this._onMediaEmptied)}}onMediaDetaching(){const{media:e,mediaSource:t,_objectUrl:r}=this;if(t){if(v.log("[buffer-controller]: media source detaching"),"open"===t.readyState)try{t.endOfStream()}catch(s){v.warn(`[buffer-controller]: onMediaDetaching: ${s.message} while calling endOfStream`)}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(e.removeEventListener("emptied",this._onMediaEmptied),r&&self.URL.revokeObjectURL(r),e.src===r?(e.removeAttribute("src"),e.load()):v.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(y.MEDIA_DETACHED,void 0)}onBufferReset(){this.getSourceBufferTypes().forEach(e=>{const t=this.sourceBuffer[e];try{t&&(this.removeBufferListeners(e),this.mediaSource&&this.mediaSource.removeSourceBuffer(t),this.sourceBuffer[e]=void 0)}catch(r){v.warn(`[buffer-controller]: Failed to reset the ${e} buffer`,r)}}),this._initSourceBuffer()}onBufferCodecs(e,t){const r=this.getSourceBufferTypes().length;Object.keys(t).forEach(s=>{if(r){const i=this.tracks[s];if(i&&"function"==typeof i.buffer.changeType){const{id:o,codec:a,levelCodec:l,container:c,metadata:u}=t[s],d=(i.levelCodec||i.codec).replace(xv,"$1"),f=(l||a).replace(xv,"$1");d!==f&&(this.appendChangeType(s,`${c};codecs=${l||a}`),v.log(`[buffer-controller]: switching codec ${d} to ${f}`),this.tracks[s]={buffer:i.buffer,codec:a,container:c,levelCodec:l,metadata:u,id:o})}}else this.pendingTracks[s]=t[s]}),!r&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())}appendChangeType(e,t){const{operationQueue:r}=this,s={execute:()=>{const i=this.sourceBuffer[e];i&&(v.log(`[buffer-controller]: changing ${e} sourceBuffer type to ${t}`),i.changeType(t)),r.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:i=>{v.warn(`[buffer-controller]: Failed to change ${e} SourceBuffer type`,i)}};r.append(s,e)}onBufferAppending(e,t){const{hls:r,operationQueue:s,tracks:i}=this,{data:o,type:a,frag:l,part:c,chunkMeta:u}=t,d=u.buffering[a],f=self.performance.now();d.start=f;const h=l.stats.buffering,p=c?c.stats.buffering:null;0===h.start&&(h.start=f),p&&0===p.start&&(p.start=f);const g=i.audio;let m=!1;"audio"===a&&"audio/mpeg"===(null==g?void 0:g.container)&&(m=!this.lastMpegAudioChunk||1===u.id||this.lastMpegAudioChunk.sn!==u.sn,this.lastMpegAudioChunk=u);const E=l.start;s.append({execute:()=>{if(d.executeStart=self.performance.now(),m){const D=this.sourceBuffer[a];if(D){const x=E-D.timestampOffset;Math.abs(x)>=.1&&(v.log(`[buffer-controller]: Updating audio SourceBuffer timestampOffset to ${E} (delta: ${x}) sn: ${l.sn})`),D.timestampOffset=E)}}this.appendExecutor(o,a)},onStart:()=>{},onComplete:()=>{const D=self.performance.now();d.executeEnd=d.end=D,0===h.first&&(h.first=D),p&&0===p.first&&(p.first=D);const{sourceBuffer:x}=this,_={};for(const w in x)_[w]=Ce.getBuffered(x[w]);this.appendError=0,this.hls.trigger(y.BUFFER_APPENDED,{type:a,frag:l,part:c,chunkMeta:u,parent:l.type,timeRanges:_})},onError:D=>{v.error(`[buffer-controller]: Error encountered while trying to append to the ${a} SourceBuffer`,D);const x={type:H.MEDIA_ERROR,parent:l.type,details:C.BUFFER_APPEND_ERROR,frag:l,part:c,chunkMeta:u,error:D,err:D,fatal:!1};D.code===DOMException.QUOTA_EXCEEDED_ERR?x.details=C.BUFFER_FULL_ERROR:(this.appendError++,x.details=C.BUFFER_APPEND_ERROR,this.appendError>r.config.appendErrorMaxRetry&&(v.error(`[buffer-controller]: Failed ${r.config.appendErrorMaxRetry} times to append segment in sourceBuffer`),x.fatal=!0)),r.trigger(y.ERROR,x)}},a)}onBufferFlushing(e,t){const{operationQueue:r}=this,s=i=>({execute:this.removeExecutor.bind(this,i,t.startOffset,t.endOffset),onStart:()=>{},onComplete:()=>{this.hls.trigger(y.BUFFER_FLUSHED,{type:i})},onError:o=>{v.warn(`[buffer-controller]: Failed to remove from ${i} SourceBuffer`,o)}});t.type?r.append(s(t.type),t.type):this.getSourceBufferTypes().forEach(i=>{r.append(s(i),i)})}onFragParsed(e,t){const{frag:r,part:s}=t,i=[],o=s?s.elementaryStreams:r.elementaryStreams;o.audiovideo?i.push("audiovideo"):(o.audio&&i.push("audio"),o.video&&i.push("video")),0===i.length&&v.warn(`Fragments must have at least one ElementaryStreamType set. type: ${r.type} level: ${r.level} sn: ${r.sn}`),this.blockBuffers(()=>{const l=self.performance.now();r.stats.buffering.end=l,s&&(s.stats.buffering.end=l),this.hls.trigger(y.FRAG_BUFFERED,{frag:r,part:s,stats:s?s.stats:r.stats,id:r.type})},i)}onFragChanged(e,t){this.flushBackBuffer()}onBufferEos(e,t){this.getSourceBufferTypes().reduce((s,i)=>{const o=this.sourceBuffer[i];return o&&(!t.type||t.type===i)&&(o.ending=!0,o.ended||(o.ended=!0,v.log(`[buffer-controller]: ${i} sourceBuffer now EOS`))),s&&!(o&&!o.ended)},!0)&&(v.log("[buffer-controller]: Queueing mediaSource.endOfStream()"),this.blockBuffers(()=>{this.getSourceBufferTypes().forEach(i=>{const o=this.sourceBuffer[i];o&&(o.ending=!1)});const{mediaSource:s}=this;s&&"open"===s.readyState?(v.log("[buffer-controller]: Calling mediaSource.endOfStream()"),s.endOfStream()):s&&v.info(`[buffer-controller]: Could not call mediaSource.endOfStream(). mediaSource.readyState: ${s.readyState}`)}))}onLevelUpdated(e,{details:t}){!t.fragments.length||(this.details=t,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())}flushBackBuffer(){const{hls:e,details:t,media:r,sourceBuffer:s}=this;if(!r||null===t)return;const i=this.getSourceBufferTypes();if(!i.length)return;const o=t.live&&null!==e.config.liveBackBufferLength?e.config.liveBackBufferLength:e.config.backBufferLength;if(!O(o)||o<0)return;const a=r.currentTime,l=t.levelTargetDuration,c=Math.max(o,l),u=Math.floor(a/l)*l-c;i.forEach(d=>{const f=s[d];if(f){const h=Ce.getBuffered(f);if(h.length>0&&u>h.start(0)){if(e.trigger(y.BACK_BUFFER_REACHED,{bufferEnd:u}),t.live)e.trigger(y.LIVE_BACK_BUFFER_REACHED,{bufferEnd:u});else if(f.ended&&h.end(h.length-1)-a<2*l)return void v.info(`[buffer-controller]: Cannot flush ${d} back buffer while SourceBuffer is in ended state`);e.trigger(y.BUFFER_FLUSHING,{startOffset:0,endOffset:u,type:d})}}})}updateMediaElementDuration(){if(!this.details||!this.media||!this.mediaSource||"open"!==this.mediaSource.readyState)return;const{details:e,hls:t,media:r,mediaSource:s}=this,i=e.fragments[0].start+e.totalduration,o=r.duration,a=O(s.duration)?s.duration:0;e.live&&t.config.liveDurationInfinity?(v.log("[buffer-controller]: Media Source duration is set to Infinity"),s.duration=1/0,this.updateSeekableRange(e)):(i>a&&i>o||!O(o))&&(v.log(`[buffer-controller]: Updating Media Source duration to ${i.toFixed(3)}`),s.duration=i)}updateSeekableRange(e){const t=this.mediaSource,r=e.fragments;if(r.length&&e.live&&null!=t&&t.setLiveSeekableRange){const i=Math.max(0,r[0].start),o=Math.max(i,i+e.totalduration);t.setLiveSeekableRange(i,o)}}checkPendingTracks(){const{bufferCodecEventsExpected:e,operationQueue:t,pendingTracks:r}=this,s=Object.keys(r).length;if(s&&!e||2===s){this.createSourceBuffers(r),this.pendingTracks={};const i=this.getSourceBufferTypes();if(i.length)this.hls.trigger(y.BUFFER_CREATED,{tracks:this.tracks}),i.forEach(o=>{t.executeNext(o)});else{const o=new Error("could not create source buffer for media codec(s)");this.hls.trigger(y.ERROR,{type:H.MEDIA_ERROR,details:C.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:o,reason:o.message})}}}createSourceBuffers(e){const{sourceBuffer:t,mediaSource:r}=this;if(!r)throw Error("createSourceBuffers called when mediaSource was null");for(const s in e)if(!t[s]){const i=e[s];if(!i)throw Error(`source buffer exists for track ${s}, however track does not`);const o=i.levelCodec||i.codec,a=`${i.container};codecs=${o}`;v.log(`[buffer-controller]: creating sourceBuffer(${a})`);try{const l=t[s]=r.addSourceBuffer(a),c=s;this.addBufferListener(c,"updatestart",this._onSBUpdateStart),this.addBufferListener(c,"updateend",this._onSBUpdateEnd),this.addBufferListener(c,"error",this._onSBUpdateError),this.tracks[s]={buffer:l,codec:o,container:i.container,levelCodec:i.levelCodec,metadata:i.metadata,id:i.id}}catch(l){v.error(`[buffer-controller]: error while trying to add sourceBuffer: ${l.message}`),this.hls.trigger(y.ERROR,{type:H.MEDIA_ERROR,details:C.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:l,mimeType:a})}}}_onSBUpdateStart(e){const{operationQueue:t}=this;t.current(e).onStart()}_onSBUpdateEnd(e){const{operationQueue:t}=this;t.current(e).onComplete(),t.shiftAndExecuteNext(e)}_onSBUpdateError(e,t){const r=new Error(`${e} SourceBuffer error`);v.error(`[buffer-controller]: ${r}`,t),this.hls.trigger(y.ERROR,{type:H.MEDIA_ERROR,details:C.BUFFER_APPENDING_ERROR,error:r,fatal:!1});const s=this.operationQueue.current(e);s&&s.onError(t)}removeExecutor(e,t,r){const{media:s,mediaSource:i,operationQueue:o,sourceBuffer:a}=this,l=a[e];if(!s||!i||!l)return v.warn(`[buffer-controller]: Attempting to remove from the ${e} SourceBuffer, but it does not exist`),void o.shiftAndExecuteNext(e);const c=O(s.duration)?s.duration:1/0,u=O(i.duration)?i.duration:1/0,d=Math.max(0,t),f=Math.min(r,c,u);f>d&&!l.ending?(l.ended=!1,v.log(`[buffer-controller]: Removing [${d},${f}] from the ${e} SourceBuffer`),l.remove(d,f)):o.shiftAndExecuteNext(e)}appendExecutor(e,t){const{operationQueue:r,sourceBuffer:s}=this,i=s[t];if(!i)return v.warn(`[buffer-controller]: Attempting to append to the ${t} SourceBuffer, but it does not exist`),void r.shiftAndExecuteNext(t);i.ended=!1,i.appendBuffer(e)}blockBuffers(e,t=this.getSourceBufferTypes()){if(!t.length)return v.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve().then(e);const{operationQueue:r}=this,s=t.map(i=>r.appendBlocker(i));Promise.all(s).then(()=>{e(),t.forEach(i=>{const o=this.sourceBuffer[i];null!=o&&o.updating||r.shiftAndExecuteNext(i)})})}getSourceBufferTypes(){return Object.keys(this.sourceBuffer)}addBufferListener(e,t,r){const s=this.sourceBuffer[e];if(!s)return;const i=r.bind(this,e);this.listeners[e].push({event:t,listener:i}),s.addEventListener(t,i)}removeBufferListeners(e){const t=this.sourceBuffer[e];!t||this.listeners[e].forEach(r=>{t.removeEventListener(r.event,r.listener)})}},capLevelController:Xf,errorController:class{constructor(e){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=e,this.log=v.log.bind(v,"[info]:"),this.warn=v.warn.bind(v,"[warning]:"),this.error=v.error.bind(v,"[error]:"),this.registerListeners()}registerListeners(){const e=this.hls;e.on(y.ERROR,this.onError,this),e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;!e||(e.off(y.ERROR,this.onError,this),e.off(y.ERROR,this.onErrorOut,this),e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(e){this.playlistError=0}stopLoad(){}getVariantLevelIndex(e){return"main"===(null==e?void 0:e.type)?e.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(e,t){var r,s;if(t.fatal)return;const i=this.hls,o=t.context;switch(t.details){case C.FRAG_LOAD_ERROR:case C.FRAG_LOAD_TIMEOUT:case C.KEY_LOAD_ERROR:case C.KEY_LOAD_TIMEOUT:return void(t.errorAction=this.getFragRetryOrSwitchAction(t));case C.FRAG_PARSING_ERROR:if(null!=(r=t.frag)&&r.gap)return void(t.errorAction={action:0,flags:0});case C.FRAG_GAP:case C.FRAG_DECRYPT_ERROR:return t.errorAction=this.getFragRetryOrSwitchAction(t),void(t.errorAction.action=2);case C.LEVEL_EMPTY_ERROR:case C.LEVEL_PARSING_ERROR:{var a,l;const c="main"===t.parent?t.level:i.loadLevel;t.details===C.LEVEL_EMPTY_ERROR&&null!=(a=t.context)&&null!=(l=a.levelDetails)&&l.live?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,c):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,c))}return;case C.LEVEL_LOAD_ERROR:case C.LEVEL_LOAD_TIMEOUT:return void("number"==typeof(null==o?void 0:o.level)&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,o.level)));case C.AUDIO_TRACK_LOAD_ERROR:case C.AUDIO_TRACK_LOAD_TIMEOUT:case C.SUBTITLE_LOAD_ERROR:case C.SUBTITLE_TRACK_LOAD_TIMEOUT:if(o){const c=i.levels[i.loadLevel];if(c&&("audioTrack"===o.type&&o.groupId===c.audioGroupId||"subtitleTrack"===o.type&&o.groupId===c.textGroupId))return t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.loadLevel),t.errorAction.action=2,void(t.errorAction.flags=1)}return;case C.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const c=i.levels[i.loadLevel],u=null==c?void 0:c.attrs["HDCP-LEVEL"];u&&(t.errorAction={action:2,flags:2,hdcpLevel:u})}return;case C.BUFFER_ADD_CODEC_ERROR:case C.REMUX_ALLOC_ERROR:return void(t.errorAction=this.getLevelSwitchAction(t,null!=(s=t.level)?s:i.loadLevel));case C.INTERNAL_EXCEPTION:case C.BUFFER_APPENDING_ERROR:case C.BUFFER_APPEND_ERROR:case C.BUFFER_FULL_ERROR:case C.LEVEL_SWITCH_ERROR:case C.BUFFER_STALLED_ERROR:case C.BUFFER_SEEK_OVER_HOLE:case C.BUFFER_NUDGE_ON_STALL:return void(t.errorAction={action:0,flags:0})}if(t.type===H.KEY_SYSTEM_ERROR){const c=this.getVariantLevelIndex(t.frag);return t.levelRetry=!1,void(t.errorAction=this.getLevelSwitchAction(t,c))}}getPlaylistRetryOrSwitchAction(e,t){var r;const i=$D(this.hls.config.playlistLoadPolicy,e),o=this.playlistError++,a=null==(r=e.response)?void 0:r.code;if(ml(i,o,gl(e),a))return{action:5,flags:0,retryConfig:i,retryCount:o};const c=this.getLevelSwitchAction(e,t);return i&&(c.retryConfig=i,c.retryCount=o),c}getFragRetryOrSwitchAction(e){const t=this.hls,r=this.getVariantLevelIndex(e.frag),s=t.levels[r],{fragLoadPolicy:i,keyLoadPolicy:o}=t.config,a=$D(e.details.startsWith("key")?o:i,e),l=t.levels.reduce((d,f)=>d+f.fragmentError,0);if(s){var c;e.details!==C.FRAG_GAP&&s.fragmentError++;const d=null==(c=e.response)?void 0:c.code;if(ml(a,l,gl(e),d))return{action:5,flags:0,retryConfig:a,retryCount:l}}const u=this.getLevelSwitchAction(e,r);return a&&(u.retryConfig=a,u.retryCount=l),u}getLevelSwitchAction(e,t){const r=this.hls;null==t&&(t=r.loadLevel);const s=this.hls.levels[t];if(s&&(s.loadError++,r.autoLevelEnabled)){var i,o;let a=-1;const{levels:l,loadLevel:c,minAutoLevel:u,maxAutoLevel:d}=r,f=null==(i=e.frag)?void 0:i.type,{type:h,groupId:p}=null!=(o=e.context)?o:{};for(let g=l.length;g--;){const m=(g+c)%l.length;if(m!==c&&m>=u&&m<=d&&0===l[m].loadError){const E=l[m];if(e.details===C.FRAG_GAP&&e.frag){const T=l[m].details;if(T){const D=po(e.frag,T.fragments,e.frag.start);if(null!=D&&D.gap)continue}}else{if("audioTrack"===h&&p===E.audioGroupId||"subtitleTrack"===h&&p===E.textGroupId)continue;if("audio"===f&&s.audioGroupId===E.audioGroupId||"subtitle"===f&&s.textGroupId===E.textGroupId)continue}a=m;break}}if(a>-1&&r.loadLevel!==a)return e.levelRetry=!0,this.playlistError=0,{action:2,flags:0,nextAutoLevel:a}}return{action:2,flags:1}}onErrorOut(e,t){var r;switch(null==(r=t.errorAction)?void 0:r.action){case 0:break;case 2:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==C.FRAG_GAP&&(t.fatal=!0)}t.fatal&&this.hls.stopLoad()}sendAlternateToPenaltyBox(e){const t=this.hls,r=e.errorAction;if(!r)return;const{flags:s,hdcpLevel:i,nextAutoLevel:o}=r;switch(s){case 0:this.switchLevel(e,o);break;case 1:r.resolved||(r.resolved=this.redundantFailover(e));break;case 2:i&&(t.maxHdcpLevel=Ef[Ef.indexOf(i)-1],r.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`)}r.resolved||this.switchLevel(e,o)}switchLevel(e,t){void 0!==t&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)}redundantFailover(e){const{hls:t,penalizedRenditions:r}=this,s="main"===e.parent?e.level:t.loadLevel,i=t.levels[s],o=i.url.length,a=e.frag?e.frag.urlId:i.urlId;i.urlId===a&&(!e.frag||i.details)&&this.penalizeRendition(i,e);for(let l=1;l<o;l++){const c=(a+l)%o,u=r[c];if(!u||$N(u,e,r[a]))return this.warn(`Switching to Redundant Stream ${c+1}/${o}: "${i.url[c]}" after ${e.details}`),this.playlistError=0,t.levels.forEach(d=>{d.urlId=c}),t.nextLoadLevel=s,!0}return!1}penalizeRendition(e,t){const{penalizedRenditions:r}=this,s=r[e.urlId]||{lastErrorPerfMs:0,errors:[],details:void 0};s.lastErrorPerfMs=performance.now(),s.errors.push(t),s.details=e.details,r[e.urlId]=s}},fpsController:class{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(y.MEDIA_ATTACHING,this.onMediaAttaching,this)}unregisterListeners(){this.hls.off(y.MEDIA_ATTACHING,this.onMediaAttaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const r=this.hls.config;if(r.capLevelOnFPSDrop){const s=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=s,s&&"function"==typeof s.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}}checkFPS(e,t,r){const s=performance.now();if(t){if(this.lastTime){const o=r-this.lastDroppedFrames,a=t-this.lastDecodedFrames,l=1e3*o/(s-this.lastTime),c=this.hls;if(c.trigger(y.FPS_DROP,{currentDropped:o,currentDecoded:a,totalDroppedFrames:r}),l>0&&o>c.config.fpsDroppedMonitoringThreshold*a){let u=c.currentLevel;v.warn("drop FPS ratio greater than max allowed value for currentLevel: "+u),u>0&&(-1===c.autoLevelCapping||c.autoLevelCapping>=u)&&(u-=1,c.trigger(y.FPS_DROP_LEVEL_CAPPING,{level:u,droppedLevel:c.currentLevel}),c.autoLevelCapping=u,this.streamController.nextLevelSwitch())}}this.lastTime=s,this.lastDroppedFrames=r,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}},stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:aD,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,certLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null}},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},{cueHandler:jB,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:class extends Af{constructor(e,t,r){super(e,t,r,"[subtitle-stream-controller]","subtitle"),this.levels=[],this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),this.mainDetails=null}_registerListeners(){const{hls:e}=this;e.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.LEVEL_LOADED,this.onLevelLoaded,this),e.on(y.ERROR,this.onError,this),e.on(y.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(y.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(y.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(y.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(y.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(y.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.LEVEL_LOADED,this.onLevelLoaded,this),e.off(y.ERROR,this.onError,this),e.off(y.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(y.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(y.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(y.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(y.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(y.FRAG_BUFFERED,this.onFragBuffered,this)}startLoad(e){this.stopLoad(),this.state="IDLE",this.setInterval(500),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}onManifestLoading(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()}onMediaDetaching(){this.tracksBuffered=[],super.onMediaDetaching()}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:r,success:s}=t;if(this.fragPrevious=r,this.state="IDLE",!s)return;const i=this.tracksBuffered[this.currentTrackId];if(!i)return;let o;const a=r.start;for(let c=0;c<i.length;c++)if(a>=i[c].start&&a<=i[c].end){o=i[c];break}const l=r.start+r.duration;o?o.end=l:(o={start:a,end:l},i.push(o)),this.fragmentTracker.fragBuffered(r)}onBufferFlushing(e,t){const{startOffset:r,endOffset:s}=t;if(0===r&&s!==Number.POSITIVE_INFINITY){const i=s-1;if(i<=0)return;t.endOffsetSubtitles=Math.max(0,i),this.tracksBuffered.forEach(o=>{for(let a=0;a<o.length;)if(o[a].end<=i)o.shift();else{if(!(o[a].start<i))break;o[a].start=i,a++}}),this.fragmentTracker.removeFragmentsInRange(r,i,"subtitle")}}onFragBuffered(e,t){var r;this.loadedmetadata||"main"!==t.frag.type||null!=(r=this.media)&&r.buffered.length&&(this.loadedmetadata=!0)}onError(e,t){const r=t.frag;"subtitle"===(null==r?void 0:r.type)&&(this.fragCurrent&&this.fragCurrent.abortRequests(),"STOPPED"!==this.state&&(this.state="IDLE"))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){Dv(this.levels,t)?this.levels=t.map(r=>new ho(r)):(this.tracksBuffered=[],this.levels=t.map(r=>{const s=new ho(r);return this.tracksBuffered[s.id]=[],s}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,"subtitle"),this.fragPrevious=null,this.mediaBuffer=null)}onSubtitleTrackSwitch(e,t){if(this.currentTrackId=t.id,!this.levels.length||-1===this.currentTrackId)return void this.clearInterval();const r=this.levels[this.currentTrackId];this.mediaBuffer=null!=r&&r.details?this.mediaBufferTimeRanges:null,r&&this.setInterval(500)}onSubtitleTrackLoaded(e,t){var r;const{details:s,id:i}=t,{currentTrackId:o,levels:a}=this;if(!a.length)return;const l=a[o];if(i>=a.length||i!==o||!l)return;this.mediaBuffer=this.mediaBufferTimeRanges;let c=0;if(s.live||null!=(r=l.details)&&r.live){const u=this.mainDetails;if(s.deltaUpdateFailed||!u)return;const d=u.fragments[0];l.details?(c=this.alignPlaylists(s,l.details),0===c&&d&&(c=d.start,Df(s,c))):s.hasProgramDateTime&&u.hasProgramDateTime?(QD(s,u),c=s.fragments[0].start):d&&(c=d.start,Df(s,c))}l.details=s,this.levelLastLoaded=i,!this.startFragRequested&&(this.mainDetails||!s.live)&&this.setStartPosition(l.details,c),this.tick(),s.live&&!this.fragCurrent&&this.media&&"IDLE"===this.state&&(po(null,s.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),l.details=void 0))}_handleFragmentLoadComplete(e){const{frag:t,payload:r}=e,s=t.decryptdata,i=this.hls;if(!this.fragContextChanged(t)&&r&&r.byteLength>0&&s&&s.key&&s.iv&&"AES-128"===s.method){const o=performance.now();this.decrypter.decrypt(new Uint8Array(r),s.key.buffer,s.iv.buffer).catch(a=>{throw i.trigger(y.ERROR,{type:H.MEDIA_ERROR,details:C.FRAG_DECRYPT_ERROR,fatal:!1,error:a,reason:a.message,frag:t}),a}).then(a=>{const l=performance.now();i.trigger(y.FRAG_DECRYPTED,{frag:t,payload:a,stats:{tstart:o,tdecrypt:l}})}).catch(a=>{this.warn(`${a.name}: ${a.message}`),this.state="IDLE"})}}doTick(){if(this.media){if("IDLE"===this.state){const{currentTrackId:e,levels:t}=this,r=t[e];if(!t.length||!r||!r.details)return;const{config:s}=this,i=this.getLoadPosition(),o=Ce.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],i,s.maxBufferHole),{end:a,len:l}=o,c=this.getFwdBufferInfo(this.media,"main"),u=r.details;if(l>this.getMaxBufferLength(null==c?void 0:c.len)+u.levelTargetDuration)return;const f=u.fragments,h=f.length,p=u.edge;let g=null;const m=this.fragPrevious;if(a<p){const E=s.maxFragLookUpTolerance,T=a>p-E?0:E;g=po(m,f,Math.max(f[0].start,a),T),!g&&m&&m.start<f[0].start&&(g=f[0])}else g=f[h-1];if(!g)return;if(g=this.mapToInitFragWhenRequired(g),"initSegment"!==g.sn){const T=f[g.sn-u.startSN-1];T&&T.cc===g.cc&&"NOT_LOADED"===this.fragmentTracker.getState(T)&&(g=T)}"NOT_LOADED"===this.fragmentTracker.getState(g)&&this.loadFragment(g,r,a)}}else this.state="IDLE"}getMaxBufferLength(e){const t=super.getMaxBufferLength();return e?Math.max(t,e):t}loadFragment(e,t,r){this.fragCurrent=e,"initSegment"===e.sn?this._loadInitSegment(e,t):(this.startFragRequested=!0,super.loadFragment(e,t,r))}get mediaBufferTimeRanges(){return new eB(this.tracksBuffered[this.currentTrackId]||[])}},subtitleTrackController:class extends xf{constructor(e){super(e,"[subtitle-track-controller]"),this.media=null,this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.trackChangeListener=()=>this.onTextTracksChanged(),this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes(this.trackId)}registerListeners(){const{hls:e}=this;e.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.MANIFEST_PARSED,this.onManifestParsed,this),e.on(y.LEVEL_LOADING,this.onLevelLoading,this),e.on(y.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(y.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(y.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.MANIFEST_PARSED,this.onManifestParsed,this),e.off(y.LEVEL_LOADING,this.onLevelLoading,this),e.off(y.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(y.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(y.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,e)}onMediaDetaching(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),Vf(this.media.textTracks).forEach(t=>{Ks(t)}),this.subtitleTrack=-1,this.media=null)}onManifestLoading(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:r,details:s}=t,{trackId:i}=this,o=this.tracksInGroup[i];if(!o)return void this.warn(`Invalid subtitle track id ${r}`);const a=o.details;o.details=t.details,this.log(`subtitle track ${r} loaded [${s.startSN}-${s.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(null==t||!t.textGroupIds)return;const r=t.textGroupIds[t.urlId],s=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;if(this.groupId!==r){const i=this.tracks.filter(l=>!r||l.groupId===r);this.tracksInGroup=i;const o=this.findTrackId(null==s?void 0:s.name)||this.findTrackId();this.groupId=r||null;const a={subtitleTracks:i};this.log(`Updating subtitle tracks, ${i.length} track(s) found in "${r}" group-id`),this.hls.trigger(y.SUBTITLE_TRACKS_UPDATED,a),-1!==o&&this.setSubtitleTrack(o,s)}else this.shouldReloadPlaylist(s)&&this.setSubtitleTrack(this.trackId,s)}findTrackId(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const s=t[r];if((!this.selectDefaultTrack||s.default)&&(!e||e===s.name))return s.id}return-1}onError(e,t){t.fatal||!t.context||"subtitleTrack"===t.context.type&&t.context.id===this.trackId&&t.context.groupId===this.groupId&&this.checkRetry(t)}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e,this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0)}loadPlaylist(e){super.loadPlaylist();const t=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(t)){const r=t.id,s=t.groupId;let i=t.url;if(e)try{i=e.addDirectives(i)}catch(o){this.warn(`Could not construct new URL with HLS Delivery Directives: ${o}`)}this.log(`Loading subtitle playlist for id ${r}`),this.hls.trigger(y.SUBTITLE_TRACK_LOADING,{url:i,id:r,groupId:s,deliveryDirectives:e||null})}}toggleTrackModes(e){const{media:t,trackId:r}=this;if(!t)return;const s=Vf(t.textTracks),i=s.filter(a=>a.groupId===this.groupId);if(-1===e)[].slice.call(s).forEach(a=>{a.mode="disabled"});else{const a=i[r];a&&(a.mode="disabled")}const o=i[e];o&&(o.mode=this.subtitleDisplay?"showing":"hidden")}setSubtitleTrack(e,t){var r;const s=this.tracksInGroup;if(!this.media)return void(this.queuedDefaultTrack=e);if(this.trackId!==e&&this.toggleTrackModes(e),this.trackId===e&&(-1===e||null!=(r=s[e])&&r.details)||e<-1||e>=s.length)return;this.clearTimer();const i=s[e];if(this.log(`Switching to subtitle-track ${e}`+(i?` "${i.name}" lang:${i.lang} group:${i.groupId}`:"")),this.trackId=e,i){const{id:o,groupId:a="",name:l,type:c,url:u}=i;this.hls.trigger(y.SUBTITLE_TRACK_SWITCH,{id:o,groupId:a,name:l,type:c,url:u});const d=this.switchParams(i.url,null==t?void 0:t.details);this.loadPlaylist(d)}else this.hls.trigger(y.SUBTITLE_TRACK_SWITCH,{id:e})}onTextTracksChanged(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let e=-1;const t=Vf(this.media.textTracks);for(let r=0;r<t.length;r++)if("hidden"===t[r].mode)e=r;else if("showing"===t[r].mode){e=r;break}this.subtitleTrack!==e&&(this.subtitleTrack=e)}},timelineController:class{constructor(e){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){const t=new bl(this,"textTrack1"),r=new bl(this,"textTrack2"),s=new bl(this,"textTrack3"),i=new bl(this,"textTrack4");this.cea608Parser1=new Av(1,t,r),this.cea608Parser2=new Av(3,s,i)}e.on(y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(y.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(y.FRAG_LOADING,this.onFragLoading,this),e.on(y.FRAG_LOADED,this.onFragLoaded,this),e.on(y.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(y.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(y.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(y.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(y.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(y.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(y.FRAG_LOADING,this.onFragLoading,this),e.off(y.FRAG_LOADED,this.onFragLoaded,this),e.off(y.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(y.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(y.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(y.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(y.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null}addCues(e,t,r,s,i){let o=!1;for(let a=i.length;a--;){const l=i[a],c=IB(l[0],l[1],t,r);if(c>=0&&(l[0]=Math.min(l[0],t),l[1]=Math.max(l[1],r),o=!0,c/(r-t)>.5))return}if(o||i.push([t,r]),this.config.renderTextTracksNatively)this.Cues.newCue(this.captionsTracks[e],t,r,s);else{const a=this.Cues.newCue(null,t,r,s);this.hls.trigger(y.CUES_PARSED,{type:"captions",cues:a,track:e})}}onInitPtsFound(e,{frag:t,id:r,initPTS:s,timescale:i}){const{unparsedVttFrags:o}=this;"main"===r&&(this.initPTS[t.cc]={baseTime:s,timescale:i}),o.length&&(this.unparsedVttFrags=[],o.forEach(a=>{this.onFragLoaded(y.FRAG_LOADED,a)}))}getExistingTrack(e){const{media:t}=this;if(t)for(let r=0;r<t.textTracks.length;r++){const s=t.textTracks[r];if(s[e])return s}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:r,media:s}=this,{label:i,languageCode:o}=t[e],a=this.getExistingTrack(e);if(a)r[e]=a,Ks(r[e]),PD(r[e],s);else{const l=this.createTextTrack("captions",i,o);l&&(l[e]=!0,r[e]=l)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const s={_id:e,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=s,this.hls.trigger(y.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[s]})}createTextTrack(e,t,r){const s=this.media;if(s)return s.addTextTrack(e,t,r)}onMediaAttaching(e,t){this.media=t.media,this._cleanTracks()}onMediaDetaching(){const{captionsTracks:e}=this;Object.keys(e).forEach(t=>{Ks(e[t]),delete e[t]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let r=0;r<t.length;r++)Ks(t[r])}onSubtitleTracksUpdated(e,t){const r=t.subtitleTracks||[],s=r.some(i=>i.textCodec===Yf);if(this.config.enableWebVTT||s&&this.config.enableIMSC1){if(Dv(this.tracks,r))return void(this.tracks=r);if(this.textTracks=[],this.tracks=r,this.config.renderTextTracksNatively){const o=this.media?this.media.textTracks:null;this.tracks.forEach((a,l)=>{let c;if(o&&l<o.length){let u=null;for(let d=0;d<o.length;d++)if(SB(o[d],a)){u=o[d];break}u&&(c=u)}if(c)Ks(c);else{const u=this._captionsOrSubtitlesFromCharacteristics(a);c=this.createTextTrack(u,a.name,a.lang),c&&(c.mode="disabled")}c&&(c.groupId=a.groupId,this.textTracks.push(c))})}else if(this.tracks.length){const o=this.tracks.map(a=>({label:a.name,kind:a.type.toLowerCase(),default:a.default,subtitleTrack:a}));this.hls.trigger(y.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:o})}}}_captionsOrSubtitlesFromCharacteristics(e){if(e.attrs.CHARACTERISTICS){const t=/transcribes-spoken-dialog/gi.test(e.attrs.CHARACTERISTICS),r=/describes-music-and-sound/gi.test(e.attrs.CHARACTERISTICS);if(t&&r)return"captions"}return"subtitles"}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(r=>{const s=/(?:CC|SERVICE)([1-4])/.exec(r.instreamId);if(!s)return;const o=this.captionsProperties[`textTrack${s[1]}`];!o||(o.label=r.name,r.lang&&(o.languageCode=r.lang),o.media=r)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return null==t?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){const{cea608Parser1:r,cea608Parser2:s,lastSn:i,lastPartIndex:o}=this;if(this.enabled&&r&&s&&"main"===t.frag.type){var a,l;const c=t.frag.sn,u=null!=(a=null==t||null==(l=t.part)?void 0:l.index)?a:-1;c===i+1||c===i&&u===o+1||(r.reset(),s.reset()),this.lastSn=c,this.lastPartIndex=u}}onFragLoaded(e,t){const{frag:r,payload:s}=t;if("subtitle"===r.type)if(s.byteLength){const i=r.decryptdata,o="stats"in t;if(null==i||!i.encrypted||o){const a=this.tracks[r.level],l=this.vttCCs;l[r.cc]||(l[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),a&&a.textCodec===Yf?this._parseIMSC1(r,s):this._parseVTTs(t)}}else this.hls.trigger(y.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const r=this.hls;Nv(t,this.initPTS[e.cc],s=>{this._appendCues(s,e.level),r.trigger(y.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},s=>{v.log(`Failed to parse IMSC1: ${s}`),r.trigger(y.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:s})})}_parseVTTs(e){var t;const{frag:r,payload:s}=e,{initPTS:i,unparsedVttFrags:o}=this,a=i.length-1;if(!i[r.cc]&&-1===a)return void o.push(e);const l=this.hls;!function(n,e,t,r,s,i,o){const a=new gB,l=kn(new Uint8Array(n)).trim().replace(mB,"\n").split("\n"),c=[],u=e?function(n,e=1){return Mf(n,9e4,1/e)}(e.baseTime,e.timescale):0;let p,d="00:00.000",f=0,h=0,g=!0;a.oncue=function(m){const E=t[r];let T=t.ccOffset;const D=(f-u)/9e4;if(null!=E&&E.new&&(void 0!==h?T=t.ccOffset=E.start:function(e,t,r){let s=e[t],i=e[s.prevCC];if(!i||!i.new&&s.new)return e.ccOffset=e.presentationOffset=s.start,void(s.new=!1);for(;null!=(o=i)&&o.new;){var o;e.ccOffset+=s.start-i.start,s.new=!1,s=i,i=e[s.prevCC]}e.presentationOffset=r}(t,r,D)),D){if(!e)return void(p=new Error("Missing initPTS for VTT MPEGTS"));T=D-t.presentationOffset}const x=m.endTime-m.startTime,_=zt(9e4*(m.startTime+T-h),9e4*s)/9e4;m.startTime=Math.max(_,0),m.endTime=Math.max(_+x,0);const w=m.text.trim();m.text=decodeURIComponent(encodeURIComponent(w)),m.id||(m.id=Wf(m.startTime,m.endTime,w)),m.endTime>0&&c.push(m)},a.onparsingerror=function(m){p=m},a.onflush=function(){p?o(p):i(c)},l.forEach(m=>{if(g){if(Gf(m,"X-TIMESTAMP-MAP=")){g=!1,m.slice(16).split(",").forEach(E=>{Gf(E,"LOCAL:")?d=E.slice(6):Gf(E,"MPEGTS:")&&(f=parseInt(E.slice(7)))});try{h=function(e){let t=parseInt(e.slice(-3));const r=parseInt(e.slice(-6,-4)),s=parseInt(e.slice(-9,-7)),i=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!(O(t)&&O(r)&&O(s)&&O(i)))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*r,t+=6e4*s,t+=36e5*i,t}(d)/1e3}catch(E){p=E}return}""===m&&(g=!1)}a.parse(m+"\n")}),a.flush()}(null!=(t=r.initSegment)&&t.data?Gr(r.initSegment.data,new Uint8Array(s)):s,this.initPTS[r.cc],this.vttCCs,r.cc,r.start,u=>{this._appendCues(u,r.level),l.trigger(y.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:r})},u=>{const d="Missing initPTS for VTT MPEGTS"===u.message;d?o.push(e):this._fallbackToIMSC1(r,s),v.log(`Failed to parse VTT cue: ${u}`),!(d&&a>r.cc)&&l.trigger(y.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:u})})}_fallbackToIMSC1(e,t){const r=this.tracks[e.level];r.textCodec||Nv(t,this.initPTS[e.cc],()=>{r.textCodec=Yf,this._parseIMSC1(e,t)},()=>{r.textCodec="wvtt"})}_appendCues(e,t){const r=this.hls;if(this.config.renderTextTracksNatively){const s=this.textTracks[t];if(!s||"disabled"===s.mode)return;e.forEach(i=>FD(s,i))}else{const s=this.tracks[t];if(!s)return;r.trigger(y.CUES_PARSED,{type:"subtitles",cues:e,track:s.default?"default":"subtitles"+t})}}onFragDecrypted(e,t){const{frag:r}=t;"subtitle"===r.type&&this.onFragLoaded(y.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){const{cea608Parser1:r,cea608Parser2:s}=this;if(!this.enabled||!r||!s)return;const{frag:i,samples:o}=t;if("main"!==i.type||"NONE"!==this.closedCaptionsForLevel(i))for(let a=0;a<o.length;a++){const l=o[a].bytes;if(l){const c=this.extractCea608Data(l);r.addData(o[a].pts,c[0]),s.addData(o[a].pts,c[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:r,endOffsetSubtitles:s,type:i}){const{media:o}=this;if(o&&!(o.currentTime<r)){if(!i||"video"===i){const{captionsTracks:a}=this;Object.keys(a).forEach(l=>gf(a[l],t,r))}if(this.config.renderTextTracksNatively&&0===t&&void 0!==s){const{textTracks:a}=this;Object.keys(a).forEach(l=>gf(a[l],t,s))}}}extractCea608Data(e){const t=[[],[]],r=31&e[0];let s=2;for(let i=0;i<r;i++){const o=e[s++],a=127&e[s++],l=127&e[s++];if((0!==a||0!==l)&&0!=(4&o)){const u=3&o;(0===u||1===u)&&(t[u].push(a),t[u].push(l))}}return t}},audioStreamController:class extends Af{constructor(e,t,r){super(e,t,r,"[audio-stream-controller]","audio"),this.videoBuffer=null,this.videoTrackCC=-1,this.waitingVideoCC=-1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null}_registerListeners(){const{hls:e}=this;e.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.LEVEL_LOADED,this.onLevelLoaded,this),e.on(y.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(y.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(y.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(y.ERROR,this.onError,this),e.on(y.BUFFER_RESET,this.onBufferReset,this),e.on(y.BUFFER_CREATED,this.onBufferCreated,this),e.on(y.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(y.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(y.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.LEVEL_LOADED,this.onLevelLoaded,this),e.off(y.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(y.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(y.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(y.ERROR,this.onError,this),e.off(y.BUFFER_RESET,this.onBufferReset,this),e.off(y.BUFFER_CREATED,this.onBufferCreated,this),e.off(y.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(y.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(y.FRAG_BUFFERED,this.onFragBuffered,this)}onInitPtsFound(e,{frag:t,id:r,initPTS:s,timescale:i}){if("main"===r){const o=t.cc;this.initPTS[t.cc]={baseTime:s,timescale:i},this.log(`InitPTS for cc: ${o} found from main: ${s}`),this.videoTrackCC=o,"WAITING_INIT_PTS"===this.state&&this.tick()}}startLoad(e){if(!this.levels)return this.startPosition=e,void(this.state="STOPPED");const t=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),t>0&&-1===e?(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t,this.state="IDLE"):(this.loadedmetadata=!1,this.state="WAITING_TRACK"),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}doTick(){switch(this.state){case"IDLE":this.doTickIdle();break;case"WAITING_TRACK":{var e;const{levels:r,trackId:s}=this,i=null==r||null==(e=r[s])?void 0:e.details;if(i){if(this.waitForCdnTuneIn(i))break;this.state="WAITING_INIT_PTS"}break}case"FRAG_LOADING_WAITING_RETRY":{var t;const r=performance.now(),s=this.retryDate;(!s||r>=s||null!=(t=this.media)&&t.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state="IDLE");break}case"WAITING_INIT_PTS":{const r=this.waitingData;if(r){const{frag:s,part:i,cache:o,complete:a}=r;if(void 0!==this.initPTS[s.cc]){this.waitingData=null,this.waitingVideoCC=-1,this.state="FRAG_LOADING";const c={frag:s,part:i,payload:o.flush(),networkDetails:null};this._handleFragmentLoadProgress(c),a&&super._handleFragmentLoadComplete(c)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log(`Waiting fragment cc (${s.cc}) cancelled because video is at cc ${this.videoTrackCC}`),this.clearWaitingFragment();else{const l=this.getLoadPosition(),c=Ce.bufferInfo(this.mediaBuffer,l,this.config.maxBufferHole);_f(c.end,this.config.maxFragLookUpTolerance,s)<0&&(this.log(`Waiting fragment cc (${s.cc}) @ ${s.start} cancelled because another fragment at ${c.end} is needed`),this.clearWaitingFragment())}}else this.state="IDLE"}}this.onTickEnd()}clearWaitingFragment(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state="IDLE")}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){const{media:e}=this;null==e||!e.readyState||(this.lastCurrentTime=e.currentTime)}doTickIdle(){const{hls:e,levels:t,media:r,trackId:s}=this;if(null==t||!t[s]||!r&&(this.startFragRequested||!e.config.startFragPrefetch))return;const o=t[s],a=o.details;if(!a||a.live&&this.levelLastLoaded!==s||this.waitForCdnTuneIn(a))return void(this.state="WAITING_TRACK");const l=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&l&&(this.bufferFlushed=!1,this.afterBufferFlushed(l,"audio","audio"));const c=this.getFwdBufferInfo(l,"audio");if(null===c)return;const{bufferedTrack:u,switchingTrack:d}=this;if(!d&&this._streamEnded(c,a))return e.trigger(y.BUFFER_EOS,{type:"audio"}),void(this.state="ENDED");const f=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,"main"),h=c.len,p=this.getMaxBufferLength(null==f?void 0:f.len);if(h>=p&&!d)return;const m=a.fragments[0].start;let E=c.end;if(d&&r){const _=this.getLoadPosition();u&&d.attrs!==u.attrs&&(E=_),a.PTSKnown&&_<m&&(c.end>m||c.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),r.currentTime=m+.05)}let T=this.getNextFragment(E,a),D=!1;if(T&&this.isLoopLoading(T,E)&&(D=!!T.gap,T=this.getNextFragmentLoopLoading(T,a,c,"main",p)),!T)return void(this.bufferFlushed=!0);const x=f&&T.start>f.end+a.targetduration;if(x||(null==f||!f.len)&&c.len){const _=this.getAppendedFrag(T.start,"main");if(null===_||(D||(D=!!_.gap||!!x&&0===f.len),x&&!D||D&&c.nextStart&&c.nextStart<_.end))return}this.loadFragment(T,o,E)}getMaxBufferLength(e){const t=super.getMaxBufferLength();return e?Math.min(Math.max(t,e),this.config.maxMaxBufferLength):t}onMediaDetaching(){this.videoBuffer=null,super.onMediaDetaching()}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(r=>new ho(r))}onAudioTrackSwitching(e,t){const r=!!t.url;this.trackId=t.id;const{fragCurrent:s}=this;s&&(s.abortRequests(),this.removeUnbufferedFrags(s.start)),this.resetLoadingState(),r?this.setInterval(100):this.resetTransmuxer(),r?(this.switchingTrack=t,this.state="IDLE"):(this.switchingTrack=null,this.bufferedTrack=t,this.state="STOPPED"),this.tick()}onManifestLoading(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1}onLevelLoaded(e,t){this.mainDetails=t.details,null!==this.cachedTrackLoadedData&&(this.hls.trigger(y.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)}onAudioTrackLoaded(e,t){var r;if(null==this.mainDetails)return void(this.cachedTrackLoadedData=t);const{levels:s}=this,{details:i,id:o}=t;if(!s)return void this.warn(`Audio tracks were reset while loading level ${o}`);this.log(`Track ${o} loaded [${i.startSN},${i.endSN}]${i.lastPartSn?`[part-${i.lastPartSn}-${i.lastPartIndex}]`:""},duration:${i.totalduration}`);const a=s[o];let l=0;if(i.live||null!=(r=a.details)&&r.live){this.checkLiveUpdate(i);const c=this.mainDetails;if(i.deltaUpdateFailed||!c)return;!a.details&&i.hasProgramDateTime&&c.hasProgramDateTime?(QD(i,c),l=i.fragments[0].start):l=this.alignPlaylists(i,a.details)}a.details=i,this.levelLastLoaded=o,!this.startFragRequested&&(this.mainDetails||!i.live)&&this.setStartPosition(a.details,l),"WAITING_TRACK"===this.state&&!this.waitForCdnTuneIn(i)&&(this.state="IDLE"),this.tick()}_handleFragmentLoadProgress(e){var t;const{frag:r,part:s,payload:i}=e,{config:o,trackId:a,levels:l}=this;if(!l)return void this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);const c=l[a];if(!c)return void this.warn("Audio track is undefined on fragment load progress");const u=c.details;if(!u)return this.warn("Audio track details undefined on fragment load progress"),void this.removeUnbufferedFrags(r.start);const d=o.defaultAudioCodec||c.audioCodec||"mp4a.40.2";let f=this.transmuxer;f||(f=this.transmuxer=new yv(this.hls,"audio",this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const h=this.initPTS[r.cc],p=null==(t=r.initSegment)?void 0:t.data;if(void 0!==h){const g=!1,m=s?s.index:-1,T=new bf(r.level,r.sn,r.stats.chunkCount,i.byteLength,m,-1!==m);f.push(i,p,d,"",r,s,u.totalduration,g,T,h)}else{this.log(`Unknown video PTS for cc ${r.cc}, waiting for video PTS before demuxing audio frag ${r.sn} of [${u.startSN} ,${u.endSN}],track ${a}`);const{cache:g}=this.waitingData=this.waitingData||{frag:r,part:s,cache:new Ev,complete:!1};g.push(new Uint8Array(i)),this.waitingVideoCC=this.videoTrackCC,this.state="WAITING_INIT_PTS"}}_handleFragmentLoadComplete(e){this.waitingData?this.waitingData.complete=!0:super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1}onBufferCreated(e,t){const r=t.tracks.audio;r&&(this.mediaBuffer=r.buffer||null),t.tracks.video&&(this.videoBuffer=t.tracks.video.buffer||null)}onFragBuffered(e,t){const{frag:r,part:s}=t;if("audio"===r.type)if(this.fragContextChanged(r))this.warn(`Fragment ${r.sn}${s?" p: "+s.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);else{if("initSegment"!==r.sn){this.fragPrevious=r;const i=this.switchingTrack;i&&(this.bufferedTrack=i,this.switchingTrack=null,this.hls.trigger(y.AUDIO_TRACK_SWITCHED,Dt({},i)))}this.fragBufferedComplete(r,s)}else if(!this.loadedmetadata&&"main"===r.type){const i=this.videoBuffer||this.media;i&&Ce.getBuffered(i).length&&(this.loadedmetadata=!0)}}onError(e,t){var r;if(t.fatal)this.state="ERROR";else switch(t.details){case C.FRAG_GAP:case C.FRAG_PARSING_ERROR:case C.FRAG_DECRYPT_ERROR:case C.FRAG_LOAD_ERROR:case C.FRAG_LOAD_TIMEOUT:case C.KEY_LOAD_ERROR:case C.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError("audio",t);break;case C.AUDIO_TRACK_LOAD_ERROR:case C.AUDIO_TRACK_LOAD_TIMEOUT:case C.LEVEL_PARSING_ERROR:!t.levelRetry&&"WAITING_TRACK"===this.state&&"audioTrack"===(null==(r=t.context)?void 0:r.type)&&(this.state="IDLE");break;case C.BUFFER_FULL_ERROR:if(!t.parent||"audio"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case C.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}onBufferFlushed(e,{type:t}){"audio"===t&&(this.bufferFlushed=!0,"ENDED"===this.state&&(this.state="IDLE"))}_handleTransmuxComplete(e){var t;const r="audio",{hls:s}=this,{remuxResult:i,chunkMeta:o}=e,a=this.getCurrentContext(o);if(!a)return void this.resetWhenMissingContext(o);const{frag:l,part:c,level:u}=a,{details:d}=u,{audio:f,text:h,id3:p,initSegment:g}=i;if(!this.fragContextChanged(l)&&d){if(this.state="PARSING",this.switchingTrack&&f&&this.completeAudioSwitch(this.switchingTrack),null!=g&&g.tracks){const m=l.initSegment||l;this._bufferInitSegment(g.tracks,m,o),s.trigger(y.FRAG_PARSING_INIT_SEGMENT,{frag:m,id:r,tracks:g.tracks})}if(f){const{startPTS:m,endPTS:E,startDTS:T,endDTS:D}=f;c&&(c.elementaryStreams.audio={startPTS:m,endPTS:E,startDTS:T,endDTS:D}),l.setElementaryStreamInfo("audio",m,E,T,D),this.bufferFragmentData(f,l,c,o)}if(null!=p&&null!=(t=p.samples)&&t.length){const m=Ye({id:r,frag:l,details:d},p);s.trigger(y.FRAG_PARSING_METADATA,m)}if(h){const m=Ye({id:r,frag:l,details:d},h);s.trigger(y.FRAG_PARSING_USERDATA,m)}}else this.fragmentTracker.removeFragment(l)}_bufferInitSegment(e,t,r){if("PARSING"!==this.state)return;e.video&&delete e.video;const s=e.audio;if(!s)return;s.levelCodec=s.codec,s.id="audio",this.log(`Init audio buffer, container:${s.container}, codecs[parsed]=[${s.codec}]`),this.hls.trigger(y.BUFFER_CODECS,e);const i=s.initSegment;null!=i&&i.byteLength&&this.hls.trigger(y.BUFFER_APPENDING,{type:"audio",frag:t,part:null,chunkMeta:r,parent:t.type,data:i}),this.tick()}loadFragment(e,t,r){const s=this.fragmentTracker.getState(e);var i;this.fragCurrent=e,this.switchingTrack||"NOT_LOADED"===s||"PARTIAL"===s?"initSegment"===e.sn?this._loadInitSegment(e,t):null!=(i=t.details)&&i.live&&!this.initPTS[e.cc]?(this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state="WAITING_INIT_PTS"):(this.startFragRequested=!0,super.loadFragment(e,t,r)):this.clearTrackerIfNeeded(e)}completeAudioSwitch(e){const{hls:t,media:r,bufferedTrack:s}=this,i=null==s?void 0:s.attrs,o=e.attrs;r&&i&&(i.CHANNELS!==o.CHANNELS||i.NAME!==o.NAME||i.LANGUAGE!==o.LANGUAGE)&&(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio")),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(y.AUDIO_TRACK_SWITCHED,Dt({},e))}},audioTrackController:class extends xf{constructor(e){super(e,"[audio-track-controller]"),this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.MANIFEST_PARSED,this.onManifestParsed,this),e.on(y.LEVEL_LOADING,this.onLevelLoading,this),e.on(y.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(y.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(y.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.MANIFEST_PARSED,this.onManifestParsed,this),e.off(y.LEVEL_LOADING,this.onLevelLoading,this),e.off(y.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(y.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(y.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:r,groupId:s,details:i}=t,o=this.tracksInGroup[r];if(!o||o.groupId!==s)return void this.warn(`Track with id:${r} and group:${s} not found in active group ${o.groupId}`);const a=o.details;o.details=t.details,this.log(`audio-track ${r} "${o.name}" lang:${o.lang} group:${s} loaded [${i.startSN}-${i.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(null==t||!t.audioGroupIds)return;const r=t.audioGroupIds[t.urlId];if(this.groupId!==r){this.groupId=r||null;const s=this.tracks.filter(o=>!r||o.groupId===r);this.selectDefaultTrack&&!s.some(o=>o.default)&&(this.selectDefaultTrack=!1),this.tracksInGroup=s;const i={audioTracks:s};this.log(`Updating audio tracks, ${s.length} track(s) found in group:${r}`),this.hls.trigger(y.AUDIO_TRACKS_UPDATED,i),this.selectInitialTrack()}else this.shouldReloadPlaylist(this.currentTrack)&&this.setAudioTrack(this.trackId)}onError(e,t){t.fatal||!t.context||"audioTrack"===t.context.type&&t.context.id===this.trackId&&t.context.groupId===this.groupId&&(this.requestScheduled=-1,this.checkRetry(t))}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length)return void this.warn("Invalid id passed to audio-track controller");this.clearTimer();const r=this.currentTrack,s=t[e],{groupId:i,name:o}=s;if(this.log(`Switching to audio-track ${e} "${o}" lang:${s.lang} group:${i}`),this.trackId=e,this.currentTrack=s,this.selectDefaultTrack=!1,this.hls.trigger(y.AUDIO_TRACK_SWITCHING,Dt({},s)),s.details&&!s.details.live)return;const a=this.switchParams(s.url,null==r?void 0:r.details);this.loadPlaylist(a)}selectInitialTrack(){const e=this.tracksInGroup,t=this.findTrackId(this.currentTrack)|this.findTrackId(null);if(-1!==t)this.setAudioTrack(t);else{const r=new Error(`No track found for running audio group-ID: ${this.groupId} track count: ${e.length}`);this.warn(r.message),this.hls.trigger(y.ERROR,{type:H.MEDIA_ERROR,details:C.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:r})}}findTrackId(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const s=t[r];if((!this.selectDefaultTrack||s.default)&&(!e||void 0!==e.attrs["STABLE-RENDITION-ID"]&&e.attrs["STABLE-RENDITION-ID"]===s.attrs["STABLE-RENDITION-ID"]||e.name===s.name&&e.lang===s.lang))return s.id}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(t)){const r=t.id,s=t.groupId;let i=t.url;if(e)try{i=e.addDirectives(i)}catch(o){this.warn(`Could not construct new URL with HLS Delivery Directives: ${o}`)}this.log(`loading audio-track playlist ${r} "${t.name}" lang:${t.lang} group:${s}`),this.clearTimer(),this.hls.trigger(y.AUDIO_TRACK_LOADING,{url:i,id:r,groupId:s,deliveryDirectives:e||null})}}},emeController:wB,cmcdController:Dr,contentSteeringController:class{constructor(e){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.log=v.log.bind(v,"[content-steering]:"),this.registerListeners()}registerListeners(){const e=this.hls;e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(y.MANIFEST_PARSED,this.onManifestParsed,this),e.on(y.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;!e||(e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(y.MANIFEST_PARSED,this.onManifestParsed,this),e.off(y.ERROR,this.onError,this))}startLoad(){if(this.started=!0,self.clearTimeout(this.reloadTimer),this.enabled&&this.uri)if(this.updated){const e=Math.max(1e3*this.timeToLoad-(performance.now()-this.updated),0);this.scheduleRefresh(this.uri,e)}else this.loadSteeringManifest(this.uri)}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),self.clearTimeout(this.reloadTimer)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(r=>r!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:r}=t;null!==r&&(this.pathwayId=r.pathwayId,this.uri=r.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:r}=t;if(2===(null==r?void 0:r.action)&&1===r.flags){let s=this.pathwayPriority;const i=this.pathwayId;this.penalizedPathways[i]||(this.penalizedPathways[i]=performance.now()),!s&&this.levels&&(s=this.levels.reduce((o,a)=>(-1===o.indexOf(a.pathwayId)&&o.push(a.pathwayId),o),[])),s&&s.length>1&&(this.updatePathwayPriority(s),r.resolved=this.pathwayId!==i)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(0===t.length){const r=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${r}"`),t=this.getLevelsForPathway(r),this.pathwayId=r}return t.length!==e.length?(this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t):e}getLevelsForPathway(e){return null===this.levels?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){let t;this.pathwayPriority=e;const r=this.penalizedPathways,s=performance.now();Object.keys(r).forEach(i=>{s-r[i]>3e5&&delete r[i]});for(let i=0;i<e.length;i++){const o=e[i];if(r[o])continue;if(o===this.pathwayId)return;const a=this.hls.nextLoadLevel,l=this.hls.levels[a];if(t=this.getLevelsForPathway(o),t.length>0){this.log(`Setting Pathway to "${o}"`),this.pathwayId=o,this.hls.trigger(y.LEVELS_UPDATED,{levels:t});const c=this.hls.levels[a];l&&c&&this.levels&&(c.attrs["STABLE-VARIANT-ID"]!==l.attrs["STABLE-VARIANT-ID"]&&c.bitrate!==l.bitrate&&this.log(`Unstable Pathways change from bitrate ${l.bitrate} to ${c.bitrate}`),this.hls.nextLoadLevel=a);break}}}clonePathways(e){const t=this.levels;if(!t)return;const r={},s={};e.forEach(i=>{const{ID:o,"BASE-ID":a,"URI-REPLACEMENT":l}=i;if(t.some(u=>u.pathwayId===o))return;const c=this.getLevelsForPathway(a).map(u=>{const d=Ye({},u);d.details=void 0,d.url=Hv(u.uri,u.attrs["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",l);const f=new Le(u.attrs);f["PATHWAY-ID"]=o;const h=f.AUDIO&&`${f.AUDIO}_clone_${o}`,p=f.SUBTITLES&&`${f.SUBTITLES}_clone_${o}`;h&&(r[f.AUDIO]=h,f.AUDIO=h),p&&(s[f.SUBTITLES]=p,f.SUBTITLES=p),d.attrs=f;const g=new ho(d);return yl(g,"audio",h),yl(g,"text",p),g});t.push(...c),$v(this.audioTracks,r,l,o),$v(this.subtitleTracks,s,l,o)})}loadSteeringManifest(e){const t=this.hls.config,r=t.loader;let s;this.loader&&this.loader.destroy(),this.loader=new r(t);try{s=new self.URL(e)}catch(u){return this.enabled=!1,void this.log(`Failed to parse Steering Manifest URI: ${e}`)}if("data:"!==s.protocol){const u=0|(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate);s.searchParams.set("_HLS_pathway",this.pathwayId),s.searchParams.set("_HLS_throughput",""+u)}const i={responseType:"json",url:s.href},o=t.steeringManifestLoadPolicy.default,a=o.errorRetry||o.timeoutRetry||{},l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},c={onSuccess:(u,d,f,h)=>{this.log(`Loaded steering manifest: "${s}"`);const p=u.data;if(1!==p.VERSION)return void this.log(`Steering VERSION ${p.VERSION} not supported!`);this.updated=performance.now(),this.timeToLoad=p.TTL;const{"RELOAD-URI":g,"PATHWAY-CLONES":m,"PATHWAY-PRIORITY":E}=p;if(g)try{this.uri=new self.URL(g,s).href}catch(T){return this.enabled=!1,void this.log(`Failed to parse Steering Manifest RELOAD-URI: ${g}`)}this.scheduleRefresh(this.uri||f.url),m&&this.clonePathways(m),E&&this.updatePathwayPriority(E)},onError:(u,d,f,h)=>{if(this.log(`Error loading steering manifest: ${u.code} ${u.text} (${d.url})`),this.stopLoad(),410===u.code)return this.enabled=!1,void this.log(`Steering manifest ${d.url} no longer available`);let p=1e3*this.timeToLoad;if(429!==u.code)this.scheduleRefresh(this.uri||d.url,p);else{const g=this.loader;if("function"==typeof(null==g?void 0:g.getResponseHeader)){const m=g.getResponseHeader("Retry-After");m&&(p=1e3*parseFloat(m))}this.log(`Steering manifest ${d.url} rate limited`)}},onTimeout:(u,d,f)=>{this.log(`Timeout loading steering manifest (${d.url})`),this.scheduleRefresh(this.uri||d.url)}};this.log(`Requesting steering manifest: ${s}`),this.loader.load(i,l,c)}scheduleRefresh(e,t=1e3*this.timeToLoad){self.clearTimeout(this.reloadTimer),this.reloadTimer=self.setTimeout(()=>{this.loadSteeringManifest(e)},t)}}});function Jf(n){return n&&"object"==typeof n?Array.isArray(n)?n.map(Jf):Object.keys(n).reduce((e,t)=>(e[t]=Jf(n[t]),e),{}):n}let Zf=(()=>{class n{static get version(){return"1.4.14"}static isSupported(){return function(){const n=hl();if(!n)return!1;const e=XD();return!(!n||"function"!=typeof n.isTypeSupported||!n.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')||e&&(!e.prototype||"function"!=typeof e.prototype.appendBuffer||"function"!=typeof e.prototype.remove))}()}static get Events(){return y}static get ErrorTypes(){return H}static get ErrorDetails(){return C}static get DefaultConfig(){return n.defaultConfig?n.defaultConfig:KB}static set DefaultConfig(t){n.defaultConfig=t}constructor(t={}){this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Of,this._autoLevelCapping=void 0,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,function(n,e){if(self.console&&!0===n||"object"==typeof n){!function(n,...e){e.forEach(function(t){co[t]=n[t]?n[t].bind(n):function(n){const e=self.console[n];return e?e.bind(self.console,`[${n}] >`):Hr}(t)})}(n,"debug","log","info","warn","error");try{co.log('Debug logs enabled for "Hls instance" in hls.js version 1.4.14')}catch(t){co=sf}}else co=sf}(t.debug||!1);const r=this.config=function(n,e){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==e.liveMaxLatencyDurationCount&&(void 0===e.liveSyncDurationCount||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==e.liveMaxLatencyDuration&&(void 0===e.liveSyncDuration||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const t=Jf(n),s=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return["manifest","level","frag"].forEach(i=>{const o=`${"level"===i?"playlist":i}LoadPolicy`,a=void 0===e[o],l=[];s.forEach(c=>{const u=`${i}Loading${c}`,d=e[u];if(void 0!==d&&a){l.push(u);const f=t[o].default;switch(e[o]={default:f},c){case"TimeOut":f.maxLoadTimeMs=d,f.maxTimeToFirstByteMs=d;break;case"MaxRetry":f.errorRetry.maxNumRetry=d,f.timeoutRetry.maxNumRetry=d;break;case"RetryDelay":f.errorRetry.retryDelayMs=d,f.timeoutRetry.retryDelayMs=d;break;case"MaxRetryTimeout":f.errorRetry.maxRetryDelayMs=d,f.timeoutRetry.maxRetryDelayMs=d}}}),l.length&&v.warn(`hls.js config: "${l.join('", "')}" setting(s) are deprecated, use "${o}": ${JSON.stringify(e[o])}`)}),Dt(Dt({},t),e)}(n.DefaultConfig,t);this.userConfig=t,this._autoLevelCapping=-1,r.progressive&&function(n){const e=n.loader;e!==Gv&&e!==jv?(v.log("[config]: Custom loader detected, cannot enable progressive streaming"),n.progressive=!1):function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(n){}return!1}()&&(n.loader=Gv,n.progressive=!0,n.enableSoftwareAES=!0,v.log("[config]: Progressive streaming enabled, using FetchLoader"))}(r);const{abrController:s,bufferController:i,capLevelController:o,errorController:a,fpsController:l}=r,c=new a(this),u=this.abrController=new s(this),d=this.bufferController=new i(this),f=this.capLevelController=new o(this),h=new l(this),p=new vN(this),g=new SN(this),m=r.contentSteeringController,E=m?new m(this):null,T=this.levelController=new HN(this,E),D=new jN(this),x=new KN(this.config),_=this.streamController=new WO(this,D,x);f.setStreamController(_),h.setStreamController(_);const w=[p,T,_];E&&w.splice(1,0,E),this.networkControllers=w;const S=[u,d,f,h,g,D];this.audioTrackController=this.createController(r.audioTrackController,w);const R=r.audioStreamController;R&&w.push(new R(this,D,x)),this.subtitleTrackController=this.createController(r.subtitleTrackController,w);const L=r.subtitleStreamController;L&&w.push(new L(this,D,x)),this.createController(r.timelineController,S),x.emeController=this.emeController=this.createController(r.emeController,S),this.cmcdController=this.createController(r.cmcdController,S),this.latencyController=this.createController(IN,S),this.coreComponents=S,w.push(c);const b=c.onErrorOut;"function"==typeof b&&this.on(y.ERROR,b,c)}createController(t,r){if(t){const s=new t(this);return r&&r.push(s),s}return null}on(t,r,s=this){this._emitter.on(t,r,s)}once(t,r,s=this){this._emitter.once(t,r,s)}removeAllListeners(t){this._emitter.removeAllListeners(t)}off(t,r,s=this,i){this._emitter.off(t,r,s,i)}listeners(t){return this._emitter.listeners(t)}emit(t,r,s){return this._emitter.emit(t,r,s)}trigger(t,r){if(this.config.debug)return this.emit(t,t,r);try{return this.emit(t,t,r)}catch(s){v.error("An internal error happened while handling event "+t+'. Error message: "'+s.message+'". Here is a stacktrace:',s),this.trigger(y.ERROR,{type:H.OTHER_ERROR,details:C.INTERNAL_EXCEPTION,fatal:!1,event:t,error:s})}return!1}listenerCount(t){return this._emitter.listenerCount(t)}destroy(){v.log("destroy"),this.trigger(y.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(r=>r.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(r=>r.destroy()),this.coreComponents.length=0;const t=this.config;t.xhrSetup=t.fetchSetup=void 0,this.userConfig=null}attachMedia(t){v.log("attachMedia"),this._media=t,this.trigger(y.MEDIA_ATTACHING,{media:t})}detachMedia(){v.log("detachMedia"),this.trigger(y.MEDIA_DETACHING,void 0),this._media=null}loadSource(t){this.stopLoad();const r=this.media,s=this.url,i=this.url=rf.buildAbsoluteURL(self.location.href,t,{alwaysNormalize:!0});v.log(`loadSource:${i}`),r&&s&&(s!==i||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(r)),this.trigger(y.MANIFEST_LOADING,{url:t})}startLoad(t=-1){v.log(`startLoad(${t})`),this.networkControllers.forEach(r=>{r.startLoad(t)})}stopLoad(){v.log("stopLoad"),this.networkControllers.forEach(t=>{t.stopLoad()})}swapAudioCodec(){v.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){v.log("recoverMediaError");const t=this._media;this.detachMedia(),t&&this.attachMedia(t)}removeLevel(t,r=0){this.levelController.removeLevel(t,r)}get levels(){return this.levelController.levels||[]}get currentLevel(){return this.streamController.currentLevel}set currentLevel(t){v.log(`set currentLevel:${t}`),this.loadLevel=t,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(t){v.log(`set nextLevel:${t}`),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(t){v.log(`set loadLevel:${t}`),this.levelController.manualLevel=t}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(t){this.levelController.nextLoadLevel=t}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(t){v.log(`set firstLevel:${t}`),this.levelController.firstLevel=t}get startLevel(){return this.levelController.startLevel}set startLevel(t){v.log(`set startLevel:${t}`),-1!==t&&(t=Math.max(t,this.minAutoLevel)),this.levelController.startLevel=t}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(t){const r=!!t;r!==this.config.capLevelToPlayerSize&&(r?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=r)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:t}=this.abrController;return t?t.getEstimate():NaN}get ttfbEstimate(){const{bwEstimator:t}=this.abrController;return t?t.getEstimateTTFB():NaN}set autoLevelCapping(t){this._autoLevelCapping!==t&&(v.log(`set autoLevelCapping:${t}`),this._autoLevelCapping=t)}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(t){Ef.indexOf(t)>-1&&(this._maxHdcpLevel=t)}get autoLevelEnabled(){return-1===this.levelController.manualLevel}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:t,config:{minAutoBitrate:r}}=this;if(!t)return 0;const s=t.length;for(let i=0;i<s;i++)if(t[i].maxBitrate>=r)return i;return 0}get maxAutoLevel(){const{levels:t,autoLevelCapping:r,maxHdcpLevel:s}=this;let i;if(i=-1===r&&t&&t.length?t.length-1:r,s)for(let o=i;o--;){const a=t[o].attrs["HDCP-LEVEL"];if(a&&a<=s)return o}return i}get nextAutoLevel(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)}set nextAutoLevel(t){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,t)}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get audioTracks(){const t=this.audioTrackController;return t?t.audioTracks:[]}get audioTrack(){const t=this.audioTrackController;return t?t.audioTrack:-1}set audioTrack(t){const r=this.audioTrackController;r&&(r.audioTrack=t)}get subtitleTracks(){const t=this.subtitleTrackController;return t?t.subtitleTracks:[]}get subtitleTrack(){const t=this.subtitleTrackController;return t?t.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(t){const r=this.subtitleTrackController;r&&(r.subtitleTrack=t)}get subtitleDisplay(){const t=this.subtitleTrackController;return!!t&&t.subtitleDisplay}set subtitleDisplay(t){const r=this.subtitleTrackController;r&&(r.subtitleDisplay=t)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(t){this.config.lowLatencyMode=t}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}}return n.defaultConfig=void 0,n})();const zB=["videoPlayer"];let QB=(()=>{class n{constructor(){this.usingFallback=!1,this.staticUrl="https://1875.space/pad=999/7104/mono.m3u8"}ngOnInit(){}ngAfterViewInit(){this.stream&&this.setupVideo()}setupVideo(){const t=this.videoPlayer.nativeElement,r=this.staticUrl;if(Zf.isSupported()){const s=new Zf;s.loadSource(r),s.attachMedia(t),s.on(Zf.Events.ERROR,()=>this.onVideoError())}else t.canPlayType("application/vnd.apple.mpegurl")?t.src=r:this.onVideoError()}onVideoError(){!this.usingFallback&&this.stream.link&&(this.usingFallback=!0,this.setupVideo())}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Co({type:n,selectors:[["app-video-player"]],viewQuery:function(t,r){if(1&t&&Jy(zB,5),2&t){let s;Xy(s=function(n,e){return n[19].queries[e].queryList}(A(),Vh()))&&(r.videoPlayer=s.first)}},inputs:{stream:"stream"},decls:5,vars:0,consts:[[1,"video-container"],[1,"live-badge"],["controls","","autoplay","","muted","",1,"video-player"],["videoPlayer",""]],template:function(t,r){1&t&&(pa(0,"div",0),pa(1,"div",1),d0(2,"LIVE"),ga(),Eu(3,"video",2,3),ga())},styles:[".video-container[_ngcontent-%COMP%]{position:relative;width:100%;max-width:800px;border:2px solid red;border-radius:10px;overflow:hidden;background-color:#000}.video-player[_ngcontent-%COMP%]{width:100%;height:auto;display:block}.live-badge[_ngcontent-%COMP%]{position:absolute;top:10px;left:10px;background-color:red;color:#fff;padding:4px 10px;font-weight:bold;font-size:12px;border-radius:4px}"]}),n})();function XB(n,e){1&n&&Eu(0,"app-video-player",1),2&n&&ha("stream",Vm().stream)}let JB=(()=>{class n{constructor(t){this.streamService=t,this.title="stream-app",this.stream=null}ngOnInit(){this.streamService.getStreams().subscribe(t=>{this.stream=t})}}return n.\u0275fac=function(t){return new(t||n)(ne(_k))},n.\u0275cmp=Co({type:n,selectors:[["app-root"]],decls:1,vars:1,consts:[[3,"stream",4,"ngIf"],[3,"stream"]],template:function(t,r){1&t&&function(n,e,t,r,s,i,o,a){const l=A(),c=ie(),u=n+20,d=c.firstCreatePass?function(n,e,t,r,s,i,o,a,l){const c=e.consts,u=hs(e,n,4,o||null,ar(c,a));Xc(e,t,u,ar(c,l)),No(e,u);const d=u.tViews=aa(2,u,r,s,i,e.directiveRegistry,e.pipeRegistry,null,e.schemas,c);return null!==e.queries&&(e.queries.template(e,u),d.queries=e.queries.embeddedTView(u)),u}(u,c,l,e,t,r,s,i,o):c.data[u];xn(d,!1);const f=l[J].createComment("");Jo(c,l,f,d),st(f,l),la(l,l[u]=Pg(f,l,f,d)),wo(d)&&zc(c,l,d),null!=o&&Qc(l,d,a)}(0,XB,1,1,"app-video-player",0),2&t&&ha("ngIf",r.stream)},directives:[TT,QB],styles:[".stream-container[_ngcontent-%COMP%]{margin:20px;padding:20px;border:1px solid #ddd;border-radius:8px}.video-streams[_ngcontent-%COMP%]{display:flex;grid-gap:20px;gap:20px;margin:20px 0}.stream-box[_ngcontent-%COMP%]{flex:1;border:1px solid #ccc;border-radius:5px;padding:15px;background-color:#f9f9f9}.video-player[_ngcontent-%COMP%]{width:100%;height:300px;background-color:#000}.stream-info[_ngcontent-%COMP%]{margin-top:15px;padding:10px;background-color:#f0f0f0;border-radius:5px}.stream-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:5px 0}h2[_ngcontent-%COMP%]{color:#333;margin-bottom:15px}h3[_ngcontent-%COMP%]{color:#666;margin-bottom:10px}"]}),n})(),ZB=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=vr({type:n,bootstrap:[JB]}),n.\u0275inj=Un({providers:[],imports:[[QF,vk]]}),n})();(function(){if(IE)throw new Error("Cannot enable prod mode after platform setup.");SE=!1})(),qF().bootstrapModule(ZB).catch(n=>console.error(n))}},Xs=>{Xs(Xs.s=370)}]);